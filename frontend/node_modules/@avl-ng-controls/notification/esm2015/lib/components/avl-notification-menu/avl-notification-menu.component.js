var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { NOTIFICATIONS_OVERFLOW_MENU } from './avl-notification-menu.consts';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "@avl-controls/ng-binders";
import * as i3 from "@ngx-translate/core";
import * as i4 from "../../pipes/prepare-notifications.pipe";
export class AvlNotificationMenuComponent {
    constructor() {
        this.open = false;
        this.openChange = new EventEmitter();
        this.openDetails = new EventEmitter();
        this.notificationStateChanged = new EventEmitter();
        this.markAllAsRead = new EventEmitter();
        this.markAllAsUnread = new EventEmitter();
        this.overflowMenuItems = [];
        this.numberOfUnreadNotifications = 0;
        this._notifications = [];
        this.overflowMenuHandlers = {
            markAllAsRead: () => {
                this.markAllAsRead.emit();
                this.numberOfUnreadNotifications = 0;
            },
            markAllAsUnread: () => {
                this.markAllAsUnread.emit();
                this.numberOfUnreadNotifications = this.notifications.length;
            },
            undefined: () => { }
        };
    }
    set notifications(notifications) {
        this.numberOfUnreadNotifications = notifications.filter(notif => !notif.read).length;
        this._notifications = notifications;
    }
    get notifications() {
        return this._notifications;
    }
    ngOnInit() {
        this.translateLabels();
    }
    ngAfterViewInit() {
        this.list.nativeElement.revertedList = true;
    }
    onNotificationStateChanged(event) {
        const notificationMenuItem = Object.assign({}, event.detail.value);
        const notification = Object.assign(Object.assign({}, notificationMenuItem), { read: notificationMenuItem.iconToggleValue });
        notification.read ? this.numberOfUnreadNotifications-- : this.numberOfUnreadNotifications++;
        this.notificationStateChanged.emit(notification);
        this.list.nativeElement.removeFocus();
    }
    onItemClicked(item) {
        this.overflowMenuHandlers[item.action]();
    }
    onOpenChanged(event) {
        if (!event.detail.value) {
            this.openChange.emit(false);
        }
    }
    onOverflowMenuClicked() {
        this.list.nativeElement.removeFocus();
    }
    onDetailsClicked() {
        this.open = false;
        this.openDetails.emit();
        this.openChange.emit(false);
    }
    /**Event fired when list item is clicked on
     * depending on the notification flag it opens in new tab
     */
    onListItemClicked(event) {
        const item = event.detail;
        if (item.link) {
            if (item.openInNewTab) {
                window.open(item.link, '_blank');
            }
            else {
                window.open(item.link, '_self');
            }
        }
    }
    translateLabels() {
        return __awaiter(this, void 0, void 0, function* () {
            if (!AvlLocalizationService || !AvlLocalizationService.translationService) {
                return;
            }
            this.overflowMenuItems = yield this.translateMenu(NOTIFICATIONS_OVERFLOW_MENU);
        });
    }
    translateMenu(menu) {
        return __awaiter(this, void 0, void 0, function* () {
            return yield Promise.all(menu.map((group) => __awaiter(this, void 0, void 0, function* () { return yield this.translateMenuGroup(group); })));
        });
    }
    translateMenuGroup(group) {
        return __awaiter(this, void 0, void 0, function* () {
            return {
                items: yield Promise.all(group.items.map((item) => __awaiter(this, void 0, void 0, function* () { return yield this.translateMenuItem(item); })))
            };
        });
    }
    translateMenuItem(item) {
        return __awaiter(this, void 0, void 0, function* () {
            const translateService = AvlLocalizationService.translationService;
            return Object.assign(Object.assign({}, item), { label: yield translateService.translate(item.label), sublabel: item.sublabel ? yield translateService.translate(item.sublabel) : null });
        });
    }
}
AvlNotificationMenuComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.3", ngImport: i0, type: AvlNotificationMenuComponent, deps: [], target: i0.ɵɵFactoryTarget.Component });
AvlNotificationMenuComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.0.3", type: AvlNotificationMenuComponent, selector: "avl-notification-menu", inputs: { open: "open", trigger: "trigger", notifications: "notifications" }, outputs: { openChange: "openChange", openDetails: "openDetails", notificationStateChanged: "notificationStateChanged", markAllAsRead: "markAllAsRead", markAllAsUnread: "markAllAsUnread" }, viewQueries: [{ propertyName: "list", first: true, predicate: ["list"], descendants: true }], ngImport: i0, template: "<avl-popup\r\n  [noCloseOnInsideClick]=\"true\"\r\n  [open]=\"open\"\r\n  [trigger]=\"trigger\"\r\n  (open-changed)=\"onOpenChanged($event)\"\r\n>\r\n  <div id=\"header\">\r\n    <div id=\"headerText\">\r\n      <span>{{ 'VizBox.NotificationMenu.Notifications' | translate }}</span>\r\n      <span *ngIf=\"numberOfUnreadNotifications\"> ({{ numberOfUnreadNotifications }}) </span>\r\n    </div>\r\n    <avl-overflow-menu (itemClicked)=\"onItemClicked($event)\" [items]=\"overflowMenuItems\">\r\n      <avl-icon-button\r\n        icon=\"more-vert\"\r\n        slot=\"trigger\"\r\n        (click)=\"onOverflowMenuClicked()\"\r\n      ></avl-icon-button>\r\n    </avl-overflow-menu>\r\n  </div>\r\n  <avl-list\r\n    #list\r\n    [rows]=\"notifications | prepareNotifications: 'menu'\"\r\n    (row-changed)=\"onNotificationStateChanged($event)\"\r\n    (list-item-clicked)=\"onListItemClicked($event)\"\r\n  ></avl-list>\r\n  <div id=\"footer\">\r\n    <avl-button (click)=\"onDetailsClicked()\">{{\r\n      'VizBox.NotificationMenu.Details' | translate\r\n    }}</avl-button>\r\n  </div>\r\n</avl-popup>\r\n", styles: ["avl-popup{width:40%}avl-list{width:100%;height:250px;padding-top:8px;--avl-item-padding-left:16px;--avl-item-padding-right:16px;--notification-item-height:48px}#header{justify-content:space-between;padding:0 16px;border-bottom:1px solid var(--avl-overflow-menu-divider-color,var(--avl-divider-color))}#footer,#header{display:flex;align-items:center;box-sizing:border-box;height:56px}#footer{border-top:1px solid var(--avl-overflow-menu-divider-color,var(--avl-divider-color))}#headerText{font-size:20px;color:var(--avl-primary-text-color);overflow:hidden;white-space:nowrap;text-overflow:ellipsis}"], directives: [{ type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i2.AvlOverflowMenuDirective, selector: "avl-overflow-menu", outputs: ["itemClicked"] }, { type: i2.AvlInteractionControlDirective, selector: "avl-button,avl-icon-button,avl-item,avl-search-bar,avl-radio-button,avl-upload,avl-snackbar", outputs: ["focusedChange"] }, { type: i2.AvlIconButtonDirective, selector: "avl-icon-button", outputs: ["badgeChange", "badgeValueChange"] }, { type: i2.AvlMultiSelectControlDirective, selector: "avl-datatable,avl-list,avl-chip-list, avl-chip-input", outputs: ["selectedIndexesChange", "selectedValuesChange"] }, { type: i2.AvlSingleSelectControlDirective, selector: "avl-datatable,avl-dropdown,avl-list,avl-radio-group,avl-app-switcher,avl-chip-list,avl-combo-box", outputs: ["selectedIndexChange", "selectedValueChange"] }, { type: i2.AvlListDirective, selector: "avl-list", inputs: ["readonly"], outputs: ["invalidChange", "overflowMenuItemClicked", "rightCheckboxChanged", "activeRowChanged", "rowReordered"] }], pipes: { "translate": i3.TranslatePipe, "prepareNotifications": i4.PrepareNotificationsPipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.3", ngImport: i0, type: AvlNotificationMenuComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'avl-notification-menu',
                    templateUrl: './avl-notification-menu.component.html',
                    styleUrls: ['./avl-notification-menu.component.css']
                }]
        }], propDecorators: { open: [{
                type: Input
            }], trigger: [{
                type: Input
            }], notifications: [{
                type: Input
            }], openChange: [{
                type: Output
            }], openDetails: [{
                type: Output
            }], notificationStateChanged: [{
                type: Output
            }], markAllAsRead: [{
                type: Output
            }], markAllAsUnread: [{
                type: Output
            }], list: [{
                type: ViewChild,
                args: ['list']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXZsLW5vdGlmaWNhdGlvbi1tZW51LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25vdGlmaWNhdGlvbi9zcmMvbGliL2NvbXBvbmVudHMvYXZsLW5vdGlmaWNhdGlvbi1tZW51L2F2bC1ub3RpZmljYXRpb24tbWVudS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9ub3RpZmljYXRpb24vc3JjL2xpYi9jb21wb25lbnRzL2F2bC1ub3RpZmljYXRpb24tbWVudS9hdmwtbm90aWZpY2F0aW9uLW1lbnUuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsT0FBTyxFQUVMLFNBQVMsRUFFVCxZQUFZLEVBQ1osS0FBSyxFQUVMLE1BQU0sRUFDTixTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFRdkIsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7Ozs7OztBQU83RSxNQUFNLE9BQU8sNEJBQTRCO0lBTHpDO1FBTVcsU0FBSSxHQUFZLEtBQUssQ0FBQztRQVdyQixlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQVcsQ0FBQztRQUN6QyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFRLENBQUM7UUFDdkMsNkJBQXdCLEdBQUcsSUFBSSxZQUFZLEVBQW1CLENBQUM7UUFDL0Qsa0JBQWEsR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBQ3pDLG9CQUFlLEdBQUcsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQUk5QyxzQkFBaUIsR0FBMkIsRUFBRSxDQUFDO1FBQy9DLGdDQUEyQixHQUFXLENBQUMsQ0FBQztRQUV2QyxtQkFBYyxHQUFzQixFQUFFLENBQUM7UUFFdkMseUJBQW9CLEdBQWtDO1lBQzVELGFBQWEsRUFBRSxHQUFHLEVBQUU7Z0JBQ2xCLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JB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d0M7b0JBQ3JELFNBQVMsRUFBRSxDQUFDLHVDQUF1QyxDQUFDO2lCQUNyRDs4QkFFVSxJQUFJO3NCQUFaLEtBQUs7Z0JBQ0csT0FBTztzQkFBZixLQUFLO2dCQUVGLGFBQWE7c0JBRGhCLEtBQUs7Z0JBU0ksVUFBVTtzQkFBbkIsTUFBTTtnQkFDRyxXQUFXO3NCQUFwQixNQUFNO2dCQUNHLHdCQUF3QjtzQkFBakMsTUFBTTtnQkFDRyxhQUFhO3NCQUF0QixNQUFNO2dCQUNHLGVBQWU7c0JBQXhCLE1BQU07Z0JBRVksSUFBSTtzQkFBdEIsU0FBUzt1QkFBQyxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBBZnRlclZpZXdJbml0LFxyXG4gIENvbXBvbmVudCxcclxuICBFbGVtZW50UmVmLFxyXG4gIEV2ZW50RW1pdHRlcixcclxuICBJbnB1dCxcclxuICBPbkluaXQsXHJcbiAgT3V0cHV0LFxyXG4gIFZpZXdDaGlsZFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBBdmxMaXN0IH0gZnJvbSAnQGF2bC1jb250cm9scy9jb3JlL2Rpc3QvYXZsLWxpc3QvYXZsLWxpc3QuYXBpJztcclxuaW1wb3J0IHtcclxuICBBdmxPdmVyZmxvd01lbnVHcm91cCxcclxuICBBdmxPdmVyZmxvd01lbnVJdGVtXHJcbn0gZnJvbSAnQGF2bC1jb250cm9scy9jb3JlL2Rpc3QvYXZsLW92ZXJmbG93LW1lbnUvYXZsLW92ZXJmbG93LW1lbnUuYXBpJztcclxuaW1wb3J0IHsgQXZsTm90aWZpY2F0aW9uIH0gZnJvbSAnQGF2bC1pbnRlcmZhY2VzL2ludGVyZmFjZXMnO1xyXG5pbXBvcnQgeyBBdmxOb3RpZmljYXRpb25NZW51SXRlbSB9IGZyb20gJy4uLy4uL21vZGVscy9ub3RpZmljYXRpb24tbWVudS5tb2RlbCc7XHJcbmltcG9ydCB7IE5PVElGSUNBVElPTlNfT1ZFUkZMT1dfTUVOVSB9IGZyb20gJy4vYXZsLW5vdGlmaWNhdGlvbi1tZW51LmNvbnN0cyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2F2bC1ub3RpZmljYXRpb24tbWVudScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2F2bC1ub3RpZmljYXRpb24tbWVudS5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vYXZsLW5vdGlmaWNhdGlvbi1tZW51LmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQXZsTm90aWZpY2F0aW9uTWVudUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgQElucHV0KCkgb3BlbjogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIEBJbnB1dCgpIHRyaWdnZXI6IEhUTUxFbGVtZW50O1xyXG4gIEBJbnB1dCgpXHJcbiAgc2V0IG5vdGlmaWNhdGlvbnMobm90aWZpY2F0aW9uczogQXZsTm90aWZpY2F0aW9uW10pIHtcclxuICAgIHRoaXMubnVtYmVyT2ZVbnJlYWROb3RpZmljYXRpb25zID0gbm90aWZpY2F0aW9ucy5maWx0ZXIobm90aWYgPT4gIW5vdGlmLnJlYWQpLmxlbmd0aDtcclxuICAgIHRoaXMuX25vdGlmaWNhdGlvbnMgPSBub3RpZmljYXRpb25zO1xyXG4gIH1cclxuICBnZXQgbm90aWZpY2F0aW9ucygpIHtcclxuICAgIHJldHVybiB0aGlzLl9ub3RpZmljYXRpb25zO1xyXG4gIH1cclxuXHJcbiAgQE91dHB1dCgpIG9wZW5DaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XHJcbiAgQE91dHB1dCgpIG9wZW5EZXRhaWxzID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xyXG4gIEBPdXRwdXQoKSBub3RpZmljYXRpb25TdGF0ZUNoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyPEF2bE5vdGlmaWNhdGlvbj4oKTtcclxuICBAT3V0cHV0KCkgbWFya0FsbEFzUmVhZCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcclxuICBAT3V0cHV0KCkgbWFya0FsbEFzVW5yZWFkID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xyXG5cclxuICBAVmlld0NoaWxkKCdsaXN0JykgbGlzdDogRWxlbWVudFJlZjxBdmxMaXN0PjtcclxuXHJcbiAgcHVibGljIG92ZXJmbG93TWVudUl0ZW1zOiBBdmxPdmVyZmxvd01lbnVHcm91cFtdID0gW107XHJcbiAgcHVibGljIG51bWJlck9mVW5yZWFkTm90aWZpY2F0aW9uczogbnVtYmVyID0gMDtcclxuXHJcbiAgcHJpdmF0ZSBfbm90aWZpY2F0aW9uczogQXZsTm90aWZpY2F0aW9uW10gPSBbXTtcclxuXHJcbiAgcHJpdmF0ZSBvdmVyZmxvd01lbnVIYW5kbGVyczogeyBba2V5OiBzdHJpbmddOiAoKSA9PiB2b2lkIH0gPSB7XHJcbiAgICBtYXJrQWxsQXNSZWFkOiAoKSA9PiB7XHJcbiAgICAgIHRoaXMubWFya0FsbEFzUmVhZC5lbWl0KCk7XHJcbiAgICAgIHRoaXMubnVtYmVyT2ZVbnJlYWROb3RpZmljYXRpb25zID0gMDtcclxuICAgIH0sXHJcbiAgICBtYXJrQWxsQXNVbnJlYWQ6ICgpID0+IHtcclxuICAgICAgdGhpcy5tYXJrQWxsQXNVbnJlYWQuZW1pdCgpO1xyXG4gICAgICB0aGlzLm51bWJlck9mVW5yZWFkTm90aWZpY2F0aW9ucyA9IHRoaXMubm90aWZpY2F0aW9ucy5sZW5ndGg7XHJcbiAgICB9LFxyXG4gICAgdW5kZWZpbmVkOiAoKSA9PiB7fVxyXG4gIH07XHJcblxyXG4gIHB1YmxpYyBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMudHJhbnNsYXRlTGFiZWxzKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5saXN0Lm5hdGl2ZUVsZW1lbnQucmV2ZXJ0ZWRMaXN0ID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvbk5vdGlmaWNhdGlvblN0YXRlQ2hhbmdlZChldmVudDogRXZlbnQpOiB2b2lkIHtcclxuICAgIGNvbnN0IG5vdGlmaWNhdGlvbk1lbnVJdGVtOiBBdmxOb3RpZmljYXRpb25NZW51SXRlbSA9IHsgLi4uKDxDdXN0b21FdmVudD5ldmVudCkuZGV0YWlsLnZhbHVlIH07XHJcbiAgICBjb25zdCBub3RpZmljYXRpb24gPSB7XHJcbiAgICAgIC4uLm5vdGlmaWNhdGlvbk1lbnVJdGVtLFxyXG4gICAgICByZWFkOiBub3RpZmljYXRpb25NZW51SXRlbS5pY29uVG9nZ2xlVmFsdWVcclxuICAgIH0gYXMgQXZsTm90aWZpY2F0aW9uO1xyXG4gICAgbm90aWZpY2F0aW9uLnJlYWQgPyB0aGlzLm51bWJlck9mVW5yZWFkTm90aWZpY2F0aW9ucy0tIDogdGhpcy5udW1iZXJPZlVucmVhZE5vdGlmaWNhdGlvbnMrKztcclxuICAgIHRoaXMubm90aWZpY2F0aW9uU3RhdGVDaGFuZ2VkLmVtaXQobm90aWZpY2F0aW9uKTtcclxuXHJcbiAgICB0aGlzLmxpc3QubmF0aXZlRWxlbWVudC5yZW1vdmVGb2N1cygpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG9uSXRlbUNsaWNrZWQoaXRlbTogQXZsT3ZlcmZsb3dNZW51SXRlbSk6IHZvaWQge1xyXG4gICAgdGhpcy5vdmVyZmxvd01lbnVIYW5kbGVyc1tpdGVtLmFjdGlvbl0oKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvbk9wZW5DaGFuZ2VkKGV2ZW50OiBFdmVudCk6IHZvaWQge1xyXG4gICAgaWYgKCEoPEN1c3RvbUV2ZW50PmV2ZW50KS5kZXRhaWwudmFsdWUpIHtcclxuICAgICAgdGhpcy5vcGVuQ2hhbmdlLmVtaXQoZmFsc2UpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIG9uT3ZlcmZsb3dNZW51Q2xpY2tlZCgpOiB2b2lkIHtcclxuICAgIHRoaXMubGlzdC5uYXRpdmVFbGVtZW50LnJlbW92ZUZvY3VzKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb25EZXRhaWxzQ2xpY2tlZCgpOiB2b2lkIHtcclxuICAgIHRoaXMub3BlbiA9IGZhbHNlO1xyXG4gICAgdGhpcy5vcGVuRGV0YWlscy5lbWl0KCk7XHJcbiAgICB0aGlzLm9wZW5DaGFuZ2UuZW1pdChmYWxzZSk7XHJcbiAgfVxyXG5cclxuICAvKipFdmVudCBmaXJlZCB3aGVuIGxpc3QgaXRlbSBpcyBjbGlja2VkIG9uXHJcbiAgICogZGVwZW5kaW5nIG9uIHRoZSBub3RpZmljYXRpb24gZmxhZyBpdCBvcGVucyBpbiBuZXcgdGFiXHJcbiAgICovXHJcbiAgcHVibGljIG9uTGlzdEl0ZW1DbGlja2VkKGV2ZW50OiBFdmVudCk6IHZvaWQge1xyXG4gICAgY29uc3QgaXRlbSA9ICg8Q3VzdG9tRXZlbnQ+ZXZlbnQpLmRldGFpbDtcclxuICAgIGlmIChpdGVtLmxpbmspIHtcclxuICAgICAgaWYgKGl0ZW0ub3BlbkluTmV3VGFiKSB7XHJcbiAgICAgICAgd2luZG93Lm9wZW4oaXRlbS5saW5rLCAnX2JsYW5rJyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgd2luZG93Lm9wZW4oaXRlbS5saW5rLCAnX3NlbGYnKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyB0cmFuc2xhdGVMYWJlbHMoKSB7XHJcbiAgICBpZiAoIUF2bExvY2FsaXphdGlvblNlcnZpY2UgfHwgIUF2bExvY2FsaXphdGlvblNlcnZpY2UudHJhbnNsYXRpb25TZXJ2aWNlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLm92ZXJmbG93TWVudUl0ZW1zID0gYXdhaXQgdGhpcy50cmFuc2xhdGVNZW51KE5PVElGSUNBVElPTlNfT1ZFUkZMT1dfTUVOVSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIHRyYW5zbGF0ZU1lbnUobWVudTogQXZsT3ZlcmZsb3dNZW51R3JvdXBbXSk6IFByb21pc2U8QXZsT3ZlcmZsb3dNZW51R3JvdXBbXT4ge1xyXG4gICAgcmV0dXJuIGF3YWl0IFByb21pc2UuYWxsKG1lbnUubWFwKGFzeW5jIGdyb3VwID0+IGF3YWl0IHRoaXMudHJhbnNsYXRlTWVudUdyb3VwKGdyb3VwKSkpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyB0cmFuc2xhdGVNZW51R3JvdXAoZ3JvdXA6IEF2bE92ZXJmbG93TWVudUdyb3VwKTogUHJvbWlzZTxBdmxPdmVyZmxvd01lbnVHcm91cD4ge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgaXRlbXM6IGF3YWl0IFByb21pc2UuYWxsKGdyb3VwLml0ZW1zLm1hcChhc3luYyBpdGVtID0+IGF3YWl0IHRoaXMudHJhbnNsYXRlTWVudUl0ZW0oaXRlbSkpKVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgdHJhbnNsYXRlTWVudUl0ZW0oaXRlbTogQXZsT3ZlcmZsb3dNZW51SXRlbSk6IFByb21pc2U8QXZsT3ZlcmZsb3dNZW51SXRlbT4ge1xyXG4gICAgY29uc3QgdHJhbnNsYXRlU2VydmljZSA9IEF2bExvY2FsaXphdGlvblNlcnZpY2UudHJhbnNsYXRpb25TZXJ2aWNlO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgLi4uaXRlbSxcclxuICAgICAgbGFiZWw6IGF3YWl0IHRyYW5zbGF0ZVNlcnZpY2UudHJhbnNsYXRlKGl0ZW0ubGFiZWwpLFxyXG4gICAgICBzdWJsYWJlbDogaXRlbS5zdWJsYWJlbCA/IGF3YWl0IHRyYW5zbGF0ZVNlcnZpY2UudHJhbnNsYXRlKGl0ZW0uc3VibGFiZWwpIDogbnVsbFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuIiwiPGF2bC1wb3B1cFxyXG4gIFtub0Nsb3NlT25JbnNpZGVDbGlja109XCJ0cnVlXCJcclxuICBbb3Blbl09XCJvcGVuXCJcclxuICBbdHJpZ2dlcl09XCJ0cmlnZ2VyXCJcclxuICAob3Blbi1jaGFuZ2VkKT1cIm9uT3BlbkNoYW5nZWQoJGV2ZW50KVwiXHJcbj5cclxuICA8ZGl2IGlkPVwiaGVhZGVyXCI+XHJcbiAgICA8ZGl2IGlkPVwiaGVhZGVyVGV4dFwiPlxyXG4gICAgICA8c3Bhbj57eyAnVml6Qm94Lk5vdGlmaWNhdGlvbk1lbnUuTm90aWZpY2F0aW9ucycgfCB0cmFuc2xhdGUgfX08L3NwYW4+XHJcbiAgICAgIDxzcGFuICpuZ0lmPVwibnVtYmVyT2ZVbnJlYWROb3RpZmljYXRpb25zXCI+ICh7eyBudW1iZXJPZlVucmVhZE5vdGlmaWNhdGlvbnMgfX0pIDwvc3Bhbj5cclxuICAgIDwvZGl2PlxyXG4gICAgPGF2bC1vdmVyZmxvdy1tZW51IChpdGVtQ2xpY2tlZCk9XCJvbkl0ZW1DbGlja2VkKCRldmVudClcIiBbaXRlbXNdPVwib3ZlcmZsb3dNZW51SXRlbXNcIj5cclxuICAgICAgPGF2bC1pY29uLWJ1dHRvblxyXG4gICAgICAgIGljb249XCJtb3JlLXZlcnRcIlxyXG4gICAgICAgIHNsb3Q9XCJ0cmlnZ2VyXCJcclxuICAgICAgICAoY2xpY2spPVwib25PdmVyZmxvd01lbnVDbGlja2VkKClcIlxyXG4gICAgICA+PC9hdmwtaWNvbi1idXR0b24+XHJcbiAgICA8L2F2bC1vdmVyZmxvdy1tZW51PlxyXG4gIDwvZGl2PlxyXG4gIDxhdmwtbGlzdFxyXG4gICAgI2xpc3RcclxuICAgIFtyb3dzXT1cIm5vdGlmaWNhdGlvbnMgfCBwcmVwYXJlTm90aWZpY2F0aW9uczogJ21lbnUnXCJcclxuICAgIChyb3ctY2hhbmdlZCk9XCJvbk5vdGlmaWNhdGlvblN0YXRlQ2hhbmdlZCgkZXZlbnQpXCJcclxuICAgIChsaXN0LWl0ZW0tY2xpY2tlZCk9XCJvbkxpc3RJdGVtQ2xpY2tlZCgkZXZlbnQpXCJcclxuICA+PC9hdmwtbGlzdD5cclxuICA8ZGl2IGlkPVwiZm9vdGVyXCI+XHJcbiAgICA8YXZsLWJ1dHRvbiAoY2xpY2spPVwib25EZXRhaWxzQ2xpY2tlZCgpXCI+e3tcclxuICAgICAgJ1ZpekJveC5Ob3RpZmljYXRpb25NZW51LkRldGFpbHMnIHwgdHJhbnNsYXRlXHJcbiAgICB9fTwvYXZsLWJ1dHRvbj5cclxuICA8L2Rpdj5cclxuPC9hdmwtcG9wdXA+XHJcbiJdfQ==