import { Component, EventEmitter, HostBinding, Input, Output, ViewChild } from '@angular/core';
import { Observable } from 'rxjs';
import '@avl-controls/core/dist/avl-snackbar/avl-snackbar';
import { takeUntil } from 'rxjs/operators';
import { SnackbarMethodDescription } from './directives/show-hide-snackbar.directive';
import { Subject } from 'rxjs';
import { SnackbarStack } from './snackbar-stack';
import { ANIMATION_DURATION } from './avl-notification-container.consts';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "./directives/animate-stack.directive";
import * as i3 from "./directives/animate-snackbar.directive";
import * as i4 from "@avl-controls/ng-binders";
import * as i5 from "./directives/snackbar-listener.directive";
import * as i6 from "./directives/show-hide-snackbar.directive";
import * as i7 from "./directives/animate-button.directive";
import * as i8 from "@ngx-translate/core";
const NOTIFICATION_TYPE = new Map([
    [0 /* Error */, 'Error'],
    [1 /* Warning */, 'Warning'],
    [2 /* Info */, 'Info'],
    [3 /* OK */, 'OK']
]);
export class AvlNotificationContainerComponent {
    constructor(cdRef) {
        this.cdRef = cdRef;
        /** Observable emits notifications. Default observable emits dummy notifications every 3s for 100s. */
        this.notification$ = new Observable(function subscribe(subscriber) {
            let i = 0;
            const intervalId = setInterval(() => {
                const warning = Math.round(Math.random());
                subscriber.next({
                    id: i++,
                    module: 'notification-container',
                    timestamp: new Date(),
                    type: warning ? 1 /* Warning */ : 2 /* Info */,
                    messageText: 'Snackbar with notification' + new Date().toTimeString(),
                    read: false,
                    link: 'https://vizbox.avl.com'
                });
            }, 3000);
            setTimeout(() => {
                clearInterval(intervalId);
            }, 100000);
        });
        this.openMenu = new EventEmitter();
        /** @hidden */
        this.stackHeight = {};
        /** @hidden */
        this.notificationList = [];
        this.destroyed$ = new Subject();
        /** @hidden */
        this.onButtonClicked = (event) => {
            if (event) {
                this.openMenu.emit();
                this.dismissAll();
            }
        };
        /** @hidden */
        this.onNotificationDismissed = (event, notification) => {
            var _a, _b;
            if (event) {
                const snackType = (_b = (_a = event.target) === null || _a === void 0 ? void 0 : _a.id) === null || _b === void 0 ? void 0 : _b.replace('Snackbar', '');
                this.removeNotification(notification, snackType);
            }
        };
        /** @hidden */
        this.openFromStack = (notification) => {
            const stackName = this.getStackName(notification.type);
            this[stackName].methodDescription = new SnackbarMethodDescription('hide', true);
        };
        /** @hidden */
        this.dismissAll = () => {
            this.notificationList = [];
            this.warningStack.activeNotification$.next(undefined);
            this.infoStack.activeNotification$.next(undefined);
        };
        this.handleNotification = (notification) => {
            this.previousNotification = this.notificationList[this.notificationList.length - 1];
            this.notificationList.push(notification);
            this.updateStackActiveNotification(notification);
            this.setStackAnimation(notification.type);
        };
        this.updateStackActiveNotification = (notification) => {
            var _a;
            const stackName = this.getStack(notification === null || notification === void 0 ? void 0 : notification.type);
            this.updateStackNotificationList(notification.type);
            this.activeNotification = notification;
            if (this[stackName].notificationList.length > 1) {
                this.reopen = true;
                if (((_a = this.previousNotification) === null || _a === void 0 ? void 0 : _a.type) === notification.type) {
                    this[stackName].snackbarAnimation = 3 /* ToStack */;
                    // silently dismiss notification after previous notification animation
                    const timeout = setTimeout(() => {
                        this.silentlyDismissNotification(stackName);
                        this[stackName].snackbarAnimation = null;
                        clearTimeout(timeout);
                    }, ANIMATION_DURATION);
                }
                else {
                    this.silentlyDismissNotification(stackName);
                }
            }
            else {
                this[stackName].activeNotification$.next(notification);
            }
        };
        this.updateStackNotificationList = (notificationType) => {
            const stack = this[this.getStack(notificationType)];
            if (stack) {
                stack.notificationList = this.notificationList.filter(item => item.type === notificationType);
            }
            return stack.notificationList;
        };
        this.silentlyDismissNotification = (stackName) => {
            this[stackName].dismissedSilently = true;
            this[stackName].methodDescription = new SnackbarMethodDescription('hide', false);
        };
        this.setStackAnimation = (notificationType, animation) => {
            var _a, _b, _c;
            const currentStack = this.getStack(notificationType);
            const previousStack = this.getStack(notificationType, true);
            if (((_b = (_a = this[previousStack]) === null || _a === void 0 ? void 0 : _a.notificationList) === null || _b === void 0 ? void 0 : _b.length) > 0 &&
                ((_c = this.previousNotification) === null || _c === void 0 ? void 0 : _c.type) !== notificationType) {
                this[previousStack].stackAnimation = animation || 2 /* ToBottom */;
                this[currentStack].stackAnimation =
                    animation === 1 /* ToTop */
                        ? 2 /* ToBottom */
                        : 1 /* ToTop */;
            }
        };
        this.removeNotification = (notification, snackType) => {
            var _a;
            const stackName = this.getStack(notification === null || notification === void 0 ? void 0 : notification.type);
            if (this[stackName].dismissedSilently) {
                //notification dismissed silently
                const stackName = this.getStack((_a = this.activeNotification) === null || _a === void 0 ? void 0 : _a.type);
                this[stackName].activeNotification$.next(this.activeNotification);
                this.reopen = false;
            }
            else {
                //notification dismissed
                this.notificationList = this.notificationList.filter(currentNotification => currentNotification.id !== notification.id);
                this.reopenLastNotification(notification, stackName);
            }
        };
        this.reopenLastNotification = (notification, stackName) => {
            var _a;
            let stackNotificationList = (_a = this[stackName]) === null || _a === void 0 ? void 0 : _a.notificationList;
            if (this.isLastNotificationDismissed(notification, this[stackName]) &&
                (stackNotificationList === null || stackNotificationList === void 0 ? void 0 : stackNotificationList.length) > 0) {
                this[stackName].reopen = true;
                stackNotificationList = this.updateStackNotificationList(notification.type);
                const lastNotification = stackNotificationList[stackNotificationList.length - 1];
                if (lastNotification) {
                    this[stackName].activeNotification$.next(lastNotification);
                }
                else {
                    this[stackName].stackIndicator = false;
                    this[stackName].reopen = false;
                    this[stackName].animateStack = 2 /* ToBottom */;
                    this.setStackAnimation(notification.type, 1 /* ToTop */);
                }
            }
        };
        this.isLastNotificationDismissed = (notification, stack) => {
            const lastNotification = stack.notificationList[stack.notificationList.length - 1];
            return (lastNotification === null || lastNotification === void 0 ? void 0 : lastNotification.id) === (notification === null || notification === void 0 ? void 0 : notification.id);
        };
        this.getStackName = (stackType) => {
            return stackType === 1 ? 'warningStack' : 'infoStack';
        };
        this.warningStack = new SnackbarStack(String(NOTIFICATION_TYPE.get(1 /* Warning */)).toLowerCase());
        this.infoStack = new SnackbarStack(String(NOTIFICATION_TYPE.get(2 /* Info */)).toLowerCase());
    }
    ngOnDestroy() {
        this.destroyed$.next();
        this.destroyed$.complete();
    }
    ngAfterViewChecked() {
        this.cdRef.detectChanges();
    }
    /** @hidden */
    ngOnInit() {
        var _a, _b;
        this.positionTop = ((_a = document.querySelector('main')) === null || _a === void 0 ? void 0 : _a.offsetTop) + 12 + 'px';
        (_b = this.notification$) === null || _b === void 0 ? void 0 : _b.pipe(takeUntil(this.destroyed$)).subscribe(notification => {
            this.handleNotification(notification);
        });
    }
    /** @hidden */
    /** Event fired when notification snackbar is clicked
     * depending on the notification flag it opens in new tab
    */
    onNotificationSnackbarClicked(event) {
        const snackbar = event.detail;
        if (snackbar.link) {
            if (snackbar.openInNewTab) {
                window.open(snackbar.link, '_blank');
            }
            else {
                window.open(snackbar.link, '_self');
            }
        }
    }
    getStack(notificationType, previous) {
        let stackType;
        if (notificationType === 1 /* Warning */ ||
            notificationType === 0 /* Error */) {
            stackType = previous ? 2 /* Info */ : 1 /* Warning */;
        }
        else {
            stackType = previous ? 1 /* Warning */ : 2 /* Info */;
        }
        return this.getStackName(stackType);
    }
}
AvlNotificationContainerComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.3", ngImport: i0, type: AvlNotificationContainerComponent, deps: [{ token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
AvlNotificationContainerComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.0.3", type: AvlNotificationContainerComponent, selector: "avl-notification-container", inputs: { displayIcon: ["display-icon", "displayIcon"], notification$: "notification$" }, outputs: { openMenu: "openMenu" }, host: { properties: { "style.top": "this.positionTop" } }, viewQueries: [{ propertyName: "warningStackElement", first: true, predicate: ["warningStackElement"], descendants: true }, { propertyName: "infoStackElement", first: true, predicate: ["infoStackElement"], descendants: true }, { propertyName: "infoStackIndicatorElement", first: true, predicate: ["infoStackIndicatorElement"], descendants: true }, { propertyName: "warningStackIndicatorElement", first: true, predicate: ["infoStackIndicatorElement"], descendants: true }], ngImport: i0, template: "<div class=\"snackbar\" *ngIf=\"notification$ | async as notification\">\r\n  <div\r\n    [animateStack]=\"warningStack?.stackAnimation\"\r\n    [previousStackHeight] = \"infoStack.notificationList.length>0 ? infoSnackElement.offsetHeight : 0\"\r\n    [snackbarMethodDescription] = \"warningStack.methodDescription\"\r\n    class=\"snackbar-stack\"\r\n    id=\"warningStack\"\r\n    #warningStackElement\r\n  >\r\n    <div [animateSnackbar]=\"warningStack.snackbarAnimation\" id=\"warningSnack\" #warningSnackElement>\r\n      <avl-snackbar\r\n        *ngIf=\"warningStack.activeNotification$ | async as activeWarningNotification\"\r\n        id=\"warningSnackbar\"\r\n        [message]=\"activeWarningNotification?.messageText\"\r\n        [openInNewTab]=\"activeWarningNotification.openInNewTab\"\r\n        [actionButtonLabel]=\"warningStack.stackIndicatorButtonLabel\"\r\n        [link]=\"activeWarningNotification.link\"\r\n        [messageType]=\"activeWarningNotification.type\"\r\n        sliding\r\n        (buttonClicked)=\"onButtonClicked($event)\"\r\n        (notificationDismissed)=\"onNotificationDismissed($event, activeWarningNotification)\"\r\n        snackbarListener\r\n        #warningSnackbar\r\n        showHideSnackbar=\"warningSnackbar\"\r\n        [methodDescription]=\"warningStack.methodDescription\"\r\n        (snackbar-clicked)=\"onNotificationSnackbarClicked($event)\"\r\n      ></avl-snackbar>\r\n    </div>\r\n\r\n    <div class=\"stack-indicator-container\" *ngIf=\"warningStack.notificationList.length>1\" #warningStackIndicator>\r\n      <div class=\"stack-indicator\">\r\n        <div class=\"notification-container\">\r\n          <div [ngClass]=\"{'notification': true, 'has-action': warningStack.stackIndicatorButtonLabel}\">\r\n            <avl-icon icon=\"icons:warning\" id=\"warningIcon\" class=\"warning\"></avl-icon>\r\n            <p id=\"snackbarMessage\">{{ warningStack.previousNotification?.messageText }}</p>\r\n            <avl-icon-button id=\"closeButton\" icon=\"icons:close\"></avl-icon-button>\r\n          </div>\r\n          <button id=\"actionButton\" *ngIf=\"warningStack.stackIndicatorButtonLabel\" (click)=\"openFromStack(warningStack.previousNotification)\">\r\n            <div class=\"button-label\">{{ warningStack.stackIndicatorButtonLabel }}</div>\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div\r\n    class=\"snackbar-stack\"\r\n    id=\"infoStack\"\r\n    [animateStack]=\"infoStack?.stackAnimation\"\r\n    [previousStackHeight] = \"infoStack.notificationList.length>0 ? warningSnackElement.offsetHeight : 0\"\r\n    [snackbarMethodDescription] = \"infoStack.methodDescription\"\r\n    #infoStackElement\r\n  >\r\n    <div [animateSnackbar]=\"infoStack.snackbarAnimation\" id=\"infoSnack\" #infoSnackElement>\r\n      <avl-snackbar\r\n        id=\"infoSnackbar\"\r\n        *ngIf=\"infoStack.activeNotification$ | async as activeInfoNotification\"\r\n        [message]=\"activeInfoNotification.messageText\"\r\n        [openInNewTab]=\"activeInfoNotification.openInNewTab\"\r\n        [actionButtonLabel]=\"infoStack.stackIndicatorButtonLabel\"\r\n        [link]=\"activeInfoNotification.link\"\r\n        [messageType]=\"activeInfoNotification.type\"\r\n        [displayIcon]=\"displayIcon\"\r\n        sliding\r\n        (buttonClicked)=\"onButtonClicked($event)\"\r\n        (notificationDismissed)=\"onNotificationDismissed($event, activeInfoNotification)\"\r\n        snackbarListener\r\n        #infoSnackbar\r\n        showHideSnackbar=\"infoSnackbar\"\r\n        [methodDescription]=\"infoStack.methodDescription\"\r\n        (snackbar-clicked)=\"onNotificationSnackbarClicked($event)\"\r\n      ></avl-snackbar>\r\n    </div>\r\n\r\n    <div class=\"stack-indicator-container\" *ngIf=\"infoStack.notificationList.length>1\" #infoStackIndicator>\r\n      <div class=\"stack-indicator\">\r\n        <div class=\"notification-container\">\r\n          <div [ngClass]=\"{'notification': true, 'has-action': infoStack.stackIndicatorButtonLabel}\">\r\n            <p id=\"snackbarMessage\">{{ infoStack.previousNotification?.messageText }}</p>\r\n            <avl-icon-button id=\"closeButton\" icon=\"icons:close\"></avl-icon-button>\r\n          </div>\r\n        </div>\r\n        <button id=\"actionButton\" *ngIf=\"infoStack.stackIndicatorButtonLabel\" (click)=\"openFromStack(infoStack.previousNotification)\">\r\n          <div class=\"button-label\">{{ infoStack.stackIndicatorButtonLabel }}</div>\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div\r\n    animateButton\r\n    [infoStackHeight]=\"infoStack?.notificationList?.length > 0 ? infoSnackElement.offsetHeight : 0\"\r\n    [warningStackHeight]=\"warningStack?.notificationList?.length > 0 ? warningSnackElement.offsetHeight : 0\"\r\n    [infoStackIndicatorHeight]=\"infoStackIndicatorElement?.nativeElement?.offsetHeight\"\r\n    [warningStackIndicatorHeight]=\"warningStackIndicatorElement?.nativeElement?.offsetHeight\"\r\n    class=\"dismiss-all\"\r\n    *ngIf=\"notificationList?.length > 1\"\r\n  >\r\n    <avl-button id=\"dismissAll\" (click)=\"dismissAll()\">{{'VizBox.NotificationContainer.DismissAll' | translate}}</avl-button>\r\n  </div>\r\n</div>\r\n\r\n\r\n", styles: [":host{position:fixed;right:0;width:445px;display:flex;flex-direction:column;--avl-snackbar-text-color:var(--avl-on-background-info-color)}.snackbar{width:100%;display:flex;flex-direction:column}.snackbar.displayed{flex:1;max-height:100%}.snackbar-stack{position:absolute;top:0;left:0;right:0;width:100%}.stack-indicator-container{margin:0 12px;position:absolute;width:calc(100% - 12px);top:12px;z-index:-1}.snackbar-container{margin-top:0;margin-left:0;margin-right:0;width:100%}.button-label{text-align:left;text-transform:none}.stack-indicator{background-color:var(--avl-background-message-color);top:0;left:0;width:calc(100% - 24px);border-radius:4px;position:relative;height:100%;z-index:-1;box-shadow:0 3px 5px -1px rgb(0 0 0/20%),0 6px 10px 0 rgb(0 0 0/14%),0 1px 18px 0 rgb(0 0 0/12%)}.notification{display:flex;flex:1 1 100%;align-items:center;flex-direction:row;padding:0 12px 0 16px;justify-content:flex-start;cursor:pointer;text-overflow:ellipsis}.notification p{flex-grow:1;-webkit-line-clamp:3;text-overflow:ellipsis;line-height:19px;margin:0 0 0 12px;padding:12px 0;color:var(--avl-on-background-info-color)}.notification p,button#actionButton{max-height:48px;font-size:14px;font-family:var(--avl-font-family)}button#actionButton{font-weight:500;color:var(--avl-on-background-message-link-color);background-color:var(--avl-button-background-default-color);height:48px;width:100%;cursor:pointer;padding:12px;margin:-12px 0 0;border-radius:2px;border:0;outline:none}div#actionButton:hover{color:var(--avl-on-background-message-link-hover-color)}#warningIcon{--avl-icon-custom-color:var(--avl-on-background-message-warning-color);flex:0 0 24px}#errorIcon{--avl-icon-custom-color:var(--avl-on-background-message-error-color);flex:0 0 24px}#infoIcon{--avl-icon-custom-color:var(--avl-on-background-message-emphasis-medium-color);flex:0 0 24px}#OKIcon{--avl-icon-custom-color:var(--avl-on-background-message-ok-color);flex:0 0 24px}.dismiss-all{position:absolute;padding:0 16px;border-radius:25px;background-color:var(--avl-background-message-color);width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;top:12px}#dismissAll{--avl-flat-button-label-color:var(--avl-on-background-message-link-color)}avl-icon-button{flex:0 0 48px;margin-left:12px;cursor:pointer;--avl-icon-button-color:var(--avl-on-background-message-icon-default-color);--avl-icon-ink-hover-color:var(--avl-on-background-message-icon-hover-color);--avl-icon-ink-focus-color:var(--avl-on-background-message-icon-focus-color);--avl-icon-ink-pressed-color:var(--avl-on-background-message-icon-pressed-color)}#warningIcon{--avl-icon-custom-color:var(--avl-warning-color)}@media only screen and (min-width:320px) and (max-width:376px){:host{width:calc(100% - 32px)}}@media only screen and (min-width:460px){:host{width:445px}}@media only screen and (min-width:376px) and (max-width:400px){:host{width:376px}}"], directives: [{ type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i2.AnimateStack, selector: "[animateStack]", inputs: ["animateStack", "notification", "previousStackHeight", "snackbarMethodDescription", "reopen"] }, { type: i3.AnimateSnackbar, selector: "[animateSnackbar]", inputs: ["animateSnackbar", "positionAnimation", "notification", "reopen"] }, { type: i4.AvlInteractionControlDirective, selector: "avl-button,avl-icon-button,avl-item,avl-search-bar,avl-radio-button,avl-upload,avl-snackbar", outputs: ["focusedChange"] }, { type: i4.AvlSnackbarDirective, selector: "avl-snackbar", outputs: ["buttonClicked", "displayedChange"] }, { type: i5.SnackbarListener, selector: "[snackbarListener]", outputs: ["notificationClicked", "buttonClicked", "notificationDismissed"] }, { type: i6.ShowHideSnackbarDirective, selector: "[showHideSnackbar]", inputs: ["methodDescription"] }, { type: i1.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { type: i4.AvlIconButtonDirective, selector: "avl-icon-button", outputs: ["badgeChange", "badgeValueChange"] }, { type: i7.AnimateButton, selector: "[animateButton]", inputs: ["increment", "infoStackHeight", "warningStackHeight", "infoStackIndicatorHeight", "warningStackIndicatorHeight"] }], pipes: { "async": i1.AsyncPipe, "translate": i8.TranslatePipe } });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.3", ngImport: i0, type: AvlNotificationContainerComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'avl-notification-container',
                    templateUrl: './avl-notification-container.component.html',
                    styleUrls: ['./avl-notification-container.component.css']
                }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }]; }, propDecorators: { positionTop: [{
                type: HostBinding,
                args: ['style.top']
            }], warningStackElement: [{
                type: ViewChild,
                args: ['warningStackElement']
            }], infoStackElement: [{
                type: ViewChild,
                args: ['infoStackElement']
            }], infoStackIndicatorElement: [{
                type: ViewChild,
                args: ['infoStackIndicatorElement']
            }], warningStackIndicatorElement: [{
                type: ViewChild,
                args: ['infoStackIndicatorElement']
            }], displayIcon: [{
                type: Input,
                args: ['display-icon']
            }], notification$: [{
                type: Input,
                args: ['notification$']
            }], openMenu: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXZsLW5vdGlmaWNhdGlvbi1jb250YWluZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbm90aWZpY2F0aW9uL3NyYy9saWIvY29tcG9uZW50cy9hdmwtbm90aWZpY2F0aW9uLWNvbnRhaW5lci9hdmwtbm90aWZpY2F0aW9uLWNvbnRhaW5lci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9ub3RpZmljYXRpb24vc3JjL2xpYi9jb21wb25lbnRzL2F2bC1ub3RpZmljYXRpb24tY29udGFpbmVyL2F2bC1ub3RpZmljYXRpb24tY29udGFpbmVyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFHTCxTQUFTLEVBRVQsWUFBWSxFQUNaLFdBQVcsRUFDWCxLQUFLLEVBR0wsTUFBTSxFQUNOLFNBQVMsRUFDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2xDLE9BQU8sbURBQW1ELENBQUM7QUFFM0QsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLDJDQUEyQyxDQUFDO0FBQ3RGLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFL0IsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHFDQUFxQyxDQUFDOzs7Ozs7Ozs7O0FBRXpFLE1BQU0saUJBQWlCLEdBQUcsSUFBSSxHQUFHLENBQWlCO0lBQ2hELGdCQUE0QixPQUFPLENBQUM7SUFDcEMsa0JBQThCLFNBQVMsQ0FBQztJQUN4QyxlQUEyQixNQUFNLENBQUM7SUFDbEMsYUFBeUIsSUFBSSxDQUFDO0NBQy9CLENBQUMsQ0FBQztBQU1ILE1BQU0sT0FBTyxpQ0FBaUM7SUFnRTVDLFlBQXFCLEtBQXdCO1FBQXhCLFVBQUssR0FBTCxLQUFLLENBQW1CO1FBN0M3QyxzR0FBc0c7UUFDdkUsa0JBQWEsR0FBZ0MsSUFBSSxVQUFVLENBQ3hGLFNBQVMsU0FBUyxDQUFDLFVBQVU7WUFDM0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ1YsTUFBTSxVQUFVLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRTtnQkFDbEMsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztnQkFDMUMsVUFBVSxDQUFDLElBQUksQ0FBQztvQkFDZCxFQUFFLEVBQUUsQ0FBQyxFQUFFO29CQUNQLE1BQU0sRUFBRSx3QkFBd0I7b0JBQ2hDLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRTtvQkFDckIsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDLGlCQUE2QixDQUFDLGFBQXlCO29CQUN0RSxXQUFXLEVBQUUsNEJBQTRCLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxZQUFZLEVBQUU7b0JBQ3JFLElBQUksRUFBRSxLQUFLO29CQUNYLElBQUksRUFBRSx3QkFBd0I7aUJBQy9CLENBQUMsQ0FBQztZQUNMLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUVULFVBQVUsQ0FBQyxHQUFHLEVBQUU7Z0JBQ2QsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQzVCLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNiLENBQUMsQ0FDRixDQUFDO1FBRVEsYUFBUSxHQUF1QixJQUFJLFlBQVksRUFBUSxDQUFDO1FBVWxFLGNBQWM7UUFDUCxnQkFBVyxHQUE4QixFQUFFLENBQUM7UUFLbkQsY0FBYztRQUNQLHFCQUFnQixHQUFzQixFQUFFLENBQUM7UUFHeEMsZUFBVSxHQUFrQixJQUFJLE9BQU8sRUFBRSxDQUFDO1FBNkJsRCxjQUFjO1FBQ1Asb0JBQWUsR0FBRyxDQUFDLEtBQVUsRUFBUSxFQUFFO1lBQzVDLElBQUksS0FBSyxFQUFFO2dCQUNULElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ3JCLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQzthQUNuQjtRQUNILENBQUMsQ0FBQztRQUVGLGNBQWM7UUFDUCw0QkFBdUIsR0FBRyxDQUFDLEtBQVUsRUFBRSxZQUE2QixFQUFRLEVBQUU7O1lBQ25GLElBQUksS0FBSyxFQUFFO2dCQUNULE1BQU0sU0FBUyxHQUFHLE1BQUEsTUFBQyxLQUFLLENBQUMsTUFBc0IsMENBQUUsRUFBRSwwQ0FBRSxPQUFPLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxDQUFDO2dCQUM3RSxJQUFJLENBQUMsa0JBQWtCLENBQUMsWUFBWSxFQUFFLFNBQVMsQ0FBQyxDQUFDO2FBQ2xEO1FBQ0gsQ0FBQyxDQUFDO1FBZ0JGLGNBQWM7UUFDUCxrQkFBYSxHQUFHLENBQUMsWUFBNkIsRUFBUSxFQUFFO1lBQzdELE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3ZELElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLHlCQUF5QixDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNsRixDQUFDLENBQUM7UUFFRixjQUFjO1FBQ1AsZUFBVSxHQUFHLEdBQVMsRUFBRTtZQUM3QixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsRUFBRSxDQUFDO1lBQzNCLElBQUksQ0FBQyxZQUFZLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3RELElBQUksQ0FBQyxTQUFTLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3JELENBQUMsQ0FBQztRQUVNLHVCQUFrQixHQUFHLENBQUMsWUFBaUIsRUFBUSxFQUFFO1lBQ3ZELElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNwRixJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3pDLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUNqRCxJQUFJLENBQUMsaUJBQWlCLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVDLENBQUMsQ0FBQztRQUVNLGtDQUE2QixHQUFHLENBQUMsWUFBNkIsRUFBUSxFQUFFOztZQUM5RSxNQUFNLFNBQVMsR0FBVyxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksYUFBWixZQUFZLHVCQUFaLFlBQVksQ0FBRSxJQUFJLENBQUMsQ0FBQztZQUM1RCxJQUFJLENBQUMsMkJBQTJCLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3BELElBQUksQ0FBQyxrQkFBa0IsR0FBRyxZQUFZLENBQUM7WUFFdkMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDL0MsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7Z0JBQ25CLElBQUksQ0FBQSxNQUFBLElBQUksQ0FBQyxvQkFBb0IsMENBQUUsSUFBSSxNQUFLLFlBQVksQ0FBQyxJQUFJLEVBQUU7b0JBQ3pELElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxpQkFBaUIsa0JBQTRCLENBQUM7b0JBRTlELHNFQUFzRTtvQkFDdEUsTUFBTSxPQUFPLEdBQUcsVUFBVSxDQUFDLEdBQUcsRUFBRTt3QkFDOUIsSUFBSSxDQUFDLDJCQUEyQixDQUFDLFNBQVMsQ0FBQyxDQUFDO3dCQUM1QyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDO3dCQUN6QyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBQ3hCLENBQUMsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO2lCQUN4QjtxQkFBTTtvQkFDTCxJQUFJLENBQUMsMkJBQTJCLENBQUMsU0FBUyxDQUFDLENBQUM7aUJBQzdDO2FBQ0Y7aUJBQU07Z0JBQ0wsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQzthQUN4RDtRQUNILENBQUMsQ0FBQztRQUNNLGdDQUEyQixHQUFHLENBQ3BDLGdCQUFxQyxFQUNsQixFQUFFO1lBQ3JCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQztZQUNwRCxJQUFJLEtBQUssRUFBRTtnQkFDVCxLQUFLLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssZ0JBQWdCLENBQUMsQ0FBQzthQUMvRjtZQUNELE9BQU8sS0FBSyxDQUFDLGdCQUFnQixDQUFDO1FBQ2hDLENBQUMsQ0FBQztRQUVNLGdDQUEyQixHQUFHLENBQUMsU0FBaUIsRUFBUSxFQUFFO1lBQ2hFLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUM7WUFDekMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLGlCQUFpQixHQUFHLElBQUkseUJBQXlCLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ25GLENBQUMsQ0FBQztRQUVNLHNCQUFpQixHQUFHLENBQzFCLGdCQUFxQyxFQUNyQyxTQUE2QixFQUN2QixFQUFFOztZQUNSLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztZQUNyRCxNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxDQUFDO1lBRTVELElBQ0UsQ0FBQSxNQUFBLE1BQUEsSUFBSSxDQUFDLGFBQWEsQ0FBQywwQ0FBRSxnQkFBZ0IsMENBQUUsTUFBTSxJQUFHLENBQUM7Z0JBQ2pELENBQUEsTUFBQSxJQUFJLENBQUMsb0JBQW9CLDBDQUFFLElBQUksTUFBSyxnQkFBZ0IsRUFDcEQ7Z0JBQ0EsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLGNBQWMsR0FBRyxTQUFTLG9CQUE4QixDQUFDO2dCQUU3RSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsY0FBYztvQkFDL0IsU0FBUyxrQkFBNEI7d0JBQ25DLENBQUM7d0JBQ0QsQ0FBQyxjQUF3QixDQUFDO2FBQy9CO1FBQ0gsQ0FBQyxDQUFDO1FBRU0sdUJBQWtCLEdBQUcsQ0FBQyxZQUE2QixFQUFFLFNBQWtCLEVBQVEsRUFBRTs7WUFDdkYsTUFBTSxTQUFTLEdBQVcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLGFBQVosWUFBWSx1QkFBWixZQUFZLENBQUUsSUFBSSxDQUFDLENBQUM7WUFDNUQsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsaUJBQWlCLEVBQUU7Z0JBQ3JDLGlDQUFpQztnQkFDakMsTUFBTSxTQUFTLEdBQVcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFBLElBQUksQ0FBQyxrQkFBa0IsMENBQUUsSUFBSSxDQUFDLENBQUM7Z0JBQ3ZFLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUM7Z0JBQ2xFLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO2FBQ3JCO2lCQUFNO2dCQUNMLHdCQUF3QjtnQkFDeEIsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQ2xELG1CQUFtQixDQUFDLEVBQUUsQ0FBQyxtQkFBbUIsQ0FBQyxFQUFFLEtBQUssWUFBWSxDQUFDLEVBQUUsQ0FDbEUsQ0FBQztnQkFDRixJQUFJLENBQUMsc0JBQXNCLENBQUMsWUFBWSxFQUFFLFNBQVMsQ0FBQyxDQUFDO2FBQ3REO1FBQ0gsQ0FBQyxDQUFDO1FBRU0sMkJBQXNCLEdBQUcsQ0FBQyxZQUE2QixFQUFFLFNBQWlCLEVBQVEsRUFBRTs7WUFDMUYsSUFBSSxxQkFBcUIsR0FBc0IsTUFBQSxJQUFJLENBQUMsU0FBUyxDQUFDLDBDQUFFLGdCQUFnQixDQUFDO1lBQ2pGLElBQ0UsSUFBSSxDQUFDLDJCQUEyQixDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQy9ELENBQUEscUJBQXFCLGFBQXJCLHFCQUFxQix1QkFBckIscUJBQXFCLENBQUUsTUFBTSxJQUFHLENBQUMsRUFDakM7Z0JBQ0EsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7Z0JBRTlCLHFCQUFxQixHQUFHLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzVFLE1BQU0sZ0JBQWdCLEdBQUcscUJBQXFCLENBQUMscUJBQXFCLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUNqRixJQUFJLGdCQUFnQixFQUFFO29CQUNwQixJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7aUJBQzVEO3FCQUFNO29CQUNMLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxjQUFjLEdBQUcsS0FBSyxDQUFDO29CQUN2QyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztvQkFDL0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLFlBQVksbUJBQTZCLENBQUM7b0JBQzFELElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLENBQUMsSUFBSSxnQkFBMEIsQ0FBQztpQkFDcEU7YUFDRjtRQUNILENBQUMsQ0FBQztRQUVNLGdDQUEyQixHQUFHLENBQ3BDLFlBQTZCLEVBQzdCLEtBQW9CLEVBQ1gsRUFBRTtZQUNYLE1BQU0sZ0JBQWdCLEdBQ3BCLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQzVELE9BQU8sQ0FBQSxnQkFBZ0IsYUFBaEIsZ0JBQWdCLHVCQUFoQixnQkFBZ0IsQ0FBRSxFQUFFLE9BQUssWUFBWSxhQUFaLFlBQVksdUJBQVosWUFBWSxDQUFFLEVBQUUsQ0FBQSxDQUFDO1FBQ25ELENBQUMsQ0FBQztRQWNNLGlCQUFZLEdBQUcsQ0FBQyxTQUE4QixFQUFVLEVBQUU7WUFDaEUsT0FBTyxTQUFTLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQztRQUN4RCxDQUFDLENBQUM7UUFsTUEsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLGFBQWEsQ0FDbkMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsaUJBQTZCLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FDekUsQ0FBQztRQUVGLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxhQUFhLENBQ2hDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLGNBQTBCLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FDdEUsQ0FBQztJQUNKLENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUN2QixJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRCxrQkFBa0I7UUFDaEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUM3QixDQUFDO0lBRUQsY0FBYztJQUNQLFFBQVE7O1FBQ2IsSUFBSSxDQUFDLFdBQVcsR0FBRyxDQUFBLE1BQUEsUUFBUSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsMENBQUUsU0FBUyxJQUFHLEVBQUUsR0FBRyxJQUFJLENBQUM7UUFDekUsTUFBQSxJQUFJLENBQUMsYUFBYSwwQ0FBRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxTQUFTLENBQUMsWUFBWSxDQUFDLEVBQUU7WUFDNUUsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3hDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQWlCRCxjQUFjO0lBQ2Q7O01BRUU7SUFDSyw2QkFBNkIsQ0FBQyxLQUFZO1FBQy9DLE1BQU0sUUFBUSxHQUFpQixLQUFNLENBQUMsTUFBTSxDQUFDO1FBQzdDLElBQUksUUFBUSxDQUFDLElBQUksRUFBRTtZQUNqQixJQUFJLFFBQVEsQ0FBQyxZQUFZLEVBQUU7Z0JBQ3pCLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQzthQUN0QztpQkFBTTtnQkFDTCxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7YUFDckM7U0FDRjtJQUNILENBQUM7SUE2SE8sUUFBUSxDQUFDLGdCQUF3QixFQUFFLFFBQWtCO1FBQzNELElBQUksU0FBOEIsQ0FBQztRQUNuQyxJQUNFLGdCQUFnQixvQkFBZ0M7WUFDaEQsZ0JBQWdCLGtCQUE4QixFQUM5QztZQUNBLFNBQVMsR0FBRyxRQUFRLENBQUMsQ0FBQyxjQUEwQixDQUFDLGdCQUE0QixDQUFDO1NBQy9FO2FBQU07WUFDTCxTQUFTLEdBQUcsUUFBUSxDQUFDLENBQUMsaUJBQTZCLENBQUMsYUFBeUIsQ0FBQztTQUMvRTtRQUNELE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUN0QyxDQUFDOzs4SEEvUFUsaUNBQWlDO2tIQUFqQyxpQ0FBaUMsa3RCQ2xDOUMsbXFLQXFHQTsyRkRuRWEsaUNBQWlDO2tCQUw3QyxTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSw0QkFBNEI7b0JBQ3RDLFdBQVcsRUFBRSw2Q0FBNkM7b0JBQzFELFNBQVMsRUFBRSxDQUFDLDRDQUE0QyxDQUFDO2lCQUMxRDt3R0FHMkIsV0FBVztzQkFBcEMsV0FBVzt1QkFBQyxXQUFXO2dCQUdVLG1CQUFtQjtzQkFBcEQsU0FBUzt1QkFBQyxxQkFBcUI7Z0JBR0QsZ0JBQWdCO3NCQUE5QyxTQUFTO3VCQUFDLGtCQUFrQjtnQkFHVyx5QkFBeUI7c0JBQWhFLFNBQVM7dUJBQUMsMkJBQTJCO2dCQUdFLDRCQUE0QjtzQkFBbkUsU0FBUzt1QkFBQywyQkFBMkI7Z0JBR1IsV0FBVztzQkFBeEMsS0FBSzt1QkFBQyxjQUFjO2dCQUdVLGFBQWE7c0JBQTNDLEtBQUs7dUJBQUMsZUFBZTtnQkFzQlosUUFBUTtzQkFBakIsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQWZ0ZXJWaWV3Q2hlY2tlZCxcclxuICBDaGFuZ2VEZXRlY3RvclJlZixcclxuICBDb21wb25lbnQsXHJcbiAgRWxlbWVudFJlZixcclxuICBFdmVudEVtaXR0ZXIsXHJcbiAgSG9zdEJpbmRpbmcsXHJcbiAgSW5wdXQsXHJcbiAgT25EZXN0cm95LFxyXG4gIE9uSW5pdCxcclxuICBPdXRwdXQsXHJcbiAgVmlld0NoaWxkXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0ICdAYXZsLWNvbnRyb2xzL2NvcmUvZGlzdC9hdmwtc25hY2tiYXIvYXZsLXNuYWNrYmFyJztcclxuaW1wb3J0IHsgQXZsTm90aWZpY2F0aW9uLCBBdmxOb3RpZmljYXRpb25UeXBlIH0gZnJvbSAnQGF2bC1pbnRlcmZhY2VzL2ludGVyZmFjZXMnO1xyXG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IFNuYWNrYmFyTWV0aG9kRGVzY3JpcHRpb24gfSBmcm9tICcuL2RpcmVjdGl2ZXMvc2hvdy1oaWRlLXNuYWNrYmFyLmRpcmVjdGl2ZSc7XHJcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgUG9zaXRpb25BbmltYXRpb24gfSBmcm9tICcuL2RpcmVjdGl2ZXMvYW5pbWF0ZS1zdGFjay5kaXJlY3RpdmUnO1xyXG5pbXBvcnQgeyBTbmFja2JhclN0YWNrIH0gZnJvbSAnLi9zbmFja2Jhci1zdGFjayc7XHJcbmltcG9ydCB7IEFOSU1BVElPTl9EVVJBVElPTiB9IGZyb20gJy4vYXZsLW5vdGlmaWNhdGlvbi1jb250YWluZXIuY29uc3RzJztcclxuXHJcbmNvbnN0IE5PVElGSUNBVElPTl9UWVBFID0gbmV3IE1hcDxudW1iZXIsIHN0cmluZz4oW1xyXG4gIFtBdmxOb3RpZmljYXRpb25UeXBlLkVycm9yLCAnRXJyb3InXSxcclxuICBbQXZsTm90aWZpY2F0aW9uVHlwZS5XYXJuaW5nLCAnV2FybmluZyddLFxyXG4gIFtBdmxOb3RpZmljYXRpb25UeXBlLkluZm8sICdJbmZvJ10sXHJcbiAgW0F2bE5vdGlmaWNhdGlvblR5cGUuT0ssICdPSyddXHJcbl0pO1xyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2F2bC1ub3RpZmljYXRpb24tY29udGFpbmVyJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vYXZsLW5vdGlmaWNhdGlvbi1jb250YWluZXIuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2F2bC1ub3RpZmljYXRpb24tY29udGFpbmVyLmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQXZsTm90aWZpY2F0aW9uQ29udGFpbmVyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIEFmdGVyVmlld0NoZWNrZWQge1xyXG4gIC8qKiBAaGlkZGVuICovXHJcbiAgQEhvc3RCaW5kaW5nKCdzdHlsZS50b3AnKSBwb3NpdGlvblRvcDogc3RyaW5nO1xyXG5cclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIEBWaWV3Q2hpbGQoJ3dhcm5pbmdTdGFja0VsZW1lbnQnKSB3YXJuaW5nU3RhY2tFbGVtZW50OiBFbGVtZW50UmVmO1xyXG5cclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIEBWaWV3Q2hpbGQoJ2luZm9TdGFja0VsZW1lbnQnKSBpbmZvU3RhY2tFbGVtZW50OiBFbGVtZW50UmVmO1xyXG5cclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIEBWaWV3Q2hpbGQoJ2luZm9TdGFja0luZGljYXRvckVsZW1lbnQnKSBpbmZvU3RhY2tJbmRpY2F0b3JFbGVtZW50OiBFbGVtZW50UmVmO1xyXG5cclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIEBWaWV3Q2hpbGQoJ2luZm9TdGFja0luZGljYXRvckVsZW1lbnQnKSB3YXJuaW5nU3RhY2tJbmRpY2F0b3JFbGVtZW50OiBFbGVtZW50UmVmO1xyXG5cclxuICAvKiogSWYgc2V0IG9wdGlvbmFsIGljb24gKGZvciBpbmZvIGFuZCBPSyBub3RpZmljYXRpb25zKSBpcyBkaXNwbGF5ZWQsIGhpZGRlbiBvdGhlcndpc2UuICovXHJcbiAgQElucHV0KCdkaXNwbGF5LWljb24nKSBwdWJsaWMgZGlzcGxheUljb246IGJvb2xlYW47XHJcblxyXG4gIC8qKiBPYnNlcnZhYmxlIGVtaXRzIG5vdGlmaWNhdGlvbnMuIERlZmF1bHQgb2JzZXJ2YWJsZSBlbWl0cyBkdW1teSBub3RpZmljYXRpb25zIGV2ZXJ5IDNzIGZvciAxMDBzLiAqL1xyXG4gIEBJbnB1dCgnbm90aWZpY2F0aW9uJCcpIHB1YmxpYyBub3RpZmljYXRpb24kOiBPYnNlcnZhYmxlPEF2bE5vdGlmaWNhdGlvbj4gPSBuZXcgT2JzZXJ2YWJsZShcclxuICAgIGZ1bmN0aW9uIHN1YnNjcmliZShzdWJzY3JpYmVyKSB7XHJcbiAgICAgIGxldCBpID0gMDtcclxuICAgICAgY29uc3QgaW50ZXJ2YWxJZCA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICBjb25zdCB3YXJuaW5nID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpKTtcclxuICAgICAgICBzdWJzY3JpYmVyLm5leHQoe1xyXG4gICAgICAgICAgaWQ6IGkrKyxcclxuICAgICAgICAgIG1vZHVsZTogJ25vdGlmaWNhdGlvbi1jb250YWluZXInLFxyXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxyXG4gICAgICAgICAgdHlwZTogd2FybmluZyA/IEF2bE5vdGlmaWNhdGlvblR5cGUuV2FybmluZyA6IEF2bE5vdGlmaWNhdGlvblR5cGUuSW5mbyxcclxuICAgICAgICAgIG1lc3NhZ2VUZXh0OiAnU25hY2tiYXIgd2l0aCBub3RpZmljYXRpb24nICsgbmV3IERhdGUoKS50b1RpbWVTdHJpbmcoKSxcclxuICAgICAgICAgIHJlYWQ6IGZhbHNlLFxyXG4gICAgICAgICAgbGluazogJ2h0dHBzOi8vdml6Ym94LmF2bC5jb20nXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0sIDMwMDApO1xyXG5cclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbElkKTtcclxuICAgICAgfSwgMTAwMDAwKTtcclxuICAgIH1cclxuICApO1xyXG5cclxuICBAT3V0cHV0KCkgb3Blbk1lbnU6IEV2ZW50RW1pdHRlcjx2b2lkPiA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcclxuXHJcbiAgLyoqIEBoaWRkZW4gKi9cclxuICBwdWJsaWMgd2FybmluZ1N0YWNrOiBTbmFja2JhclN0YWNrO1xyXG4gIC8qKiBAaGlkZGVuICovXHJcbiAgcHVibGljIGluZm9TdGFjazogU25hY2tiYXJTdGFjaztcclxuXHJcbiAgLyoqIEBoaWRkZW4gKi9cclxuICBwdWJsaWMgcHJldmlvdXNOb3RpZmljYXRpb246IEF2bE5vdGlmaWNhdGlvbjtcclxuXHJcbiAgLyoqIEBoaWRkZW4gKi9cclxuICBwdWJsaWMgc3RhY2tIZWlnaHQ6IHsgW2tleTogc3RyaW5nXTogbnVtYmVyIH0gPSB7fTtcclxuXHJcbiAgLyoqIEBoaWRkZW4gKi9cclxuICBwdWJsaWMgcmVvcGVuOiBib29sZWFuO1xyXG5cclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIHB1YmxpYyBub3RpZmljYXRpb25MaXN0OiBBdmxOb3RpZmljYXRpb25bXSA9IFtdO1xyXG5cclxuICBwcml2YXRlIGFjdGl2ZU5vdGlmaWNhdGlvbjogQXZsTm90aWZpY2F0aW9uO1xyXG4gIHByaXZhdGUgZGVzdHJveWVkJDogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IGNkUmVmOiBDaGFuZ2VEZXRlY3RvclJlZikge1xyXG4gICAgdGhpcy53YXJuaW5nU3RhY2sgPSBuZXcgU25hY2tiYXJTdGFjayhcclxuICAgICAgU3RyaW5nKE5PVElGSUNBVElPTl9UWVBFLmdldChBdmxOb3RpZmljYXRpb25UeXBlLldhcm5pbmcpKS50b0xvd2VyQ2FzZSgpXHJcbiAgICApO1xyXG5cclxuICAgIHRoaXMuaW5mb1N0YWNrID0gbmV3IFNuYWNrYmFyU3RhY2soXHJcbiAgICAgIFN0cmluZyhOT1RJRklDQVRJT05fVFlQRS5nZXQoQXZsTm90aWZpY2F0aW9uVHlwZS5JbmZvKSkudG9Mb3dlckNhc2UoKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgdGhpcy5kZXN0cm95ZWQkLm5leHQoKTtcclxuICAgIHRoaXMuZGVzdHJveWVkJC5jb21wbGV0ZSgpO1xyXG4gIH1cclxuXHJcbiAgbmdBZnRlclZpZXdDaGVja2VkKCk6IHZvaWQge1xyXG4gICAgdGhpcy5jZFJlZi5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgfVxyXG5cclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIHB1YmxpYyBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMucG9zaXRpb25Ub3AgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdtYWluJyk/Lm9mZnNldFRvcCArIDEyICsgJ3B4JztcclxuICAgIHRoaXMubm90aWZpY2F0aW9uJD8ucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95ZWQkKSkuc3Vic2NyaWJlKG5vdGlmaWNhdGlvbiA9PiB7XHJcbiAgICAgIHRoaXMuaGFuZGxlTm90aWZpY2F0aW9uKG5vdGlmaWNhdGlvbik7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKiBAaGlkZGVuICovXHJcbiAgcHVibGljIG9uQnV0dG9uQ2xpY2tlZCA9IChldmVudDogYW55KTogdm9pZCA9PiB7XHJcbiAgICBpZiAoZXZlbnQpIHtcclxuICAgICAgdGhpcy5vcGVuTWVudS5lbWl0KCk7XHJcbiAgICAgIHRoaXMuZGlzbWlzc0FsbCgpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIC8qKiBAaGlkZGVuICovXHJcbiAgcHVibGljIG9uTm90aWZpY2F0aW9uRGlzbWlzc2VkID0gKGV2ZW50OiBhbnksIG5vdGlmaWNhdGlvbjogQXZsTm90aWZpY2F0aW9uKTogdm9pZCA9PiB7XHJcbiAgICBpZiAoZXZlbnQpIHtcclxuICAgICAgY29uc3Qgc25hY2tUeXBlID0gKGV2ZW50LnRhcmdldCBhcyBIVE1MRWxlbWVudCk/LmlkPy5yZXBsYWNlKCdTbmFja2JhcicsICcnKTtcclxuICAgICAgdGhpcy5yZW1vdmVOb3RpZmljYXRpb24obm90aWZpY2F0aW9uLCBzbmFja1R5cGUpO1xyXG4gICAgfVxyXG4gIH07XHJcbiAgLyoqIEBoaWRkZW4gKi9cclxuICAvKiogRXZlbnQgZmlyZWQgd2hlbiBub3RpZmljYXRpb24gc25hY2tiYXIgaXMgY2xpY2tlZCBcclxuICAgKiBkZXBlbmRpbmcgb24gdGhlIG5vdGlmaWNhdGlvbiBmbGFnIGl0IG9wZW5zIGluIG5ldyB0YWJcclxuICAqL1xyXG4gIHB1YmxpYyBvbk5vdGlmaWNhdGlvblNuYWNrYmFyQ2xpY2tlZChldmVudDogRXZlbnQpOiB2b2lkIHtcclxuICAgIGNvbnN0IHNuYWNrYmFyID0gKDxDdXN0b21FdmVudD5ldmVudCkuZGV0YWlsO1xyXG4gICAgaWYgKHNuYWNrYmFyLmxpbmspIHtcclxuICAgICAgaWYgKHNuYWNrYmFyLm9wZW5Jbk5ld1RhYikge1xyXG4gICAgICAgIHdpbmRvdy5vcGVuKHNuYWNrYmFyLmxpbmssICdfYmxhbmsnKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB3aW5kb3cub3BlbihzbmFja2Jhci5saW5rLCAnX3NlbGYnKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqIEBoaWRkZW4gKi9cclxuICBwdWJsaWMgb3BlbkZyb21TdGFjayA9IChub3RpZmljYXRpb246IEF2bE5vdGlmaWNhdGlvbik6IHZvaWQgPT4ge1xyXG4gICAgY29uc3Qgc3RhY2tOYW1lID0gdGhpcy5nZXRTdGFja05hbWUobm90aWZpY2F0aW9uLnR5cGUpO1xyXG4gICAgdGhpc1tzdGFja05hbWVdLm1ldGhvZERlc2NyaXB0aW9uID0gbmV3IFNuYWNrYmFyTWV0aG9kRGVzY3JpcHRpb24oJ2hpZGUnLCB0cnVlKTtcclxuICB9O1xyXG5cclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIHB1YmxpYyBkaXNtaXNzQWxsID0gKCk6IHZvaWQgPT4ge1xyXG4gICAgdGhpcy5ub3RpZmljYXRpb25MaXN0ID0gW107XHJcbiAgICB0aGlzLndhcm5pbmdTdGFjay5hY3RpdmVOb3RpZmljYXRpb24kLm5leHQodW5kZWZpbmVkKTtcclxuICAgIHRoaXMuaW5mb1N0YWNrLmFjdGl2ZU5vdGlmaWNhdGlvbiQubmV4dCh1bmRlZmluZWQpO1xyXG4gIH07XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlTm90aWZpY2F0aW9uID0gKG5vdGlmaWNhdGlvbjogYW55KTogdm9pZCA9PiB7XHJcbiAgICB0aGlzLnByZXZpb3VzTm90aWZpY2F0aW9uID0gdGhpcy5ub3RpZmljYXRpb25MaXN0W3RoaXMubm90aWZpY2F0aW9uTGlzdC5sZW5ndGggLSAxXTtcclxuICAgIHRoaXMubm90aWZpY2F0aW9uTGlzdC5wdXNoKG5vdGlmaWNhdGlvbik7XHJcbiAgICB0aGlzLnVwZGF0ZVN0YWNrQWN0aXZlTm90aWZpY2F0aW9uKG5vdGlmaWNhdGlvbik7XHJcbiAgICB0aGlzLnNldFN0YWNrQW5pbWF0aW9uKG5vdGlmaWNhdGlvbi50eXBlKTtcclxuICB9O1xyXG5cclxuICBwcml2YXRlIHVwZGF0ZVN0YWNrQWN0aXZlTm90aWZpY2F0aW9uID0gKG5vdGlmaWNhdGlvbjogQXZsTm90aWZpY2F0aW9uKTogdm9pZCA9PiB7XHJcbiAgICBjb25zdCBzdGFja05hbWU6IHN0cmluZyA9IHRoaXMuZ2V0U3RhY2sobm90aWZpY2F0aW9uPy50eXBlKTtcclxuICAgIHRoaXMudXBkYXRlU3RhY2tOb3RpZmljYXRpb25MaXN0KG5vdGlmaWNhdGlvbi50eXBlKTtcclxuICAgIHRoaXMuYWN0aXZlTm90aWZpY2F0aW9uID0gbm90aWZpY2F0aW9uO1xyXG5cclxuICAgIGlmICh0aGlzW3N0YWNrTmFtZV0ubm90aWZpY2F0aW9uTGlzdC5sZW5ndGggPiAxKSB7XHJcbiAgICAgIHRoaXMucmVvcGVuID0gdHJ1ZTtcclxuICAgICAgaWYgKHRoaXMucHJldmlvdXNOb3RpZmljYXRpb24/LnR5cGUgPT09IG5vdGlmaWNhdGlvbi50eXBlKSB7XHJcbiAgICAgICAgdGhpc1tzdGFja05hbWVdLnNuYWNrYmFyQW5pbWF0aW9uID0gUG9zaXRpb25BbmltYXRpb24uVG9TdGFjaztcclxuXHJcbiAgICAgICAgLy8gc2lsZW50bHkgZGlzbWlzcyBub3RpZmljYXRpb24gYWZ0ZXIgcHJldmlvdXMgbm90aWZpY2F0aW9uIGFuaW1hdGlvblxyXG4gICAgICAgIGNvbnN0IHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgIHRoaXMuc2lsZW50bHlEaXNtaXNzTm90aWZpY2F0aW9uKHN0YWNrTmFtZSk7XHJcbiAgICAgICAgICB0aGlzW3N0YWNrTmFtZV0uc25hY2tiYXJBbmltYXRpb24gPSBudWxsO1xyXG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xyXG4gICAgICAgIH0sIEFOSU1BVElPTl9EVVJBVElPTik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5zaWxlbnRseURpc21pc3NOb3RpZmljYXRpb24oc3RhY2tOYW1lKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpc1tzdGFja05hbWVdLmFjdGl2ZU5vdGlmaWNhdGlvbiQubmV4dChub3RpZmljYXRpb24pO1xyXG4gICAgfVxyXG4gIH07XHJcbiAgcHJpdmF0ZSB1cGRhdGVTdGFja05vdGlmaWNhdGlvbkxpc3QgPSAoXHJcbiAgICBub3RpZmljYXRpb25UeXBlOiBBdmxOb3RpZmljYXRpb25UeXBlXHJcbiAgKTogQXZsTm90aWZpY2F0aW9uW10gPT4ge1xyXG4gICAgY29uc3Qgc3RhY2sgPSB0aGlzW3RoaXMuZ2V0U3RhY2sobm90aWZpY2F0aW9uVHlwZSldO1xyXG4gICAgaWYgKHN0YWNrKSB7XHJcbiAgICAgIHN0YWNrLm5vdGlmaWNhdGlvbkxpc3QgPSB0aGlzLm5vdGlmaWNhdGlvbkxpc3QuZmlsdGVyKGl0ZW0gPT4gaXRlbS50eXBlID09PSBub3RpZmljYXRpb25UeXBlKTtcclxuICAgIH1cclxuICAgIHJldHVybiBzdGFjay5ub3RpZmljYXRpb25MaXN0O1xyXG4gIH07XHJcblxyXG4gIHByaXZhdGUgc2lsZW50bHlEaXNtaXNzTm90aWZpY2F0aW9uID0gKHN0YWNrTmFtZTogc3RyaW5nKTogdm9pZCA9PiB7XHJcbiAgICB0aGlzW3N0YWNrTmFtZV0uZGlzbWlzc2VkU2lsZW50bHkgPSB0cnVlO1xyXG4gICAgdGhpc1tzdGFja05hbWVdLm1ldGhvZERlc2NyaXB0aW9uID0gbmV3IFNuYWNrYmFyTWV0aG9kRGVzY3JpcHRpb24oJ2hpZGUnLCBmYWxzZSk7XHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSBzZXRTdGFja0FuaW1hdGlvbiA9IChcclxuICAgIG5vdGlmaWNhdGlvblR5cGU6IEF2bE5vdGlmaWNhdGlvblR5cGUsXHJcbiAgICBhbmltYXRpb24/OiBQb3NpdGlvbkFuaW1hdGlvblxyXG4gICk6IHZvaWQgPT4ge1xyXG4gICAgY29uc3QgY3VycmVudFN0YWNrID0gdGhpcy5nZXRTdGFjayhub3RpZmljYXRpb25UeXBlKTtcclxuICAgIGNvbnN0IHByZXZpb3VzU3RhY2sgPSB0aGlzLmdldFN0YWNrKG5vdGlmaWNhdGlvblR5cGUsIHRydWUpO1xyXG5cclxuICAgIGlmIChcclxuICAgICAgdGhpc1twcmV2aW91c1N0YWNrXT8ubm90aWZpY2F0aW9uTGlzdD8ubGVuZ3RoID4gMCAmJlxyXG4gICAgICB0aGlzLnByZXZpb3VzTm90aWZpY2F0aW9uPy50eXBlICE9PSBub3RpZmljYXRpb25UeXBlXHJcbiAgICApIHtcclxuICAgICAgdGhpc1twcmV2aW91c1N0YWNrXS5zdGFja0FuaW1hdGlvbiA9IGFuaW1hdGlvbiB8fCBQb3NpdGlvbkFuaW1hdGlvbi5Ub0JvdHRvbTtcclxuXHJcbiAgICAgIHRoaXNbY3VycmVudFN0YWNrXS5zdGFja0FuaW1hdGlvbiA9XHJcbiAgICAgICAgYW5pbWF0aW9uID09PSBQb3NpdGlvbkFuaW1hdGlvbi5Ub1RvcFxyXG4gICAgICAgICAgPyBQb3NpdGlvbkFuaW1hdGlvbi5Ub0JvdHRvbVxyXG4gICAgICAgICAgOiBQb3NpdGlvbkFuaW1hdGlvbi5Ub1RvcDtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBwcml2YXRlIHJlbW92ZU5vdGlmaWNhdGlvbiA9IChub3RpZmljYXRpb246IEF2bE5vdGlmaWNhdGlvbiwgc25hY2tUeXBlPzogc3RyaW5nKTogdm9pZCA9PiB7XHJcbiAgICBjb25zdCBzdGFja05hbWU6IHN0cmluZyA9IHRoaXMuZ2V0U3RhY2sobm90aWZpY2F0aW9uPy50eXBlKTtcclxuICAgIGlmICh0aGlzW3N0YWNrTmFtZV0uZGlzbWlzc2VkU2lsZW50bHkpIHtcclxuICAgICAgLy9ub3RpZmljYXRpb24gZGlzbWlzc2VkIHNpbGVudGx5XHJcbiAgICAgIGNvbnN0IHN0YWNrTmFtZTogc3RyaW5nID0gdGhpcy5nZXRTdGFjayh0aGlzLmFjdGl2ZU5vdGlmaWNhdGlvbj8udHlwZSk7XHJcbiAgICAgIHRoaXNbc3RhY2tOYW1lXS5hY3RpdmVOb3RpZmljYXRpb24kLm5leHQodGhpcy5hY3RpdmVOb3RpZmljYXRpb24pO1xyXG4gICAgICB0aGlzLnJlb3BlbiA9IGZhbHNlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy9ub3RpZmljYXRpb24gZGlzbWlzc2VkXHJcbiAgICAgIHRoaXMubm90aWZpY2F0aW9uTGlzdCA9IHRoaXMubm90aWZpY2F0aW9uTGlzdC5maWx0ZXIoXHJcbiAgICAgICAgY3VycmVudE5vdGlmaWNhdGlvbiA9PiBjdXJyZW50Tm90aWZpY2F0aW9uLmlkICE9PSBub3RpZmljYXRpb24uaWRcclxuICAgICAgKTtcclxuICAgICAgdGhpcy5yZW9wZW5MYXN0Tm90aWZpY2F0aW9uKG5vdGlmaWNhdGlvbiwgc3RhY2tOYW1lKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBwcml2YXRlIHJlb3Blbkxhc3ROb3RpZmljYXRpb24gPSAobm90aWZpY2F0aW9uOiBBdmxOb3RpZmljYXRpb24sIHN0YWNrTmFtZTogc3RyaW5nKTogdm9pZCA9PiB7XHJcbiAgICBsZXQgc3RhY2tOb3RpZmljYXRpb25MaXN0OiBBdmxOb3RpZmljYXRpb25bXSA9IHRoaXNbc3RhY2tOYW1lXT8ubm90aWZpY2F0aW9uTGlzdDtcclxuICAgIGlmIChcclxuICAgICAgdGhpcy5pc0xhc3ROb3RpZmljYXRpb25EaXNtaXNzZWQobm90aWZpY2F0aW9uLCB0aGlzW3N0YWNrTmFtZV0pICYmXHJcbiAgICAgIHN0YWNrTm90aWZpY2F0aW9uTGlzdD8ubGVuZ3RoID4gMFxyXG4gICAgKSB7XHJcbiAgICAgIHRoaXNbc3RhY2tOYW1lXS5yZW9wZW4gPSB0cnVlO1xyXG5cclxuICAgICAgc3RhY2tOb3RpZmljYXRpb25MaXN0ID0gdGhpcy51cGRhdGVTdGFja05vdGlmaWNhdGlvbkxpc3Qobm90aWZpY2F0aW9uLnR5cGUpO1xyXG4gICAgICBjb25zdCBsYXN0Tm90aWZpY2F0aW9uID0gc3RhY2tOb3RpZmljYXRpb25MaXN0W3N0YWNrTm90aWZpY2F0aW9uTGlzdC5sZW5ndGggLSAxXTtcclxuICAgICAgaWYgKGxhc3ROb3RpZmljYXRpb24pIHtcclxuICAgICAgICB0aGlzW3N0YWNrTmFtZV0uYWN0aXZlTm90aWZpY2F0aW9uJC5uZXh0KGxhc3ROb3RpZmljYXRpb24pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXNbc3RhY2tOYW1lXS5zdGFja0luZGljYXRvciA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXNbc3RhY2tOYW1lXS5yZW9wZW4gPSBmYWxzZTtcclxuICAgICAgICB0aGlzW3N0YWNrTmFtZV0uYW5pbWF0ZVN0YWNrID0gUG9zaXRpb25BbmltYXRpb24uVG9Cb3R0b207XHJcbiAgICAgICAgdGhpcy5zZXRTdGFja0FuaW1hdGlvbihub3RpZmljYXRpb24udHlwZSwgUG9zaXRpb25BbmltYXRpb24uVG9Ub3ApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSBpc0xhc3ROb3RpZmljYXRpb25EaXNtaXNzZWQgPSAoXHJcbiAgICBub3RpZmljYXRpb246IEF2bE5vdGlmaWNhdGlvbixcclxuICAgIHN0YWNrOiBTbmFja2JhclN0YWNrXHJcbiAgKTogYm9vbGVhbiA9PiB7XHJcbiAgICBjb25zdCBsYXN0Tm90aWZpY2F0aW9uOiBBdmxOb3RpZmljYXRpb24gPVxyXG4gICAgICBzdGFjay5ub3RpZmljYXRpb25MaXN0W3N0YWNrLm5vdGlmaWNhdGlvbkxpc3QubGVuZ3RoIC0gMV07XHJcbiAgICByZXR1cm4gbGFzdE5vdGlmaWNhdGlvbj8uaWQgPT09IG5vdGlmaWNhdGlvbj8uaWQ7XHJcbiAgfTtcclxuICBwcml2YXRlIGdldFN0YWNrKG5vdGlmaWNhdGlvblR5cGU6IG51bWJlciwgcHJldmlvdXM/OiBib29sZWFuKTogc3RyaW5nIHtcclxuICAgIGxldCBzdGFja1R5cGU6IEF2bE5vdGlmaWNhdGlvblR5cGU7XHJcbiAgICBpZiAoXHJcbiAgICAgIG5vdGlmaWNhdGlvblR5cGUgPT09IEF2bE5vdGlmaWNhdGlvblR5cGUuV2FybmluZyB8fFxyXG4gICAgICBub3RpZmljYXRpb25UeXBlID09PSBBdmxOb3RpZmljYXRpb25UeXBlLkVycm9yXHJcbiAgICApIHtcclxuICAgICAgc3RhY2tUeXBlID0gcHJldmlvdXMgPyBBdmxOb3RpZmljYXRpb25UeXBlLkluZm8gOiBBdmxOb3RpZmljYXRpb25UeXBlLldhcm5pbmc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzdGFja1R5cGUgPSBwcmV2aW91cyA/IEF2bE5vdGlmaWNhdGlvblR5cGUuV2FybmluZyA6IEF2bE5vdGlmaWNhdGlvblR5cGUuSW5mbztcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmdldFN0YWNrTmFtZShzdGFja1R5cGUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRTdGFja05hbWUgPSAoc3RhY2tUeXBlOiBBdmxOb3RpZmljYXRpb25UeXBlKTogc3RyaW5nID0+IHtcclxuICAgIHJldHVybiBzdGFja1R5cGUgPT09IDEgPyAnd2FybmluZ1N0YWNrJyA6ICdpbmZvU3RhY2snO1xyXG4gIH07XHJcbn1cclxuIiwiPGRpdiBjbGFzcz1cInNuYWNrYmFyXCIgKm5nSWY9XCJub3RpZmljYXRpb24kIHwgYXN5bmMgYXMgbm90aWZpY2F0aW9uXCI+XHJcbiAgPGRpdlxyXG4gICAgW2FuaW1hdGVTdGFja109XCJ3YXJuaW5nU3RhY2s/LnN0YWNrQW5pbWF0aW9uXCJcclxuICAgIFtwcmV2aW91c1N0YWNrSGVpZ2h0XSA9IFwiaW5mb1N0YWNrLm5vdGlmaWNhdGlvbkxpc3QubGVuZ3RoPjAgPyBpbmZvU25hY2tFbGVtZW50Lm9mZnNldEhlaWdodCA6IDBcIlxyXG4gICAgW3NuYWNrYmFyTWV0aG9kRGVzY3JpcHRpb25dID0gXCJ3YXJuaW5nU3RhY2subWV0aG9kRGVzY3JpcHRpb25cIlxyXG4gICAgY2xhc3M9XCJzbmFja2Jhci1zdGFja1wiXHJcbiAgICBpZD1cIndhcm5pbmdTdGFja1wiXHJcbiAgICAjd2FybmluZ1N0YWNrRWxlbWVudFxyXG4gID5cclxuICAgIDxkaXYgW2FuaW1hdGVTbmFja2Jhcl09XCJ3YXJuaW5nU3RhY2suc25hY2tiYXJBbmltYXRpb25cIiBpZD1cIndhcm5pbmdTbmFja1wiICN3YXJuaW5nU25hY2tFbGVtZW50PlxyXG4gICAgICA8YXZsLXNuYWNrYmFyXHJcbiAgICAgICAgKm5nSWY9XCJ3YXJuaW5nU3RhY2suYWN0aXZlTm90aWZpY2F0aW9uJCB8IGFzeW5jIGFzIGFjdGl2ZVdhcm5pbmdOb3RpZmljYXRpb25cIlxyXG4gICAgICAgIGlkPVwid2FybmluZ1NuYWNrYmFyXCJcclxuICAgICAgICBbbWVzc2FnZV09XCJhY3RpdmVXYXJuaW5nTm90aWZpY2F0aW9uPy5tZXNzYWdlVGV4dFwiXHJcbiAgICAgICAgW29wZW5Jbk5ld1RhYl09XCJhY3RpdmVXYXJuaW5nTm90aWZpY2F0aW9uLm9wZW5Jbk5ld1RhYlwiXHJcbiAgICAgICAgW2FjdGlvbkJ1dHRvbkxhYmVsXT1cIndhcm5pbmdTdGFjay5zdGFja0luZGljYXRvckJ1dHRvbkxhYmVsXCJcclxuICAgICAgICBbbGlua109XCJhY3RpdmVXYXJuaW5nTm90aWZpY2F0aW9uLmxpbmtcIlxyXG4gICAgICAgIFttZXNzYWdlVHlwZV09XCJhY3RpdmVXYXJuaW5nTm90aWZpY2F0aW9uLnR5cGVcIlxyXG4gICAgICAgIHNsaWRpbmdcclxuICAgICAgICAoYnV0dG9uQ2xpY2tlZCk9XCJvbkJ1dHRvbkNsaWNrZWQoJGV2ZW50KVwiXHJcbiAgICAgICAgKG5vdGlmaWNhdGlvbkRpc21pc3NlZCk9XCJvbk5vdGlmaWNhdGlvbkRpc21pc3NlZCgkZXZlbnQsIGFjdGl2ZVdhcm5pbmdOb3RpZmljYXRpb24pXCJcclxuICAgICAgICBzbmFja2Jhckxpc3RlbmVyXHJcbiAgICAgICAgI3dhcm5pbmdTbmFja2JhclxyXG4gICAgICAgIHNob3dIaWRlU25hY2tiYXI9XCJ3YXJuaW5nU25hY2tiYXJcIlxyXG4gICAgICAgIFttZXRob2REZXNjcmlwdGlvbl09XCJ3YXJuaW5nU3RhY2subWV0aG9kRGVzY3JpcHRpb25cIlxyXG4gICAgICAgIChzbmFja2Jhci1jbGlja2VkKT1cIm9uTm90aWZpY2F0aW9uU25hY2tiYXJDbGlja2VkKCRldmVudClcIlxyXG4gICAgICA+PC9hdmwtc25hY2tiYXI+XHJcbiAgICA8L2Rpdj5cclxuXHJcbiAgICA8ZGl2IGNsYXNzPVwic3RhY2staW5kaWNhdG9yLWNvbnRhaW5lclwiICpuZ0lmPVwid2FybmluZ1N0YWNrLm5vdGlmaWNhdGlvbkxpc3QubGVuZ3RoPjFcIiAjd2FybmluZ1N0YWNrSW5kaWNhdG9yPlxyXG4gICAgICA8ZGl2IGNsYXNzPVwic3RhY2staW5kaWNhdG9yXCI+XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cIm5vdGlmaWNhdGlvbi1jb250YWluZXJcIj5cclxuICAgICAgICAgIDxkaXYgW25nQ2xhc3NdPVwieydub3RpZmljYXRpb24nOiB0cnVlLCAnaGFzLWFjdGlvbic6IHdhcm5pbmdTdGFjay5zdGFja0luZGljYXRvckJ1dHRvbkxhYmVsfVwiPlxyXG4gICAgICAgICAgICA8YXZsLWljb24gaWNvbj1cImljb25zOndhcm5pbmdcIiBpZD1cIndhcm5pbmdJY29uXCIgY2xhc3M9XCJ3YXJuaW5nXCI+PC9hdmwtaWNvbj5cclxuICAgICAgICAgICAgPHAgaWQ9XCJzbmFja2Jhck1lc3NhZ2VcIj57eyB3YXJuaW5nU3RhY2sucHJldmlvdXNOb3RpZmljYXRpb24/Lm1lc3NhZ2VUZXh0IH19PC9wPlxyXG4gICAgICAgICAgICA8YXZsLWljb24tYnV0dG9uIGlkPVwiY2xvc2VCdXR0b25cIiBpY29uPVwiaWNvbnM6Y2xvc2VcIj48L2F2bC1pY29uLWJ1dHRvbj5cclxuICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgPGJ1dHRvbiBpZD1cImFjdGlvbkJ1dHRvblwiICpuZ0lmPVwid2FybmluZ1N0YWNrLnN0YWNrSW5kaWNhdG9yQnV0dG9uTGFiZWxcIiAoY2xpY2spPVwib3BlbkZyb21TdGFjayh3YXJuaW5nU3RhY2sucHJldmlvdXNOb3RpZmljYXRpb24pXCI+XHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJidXR0b24tbGFiZWxcIj57eyB3YXJuaW5nU3RhY2suc3RhY2tJbmRpY2F0b3JCdXR0b25MYWJlbCB9fTwvZGl2PlxyXG4gICAgICAgICAgPC9idXR0b24+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgPC9kaXY+XHJcbiAgPC9kaXY+XHJcbiAgPGRpdlxyXG4gICAgY2xhc3M9XCJzbmFja2Jhci1zdGFja1wiXHJcbiAgICBpZD1cImluZm9TdGFja1wiXHJcbiAgICBbYW5pbWF0ZVN0YWNrXT1cImluZm9TdGFjaz8uc3RhY2tBbmltYXRpb25cIlxyXG4gICAgW3ByZXZpb3VzU3RhY2tIZWlnaHRdID0gXCJpbmZvU3RhY2subm90aWZpY2F0aW9uTGlzdC5sZW5ndGg+MCA/IHdhcm5pbmdTbmFja0VsZW1lbnQub2Zmc2V0SGVpZ2h0IDogMFwiXHJcbiAgICBbc25hY2tiYXJNZXRob2REZXNjcmlwdGlvbl0gPSBcImluZm9TdGFjay5tZXRob2REZXNjcmlwdGlvblwiXHJcbiAgICAjaW5mb1N0YWNrRWxlbWVudFxyXG4gID5cclxuICAgIDxkaXYgW2FuaW1hdGVTbmFja2Jhcl09XCJpbmZvU3RhY2suc25hY2tiYXJBbmltYXRpb25cIiBpZD1cImluZm9TbmFja1wiICNpbmZvU25hY2tFbGVtZW50PlxyXG4gICAgICA8YXZsLXNuYWNrYmFyXHJcbiAgICAgICAgaWQ9XCJpbmZvU25hY2tiYXJcIlxyXG4gICAgICAgICpuZ0lmPVwiaW5mb1N0YWNrLmFjdGl2ZU5vdGlmaWNhdGlvbiQgfCBhc3luYyBhcyBhY3RpdmVJbmZvTm90aWZpY2F0aW9uXCJcclxuICAgICAgICBbbWVzc2FnZV09XCJhY3RpdmVJbmZvTm90aWZpY2F0aW9uLm1lc3NhZ2VUZXh0XCJcclxuICAgICAgICBbb3BlbkluTmV3VGFiXT1cImFjdGl2ZUluZm9Ob3RpZmljYXRpb24ub3BlbkluTmV3VGFiXCJcclxuICAgICAgICBbYWN0aW9uQnV0dG9uTGFiZWxdPVwiaW5mb1N0YWNrLnN0YWNrSW5kaWNhdG9yQnV0dG9uTGFiZWxcIlxyXG4gICAgICAgIFtsaW5rXT1cImFjdGl2ZUluZm9Ob3RpZmljYXRpb24ubGlua1wiXHJcbiAgICAgICAgW21lc3NhZ2VUeXBlXT1cImFjdGl2ZUluZm9Ob3RpZmljYXRpb24udHlwZVwiXHJcbiAgICAgICAgW2Rpc3BsYXlJY29uXT1cImRpc3BsYXlJY29uXCJcclxuICAgICAgICBzbGlkaW5nXHJcbiAgICAgICAgKGJ1dHRvbkNsaWNrZWQpPVwib25CdXR0b25DbGlja2VkKCRldmVudClcIlxyXG4gICAgICAgIChub3RpZmljYXRpb25EaXNtaXNzZWQpPVwib25Ob3RpZmljYXRpb25EaXNtaXNzZWQoJGV2ZW50LCBhY3RpdmVJbmZvTm90aWZpY2F0aW9uKVwiXHJcbiAgICAgICAgc25hY2tiYXJMaXN0ZW5lclxyXG4gICAgICAgICNpbmZvU25hY2tiYXJcclxuICAgICAgICBzaG93SGlkZVNuYWNrYmFyPVwiaW5mb1NuYWNrYmFyXCJcclxuICAgICAgICBbbWV0aG9kRGVzY3JpcHRpb25dPVwiaW5mb1N0YWNrLm1ldGhvZERlc2NyaXB0aW9uXCJcclxuICAgICAgICAoc25hY2tiYXItY2xpY2tlZCk9XCJvbk5vdGlmaWNhdGlvblNuYWNrYmFyQ2xpY2tlZCgkZXZlbnQpXCJcclxuICAgICAgPjwvYXZsLXNuYWNrYmFyPlxyXG4gICAgPC9kaXY+XHJcblxyXG4gICAgPGRpdiBjbGFzcz1cInN0YWNrLWluZGljYXRvci1jb250YWluZXJcIiAqbmdJZj1cImluZm9TdGFjay5ub3RpZmljYXRpb25MaXN0Lmxlbmd0aD4xXCIgI2luZm9TdGFja0luZGljYXRvcj5cclxuICAgICAgPGRpdiBjbGFzcz1cInN0YWNrLWluZGljYXRvclwiPlxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJub3RpZmljYXRpb24tY29udGFpbmVyXCI+XHJcbiAgICAgICAgICA8ZGl2IFtuZ0NsYXNzXT1cInsnbm90aWZpY2F0aW9uJzogdHJ1ZSwgJ2hhcy1hY3Rpb24nOiBpbmZvU3RhY2suc3RhY2tJbmRpY2F0b3JCdXR0b25MYWJlbH1cIj5cclxuICAgICAgICAgICAgPHAgaWQ9XCJzbmFja2Jhck1lc3NhZ2VcIj57eyBpbmZvU3RhY2sucHJldmlvdXNOb3RpZmljYXRpb24/Lm1lc3NhZ2VUZXh0IH19PC9wPlxyXG4gICAgICAgICAgICA8YXZsLWljb24tYnV0dG9uIGlkPVwiY2xvc2VCdXR0b25cIiBpY29uPVwiaWNvbnM6Y2xvc2VcIj48L2F2bC1pY29uLWJ1dHRvbj5cclxuICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICAgIDxidXR0b24gaWQ9XCJhY3Rpb25CdXR0b25cIiAqbmdJZj1cImluZm9TdGFjay5zdGFja0luZGljYXRvckJ1dHRvbkxhYmVsXCIgKGNsaWNrKT1cIm9wZW5Gcm9tU3RhY2soaW5mb1N0YWNrLnByZXZpb3VzTm90aWZpY2F0aW9uKVwiPlxyXG4gICAgICAgICAgPGRpdiBjbGFzcz1cImJ1dHRvbi1sYWJlbFwiPnt7IGluZm9TdGFjay5zdGFja0luZGljYXRvckJ1dHRvbkxhYmVsIH19PC9kaXY+XHJcbiAgICAgICAgPC9idXR0b24+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgPC9kaXY+XHJcbiAgPC9kaXY+XHJcbiAgPGRpdlxyXG4gICAgYW5pbWF0ZUJ1dHRvblxyXG4gICAgW2luZm9TdGFja0hlaWdodF09XCJpbmZvU3RhY2s/Lm5vdGlmaWNhdGlvbkxpc3Q/Lmxlbmd0aCA+IDAgPyBpbmZvU25hY2tFbGVtZW50Lm9mZnNldEhlaWdodCA6IDBcIlxyXG4gICAgW3dhcm5pbmdTdGFja0hlaWdodF09XCJ3YXJuaW5nU3RhY2s/Lm5vdGlmaWNhdGlvbkxpc3Q/Lmxlbmd0aCA+IDAgPyB3YXJuaW5nU25hY2tFbGVtZW50Lm9mZnNldEhlaWdodCA6IDBcIlxyXG4gICAgW2luZm9TdGFja0luZGljYXRvckhlaWdodF09XCJpbmZvU3RhY2tJbmRpY2F0b3JFbGVtZW50Py5uYXRpdmVFbGVtZW50Py5vZmZzZXRIZWlnaHRcIlxyXG4gICAgW3dhcm5pbmdTdGFja0luZGljYXRvckhlaWdodF09XCJ3YXJuaW5nU3RhY2tJbmRpY2F0b3JFbGVtZW50Py5uYXRpdmVFbGVtZW50Py5vZmZzZXRIZWlnaHRcIlxyXG4gICAgY2xhc3M9XCJkaXNtaXNzLWFsbFwiXHJcbiAgICAqbmdJZj1cIm5vdGlmaWNhdGlvbkxpc3Q/Lmxlbmd0aCA+IDFcIlxyXG4gID5cclxuICAgIDxhdmwtYnV0dG9uIGlkPVwiZGlzbWlzc0FsbFwiIChjbGljayk9XCJkaXNtaXNzQWxsKClcIj57eydWaXpCb3guTm90aWZpY2F0aW9uQ29udGFpbmVyLkRpc21pc3NBbGwnIHwgdHJhbnNsYXRlfX08L2F2bC1idXR0b24+XHJcbiAgPC9kaXY+XHJcbjwvZGl2PlxyXG5cclxuXHJcbiJdfQ==