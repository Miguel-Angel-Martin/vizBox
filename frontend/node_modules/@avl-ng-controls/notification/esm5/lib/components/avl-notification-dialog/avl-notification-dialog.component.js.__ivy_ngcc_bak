var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __values = (this && this.__values) || function(o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
};
var __read = (this && this.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};
var __spread = (this && this.__spread) || function () {
    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));
    return ar;
};
import { Component, Input, ViewChild, ElementRef, Output, EventEmitter, OnInit, ChangeDetectorRef, AfterViewChecked } from '@angular/core';
import '@avl-controls/datatable/dist/avl-datatable/avl-datatable';
import '@avl-controls/core/dist/avl-icon-button/avl-icon-button';
import '@avl-controls/core/dist/avl-icon/avl-icon';
import '@avl-controls/core/dist/avl-side-sheet/avl-side-sheet';
import '@avl-controls/core/dist/avl-checkbox/avl-checkbox';
import '@avl-controls/core/dist/avl-tooltip/avl-tooltip';
import '@avl-controls/core/dist/avl-date/avl-date';
import { DEFAULT_COLUMN_DEFINITIONS, DEFAULT_FILTERS, DEFAULT_PAGE_SIZE_OPTIONS, TYPE_ICON_STYLE_MAPPINGS, TYPE_ICON_MAPPINGS, STATE_ICON_MAPPINGS, NOTIFICATION_TYPE_MAPPINGS, DEFAULT_ICON_STYLE } from './avl-notification-dialog.consts';
import { NgForm } from '@angular/forms';
var AvlNotificationDialogComponent = /** @class */ (function () {
    function AvlNotificationDialogComponent(cdRef) {
        this.cdRef = cdRef;
        this.open = false;
        this.pageSizeOptions = DEFAULT_PAGE_SIZE_OPTIONS;
        this.columnDefinitions = DEFAULT_COLUMN_DEFINITIONS;
        this.openChange = new EventEmitter();
        this.markSelectedAsRead = new EventEmitter();
        this.markSelectedAsUnread = new EventEmitter();
        this.tableData = [];
        this.filteredData = [];
        this.badge = false;
        this.disableMarkingSelected = true;
        this.filters = this.deepCopyObject(DEFAULT_FILTERS);
        this.filtersOpen = true;
        this.showRefreshButton = false;
        this.dateFromLabel = 'Date from';
        this.dateToLabel = 'Date to';
        this.dateFilterGroupInitHeader = 'Date';
        this.dateFilterGroupHeader = this.dateFilterGroupInitHeader;
        //notification datatable options
        this.selectedRows = [];
        this.pageSize = 15;
        this.appliedFilters = this.deepCopyObject(DEFAULT_FILTERS);
        this._notifications = [];
    }
    Object.defineProperty(AvlNotificationDialogComponent.prototype, "notifications", {
        get: function () {
            return this._notifications;
        },
        set: function (notifications) {
            if (this._notifications.length === notifications.length) {
                return;
            }
            this.showRefreshButton = true;
            this._notifications = notifications;
        },
        enumerable: true,
        configurable: true
    });
    AvlNotificationDialogComponent.prototype.ngOnInit = function () {
        this.translateLabels();
        this.refreshTable();
    };
    AvlNotificationDialogComponent.prototype.ngAfterViewChecked = function () {
        this.cdRef.detectChanges();
    };
    /** Emits event when dialog opens or closes */
    AvlNotificationDialogComponent.prototype.openChanged = function (open) {
        this.openChange.emit(open);
    };
    /** Toggles displaying of filter sheet */
    AvlNotificationDialogComponent.prototype.toggleFilters = function () {
        this.filtersOpen = !this.filtersOpen;
    };
    /** Refreshes the datatable when refresh button is clicked */
    AvlNotificationDialogComponent.prototype.refreshTable = function () {
        this.showRefreshButton = false;
        this.tableData = this.prepareNotifications(this._notifications);
        this.filters = this.deepCopyObject(this.appliedFilters);
        this.filterData();
    };
    /**
     * Invoked when clicking apply button - filters data by given filters.
     */
    AvlNotificationDialogComponent.prototype.applyFilters = function () {
        this.appliedFilters = this.deepCopyObject(this.filters);
        this.filterData();
    };
    /** Filters notifications according to applied filters */
    AvlNotificationDialogComponent.prototype.filterData = function () {
        var e_1, _a;
        this.filteredData = [];
        var filters = this.getActiveFilters();
        try {
            for (var _b = __values(this.tableData), _c = _b.next(); !_c.done; _c = _b.next()) {
                var element = _c.value;
                if (this.doesElementPassEveryFilter(filters, element)) {
                    this.filteredData.push(element);
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
    };
    /** Changes selected notification state to read */
    AvlNotificationDialogComponent.prototype.markAsRead = function () {
        this.updateStateOfSelectedRowsTo(true);
        this.markSelectedAsRead.emit(this.selectedRows);
    };
    /** Changes selected notification state to unread */
    AvlNotificationDialogComponent.prototype.markAsUnread = function () {
        this.updateStateOfSelectedRowsTo(false);
        this.markSelectedAsUnread.emit(this.selectedRows);
    };
    /**
     * Resets all filters.
     */
    AvlNotificationDialogComponent.prototype.reset = function () {
        this.filters = this.deepCopyObject(DEFAULT_FILTERS);
        this.appliedFilters = this.deepCopyObject(DEFAULT_FILTERS);
        this.filterData();
        this.updateLabels();
        this.badge = false;
    };
    /** Calculates active filters from filter object */
    AvlNotificationDialogComponent.prototype.getActiveFilters = function () {
        var e_2, _a, e_3, _b;
        this.badge = false;
        var setFilters = {};
        try {
            // Mapping applied filters object to better format used for filtering, 
            // creates arrays from objects
            for (var _c = __values(Object.keys(this.appliedFilters)), _d = _c.next(); !_d.done; _d = _c.next()) {
                var item = _d.value;
                var secondLevelFilter = [];
                try {
                    for (var _e = (e_3 = void 0, __values(Object.keys(this.appliedFilters[item]))), _f = _e.next(); !_f.done; _f = _e.next()) {
                        var filter = _f.value;
                        if (this.appliedFilters[item][filter] === true) {
                            secondLevelFilter.push(filter);
                            this.badge = true;
                        }
                    }
                }
                catch (e_3_1) { e_3 = { error: e_3_1 }; }
                finally {
                    try {
                        if (_f && !_f.done && (_b = _e.return)) _b.call(_e);
                    }
                    finally { if (e_3) throw e_3.error; }
                }
                if (secondLevelFilter.length) {
                    setFilters[item] = secondLevelFilter;
                }
                if (item === 'date') {
                    setFilters[item] = [
                        this.appliedFilters[item]['dateFromValue'],
                        this.appliedFilters[item]['dateToValue']
                    ];
                }
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
            }
            finally { if (e_2) throw e_2.error; }
        }
        return setFilters;
    };
    /** Called when selection is applied to the table rows */
    AvlNotificationDialogComponent.prototype.selectedValuesChanged = function () {
        this.disableMarkingSelected = false;
        if (this.selectedRows.length == 0) {
            this.disableMarkingSelected = true;
        }
    };
    /** Updates date filter header labels when date changes */
    AvlNotificationDialogComponent.prototype.updateLabels = function () {
        return __awaiter(this, void 0, void 0, function () {
            var translationService, _a, dateFromValue, dateToValue, _b;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        translationService = AvlLocalizationService.translationService;
                        _a = this.filters.date, dateFromValue = _a.dateFromValue, dateToValue = _a.dateToValue;
                        if (!(!dateFromValue && !dateToValue)) return [3 /*break*/, 1];
                        this.dateFilterGroupHeader = this.dateFilterGroupInitHeader;
                        return [3 /*break*/, 3];
                    case 1:
                        _b = this;
                        return [4 /*yield*/, translationService.translate('VizBox.NotificationDialog.DateRange', {
                                dateFrom: this.formatDateTime(dateFromValue),
                                dateTo: this.formatDateTime(dateToValue)
                            })];
                    case 2:
                        _b.dateFilterGroupHeader = _c.sent();
                        _c.label = 3;
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    /** Calculates number of notifications with specific type */
    AvlNotificationDialogComponent.prototype.getNumberOfNotificationsWithType = function (data, type) {
        return data.filter(function (element) { return NOTIFICATION_TYPE_MAPPINGS[element.type] === type; }).length;
    };
    /** Calculates number of unread notifications */
    AvlNotificationDialogComponent.prototype.getNumberOfUnreadNotifications = function (data) {
        return data.filter(function (element) { return !element.state; }).length;
    };
    /** Calculates number of notifications currently displayed in datatable */
    AvlNotificationDialogComponent.prototype.getNumberOfNotifications = function () {
        if (this.filteredData.length === this.tableData.length && !this.badge) {
            return this.filteredData.length.toString();
        }
        else {
            return this.filteredData.length + "/" + this.tableData.length;
        }
    };
    /** Opens link in new tab when table row is clicked */
    AvlNotificationDialogComponent.prototype.onRowClicked = function (event) {
        var row = event.detail;
        if (row.link) {
            window.open(row.link, '_blank');
        }
    };
    /** Maps general avl notification list to table specific list */
    AvlNotificationDialogComponent.prototype.prepareNotifications = function (notifications) {
        return notifications.map(function (notification) { return (__assign(__assign({}, notification), { icon: TYPE_ICON_MAPPINGS[notification.type], iconStyle: TYPE_ICON_STYLE_MAPPINGS[notification.type], currentIconToggle: STATE_ICON_MAPPINGS[String(notification.read)], currentIconToggleStyle: DEFAULT_ICON_STYLE, state: notification.read })); });
    };
    /** Formats date time to date-short */
    AvlNotificationDialogComponent.prototype.formatDateTime = function (d) {
        return d ? AvlLocalizationService.formatDateTime(d, { format: 'date-short' }) : '(-)';
    };
    /** Deep copy of filters object */
    AvlNotificationDialogComponent.prototype.deepCopyObject = function (object) {
        var copiedObject = {};
        Object.keys(object).forEach(function (key) {
            copiedObject[key] = Object.assign({}, object[key]);
        });
        return copiedObject;
    };
    /** Determines if element satisfies filter for every key in this.apppliedFilters */
    AvlNotificationDialogComponent.prototype.doesElementPassEveryFilter = function (activeFilters, element) {
        var _this = this;
        return Object.keys(activeFilters).every(function (key) {
            if (key === 'date') {
                var _a = __read(_this.prepareDates(activeFilters[key]), 2), dateFrom = _a[0], dateTo = _a[1];
                // If dates not set, filter this element as well
                if (!dateFrom.getTime() && !dateTo.getTime()) {
                    return true;
                }
                _this.badge = true;
                // If timestamp is not a Date, don't filter this element
                var timestamp = new Date(element.timestamp);
                if (!timestamp.getTime()) {
                    return false;
                }
                return _this.compareDates(timestamp, dateFrom, dateTo);
            }
            return activeFilters[key].includes(NOTIFICATION_TYPE_MAPPINGS[element[key]]);
        });
    };
    AvlNotificationDialogComponent.prototype.prepareDates = function (dates) {
        var dateFrom = new Date(dates[0]);
        var dateTo = new Date(dates[1]);
        dateFrom.setHours(0, 0, 0, 0);
        dateTo.setHours(23, 59, 59, 999);
        return [dateFrom, dateTo];
    };
    AvlNotificationDialogComponent.prototype.compareDates = function (timestamp, from, to) {
        var ts = timestamp.getTime();
        var fromTs = from === null || from === void 0 ? void 0 : from.getTime();
        var toTs = to === null || to === void 0 ? void 0 : to.getTime();
        if (fromTs && toTs) {
            return ts >= fromTs && ts <= toTs;
        }
        else if (fromTs) {
            return ts >= fromTs;
        }
        else if (toTs) {
            return ts <= toTs;
        }
        return false;
    };
    AvlNotificationDialogComponent.prototype.updateStateOfSelectedRowsTo = function (state) {
        var _this = this;
        this.tableData
            .filter(function (notification) { return _this.isRowSelected(notification.id); })
            .forEach(function (notification) {
            notification.state = state;
            notification.currentIconToggle = STATE_ICON_MAPPINGS[String(state)];
        });
        this.tableData = __spread(this.tableData);
        this.filterData();
    };
    AvlNotificationDialogComponent.prototype.isRowSelected = function (id) {
        return this.selectedRows.map(function (row) { return row.id; }).includes(id);
    };
    // Translations
    AvlNotificationDialogComponent.prototype.translateLabels = function () {
        return __awaiter(this, void 0, void 0, function () {
            var translationService, _a, _b, _c, _d, _e;
            return __generator(this, function (_f) {
                switch (_f.label) {
                    case 0:
                        if (!AvlLocalizationService || !AvlLocalizationService.translationService) {
                            return [2 /*return*/];
                        }
                        translationService = AvlLocalizationService.translationService;
                        _a = this;
                        return [4 /*yield*/, translationService.translate('VizBox.NotificationDialog.Date')];
                    case 1:
                        _a.dateFilterGroupInitHeader = _f.sent();
                        this.dateFilterGroupHeader = this.dateFilterGroupInitHeader;
                        _b = this;
                        return [4 /*yield*/, translationService.translate('VizBox.NotificationDialog.DateFrom')];
                    case 2:
                        _b.dateFromLabel = _f.sent();
                        _c = this;
                        return [4 /*yield*/, translationService.translate('VizBox.NotificationDialog.DateTo')];
                    case 3:
                        _c.dateToLabel = _f.sent();
                        _d = this;
                        return [4 /*yield*/, this.translatePageSizeOptions(this.pageSizeOptions)];
                    case 4:
                        _d.pageSizeOptions = _f.sent();
                        _e = this;
                        return [4 /*yield*/, this.translateColumns(this.columnDefinitions)];
                    case 5:
                        _e.columnDefinitions = _f.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    AvlNotificationDialogComponent.prototype.translatePageSizeOptions = function (options) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, Promise.all(options.map(function (option) { return __awaiter(_this, void 0, void 0, function () { return __generator(this, function (_a) {
                            switch (_a.label) {
                                case 0: return [4 /*yield*/, this.translatePageSizeOption(option)];
                                case 1: return [2 /*return*/, _a.sent()];
                            }
                        }); }); }))];
                    case 1: return [2 /*return*/, _a.sent()];
                }
            });
        });
    };
    AvlNotificationDialogComponent.prototype.translatePageSizeOption = function (item) {
        return __awaiter(this, void 0, void 0, function () {
            var translationService, _a, _b, _c;
            return __generator(this, function (_d) {
                switch (_d.label) {
                    case 0:
                        translationService = AvlLocalizationService.translationService;
                        _a = [__assign({}, item)];
                        _b = {};
                        if (!(item.value === Number.MAX_SAFE_INTEGER)) return [3 /*break*/, 2];
                        return [4 /*yield*/, translationService.translate('VizBox.NotificationDialog.ShowAll')];
                    case 1:
                        _c = _d.sent();
                        return [3 /*break*/, 4];
                    case 2: return [4 /*yield*/, translationService.translate('VizBox.NotificationDialog.ShowXPerPage', {
                            rows: item.value
                        })];
                    case 3:
                        _c = _d.sent();
                        _d.label = 4;
                    case 4: return [2 /*return*/, __assign.apply(void 0, _a.concat([(_b.label = _c, _b)]))];
                }
            });
        });
    };
    AvlNotificationDialogComponent.prototype.translateColumns = function (column) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, Promise.all(column.map(function (item) { return __awaiter(_this, void 0, void 0, function () { return __generator(this, function (_a) {
                            switch (_a.label) {
                                case 0: return [4 /*yield*/, this.translateColumnItem(item)];
                                case 1: return [2 /*return*/, _a.sent()];
                            }
                        }); }); }))];
                    case 1: return [2 /*return*/, _a.sent()];
                }
            });
        });
    };
    AvlNotificationDialogComponent.prototype.translateColumnItem = function (item) {
        return __awaiter(this, void 0, void 0, function () {
            var translateService, _a, _b;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        translateService = AvlLocalizationService.translationService;
                        _a = [__assign({}, item)];
                        _b = {};
                        return [4 /*yield*/, translateService.translate(item.caption)];
                    case 1: return [2 /*return*/, __assign.apply(void 0, _a.concat([(_b.caption = _c.sent(), _b)]))];
                }
            });
        });
    };
    AvlNotificationDialogComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], AvlNotificationDialogComponent.prototype, "open", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Array)
    ], AvlNotificationDialogComponent.prototype, "pageSizeOptions", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Array)
    ], AvlNotificationDialogComponent.prototype, "columnDefinitions", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Array),
        __metadata("design:paramtypes", [Array])
    ], AvlNotificationDialogComponent.prototype, "notifications", null);
    __decorate([
        Output(),
        __metadata("design:type", EventEmitter)
    ], AvlNotificationDialogComponent.prototype, "openChange", void 0);
    __decorate([
        Output(),
        __metadata("design:type", EventEmitter)
    ], AvlNotificationDialogComponent.prototype, "markSelectedAsRead", void 0);
    __decorate([
        Output(),
        __metadata("design:type", EventEmitter)
    ], AvlNotificationDialogComponent.prototype, "markSelectedAsUnread", void 0);
    __decorate([
        ViewChild('notificationTable'),
        __metadata("design:type", ElementRef)
    ], AvlNotificationDialogComponent.prototype, "table", void 0);
    __decorate([
        ViewChild('filterForm', { read: NgForm }),
        __metadata("design:type", NgForm)
    ], AvlNotificationDialogComponent.prototype, "filterForm", void 0);
    AvlNotificationDialogComponent = __decorate([
        Component({
            selector: 'avl-notification-dialog',
            template: "<avl-dialog\r\n  id=\"outerDialog\"\r\n  [open]=\"open\"\r\n  (openChange)=\"openChanged($event)\"\r\n  [closeOnScrimClick]=\"false\"\r\n  [fullscreen]=\"true\"\r\n>\r\n  <ng-template #content>\r\n    <avl-dialog-header>{{ 'VizBox.NotificationDialog.Details' | translate }}</avl-dialog-header>\r\n    <avl-dialog-content>\r\n      <div class=\"main-container\">\r\n        <div class=\"content\">\r\n          <div class=\"table-header\">\r\n            <h1>\r\n              {{ 'VizBox.NotificationDialog.Notifications' | translate }} ({{\r\n                getNumberOfNotifications()\r\n              }})\r\n            </h1>\r\n            <div class=\"table-header-right\">\r\n              <avl-icon-button\r\n                *ngIf=\"showRefreshButton\"\r\n                id=\"updateIcon\"\r\n                (click)=\"refreshTable()\"\r\n                class=\"pointer\"\r\n                icon=\"icons:refresh\"\r\n              >\r\n              </avl-icon-button>\r\n              <avl-tooltip *ngIf=\"showRefreshButton\" for=\"updateIcon\"\r\n                > {{ 'VizBox.NotificationDialog.Refresh' | translate }}</avl-tooltip\r\n              >\r\n              <avl-icon-button\r\n                id=\"unreadIcon\"\r\n                (click)=\"markAsUnread()\"\r\n                class=\"pointer\"\r\n                icon=\"icons:mail\"\r\n                [disabled]=\"disableMarkingSelected\"\r\n              >\r\n              </avl-icon-button>\r\n              <avl-tooltip for=\"unreadIcon\">{{\r\n                'VizBox.NotificationDialog.MarkSelectedAsUnread' | translate\r\n              }}</avl-tooltip>\r\n              <avl-icon-button\r\n                id=\"readIcon\"\r\n                class=\"pointer\"\r\n                (click)=\"markAsRead()\"\r\n                icon=\"communication:mail-outline\"\r\n                [disabled]=\"disableMarkingSelected\"\r\n              >\r\n              </avl-icon-button>\r\n              <avl-tooltip for=\"readIcon\">{{\r\n                'VizBox.NotificationDialog.MarkSelectedAsRead' | translate\r\n              }}</avl-tooltip>\r\n              <avl-icon-button\r\n                (click)=\"toggleFilters()\"\r\n                class=\"pointer\"\r\n                icon=\"icons:filter-list\"\r\n                [badge]=\"badge\"\r\n              ></avl-icon-button>\r\n            </div>\r\n          </div>\r\n          <avl-datatable\r\n            #notificationTable\r\n            class=\"filterDatatable\"\r\n            multi-select\r\n            allow-active-row\r\n            pagination\r\n            [columnDefinitions]=\"columnDefinitions\"\r\n            [data]=\"filteredData\"\r\n            [pageSize]=\"pageSize\"\r\n            [pageSizeOptions]=\"pageSizeOptions\"\r\n            [(selectedValues)]=\"selectedRows\"\r\n            (selectedValuesChange)=\"selectedValuesChanged()\"\r\n            (on-row-clicked)=\"onRowClicked($event)\"\r\n          >\r\n          </avl-datatable>\r\n        </div>\r\n        <avl-side-sheet class=\"filter-sheet\" divider [(open)]=\"filtersOpen\" #filterSheet>\r\n          <div slot=\"title\">\r\n            <h2>{{ 'VizBox.NotificationDialog.Filters' | translate }}</h2>\r\n          </div>\r\n          <div slot=\"content\">\r\n            <form #filterForm=\"ngForm\">\r\n              <avl-list-expander [narrow]=\"true\">\r\n                <div role=\"header\">\r\n                  <h3>{{ 'VizBox.NotificationDialog.Type' | translate }}</h3>\r\n                </div>\r\n                <div role=\"content\" class=\"filterContent\">\r\n                  <div>\r\n                    <avl-checkbox name=\"warningSwitch\" [(ngModel)]=\"filters.type.warning\">\r\n                      {{ 'VizBox.NotificationDialog.Warning' | translate }}\r\n                      <span *ngIf=\"tableData.length\"\r\n                        >({{ getNumberOfNotificationsWithType(tableData, 'warning') }})</span\r\n                      >\r\n                    </avl-checkbox>\r\n                    <avl-icon id=\"warningIcon\" class=\"typeIcons\" icon=\"icons:warning\"></avl-icon>\r\n                  </div>\r\n                  <div>\r\n                    <avl-checkbox name=\"errorSwitch\" [(ngModel)]=\"filters.type.error\">\r\n                      {{ 'VizBox.NotificationDialog.Error' | translate }}\r\n                      <span *ngIf=\"tableData.length\"\r\n                        >({{ getNumberOfNotificationsWithType(tableData, 'error') }})</span\r\n                      >\r\n                    </avl-checkbox>\r\n                    <avl-icon id=\"errorIcon\" class=\"typeIcons\" icon=\"icons:cancel\"></avl-icon>\r\n                  </div>\r\n                  <div>\r\n                    <avl-checkbox name=\"infoSwitch\" [(ngModel)]=\"filters.type.info\">\r\n                      {{ 'VizBox.NotificationDialog.Info' | translate }}\r\n                      <span *ngIf=\"tableData.length\"\r\n                        >({{ getNumberOfNotificationsWithType(tableData, 'info') }})</span\r\n                      >\r\n                    </avl-checkbox>\r\n                    <avl-icon id=\"infoIcon\" class=\"typeIcons\" icon=\"icons:info-outline\"></avl-icon>\r\n                  </div>\r\n                  <div>\r\n                    <avl-checkbox name=\"okSwitch\" [(ngModel)]=\"filters.type.ok\">\r\n                      {{ 'VizBox.NotificationDialog.Ok' | translate }}\r\n                      <span *ngIf=\"tableData.length\"\r\n                        >({{ getNumberOfNotificationsWithType(tableData, 'ok') }})</span\r\n                      >\r\n                    </avl-checkbox>\r\n                    <avl-icon id=\"okIcon\" class=\"typeIcons\" icon=\"icons:check\"></avl-icon>\r\n                  </div>\r\n                </div>\r\n              </avl-list-expander>\r\n              <avl-list-expander [narrow]=\"true\">\r\n                <div role=\"header\">\r\n                  <h3>{{ 'VizBox.NotificationDialog.State' | translate }}</h3>\r\n                </div>\r\n                <div role=\"content\" class=\"filterContent\">\r\n                  <avl-checkbox name=\"unreadState\" [(ngModel)]=\"filters.state.unread\">\r\n                    {{ 'VizBox.NotificationDialog.Unread' | translate }} ({{\r\n                      getNumberOfUnreadNotifications(tableData)\r\n                    }})\r\n                  </avl-checkbox>\r\n                  <avl-icon id=\"infoIcon\" class=\"typeIcons\" icon=\"icons:mail\"></avl-icon>\r\n                  <avl-checkbox name=\"readState\" [(ngModel)]=\"filters.state.read\">\r\n                    {{ 'VizBox.NotificationDialog.Read' | translate }} ({{\r\n                      tableData.length - getNumberOfUnreadNotifications(tableData)\r\n                    }})\r\n                  </avl-checkbox>\r\n                  <avl-icon\r\n                    id=\"infoIcon\"\r\n                    class=\"typeIcons\"\r\n                    icon=\"communication:mail-outline\"\r\n                  ></avl-icon>\r\n                </div>\r\n              </avl-list-expander>\r\n              <avl-list-expander [narrow]=\"true\">\r\n                <div role=\"header\">\r\n                  <h3 id=\"date-group\" #dateGroup>\r\n                    {{ dateFilterGroupHeader }}\r\n                  </h3>\r\n                  <avl-tooltip for=\"date-group\" *ngIf=\"dateGroup.scrollWidth > dateGroup.clientWidth\">\r\n                    {{ dateFilterGroupHeader }}\r\n                  </avl-tooltip>\r\n                </div>\r\n                <div role=\"content\">\r\n                  <avl-date\r\n                    class=\"date-control\"\r\n                    [(ngModel)]=\"filters.date.dateFromValue\"\r\n                    name=\"dateFromValue\"\r\n                    (valueChange)=\"updateLabels()\"\r\n                    [label]=\"dateFromLabel\"\r\n                  ></avl-date>\r\n                  <avl-date\r\n                    class=\"date-control\"\r\n                    [(ngModel)]=\"filters.date.dateToValue\"\r\n                    name=\"dateTo\"\r\n                    (valueChange)=\"updateLabels()\"\r\n                    [label]=\"dateToLabel\"\r\n                  ></avl-date>\r\n                </div>\r\n              </avl-list-expander>\r\n            </form>\r\n          </div>\r\n          <div slot=\"actions\">\r\n            <avl-button contained (click)=\"applyFilters()\">{{\r\n              'VizBox.NotificationDialog.Apply' | translate\r\n            }}</avl-button>\r\n            <avl-button (click)=\"reset()\">{{\r\n              'VizBox.NotificationDialog.Reset' | translate\r\n            }}</avl-button>\r\n          </div>\r\n        </avl-side-sheet>\r\n      </div>\r\n    </avl-dialog-content>\r\n  </ng-template>\r\n</avl-dialog>\r\n",
            styles: [".content{position:relative;display:flex;flex-direction:column;flex-grow:1}.table-header{display:flex;justify-content:space-between;align-items:center}.main-container{display:flex;height:100%}.main-container.hidden{display:none}.filterDatatable{height:100%}.filter-sheet{--avl-side-sheet-padding:0px;--avl-side-sheet-height:84vh;width:300px}.filter-sheet h2{font-size:20px;margin-left:24px}.filter-sheet h3{font-size:16px;margin:0;text-overflow:ellipsis;overflow:hidden}.pointer{cursor:pointer}#errorIcon{--avl-icon-custom-color:var(--avl-error-color)}#warningIcon{--avl-icon-custom-color:var(--avl-warning-color)}#okIcon{--avl-icon-custom-color:var(--avl-ok-color)}#infoIcon{--avl-icon-custom-color:var(--avl-icon-default-color)}.filterContent{position:relative}.typeIcons{position:absolute;right:0;margin-top:12px;margin-bottom:12px}.date-control{width:100%}avl-dialog-content{--padding-top:1px!important;--padding-right:0px!important;--padding-bottom:2px!important}avl-dialog-header{z-index:1}avl-side-sheet{--avl-side-sheet-height:unset!important;box-shadow:none;border-left:1px solid var(--avl-divider-color)}avl-datatable{--margin-top-pages:0px!important}"]
        }),
        __metadata("design:paramtypes", [ChangeDetectorRef])
    ], AvlNotificationDialogComponent);
    return AvlNotificationDialogComponent;
}());
export { AvlNotificationDialogComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXZsLW5vdGlmaWNhdGlvbi1kaWFsb2cuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGF2bC1uZy1jb250cm9scy9ub3RpZmljYXRpb24vIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9hdmwtbm90aWZpY2F0aW9uLWRpYWxvZy9hdmwtbm90aWZpY2F0aW9uLWRpYWxvZy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsU0FBUyxFQUNULFVBQVUsRUFDVixNQUFNLEVBQ04sWUFBWSxFQUNaLE1BQU0sRUFDTixpQkFBaUIsRUFDakIsZ0JBQWdCLEVBQ2pCLE1BQU0sZUFBZSxDQUFDO0FBU3ZCLE9BQU8sMERBQTBELENBQUM7QUFDbEUsT0FBTyx5REFBeUQsQ0FBQztBQUNqRSxPQUFPLDJDQUEyQyxDQUFDO0FBQ25ELE9BQU8sdURBQXVELENBQUM7QUFDL0QsT0FBTyxtREFBbUQsQ0FBQztBQUMzRCxPQUFPLGlEQUFpRCxDQUFDO0FBQ3pELE9BQU8sMkNBQTJDLENBQUM7QUFFbkQsT0FBTyxFQUNMLDBCQUEwQixFQUMxQixlQUFlLEVBQ2YseUJBQXlCLEVBQ3pCLHdCQUF3QixFQUN4QixrQkFBa0IsRUFDbEIsbUJBQW1CLEVBQ25CLDBCQUEwQixFQUMxQixrQkFBa0IsRUFDbkIsTUFBTSxrQ0FBa0MsQ0FBQztBQUMxQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFNeEM7SUE4Q0Usd0NBQW9CLEtBQXdCO1FBQXhCLFVBQUssR0FBTCxLQUFLLENBQW1CO1FBN0NuQyxTQUFJLEdBQVksS0FBSyxDQUFDO1FBQ3RCLG9CQUFlLEdBQXFCLHlCQUF5QixDQUFDO1FBQzlELHNCQUFpQixHQUFh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Q0FBYSxNQUFNO3NFQUFDO0lBdkJuRCw4QkFBOEI7UUFMMUMsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLHlCQUF5QjtZQUNuQyxrb1JBQXVEOztTQUV4RCxDQUFDO3lDQStDMkIsaUJBQWlCO09BOUNqQyw4QkFBOEIsQ0ErVTFDO0lBQUQscUNBQUM7Q0FBQSxBQS9VRCxJQStVQztTQS9VWSw4QkFBOEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIENvbXBvbmVudCxcclxuICBJbnB1dCxcclxuICBWaWV3Q2hpbGQsXHJcbiAgRWxlbWVudFJlZixcclxuICBPdXRwdXQsXHJcbiAgRXZlbnRFbWl0dGVyLFxyXG4gIE9uSW5pdCxcclxuICBDaGFuZ2VEZXRlY3RvclJlZixcclxuICBBZnRlclZpZXdDaGVja2VkXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IENvbHVtbiB9IGZyb20gJ0BhdmwtY29udHJvbHMvZGF0YXRhYmxlL2Rpc3QvYXZsLWRhdGF0YWJsZS9jb2x1bW4tZGVmaW5pdGlvbnMnO1xyXG5pbXBvcnQge1xyXG4gIEF2bERhdGF0YWJsZSxcclxuICBQYWdlU2l6ZU9wdGlvblxyXG59IGZyb20gJ0BhdmwtY29udHJvbHMvZGF0YXRhYmxlL2Rpc3QvYXZsLWRhdGF0YWJsZS9hdmwtZGF0YXRhYmxlJztcclxuXHJcbmltcG9ydCB7IEF2bE5vdGlmaWNhdGlvbiB9IGZyb20gJ0BhdmwtY29udHJvbHMvaW50ZXJmYWNlcyc7XHJcblxyXG5pbXBvcnQgJ0BhdmwtY29udHJvbHMvZGF0YXRhYmxlL2Rpc3QvYXZsLWRhdGF0YWJsZS9hdmwtZGF0YXRhYmxlJztcclxuaW1wb3J0ICdAYXZsLWNvbnRyb2xzL2NvcmUvZGlzdC9hdmwtaWNvbi1idXR0b24vYXZsLWljb24tYnV0dG9uJztcclxuaW1wb3J0ICdAYXZsLWNvbnRyb2xzL2NvcmUvZGlzdC9hdmwtaWNvbi9hdmwtaWNvbic7XHJcbmltcG9ydCAnQGF2bC1jb250cm9scy9jb3JlL2Rpc3QvYXZsLXNpZGUtc2hlZXQvYXZsLXNpZGUtc2hlZXQnO1xyXG5pbXBvcnQgJ0BhdmwtY29udHJvbHMvY29yZS9kaXN0L2F2bC1jaGVja2JveC9hdmwtY2hlY2tib3gnO1xyXG5pbXBvcnQgJ0BhdmwtY29udHJvbHMvY29yZS9kaXN0L2F2bC10b29sdGlwL2F2bC10b29sdGlwJztcclxuaW1wb3J0ICdAYXZsLWNvbnRyb2xzL2NvcmUvZGlzdC9hdmwtZGF0ZS9hdmwtZGF0ZSc7XHJcbmltcG9ydCB7IEF2bE5vdGlmaWNhdGlvblRhYmxlSXRlbSB9IGZyb20gJy4uLy4uL21vZGVscy9ub3RpZmljYXRpb24tZGlhbG9nLm1vZGVsJztcclxuaW1wb3J0IHtcclxuICBERUZBVUxUX0NPTFVNTl9ERUZJTklUSU9OUyxcclxuICBERUZBVUxUX0ZJTFRFUlMsXHJcbiAgREVGQVVMVF9QQUdFX1NJWkVfT1BUSU9OUyxcclxuICBUWVBFX0lDT05fU1RZTEVfTUFQUElOR1MsXHJcbiAgVFlQRV9JQ09OX01BUFBJTkdTLFxyXG4gIFNUQVRFX0lDT05fTUFQUElOR1MsXHJcbiAgTk9USUZJQ0FUSU9OX1RZUEVfTUFQUElOR1MsXHJcbiAgREVGQVVMVF9JQ09OX1NUWUxFXHJcbn0gZnJvbSAnLi9hdmwtbm90aWZpY2F0aW9uLWRpYWxvZy5jb25zdHMnO1xyXG5pbXBvcnQgeyBOZ0Zvcm0gfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnYXZsLW5vdGlmaWNhdGlvbi1kaWFsb2cnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9hdmwtbm90aWZpY2F0aW9uLWRpYWxvZy5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vYXZsLW5vdGlmaWNhdGlvbi1kaWFsb2cuY29tcG9uZW50LmNzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBBdmxOb3RpZmljYXRpb25EaWFsb2dDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0NoZWNrZWQge1xyXG4gIEBJbnB1dCgpIG9wZW46IGJvb2xlYW4gPSBmYWxzZTtcclxuICBASW5wdXQoKSBwYWdlU2l6ZU9wdGlvbnM6IFBhZ2VTaXplT3B0aW9uW10gPSBERUZBVUxUX1BBR0VfU0laRV9PUFRJT05TO1xyXG4gIEBJbnB1dCgpIGNvbHVtbkRlZmluaXRpb25zOiBDb2x1bW5bXSA9IERFRkFVTFRfQ09MVU1OX0RFRklOSVRJT05TO1xyXG4gIEBJbnB1dCgpXHJcbiAgZ2V0IG5vdGlmaWNhdGlvbnMoKTogQXZsTm90aWZpY2F0aW9uW10ge1xyXG4gICAgcmV0dXJuIHRoaXMuX25vdGlmaWNhdGlvbnM7XHJcbiAgfVxyXG5cclxuICBzZXQgbm90aWZpY2F0aW9ucyhub3RpZmljYXRpb25zOiBBdmxOb3RpZmljYXRpb25bXSkge1xyXG4gICAgaWYgKHRoaXMuX25vdGlmaWNhdGlvbnMubGVuZ3RoID09PSBub3RpZmljYXRpb25zLmxlbmd0aCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zaG93UmVmcmVzaEJ1dHRvbiA9IHRydWU7XHJcbiAgICB0aGlzLl9ub3RpZmljYXRpb25zID0gbm90aWZpY2F0aW9ucztcclxuICB9XHJcblxyXG4gIEBPdXRwdXQoKSBvcGVuQ2hhbmdlOiBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4gPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XHJcbiAgQE91dHB1dCgpIG1hcmtTZWxlY3RlZEFzUmVhZDogRXZlbnRFbWl0dGVyPGFueVtdPiA9IG5ldyBFdmVudEVtaXR0ZXI8QXZsTm90aWZpY2F0aW9uW10+KCk7XHJcbiAgQE91dHB1dCgpIG1hcmtTZWxlY3RlZEFzVW5yZWFkOiBFdmVudEVtaXR0ZXI8YW55W10+ID0gbmV3IEV2ZW50RW1pdHRlcjxBdmxOb3RpZmljYXRpb25bXT4oKTtcclxuXHJcbiAgQFZpZXdDaGlsZCgnbm90aWZpY2F0aW9uVGFibGUnKSBwdWJsaWMgdGFibGU6IEVsZW1lbnRSZWY8QXZsRGF0YXRhYmxlPjtcclxuICBAVmlld0NoaWxkKCdmaWx0ZXJGb3JtJywgeyByZWFkOiBOZ0Zvcm0gfSkgZmlsdGVyRm9ybTogTmdGb3JtO1xyXG5cclxuICBwdWJsaWMgdGFibGVEYXRhOiBBdmxOb3RpZmljYXRpb25UYWJsZUl0ZW1bXSA9IFtdO1xyXG4gIHB1YmxpYyBmaWx0ZXJlZERhdGE6IEF2bE5vdGlmaWNhdGlvblRhYmxlSXRlbVtdID0gW107XHJcbiAgcHVibGljIGJhZGdlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgcHVibGljIGRpc2FibGVNYXJraW5nU2VsZWN0ZWQ6IGJvb2xlYW4gPSB0cnVlO1xyXG4gIHB1YmxpYyBmaWx0ZXJzID0gdGhpcy5kZWVwQ29weU9iamVjdChERUZBVUxUX0ZJTFRFUlMpO1xyXG4gIHB1YmxpYyBmaWx0ZXJzT3BlbiA9IHRydWU7XHJcbiAgcHVibGljIHNob3dSZWZyZXNoQnV0dG9uID0gZmFsc2U7XHJcbiAgcHVibGljIGRhdGVGcm9tTGFiZWwgPSAnRGF0ZSBmcm9tJztcclxuICBwdWJsaWMgZGF0ZVRvTGFiZWwgPSAnRGF0ZSB0byc7XHJcblxyXG4gIHByaXZhdGUgZGF0ZUZpbHRlckdyb3VwSW5pdEhlYWRlciA9ICdEYXRlJztcclxuICBwdWJsaWMgZGF0ZUZpbHRlckdyb3VwSGVhZGVyID0gdGhpcy5kYXRlRmlsdGVyR3JvdXBJbml0SGVhZGVyO1xyXG5cclxuICAvL25vdGlmaWNhdGlvbiBkYXRhdGFibGUgb3B0aW9uc1xyXG4gIHB1YmxpYyBzZWxlY3RlZFJvd3M6IEF2bE5vdGlmaWNhdGlvblRhYmxlSXRlbVtdID0gW107XHJcbiAgcHVibGljIHBhZ2VTaXplID0gMTU7XHJcblxyXG4gIHB1YmxpYyBhcHBsaWVkRmlsdGVycyA9IHRoaXMuZGVlcENvcHlPYmplY3QoREVGQVVMVF9GSUxURVJTKTtcclxuXHJcbiAgcHJpdmF0ZSBfbm90aWZpY2F0aW9uczogQXZsTm90aWZpY2F0aW9uW10gPSBbXTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjZFJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHt9XHJcblxyXG4gIHB1YmxpYyBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMudHJhbnNsYXRlTGFiZWxzKCk7XHJcbiAgICB0aGlzLnJlZnJlc2hUYWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpOiB2b2lkIHtcclxuICAgIHRoaXMuY2RSZWYuZGV0ZWN0Q2hhbmdlcygpO1xyXG4gIH1cclxuXHJcbiAgLyoqIEVtaXRzIGV2ZW50IHdoZW4gZGlhbG9nIG9wZW5zIG9yIGNsb3NlcyAqL1xyXG4gIHB1YmxpYyBvcGVuQ2hhbmdlZChvcGVuOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICB0aGlzLm9wZW5DaGFuZ2UuZW1pdChvcGVuKTtcclxuICB9XHJcblxyXG4gIC8qKiBUb2dnbGVzIGRpc3BsYXlpbmcgb2YgZmlsdGVyIHNoZWV0ICovXHJcbiAgcHVibGljIHRvZ2dsZUZpbHRlcnMoKTogdm9pZCB7XHJcbiAgICB0aGlzLmZpbHRlcnNPcGVuID0gIXRoaXMuZmlsdGVyc09wZW47XHJcbiAgfVxyXG5cclxuICAvKiogUmVmcmVzaGVzIHRoZSBkYXRhdGFibGUgd2hlbiByZWZyZXNoIGJ1dHRvbiBpcyBjbGlja2VkICovXHJcbiAgcHVibGljIHJlZnJlc2hUYWJsZSgpOiB2b2lkIHtcclxuICAgIHRoaXMuc2hvd1JlZnJlc2hCdXR0b24gPSBmYWxzZTtcclxuICAgIHRoaXMudGFibGVEYXRhID0gdGhpcy5wcmVwYXJlTm90aWZpY2F0aW9ucyh0aGlzLl9ub3RpZmljYXRpb25zKTtcclxuICAgIHRoaXMuZmlsdGVycyA9IHRoaXMuZGVlcENvcHlPYmplY3QodGhpcy5hcHBsaWVkRmlsdGVycyk7XHJcbiAgICB0aGlzLmZpbHRlckRhdGEoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEludm9rZWQgd2hlbiBjbGlja2luZyBhcHBseSBidXR0b24gLSBmaWx0ZXJzIGRhdGEgYnkgZ2l2ZW4gZmlsdGVycy5cclxuICAgKi9cclxuICBwdWJsaWMgYXBwbHlGaWx0ZXJzKCk6IHZvaWQge1xyXG4gICAgdGhpcy5hcHBsaWVkRmlsdGVycyA9IHRoaXMuZGVlcENvcHlPYmplY3QodGhpcy5maWx0ZXJzKTtcclxuICAgIHRoaXMuZmlsdGVyRGF0YSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqIEZpbHRlcnMgbm90aWZpY2F0aW9ucyBhY2NvcmRpbmcgdG8gYXBwbGllZCBmaWx0ZXJzICovXHJcbiAgcHVibGljIGZpbHRlckRhdGEoKTogdm9pZCB7XHJcbiAgICB0aGlzLmZpbHRlcmVkRGF0YSA9IFtdO1xyXG4gICAgY29uc3QgZmlsdGVycyA9IHRoaXMuZ2V0QWN0aXZlRmlsdGVycygpO1xyXG4gICAgZm9yIChjb25zdCBlbGVtZW50IG9mIHRoaXMudGFibGVEYXRhKSB7XHJcbiAgICAgIGlmICh0aGlzLmRvZXNFbGVtZW50UGFzc0V2ZXJ5RmlsdGVyKGZpbHRlcnMsIGVsZW1lbnQpKSB7XHJcbiAgICAgICAgdGhpcy5maWx0ZXJlZERhdGEucHVzaChlbGVtZW50KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqIENoYW5nZXMgc2VsZWN0ZWQgbm90aWZpY2F0aW9uIHN0YXRlIHRvIHJlYWQgKi9cclxuICBwdWJsaWMgbWFya0FzUmVhZCgpOiB2b2lkIHtcclxuICAgIHRoaXMudXBkYXRlU3RhdGVPZlNlbGVjdGVkUm93c1RvKHRydWUpO1xyXG4gICAgdGhpcy5tYXJrU2VsZWN0ZWRBc1JlYWQuZW1pdCh0aGlzLnNlbGVjdGVkUm93cyk7XHJcbiAgfVxyXG5cclxuICAvKiogQ2hhbmdlcyBzZWxlY3RlZCBub3RpZmljYXRpb24gc3RhdGUgdG8gdW5yZWFkICovXHJcbiAgcHVibGljIG1hcmtBc1VucmVhZCgpOiB2b2lkIHtcclxuICAgIHRoaXMudXBkYXRlU3RhdGVPZlNlbGVjdGVkUm93c1RvKGZhbHNlKTtcclxuICAgIHRoaXMubWFya1NlbGVjdGVkQXNVbnJlYWQuZW1pdCh0aGlzLnNlbGVjdGVkUm93cyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXNldHMgYWxsIGZpbHRlcnMuXHJcbiAgICovXHJcbiAgcHVibGljIHJlc2V0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5maWx0ZXJzID0gdGhpcy5kZWVwQ29weU9iamVjdChERUZBVUxUX0ZJTFRFUlMpO1xyXG4gICAgdGhpcy5hcHBsaWVkRmlsdGVycyA9IHRoaXMuZGVlcENvcHlPYmplY3QoREVGQVVMVF9GSUxURVJTKTtcclxuICAgIHRoaXMuZmlsdGVyRGF0YSgpO1xyXG4gICAgdGhpcy51cGRhdGVMYWJlbHMoKTtcclxuICAgIHRoaXMuYmFkZ2UgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKiBDYWxjdWxhdGVzIGFjdGl2ZSBmaWx0ZXJzIGZyb20gZmlsdGVyIG9iamVjdCAqL1xyXG4gIHB1YmxpYyBnZXRBY3RpdmVGaWx0ZXJzKCk6IE9iamVjdCB7XHJcbiAgICB0aGlzLmJhZGdlID0gZmFsc2U7XHJcbiAgICBjb25zdCBzZXRGaWx0ZXJzID0ge307XHJcbiAgICAvLyBNYXBwaW5nIGFwcGxpZWQgZmlsdGVycyBvYmplY3QgdG8gYmV0dGVyIGZvcm1hdCB1c2VkIGZvciBmaWx0ZXJpbmcsIFxyXG4gICAgLy8gY3JlYXRlcyBhcnJheXMgZnJvbSBvYmplY3RzXHJcbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgT2JqZWN0LmtleXModGhpcy5hcHBsaWVkRmlsdGVycykpIHtcclxuICAgICAgY29uc3Qgc2Vjb25kTGV2ZWxGaWx0ZXIgPSBbXTtcclxuICAgICAgZm9yIChjb25zdCBmaWx0ZXIgb2YgT2JqZWN0LmtleXModGhpcy5hcHBsaWVkRmlsdGVyc1tpdGVtXSkpIHtcclxuICAgICAgICBpZiAodGhpcy5hcHBsaWVkRmlsdGVyc1tpdGVtXVtmaWx0ZXJdID09PSB0cnVlKSB7XHJcbiAgICAgICAgICBzZWNvbmRMZXZlbEZpbHRlci5wdXNoKGZpbHRlcik7XHJcbiAgICAgICAgICB0aGlzLmJhZGdlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChzZWNvbmRMZXZlbEZpbHRlci5sZW5ndGgpIHtcclxuICAgICAgICBzZXRGaWx0ZXJzW2l0ZW1dID0gc2Vjb25kTGV2ZWxGaWx0ZXI7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChpdGVtID09PSAnZGF0ZScpIHtcclxuICAgICAgICBzZXRGaWx0ZXJzW2l0ZW1dID0gW1xyXG4gICAgICAgICAgdGhpcy5hcHBsaWVkRmlsdGVyc1tpdGVtXVsnZGF0ZUZyb21WYWx1ZSddLFxyXG4gICAgICAgICAgdGhpcy5hcHBsaWVkRmlsdGVyc1tpdGVtXVsnZGF0ZVRvVmFsdWUnXVxyXG4gICAgICAgIF07XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBzZXRGaWx0ZXJzO1xyXG4gIH1cclxuXHJcbiAgLyoqIENhbGxlZCB3aGVuIHNlbGVjdGlvbiBpcyBhcHBsaWVkIHRvIHRoZSB0YWJsZSByb3dzICovXHJcbiAgcHVibGljIHNlbGVjdGVkVmFsdWVzQ2hhbmdlZCgpIHtcclxuICAgIHRoaXMuZGlzYWJsZU1hcmtpbmdTZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRSb3dzLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgIHRoaXMuZGlzYWJsZU1hcmtpbmdTZWxlY3RlZCA9IHRydWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKiogVXBkYXRlcyBkYXRlIGZpbHRlciBoZWFkZXIgbGFiZWxzIHdoZW4gZGF0ZSBjaGFuZ2VzICovXHJcbiAgcHVibGljIGFzeW5jIHVwZGF0ZUxhYmVscygpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGNvbnN0IHRyYW5zbGF0aW9uU2VydmljZSA9IEF2bExvY2FsaXphdGlvblNlcnZpY2UudHJhbnNsYXRpb25TZXJ2aWNlO1xyXG4gICAgY29uc3QgeyBkYXRlRnJvbVZhbHVlLCBkYXRlVG9WYWx1ZSB9ID0gdGhpcy5maWx0ZXJzLmRhdGU7XHJcbiAgICBpZiAoIWRhdGVGcm9tVmFsdWUgJiYgIWRhdGVUb1ZhbHVlKSB7XHJcbiAgICAgIHRoaXMuZGF0ZUZpbHRlckdyb3VwSGVhZGVyID0gdGhpcy5kYXRlRmlsdGVyR3JvdXBJbml0SGVhZGVyO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5kYXRlRmlsdGVyR3JvdXBIZWFkZXIgPSBhd2FpdCB0cmFuc2xhdGlvblNlcnZpY2UudHJhbnNsYXRlKFxyXG4gICAgICAgICdWaXpCb3guTm90aWZpY2F0aW9uRGlhbG9nLkRhdGVSYW5nZScsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgZGF0ZUZyb206IHRoaXMuZm9ybWF0RGF0ZVRpbWUoZGF0ZUZyb21WYWx1ZSksXHJcbiAgICAgICAgICBkYXRlVG86IHRoaXMuZm9ybWF0RGF0ZVRpbWUoZGF0ZVRvVmFsdWUpXHJcbiAgICAgICAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqIENhbGN1bGF0ZXMgbnVtYmVyIG9mIG5vdGlmaWNhdGlvbnMgd2l0aCBzcGVjaWZpYyB0eXBlICovXHJcbiAgcHVibGljIGdldE51bWJlck9mTm90aWZpY2F0aW9uc1dpdGhUeXBlKGRhdGE6IEF2bE5vdGlmaWNhdGlvblRhYmxlSXRlbVtdLCB0eXBlOiBzdHJpbmcpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIGRhdGEuZmlsdGVyKGVsZW1lbnQgPT4gTk9USUZJQ0FUSU9OX1RZUEVfTUFQUElOR1NbZWxlbWVudC50eXBlXSA9PT0gdHlwZSkubGVuZ3RoO1xyXG4gIH1cclxuXHJcbiAgLyoqIENhbGN1bGF0ZXMgbnVtYmVyIG9mIHVucmVhZCBub3RpZmljYXRpb25zICovXHJcbiAgcHVibGljIGdldE51bWJlck9mVW5yZWFkTm90aWZpY2F0aW9ucyhkYXRhOiBBdmxOb3RpZmljYXRpb25UYWJsZUl0ZW1bXSk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gZGF0YS5maWx0ZXIoZWxlbWVudCA9PiAhZWxlbWVudC5zdGF0ZSkubGVuZ3RoO1xyXG4gIH1cclxuXHJcbiAgLyoqIENhbGN1bGF0ZXMgbnVtYmVyIG9mIG5vdGlmaWNhdGlvbnMgY3VycmVudGx5IGRpc3BsYXllZCBpbiBkYXRhdGFibGUgKi9cclxuICBwdWJsaWMgZ2V0TnVtYmVyT2ZOb3RpZmljYXRpb25zKCk6IHN0cmluZyB7XHJcbiAgICBpZiAodGhpcy5maWx0ZXJlZERhdGEubGVuZ3RoID09PSB0aGlzLnRhYmxlRGF0YS5sZW5ndGggJiYgIXRoaXMuYmFkZ2UpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyZWREYXRhLmxlbmd0aC50b1N0cmluZygpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIGAke3RoaXMuZmlsdGVyZWREYXRhLmxlbmd0aH0vJHt0aGlzLnRhYmxlRGF0YS5sZW5ndGh9YDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKiBPcGVucyBsaW5rIGluIG5ldyB0YWIgd2hlbiB0YWJsZSByb3cgaXMgY2xpY2tlZCAqL1xyXG4gIHB1YmxpYyBvblJvd0NsaWNrZWQoZXZlbnQ6IEV2ZW50KTogdm9pZCB7XHJcbiAgICBjb25zdCByb3cgPSAoPEN1c3RvbUV2ZW50PmV2ZW50KS5kZXRhaWw7XHJcbiAgICBpZiAocm93LmxpbmspIHtcclxuICAgICAgd2luZG93Lm9wZW4ocm93LmxpbmssICdfYmxhbmsnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKiBNYXBzIGdlbmVyYWwgYXZsIG5vdGlmaWNhdGlvbiBsaXN0IHRvIHRhYmxlIHNwZWNpZmljIGxpc3QgKi9cclxuICBwcml2YXRlIHByZXBhcmVOb3RpZmljYXRpb25zKG5vdGlmaWNhdGlvbnM6IEF2bE5vdGlmaWNhdGlvbltdKTogQXZsTm90aWZpY2F0aW9uVGFibGVJdGVtW10ge1xyXG4gICAgcmV0dXJuIG5vdGlmaWNhdGlvbnMubWFwKG5vdGlmaWNhdGlvbiA9PiAoe1xyXG4gICAgICAuLi5ub3RpZmljYXRpb24sXHJcbiAgICAgIGljb246IFRZUEVfSUNPTl9NQVBQSU5HU1tub3RpZmljYXRpb24udHlwZV0sXHJcbiAgICAgIGljb25TdHlsZTogVFlQRV9JQ09OX1NUWUxFX01BUFBJTkdTW25vdGlmaWNhdGlvbi50eXBlXSxcclxuICAgICAgY3VycmVudEljb25Ub2dnbGU6IFNUQVRFX0lDT05fTUFQUElOR1NbU3RyaW5nKG5vdGlmaWNhdGlvbi5yZWFkKV0sXHJcbiAgICAgIGN1cnJlbnRJY29uVG9nZ2xlU3R5bGU6IERFRkFVTFRfSUNPTl9TVFlMRSxcclxuICAgICAgc3RhdGU6IG5vdGlmaWNhdGlvbi5yZWFkXHJcbiAgICB9KSk7XHJcbiAgfVxyXG5cclxuICAvKiogRm9ybWF0cyBkYXRlIHRpbWUgdG8gZGF0ZS1zaG9ydCAqL1xyXG4gIHByaXZhdGUgZm9ybWF0RGF0ZVRpbWUoZDogRGF0ZSk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gZCA/IEF2bExvY2FsaXphdGlvblNlcnZpY2UuZm9ybWF0RGF0ZVRpbWUoZCwgeyBmb3JtYXQ6ICdkYXRlLXNob3J0JyB9KSA6ICcoLSknO1xyXG4gIH1cclxuXHJcbiAgLyoqIERlZXAgY29weSBvZiBmaWx0ZXJzIG9iamVjdCAqL1xyXG4gIHByaXZhdGUgZGVlcENvcHlPYmplY3Qob2JqZWN0OiBhbnkpOiBhbnkge1xyXG4gICAgY29uc3QgY29waWVkT2JqZWN0ID0ge307XHJcbiAgICBPYmplY3Qua2V5cyhvYmplY3QpLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgY29waWVkT2JqZWN0W2tleV0gPSBPYmplY3QuYXNzaWduKHt9LCBvYmplY3Rba2V5XSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBjb3BpZWRPYmplY3Q7XHJcbiAgfVxyXG5cclxuICAvKiogRGV0ZXJtaW5lcyBpZiBlbGVtZW50IHNhdGlzZmllcyBmaWx0ZXIgZm9yIGV2ZXJ5IGtleSBpbiB0aGlzLmFwcHBsaWVkRmlsdGVycyAqL1xyXG4gIHByaXZhdGUgZG9lc0VsZW1lbnRQYXNzRXZlcnlGaWx0ZXIoYWN0aXZlRmlsdGVyczogYW55LCBlbGVtZW50OiBhbnkpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBPYmplY3Qua2V5cyhhY3RpdmVGaWx0ZXJzKS5ldmVyeShrZXkgPT4ge1xyXG4gICAgICBpZiAoa2V5ID09PSAnZGF0ZScpIHtcclxuICAgICAgICBjb25zdCBbZGF0ZUZyb20sIGRhdGVUb10gPSB0aGlzLnByZXBhcmVEYXRlcyhhY3RpdmVGaWx0ZXJzW2tleV0pO1xyXG5cclxuICAgICAgICAvLyBJZiBkYXRlcyBub3Qgc2V0LCBmaWx0ZXIgdGhpcyBlbGVtZW50IGFzIHdlbGxcclxuICAgICAgICBpZiAoIWRhdGVGcm9tLmdldFRpbWUoKSAmJiAhZGF0ZVRvLmdldFRpbWUoKSkge1xyXG4gICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmJhZGdlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgLy8gSWYgdGltZXN0YW1wIGlzIG5vdCBhIERhdGUsIGRvbid0IGZpbHRlciB0aGlzIGVsZW1lbnRcclxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZShlbGVtZW50LnRpbWVzdGFtcCk7XHJcbiAgICAgICAgaWYgKCF0aW1lc3RhbXAuZ2V0VGltZSgpKSB7XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmNvbXBhcmVEYXRlcyh0aW1lc3RhbXAsIGRhdGVGcm9tLCBkYXRlVG8pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4gYWN0aXZlRmlsdGVyc1trZXldLmluY2x1ZGVzKE5PVElGSUNBVElPTl9UWVBFX01BUFBJTkdTW2VsZW1lbnRba2V5XV0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHByZXBhcmVEYXRlcyhkYXRlczogc3RyaW5nW10pOiBbRGF0ZSwgRGF0ZV0ge1xyXG4gICAgY29uc3QgZGF0ZUZyb20gPSBuZXcgRGF0ZShkYXRlc1swXSk7XHJcbiAgICBjb25zdCBkYXRlVG8gPSBuZXcgRGF0ZShkYXRlc1sxXSk7XHJcbiAgICBkYXRlRnJvbS5zZXRIb3VycygwLCAwLCAwLCAwKTtcclxuICAgIGRhdGVUby5zZXRIb3VycygyMywgNTksIDU5LCA5OTkpO1xyXG4gICAgcmV0dXJuIFtkYXRlRnJvbSwgZGF0ZVRvXTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY29tcGFyZURhdGVzKHRpbWVzdGFtcDogRGF0ZSwgZnJvbTogRGF0ZSwgdG86IERhdGUpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IHRzID0gdGltZXN0YW1wLmdldFRpbWUoKTtcclxuICAgIGNvbnN0IGZyb21UcyA9IGZyb20/LmdldFRpbWUoKTtcclxuICAgIGNvbnN0IHRvVHMgPSB0bz8uZ2V0VGltZSgpO1xyXG5cclxuICAgIGlmIChmcm9tVHMgJiYgdG9Ucykge1xyXG4gICAgICByZXR1cm4gdHMgPj0gZnJvbVRzICYmIHRzIDw9IHRvVHM7XHJcbiAgICB9IGVsc2UgaWYgKGZyb21Ucykge1xyXG4gICAgICByZXR1cm4gdHMgPj0gZnJvbVRzO1xyXG4gICAgfSBlbHNlIGlmICh0b1RzKSB7XHJcbiAgICAgIHJldHVybiB0cyA8PSB0b1RzO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdXBkYXRlU3RhdGVPZlNlbGVjdGVkUm93c1RvKHN0YXRlOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICB0aGlzLnRhYmxlRGF0YVxyXG4gICAgICAuZmlsdGVyKG5vdGlmaWNhdGlvbiA9PiB0aGlzLmlzUm93U2VsZWN0ZWQobm90aWZpY2F0aW9uLmlkKSlcclxuICAgICAgLmZvckVhY2gobm90aWZpY2F0aW9uID0+IHtcclxuICAgICAgICBub3RpZmljYXRpb24uc3RhdGUgPSBzdGF0ZTtcclxuICAgICAgICBub3RpZmljYXRpb24uY3VycmVudEljb25Ub2dnbGUgPSBTVEFURV9JQ09OX01BUFBJTkdTW1N0cmluZyhzdGF0ZSldO1xyXG4gICAgICB9KTtcclxuICAgIHRoaXMudGFibGVEYXRhID0gWy4uLnRoaXMudGFibGVEYXRhXTtcclxuICAgIHRoaXMuZmlsdGVyRGF0YSgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpc1Jvd1NlbGVjdGVkKGlkOiBudW1iZXIpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLnNlbGVjdGVkUm93cy5tYXAocm93ID0+IHJvdy5pZCkuaW5jbHVkZXMoaWQpO1xyXG4gIH1cclxuXHJcbiAgLy8gVHJhbnNsYXRpb25zXHJcbiAgcHJpdmF0ZSBhc3luYyB0cmFuc2xhdGVMYWJlbHMoKSB7XHJcbiAgICBpZiAoIUF2bExvY2FsaXphdGlvblNlcnZpY2UgfHwgIUF2bExvY2FsaXphdGlvblNlcnZpY2UudHJhbnNsYXRpb25TZXJ2aWNlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB0cmFuc2xhdGlvblNlcnZpY2UgPSBBdmxMb2NhbGl6YXRpb25TZXJ2aWNlLnRyYW5zbGF0aW9uU2VydmljZTtcclxuICAgIHRoaXMuZGF0ZUZpbHRlckdyb3VwSW5pdEhlYWRlciA9IGF3YWl0IHRyYW5zbGF0aW9uU2VydmljZS50cmFuc2xhdGUoXHJcbiAgICAgICdWaXpCb3guTm90aWZpY2F0aW9uRGlhbG9nLkRhdGUnXHJcbiAgICApO1xyXG4gICAgdGhpcy5kYXRlRmlsdGVyR3JvdXBIZWFkZXIgPSB0aGlzLmRhdGVGaWx0ZXJHcm91cEluaXRIZWFkZXI7XHJcbiAgICB0aGlzLmRhdGVGcm9tTGFiZWwgPSBhd2FpdCB0cmFuc2xhdGlvblNlcnZpY2UudHJhbnNsYXRlKCdWaXpCb3guTm90aWZpY2F0aW9uRGlhbG9nLkRhdGVGcm9tJyk7XHJcbiAgICB0aGlzLmRhdGVUb0xhYmVsID0gYXdhaXQgdHJhbnNsYXRpb25TZXJ2aWNlLnRyYW5zbGF0ZSgnVml6Qm94Lk5vdGlmaWNhdGlvbkRpYWxvZy5EYXRlVG8nKTtcclxuICAgIHRoaXMucGFnZVNpemVPcHRpb25zID0gYXdhaXQgdGhpcy50cmFuc2xhdGVQYWdlU2l6ZU9wdGlvbnModGhpcy5wYWdlU2l6ZU9wdGlvbnMpO1xyXG4gICAgdGhpcy5jb2x1bW5EZWZpbml0aW9ucyA9IGF3YWl0IHRoaXMudHJhbnNsYXRlQ29sdW1ucyh0aGlzLmNvbHVtbkRlZmluaXRpb25zKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgdHJhbnNsYXRlUGFnZVNpemVPcHRpb25zKG9wdGlvbnM6IFBhZ2VTaXplT3B0aW9uW10pOiBQcm9taXNlPFBhZ2VTaXplT3B0aW9uW10+IHtcclxuICAgIHJldHVybiBhd2FpdCBQcm9taXNlLmFsbChcclxuICAgICAgb3B0aW9ucy5tYXAoYXN5bmMgb3B0aW9uID0+IGF3YWl0IHRoaXMudHJhbnNsYXRlUGFnZVNpemVPcHRpb24ob3B0aW9uKSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIHRyYW5zbGF0ZVBhZ2VTaXplT3B0aW9uKGl0ZW06IFBhZ2VTaXplT3B0aW9uKTogUHJvbWlzZTxQYWdlU2l6ZU9wdGlvbj4ge1xyXG4gICAgY29uc3QgdHJhbnNsYXRpb25TZXJ2aWNlID0gQXZsTG9jYWxpemF0aW9uU2VydmljZS50cmFuc2xhdGlvblNlcnZpY2U7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAuLi5pdGVtLFxyXG4gICAgICBsYWJlbDpcclxuICAgICAgICBpdGVtLnZhbHVlID09PSBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUlxyXG4gICAgICAgICAgPyBhd2FpdCB0cmFuc2xhdGlvblNlcnZpY2UudHJhbnNsYXRlKCdWaXpCb3guTm90aWZpY2F0aW9uRGlhbG9nLlNob3dBbGwnKVxyXG4gICAgICAgICAgOiBhd2FpdCB0cmFuc2xhdGlvblNlcnZpY2UudHJhbnNsYXRlKCdWaXpCb3guTm90aWZpY2F0aW9uRGlhbG9nLlNob3dYUGVyUGFnZScsIHtcclxuICAgICAgICAgICAgICByb3dzOiBpdGVtLnZhbHVlXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyB0cmFuc2xhdGVDb2x1bW5zKGNvbHVtbjogQ29sdW1uW10pOiBQcm9taXNlPENvbHVtbltdPiB7XHJcbiAgICByZXR1cm4gYXdhaXQgUHJvbWlzZS5hbGwoY29sdW1uLm1hcChhc3luYyBpdGVtID0+IGF3YWl0IHRoaXMudHJhbnNsYXRlQ29sdW1uSXRlbShpdGVtKSkpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyB0cmFuc2xhdGVDb2x1bW5JdGVtKGl0ZW06IENvbHVtbik6IFByb21pc2U8Q29sdW1uPiB7XHJcbiAgICBjb25zdCB0cmFuc2xhdGVTZXJ2aWNlID0gQXZsTG9jYWxpemF0aW9uU2VydmljZS50cmFuc2xhdGlvblNlcnZpY2U7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAuLi5pdGVtLFxyXG4gICAgICBjYXB0aW9uOiBhd2FpdCB0cmFuc2xhdGVTZXJ2aWNlLnRyYW5zbGF0ZShpdGVtLmNhcHRpb24pXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG4iXX0=