var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __read = (this && this.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};
var __spread = (this && this.__spread) || function () {
    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));
    return ar;
};
import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { NOTIFICATIONS_OVERFLOW_MENU, TYPE_ICON_MAPPINGS } from './avl-notification-menu.consts';
var AvlNotificationMenuComponent = /** @class */ (function () {
    function AvlNotificationMenuComponent() {
        var _this = this;
        this.open = false;
        this.openChange = new EventEmitter();
        this.openDetails = new EventEmitter();
        this.notificationStateChanged = new EventEmitter();
        this.markAllAsRead = new EventEmitter();
        this.markAllAsUnread = new EventEmitter();
        this.overflowMenuItems = [];
        this.notificationList = [];
        this.numberOfUnreadNotifications = 0;
        this.overflowMenuHandlers = {
            markAllAsRead: function () {
                _this.markAllAsRead.emit();
                _this.numberOfUnreadNotifications = 0;
            },
            markAllAsUnread: function () {
                _this.markAllAsUnread.emit();
                _this.numberOfUnreadNotifications = _this.notificationList.length;
            },
            undefined: function () { }
        };
        this.translateLabels();
    }
    Object.defineProperty(AvlNotificationMenuComponent.prototype, "notifications", {
        set: function (notifications) {
            this.notificationList = this.prepareNotifications(notifications);
            this.numberOfUnreadNotifications = notifications.filter(function (notif) { return !notif.read; }).length;
        },
        enumerable: true,
        configurable: true
    });
    AvlNotificationMenuComponent.prototype.ngAfterViewInit = function () {
        this.list.nativeElement.revertedList = true;
    };
    AvlNotificationMenuComponent.prototype.onNotificationStateChanged = function (event) {
        var notificationMenuItem = __assign({}, event.detail.value);
        var notification = __assign(__assign({}, notificationMenuItem), { read: notificationMenuItem.iconToggleValue });
        notification.read ? this.numberOfUnreadNotifications-- : this.numberOfUnreadNotifications++;
        this.notificationStateChanged.emit(notification);
        this.list.nativeElement.removeFocus();
    };
    AvlNotificationMenuComponent.prototype.onItemClicked = function (item) {
        this.overflowMenuHandlers[item.action]();
    };
    AvlNotificationMenuComponent.prototype.onOpenChanged = function (event) {
        if (!event.detail.value) {
            this.openChange.emit(false);
        }
        else {
            this.notificationList = __spread(this.notificationList);
        }
    };
    AvlNotificationMenuComponent.prototype.onOverflowMenuClicked = function () {
        this.list.nativeElement.removeFocus();
    };
    AvlNotificationMenuComponent.prototype.onDetailsClicked = function () {
        this.open = false;
        this.openDetails.emit();
        this.openChange.emit(false);
    };
    AvlNotificationMenuComponent.prototype.prepareNotifications = function (notifications) {
        var _this = this;
        return notifications.map(function (notification) { return (__assign(__assign({}, notification), { label: notification.messageText, sublabel: _this.formatDateTime(notification.timestamp), icon: TYPE_ICON_MAPPINGS[notification.type], iconToggleUnchecked: 'mail', iconToggleChecked: 'communication:mail-outline', iconToggleValue: notification.read })); });
    };
    AvlNotificationMenuComponent.prototype.formatDateTime = function (date) {
        return date === null
            ? ''
            : AvlLocalizationService.formatDateTime(date, {
                format: 'date-short'
            }) + " " + AvlLocalizationService.formatDateTime(date, { format: 'time-long' });
    };
    AvlNotificationMenuComponent.prototype.translateLabels = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _a;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        if (!AvlLocalizationService || !AvlLocalizationService.translationService) {
                            return [2 /*return*/];
                        }
                        _a = this;
                        return [4 /*yield*/, this.translateMenu(NOTIFICATIONS_OVERFLOW_MENU)];
                    case 1:
                        _a.overflowMenuItems = _b.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    AvlNotificationMenuComponent.prototype.translateMenu = function (menu) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, Promise.all(menu.map(function (group) { return __awaiter(_this, void 0, void 0, function () { return __generator(this, function (_a) {
                            switch (_a.label) {
                                case 0: return [4 /*yield*/, this.translateMenuGroup(group)];
                                case 1: return [2 /*return*/, _a.sent()];
                            }
                        }); }); }))];
                    case 1: return [2 /*return*/, _a.sent()];
                }
            });
        });
    };
    AvlNotificationMenuComponent.prototype.translateMenuGroup = function (group) {
        return __awaiter(this, void 0, void 0, function () {
            var _a;
            var _this = this;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _a = {};
                        return [4 /*yield*/, Promise.all(group.items.map(function (item) { return __awaiter(_this, void 0, void 0, function () { return __generator(this, function (_a) {
                                switch (_a.label) {
                                    case 0: return [4 /*yield*/, this.translateMenuItem(item)];
                                    case 1: return [2 /*return*/, _a.sent()];
                                }
                            }); }); }))];
                    case 1: return [2 /*return*/, (_a.items = _b.sent(),
                            _a)];
                }
            });
        });
    };
    AvlNotificationMenuComponent.prototype.translateMenuItem = function (item) {
        return __awaiter(this, void 0, void 0, function () {
            var translateService, _a, _b, _c;
            return __generator(this, function (_d) {
                switch (_d.label) {
                    case 0:
                        translateService = AvlLocalizationService.translationService;
                        _a = [__assign({}, item)];
                        _b = {};
                        return [4 /*yield*/, translateService.translate(item.label)];
                    case 1:
                        _b.label = _d.sent();
                        if (!item.sublabel) return [3 /*break*/, 3];
                        return [4 /*yield*/, translateService.translate(item.sublabel)];
                    case 2:
                        _c = _d.sent();
                        return [3 /*break*/, 4];
                    case 3:
                        _c = null;
                        _d.label = 4;
                    case 4: return [2 /*return*/, __assign.apply(void 0, _a.concat([(_b.sublabel = _c, _b)]))];
                }
            });
        });
    };
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], AvlNotificationMenuComponent.prototype, "open", void 0);
    __decorate([
        Input(),
        __metadata("design:type", HTMLElement)
    ], AvlNotificationMenuComponent.prototype, "trigger", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Array),
        __metadata("design:paramtypes", [Array])
    ], AvlNotificationMenuComponent.prototype, "notifications", null);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], AvlNotificationMenuComponent.prototype, "openChange", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], AvlNotificationMenuComponent.prototype, "openDetails", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], AvlNotificationMenuComponent.prototype, "notificationStateChanged", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], AvlNotificationMenuComponent.prototype, "markAllAsRead", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], AvlNotificationMenuComponent.prototype, "markAllAsUnread", void 0);
    __decorate([
        ViewChild('list'),
        __metadata("design:type", ElementRef)
    ], AvlNotificationMenuComponent.prototype, "list", void 0);
    AvlNotificationMenuComponent = __decorate([
        Component({
            selector: 'avl-notification-menu',
            template: "<avl-popup\r\n  [noCloseOnInsideClick]=\"true\"\r\n  [open]=\"open\"\r\n  [trigger]=\"trigger\"\r\n  (open-changed)=\"onOpenChanged($event)\"\r\n>\r\n  <div id=\"header\">\r\n    <div id=\"headerText\">\r\n      <span>{{ 'VizBox.NotificationMenu.Notifications' | translate }}</span>\r\n      <span *ngIf=\"numberOfUnreadNotifications\"> ({{ numberOfUnreadNotifications }}) </span>\r\n    </div>\r\n    <avl-overflow-menu (itemClicked)=\"onItemClicked($event)\" [items]=\"overflowMenuItems\">\r\n      <avl-icon-button\r\n        icon=\"more-vert\"\r\n        slot=\"trigger\"\r\n        (click)=\"onOverflowMenuClicked()\"\r\n      ></avl-icon-button>\r\n    </avl-overflow-menu>\r\n  </div>\r\n  <avl-list\r\n    #list\r\n    [rows]=\"notificationList\"\r\n    (row-changed)=\"onNotificationStateChanged($event)\"\r\n  ></avl-list>\r\n  <div id=\"footer\">\r\n    <avl-button (click)=\"onDetailsClicked()\">{{ 'VizBox.NotificationMenu.Details' | translate }}</avl-button>\r\n  </div>\r\n</avl-popup>\r\n",
            styles: ["avl-popup{width:40%}avl-list{width:100%;height:250px;padding-top:8px;--avl-item-padding-left:16px;--avl-item-padding-right:16px;--notification-item-height:48px}#header{display:flex;align-items:center;justify-content:space-between;box-sizing:border-box;height:56px;padding:0 16px;border-bottom:1px solid var(--avl-overflow-menu-divider-color,var(--avl-divider-color))}#footer{display:flex;align-items:center;box-sizing:border-box;height:56px;border-top:1px solid var(--avl-overflow-menu-divider-color,var(--avl-divider-color))}#headerText{font-size:20px;color:var(--avl-primary-text-color);overflow:hidden;white-space:nowrap;text-overflow:ellipsis}"]
        }),
        __metadata("design:paramtypes", [])
    ], AvlNotificationMenuComponent);
    return AvlNotificationMenuComponent;
}());
export { AvlNotificationMenuComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXZsLW5vdGlmaWNhdGlvbi1tZW51LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhdmwtbmctY29udHJvbHMvbm90aWZpY2F0aW9uLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvYXZsLW5vdGlmaWNhdGlvbi1tZW51L2F2bC1ub3RpZmljYXRpb24tbWVudS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLE9BQU8sRUFFTCxTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixLQUFLLEVBQ0wsTUFBTSxFQUNOLFNBQVMsRUFDVixNQUFNLGVBQWUsQ0FBQztBQVF2QixPQUFPLEVBQUUsMkJBQTJCLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQU9qRztJQWlDRTtRQUFBLGlCQUVDO1FBbENRLFNBQUksR0FBWSxLQUFLLENBQUM7UUFRckIsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFXLENBQUM7UUFDekMsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBQ3ZDLDZCQUF3QixHQUFHLElBQUksWUFBWSxFQUFtQixDQUFDO1FBQy9ELGtCQUFhLEdBQUcsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQUN6QyxvQkFBZSxHQUFHLElBQUksWUFBWSxFQUFRLENBQUM7UUFJOUMsc0JBQWlCLEdBQTJCLEVBQUUsQ0FBQztRQUMvQyxxQkFBZ0IsR0FBOEIsRUFBRSxDQUFDO1FBQ2pELGdDQUEyQixHQUFXLENBQUMsQ0FBQztRQUV2Qyx5QkFBb0IsR0FBa0M7WUFDNUQsYUFBYSxFQUFFO2dCQUNiLEtBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQzFCLEtBQUksQ0FBQywyQkFBMkIsR0FBRyxDQUFDLENBQUM7WUFDdkMsQ0FBQztZQUNELGVBQWUsRUFB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b0Y7aUNBQzNGOzs7O0tBQ0g7SUFFYSx3REFBaUIsR0FBL0IsVUFBZ0MsSUFBeUI7Ozs7Ozt3QkFDakQsZ0JBQWdCLEdBQUcsc0JBQXNCLENBQUMsa0JBQWtCLENBQUM7MkNBRTlELElBQUk7O3dCQUNBLHFCQUFNLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUE7O3dCQUFuRCxRQUFLLEdBQUUsU0FBNEM7NkJBQ3pDLElBQUksQ0FBQyxRQUFRLEVBQWIsd0JBQWE7d0JBQUcscUJBQU0sZ0JBQWdCLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBQTs7d0JBQS9DLEtBQUEsU0FBK0MsQ0FBQTs7O3dCQUFHLEtBQUEsSUFBSSxDQUFBOzs0QkFIbEYseURBR0UsV0FBUSxlQUNSOzs7O0tBQ0g7SUF2SFE7UUFBUixLQUFLLEVBQUU7OzhEQUF1QjtJQUN0QjtRQUFSLEtBQUssRUFBRTtrQ0FBVSxXQUFXO2lFQUFDO0lBRTlCO1FBREMsS0FBSyxFQUFFOzs7cUVBSVA7SUFFUztRQUFULE1BQU0sRUFBRTs7b0VBQTBDO0lBQ3pDO1FBQVQsTUFBTSxFQUFFOztxRUFBd0M7SUFDdkM7UUFBVCxNQUFNLEVBQUU7O2tGQUFnRTtJQUMvRDtRQUFULE1BQU0sRUFBRTs7dUVBQTBDO0lBQ3pDO1FBQVQsTUFBTSxFQUFFOzt5RUFBNEM7SUFFbEM7UUFBbEIsU0FBUyxDQUFDLE1BQU0sQ0FBQztrQ0FBTyxVQUFVOzhEQUFVO0lBZmxDLDRCQUE0QjtRQUx4QyxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsdUJBQXVCO1lBQ2pDLHcvQkFBcUQ7O1NBRXRELENBQUM7O09BQ1csNEJBQTRCLENBeUh4QztJQUFELG1DQUFDO0NBQUEsQUF6SEQsSUF5SEM7U0F6SFksNEJBQTRCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBBZnRlclZpZXdJbml0LFxyXG4gIENvbXBvbmVudCxcclxuICBFbGVtZW50UmVmLFxyXG4gIEV2ZW50RW1pdHRlcixcclxuICBJbnB1dCxcclxuICBPdXRwdXQsXHJcbiAgVmlld0NoaWxkXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEF2bExpc3QgfSBmcm9tICdAYXZsLWNvbnRyb2xzL2NvcmUvZGlzdC9hdmwtbGlzdC9hdmwtbGlzdC5hcGknO1xyXG5pbXBvcnQge1xyXG4gIEF2bE92ZXJmbG93TWVudUdyb3VwLFxyXG4gIEF2bE92ZXJmbG93TWVudUl0ZW1cclxufSBmcm9tICdAYXZsLWNvbnRyb2xzL2NvcmUvZGlzdC9hdmwtb3ZlcmZsb3ctbWVudS9hdmwtb3ZlcmZsb3ctbWVudS5hcGknO1xyXG5pbXBvcnQgeyBBdmxOb3RpZmljYXRpb24gfSBmcm9tICdAYXZsLWNvbnRyb2xzL2ludGVyZmFjZXMnO1xyXG5pbXBvcnQgeyBBdmxOb3RpZmljYXRpb25NZW51SXRlbSB9IGZyb20gJy4uLy4uL21vZGVscy9ub3RpZmljYXRpb24tbWVudS5tb2RlbCc7XHJcbmltcG9ydCB7IE5PVElGSUNBVElPTlNfT1ZFUkZMT1dfTUVOVSwgVFlQRV9JQ09OX01BUFBJTkdTIH0gZnJvbSAnLi9hdmwtbm90aWZpY2F0aW9uLW1lbnUuY29uc3RzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnYXZsLW5vdGlmaWNhdGlvbi1tZW51JyxcclxuICB0ZW1wbGF0ZVVybDogJy4vYXZsLW5vdGlmaWNhdGlvbi1tZW51LmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9hdmwtbm90aWZpY2F0aW9uLW1lbnUuY29tcG9uZW50LmNzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBBdmxOb3RpZmljYXRpb25NZW51Q29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCB7XHJcbiAgQElucHV0KCkgb3BlbjogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIEBJbnB1dCgpIHRyaWdnZXI6IEhUTUxFbGVtZW50O1xyXG4gIEBJbnB1dCgpIFxyXG4gIHNldCBub3RpZmljYXRpb25zKG5vdGlmaWNhdGlvbnM6IEF2bE5vdGlmaWNhdGlvbltdKSB7XHJcbiAgICB0aGlzLm5vdGlmaWNhdGlvbkxpc3QgPSB0aGlzLnByZXBhcmVOb3RpZmljYXRpb25zKG5vdGlmaWNhdGlvbnMpO1xyXG4gICAgdGhpcy5udW1iZXJPZlVucmVhZE5vdGlmaWNhdGlvbnMgPSBub3RpZmljYXRpb25zLmZpbHRlcihub3RpZiA9PiAhbm90aWYucmVhZCkubGVuZ3RoO1xyXG4gIH1cclxuXHJcbiAgQE91dHB1dCgpIG9wZW5DaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XHJcbiAgQE91dHB1dCgpIG9wZW5EZXRhaWxzID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xyXG4gIEBPdXRwdXQoKSBub3RpZmljYXRpb25TdGF0ZUNoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyPEF2bE5vdGlmaWNhdGlvbj4oKTtcclxuICBAT3V0cHV0KCkgbWFya0FsbEFzUmVhZCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcclxuICBAT3V0cHV0KCkgbWFya0FsbEFzVW5yZWFkID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xyXG5cclxuICBAVmlld0NoaWxkKCdsaXN0JykgbGlzdDogRWxlbWVudFJlZjxBdmxMaXN0PjtcclxuXHJcbiAgcHVibGljIG92ZXJmbG93TWVudUl0ZW1zOiBBdmxPdmVyZmxvd01lbnVHcm91cFtdID0gW107XHJcbiAgcHVibGljIG5vdGlmaWNhdGlvbkxpc3Q6IEF2bE5vdGlmaWNhdGlvbk1lbnVJdGVtW10gPSBbXTtcclxuICBwdWJsaWMgbnVtYmVyT2ZVbnJlYWROb3RpZmljYXRpb25zOiBudW1iZXIgPSAwO1xyXG5cclxuICBwcml2YXRlIG92ZXJmbG93TWVudUhhbmRsZXJzOiB7IFtrZXk6IHN0cmluZ106ICgpID0+IHZvaWQgfSA9IHtcclxuICAgIG1hcmtBbGxBc1JlYWQ6ICgpID0+IHtcclxuICAgICAgdGhpcy5tYXJrQWxsQXNSZWFkLmVtaXQoKTtcclxuICAgICAgdGhpcy5udW1iZXJPZlVucmVhZE5vdGlmaWNhdGlvbnMgPSAwO1xyXG4gICAgfSxcclxuICAgIG1hcmtBbGxBc1VucmVhZDogKCkgPT4ge1xyXG4gICAgICB0aGlzLm1hcmtBbGxBc1VucmVhZC5lbWl0KCk7XHJcbiAgICAgIHRoaXMubnVtYmVyT2ZVbnJlYWROb3RpZmljYXRpb25zID0gdGhpcy5ub3RpZmljYXRpb25MaXN0Lmxlbmd0aDtcclxuICAgIH0sXHJcbiAgICB1bmRlZmluZWQ6ICgpID0+IHt9XHJcbiAgfTtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLnRyYW5zbGF0ZUxhYmVscygpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMubGlzdC5uYXRpdmVFbGVtZW50LnJldmVydGVkTGlzdCA9IHRydWU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb25Ob3RpZmljYXRpb25TdGF0ZUNoYW5nZWQoZXZlbnQ6IEV2ZW50KTogdm9pZCB7XHJcbiAgICBjb25zdCBub3RpZmljYXRpb25NZW51SXRlbTogQXZsTm90aWZpY2F0aW9uTWVudUl0ZW0gPSB7IC4uLig8Q3VzdG9tRXZlbnQ+ZXZlbnQpLmRldGFpbC52YWx1ZSB9O1xyXG4gICAgY29uc3Qgbm90aWZpY2F0aW9uID0ge1xyXG4gICAgICAuLi5ub3RpZmljYXRpb25NZW51SXRlbSxcclxuICAgICAgcmVhZDogbm90aWZpY2F0aW9uTWVudUl0ZW0uaWNvblRvZ2dsZVZhbHVlXHJcbiAgICB9IGFzIEF2bE5vdGlmaWNhdGlvbjtcclxuICAgIG5vdGlmaWNhdGlvbi5yZWFkID8gdGhpcy5udW1iZXJPZlVucmVhZE5vdGlmaWNhdGlvbnMtLSA6IHRoaXMubnVtYmVyT2ZVbnJlYWROb3RpZmljYXRpb25zKys7XHJcbiAgICB0aGlzLm5vdGlmaWNhdGlvblN0YXRlQ2hhbmdlZC5lbWl0KG5vdGlmaWNhdGlvbik7XHJcblxyXG4gICAgdGhpcy5saXN0Lm5hdGl2ZUVsZW1lbnQucmVtb3ZlRm9jdXMoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvbkl0ZW1DbGlja2VkKGl0ZW06IEF2bE92ZXJmbG93TWVudUl0ZW0pOiB2b2lkIHtcclxuICAgIHRoaXMub3ZlcmZsb3dNZW51SGFuZGxlcnNbaXRlbS5hY3Rpb25dKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb25PcGVuQ2hhbmdlZChldmVudDogRXZlbnQpOiB2b2lkIHtcclxuICAgIGlmICghKDxDdXN0b21FdmVudD5ldmVudCkuZGV0YWlsLnZhbHVlKSB7XHJcbiAgICAgIHRoaXMub3BlbkNoYW5nZS5lbWl0KGZhbHNlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMubm90aWZpY2F0aW9uTGlzdCA9IFsuLi50aGlzLm5vdGlmaWNhdGlvbkxpc3RdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIG9uT3ZlcmZsb3dNZW51Q2xpY2tlZCgpOiB2b2lkIHtcclxuICAgIHRoaXMubGlzdC5uYXRpdmVFbGVtZW50LnJlbW92ZUZvY3VzKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb25EZXRhaWxzQ2xpY2tlZCgpOiB2b2lkIHtcclxuICAgIHRoaXMub3BlbiA9IGZhbHNlO1xyXG4gICAgdGhpcy5vcGVuRGV0YWlscy5lbWl0KCk7XHJcbiAgICB0aGlzLm9wZW5DaGFuZ2UuZW1pdChmYWxzZSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHByZXBhcmVOb3RpZmljYXRpb25zKG5vdGlmaWNhdGlvbnM6IEF2bE5vdGlmaWNhdGlvbltdKTogQXZsTm90aWZpY2F0aW9uTWVudUl0ZW1bXSB7XHJcbiAgICByZXR1cm4gbm90aWZpY2F0aW9ucy5tYXAobm90aWZpY2F0aW9uID0+ICh7XHJcbiAgICAgIC4uLm5vdGlmaWNhdGlvbixcclxuICAgICAgbGFiZWw6IG5vdGlmaWNhdGlvbi5tZXNzYWdlVGV4dCxcclxuICAgICAgc3VibGFiZWw6IHRoaXMuZm9ybWF0RGF0ZVRpbWUobm90aWZpY2F0aW9uLnRpbWVzdGFtcCksXHJcbiAgICAgIGljb246IFRZUEVfSUNPTl9NQVBQSU5HU1tub3RpZmljYXRpb24udHlwZV0sXHJcbiAgICAgIGljb25Ub2dnbGVVbmNoZWNrZWQ6ICdtYWlsJyxcclxuICAgICAgaWNvblRvZ2dsZUNoZWNrZWQ6ICdjb21tdW5pY2F0aW9uOm1haWwtb3V0bGluZScsXHJcbiAgICAgIGljb25Ub2dnbGVWYWx1ZTogbm90aWZpY2F0aW9uLnJlYWRcclxuICAgIH0pKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZm9ybWF0RGF0ZVRpbWUoZGF0ZTogRGF0ZSk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gZGF0ZSA9PT0gbnVsbFxyXG4gICAgICA/ICcnXHJcbiAgICAgIDogYCR7QXZsTG9jYWxpemF0aW9uU2VydmljZS5mb3JtYXREYXRlVGltZShkYXRlLCB7XHJcbiAgICAgICAgICBmb3JtYXQ6ICdkYXRlLXNob3J0J1xyXG4gICAgICAgIH0pfSAke0F2bExvY2FsaXphdGlvblNlcnZpY2UuZm9ybWF0RGF0ZVRpbWUoZGF0ZSwgeyBmb3JtYXQ6ICd0aW1lLWxvbmcnIH0pfWA7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIHRyYW5zbGF0ZUxhYmVscygpIHtcclxuICAgIGlmICghQXZsTG9jYWxpemF0aW9uU2VydmljZSB8fCAhQXZsTG9jYWxpemF0aW9uU2VydmljZS50cmFuc2xhdGlvblNlcnZpY2UpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMub3ZlcmZsb3dNZW51SXRlbXMgPSBhd2FpdCB0aGlzLnRyYW5zbGF0ZU1lbnUoTk9USUZJQ0FUSU9OU19PVkVSRkxPV19NRU5VKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgdHJhbnNsYXRlTWVudShtZW51OiBBdmxPdmVyZmxvd01lbnVHcm91cFtdKTogUHJvbWlzZTxBdmxPdmVyZmxvd01lbnVHcm91cFtdPiB7XHJcbiAgICByZXR1cm4gYXdhaXQgUHJvbWlzZS5hbGwobWVudS5tYXAoYXN5bmMgZ3JvdXAgPT4gYXdhaXQgdGhpcy50cmFuc2xhdGVNZW51R3JvdXAoZ3JvdXApKSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIHRyYW5zbGF0ZU1lbnVHcm91cChncm91cDogQXZsT3ZlcmZsb3dNZW51R3JvdXApOiBQcm9taXNlPEF2bE92ZXJmbG93TWVudUdyb3VwPiB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpdGVtczogYXdhaXQgUHJvbWlzZS5hbGwoZ3JvdXAuaXRlbXMubWFwKGFzeW5jIGl0ZW0gPT4gYXdhaXQgdGhpcy50cmFuc2xhdGVNZW51SXRlbShpdGVtKSkpXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyB0cmFuc2xhdGVNZW51SXRlbShpdGVtOiBBdmxPdmVyZmxvd01lbnVJdGVtKTogUHJvbWlzZTxBdmxPdmVyZmxvd01lbnVJdGVtPiB7XHJcbiAgICBjb25zdCB0cmFuc2xhdGVTZXJ2aWNlID0gQXZsTG9jYWxpemF0aW9uU2VydmljZS50cmFuc2xhdGlvblNlcnZpY2U7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAuLi5pdGVtLFxyXG4gICAgICBsYWJlbDogYXdhaXQgdHJhbnNsYXRlU2VydmljZS50cmFuc2xhdGUoaXRlbS5sYWJlbCksXHJcbiAgICAgIHN1YmxhYmVsOiBpdGVtLnN1YmxhYmVsID8gYXdhaXQgdHJhbnNsYXRlU2VydmljZS50cmFuc2xhdGUoaXRlbS5zdWJsYWJlbCkgOiBudWxsXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG4iXX0=