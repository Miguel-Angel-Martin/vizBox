var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
import { AfterViewChecked, ChangeDetectorRef, Component, ElementRef, EventEmitter, HostBinding, Input, OnDestroy, OnInit, Output, ViewChild } from '@angular/core';
import { Observable } from 'rxjs';
import '@avl-controls/core/dist/avl-snackbar/avl-snackbar';
import { takeUntil } from 'rxjs/operators';
import { SnackbarMethodDescription } from './directives/show-hide-snackbar.directive';
import { Subject } from 'rxjs';
import { SnackbarStack } from './snackbar-stack';
import { ANIMATION_DURATION } from './avl-notification-container.consts';
var NOTIFICATION_TYPE = new Map([
    [0 /* Error */, 'Error'],
    [1 /* Warning */, 'Warning'],
    [2 /* Info */, 'Info'],
    [3 /* OK */, 'OK']
]);
var AvlNotificationContainerComponent = /** @class */ (function () {
    function AvlNotificationContainerComponent(cdRef) {
        var _this = this;
        this.cdRef = cdRef;
        /** Observable emits notifications. Default observable emits dummy notifications every 3s for 100s. */
        this.notification$ = new Observable(function subscribe(subscriber) {
            var i = 0;
            var intervalId = setInterval(function () {
                var warning = Math.round(Math.random());
                subscriber.next({
                    id: i++,
                    module: 'notification-container',
                    timestamp: new Date(),
                    type: warning ? 1 /* Warning */ : 2 /* Info */,
                    messageText: 'Snackbar with notification' + new Date().toTimeString(),
                    read: false,
                    link: 'https://vizbox.avl.com'
                });
            }, 3000);
            setTimeout(function () {
                clearInterval(intervalId);
            }, 100000);
        });
        this.openMenu = new EventEmitter();
        /** @hidden */
        this.stackHeight = {};
        /** @hidden */
        this.notificationList = [];
        this.destroyed$ = new Subject();
        /** @hidden */
        this.onButtonClicked = function (event) {
            if (event) {
                _this.openMenu.emit();
                _this.dismissAll();
            }
        };
        /** @hidden */
        this.onNotificationDismissed = function (event, notification) {
            var _a, _b;
            if (event) {
                var snackType = (_b = (_a = event.target) === null || _a === void 0 ? void 0 : _a.id) === null || _b === void 0 ? void 0 : _b.replace('Snackbar', '');
                _this.removeNotification(notification, snackType);
            }
        };
        /** @hidden */
        this.openFromStack = function (notification) {
            var stackName = _this.getStackName(notification.type);
            _this[stackName].methodDescription = new SnackbarMethodDescription('hide', true);
        };
        /** @hidden */
        this.dismissAll = function () {
            _this.notificationList = [];
            _this.warningStack.activeNotification$.next(undefined);
            _this.infoStack.activeNotification$.next(undefined);
        };
        this.handleNotification = function (notification) {
            _this.previousNotification = _this.notificationList[_this.notificationList.length - 1];
            _this.notificationList.push(notification);
            _this.updateStackActiveNotification(notification);
            _this.setStackAnimation(notification.type);
        };
        this.updateStackActiveNotification = function (notification) {
            var _a;
            var stackName = _this.getStack(notification === null || notification === void 0 ? void 0 : notification.type);
            _this.updateStackNotificationList(notification.type);
            _this.activeNotification = notification;
            if (_this[stackName].notificationList.length > 1) {
                _this.reopen = true;
                if (((_a = _this.previousNotification) === null || _a === void 0 ? void 0 : _a.type) === notification.type) {
                    _this[stackName].snackbarAnimation = 3 /* ToStack */;
                    // silently dismiss notification after previous notification animation
                    var timeout_1 = setTimeout(function () {
                        _this.silentlyDismissNotification(stackName);
                        _this[stackName].snackbarAnimation = null;
                        clearTimeout(timeout_1);
                    }, ANIMATION_DURATION);
                }
                else {
                    _this.silentlyDismissNotification(stackName);
                }
            }
            else {
                _this[stackName].activeNotification$.next(notification);
            }
        };
        this.updateStackNotificationList = function (notificationType) {
            var stack = _this[_this.getStack(notificationType)];
            if (stack) {
                stack.notificationList = _this.notificationList.filter(function (item) { return item.type === notificationType; });
            }
            return stack.notificationList;
        };
        this.silentlyDismissNotification = function (stackName) {
            _this[stackName].dismissedSilently = true;
            _this[stackName].methodDescription = new SnackbarMethodDescription('hide', false);
        };
        this.setStackAnimation = function (notificationType, animation) {
            var _a, _b, _c;
            var currentStack = _this.getStack(notificationType);
            var previousStack = _this.getStack(notificationType, true);
            if (((_b = (_a = _this[previousStack]) === null || _a === void 0 ? void 0 : _a.notificationList) === null || _b === void 0 ? void 0 : _b.length) > 0 &&
                ((_c = _this.previousNotification) === null || _c === void 0 ? void 0 : _c.type) !== notificationType) {
                _this[previousStack].stackAnimation = animation || 2 /* ToBottom */;
                _this[currentStack].stackAnimation =
                    animation === 1 /* ToTop */
                        ? 2 /* ToBottom */
                        : 1 /* ToTop */;
            }
        };
        this.removeNotification = function (notification, snackType) {
            var _a;
            var stackName = _this.getStack(notification === null || notification === void 0 ? void 0 : notification.type);
            if (_this[stackName].dismissedSilently) {
                //notification dismissed silently
                var stackName_1 = _this.getStack((_a = _this.activeNotification) === null || _a === void 0 ? void 0 : _a.type);
                _this[stackName_1].activeNotification$.next(_this.activeNotification);
                _this.reopen = false;
            }
            else {
                //notification dismissed
                _this.notificationList = _this.notificationList.filter(function (currentNotification) { return currentNotification.id !== notification.id; });
                _this.reopenLastNotification(notification, stackName);
            }
        };
        this.reopenLastNotification = function (notification, stackName) {
            var _a;
            var stackNotificationList = (_a = _this[stackName]) === null || _a === void 0 ? void 0 : _a.notificationList;
            if (_this.isLastNotificationDismissed(notification, _this[stackName]) &&
                (stackNotificationList === null || stackNotificationList === void 0 ? void 0 : stackNotificationList.length) > 0) {
                _this[stackName].reopen = true;
                stackNotificationList = _this.updateStackNotificationList(notification.type);
                var lastNotification = stackNotificationList[stackNotificationList.length - 1];
                if (lastNotification) {
                    _this[stackName].activeNotification$.next(lastNotification);
                }
                else {
                    _this[stackName].stackIndicator = false;
                    _this[stackName].reopen = false;
                    _this[stackName].animateStack = 2 /* ToBottom */;
                    _this.setStackAnimation(notification.type, 1 /* ToTop */);
                }
            }
        };
        this.isLastNotificationDismissed = function (notification, stack) {
            var lastNotification = stack.notificationList[stack.notificationList.length - 1];
            return (lastNotification === null || lastNotification === void 0 ? void 0 : lastNotification.id) === (notification === null || notification === void 0 ? void 0 : notification.id);
        };
        this.getStackName = function (stackType) {
            return stackType === 1 ? 'warningStack' : 'infoStack';
        };
        this.warningStack = new SnackbarStack(String(NOTIFICATION_TYPE.get(1 /* Warning */)).toLowerCase());
        this.infoStack = new SnackbarStack(String(NOTIFICATION_TYPE.get(2 /* Info */)).toLowerCase());
    }
    AvlNotificationContainerComponent.prototype.ngOnDestroy = function () {
        this.destroyed$.next();
        this.destroyed$.complete();
    };
    AvlNotificationContainerComponent.prototype.ngAfterViewChecked = function () {
        this.cdRef.detectChanges();
    };
    /** @hidden */
    AvlNotificationContainerComponent.prototype.ngOnInit = function () {
        var _this = this;
        var _a, _b;
        this.positionTop = ((_a = document.querySelector('main')) === null || _a === void 0 ? void 0 : _a.offsetTop) + 12 + 'px';
        (_b = this.notification$) === null || _b === void 0 ? void 0 : _b.pipe(takeUntil(this.destroyed$)).subscribe(function (notification) {
            _this.handleNotification(notification);
        });
    };
    AvlNotificationContainerComponent.prototype.getStack = function (notificationType, previous) {
        var stackType;
        if (notificationType === 1 /* Warning */ ||
            notificationType === 0 /* Error */) {
            stackType = previous ? 2 /* Info */ : 1 /* Warning */;
        }
        else {
            stackType = previous ? 1 /* Warning */ : 2 /* Info */;
        }
        return this.getStackName(stackType);
    };
    AvlNotificationContainerComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    __decorate([
        HostBinding('style.top'),
        __metadata("design:type", String)
    ], AvlNotificationContainerComponent.prototype, "positionTop", void 0);
    __decorate([
        ViewChild('warningStackElement'),
        __metadata("design:type", ElementRef)
    ], AvlNotificationContainerComponent.prototype, "warningStackElement", void 0);
    __decorate([
        ViewChild('infoStackElement'),
        __metadata("design:type", ElementRef)
    ], AvlNotificationContainerComponent.prototype, "infoStackElement", void 0);
    __decorate([
        ViewChild('infoStackIndicatorElement'),
        __metadata("design:type", ElementRef)
    ], AvlNotificationContainerComponent.prototype, "infoStackIndicatorElement", void 0);
    __decorate([
        ViewChild('infoStackIndicatorElement'),
        __metadata("design:type", ElementRef)
    ], AvlNotificationContainerComponent.prototype, "warningStackIndicatorElement", void 0);
    __decorate([
        Input('display-icon'),
        __metadata("design:type", Boolean)
    ], AvlNotificationContainerComponent.prototype, "displayIcon", void 0);
    __decorate([
        Input('notification$'),
        __metadata("design:type", Observable)
    ], AvlNotificationContainerComponent.prototype, "notification$", void 0);
    __decorate([
        Output(),
        __metadata("design:type", EventEmitter)
    ], AvlNotificationContainerComponent.prototype, "openMenu", void 0);
    AvlNotificationContainerComponent = __decorate([
        Component({
            selector: 'avl-notification-container',
            template: "<div class=\"snackbar\" *ngIf=\"notification$ | async as notification\">\r\n  <div\r\n    [animateStack]=\"warningStack?.stackAnimation\"\r\n    [previousStackHeight] = \"infoStack.notificationList.length>0 ? infoSnackElement.offsetHeight : 0\"\r\n    [snackbarMethodDescription] = \"warningStack.methodDescription\"\r\n    class=\"snackbar-stack\"\r\n    id=\"warningStack\"\r\n    #warningStackElement\r\n  >\r\n    <div [animateSnackbar]=\"warningStack.snackbarAnimation\" id=\"warningSnack\" #warningSnackElement>\r\n      <avl-snackbar\r\n        *ngIf=\"warningStack.activeNotification$ | async as activeWarningNotification\"\r\n        id=\"warningSnackbar\"\r\n        [message]=\"activeWarningNotification?.messageText\"\r\n        [actionButtonLabel]=\"warningStack.stackIndicatorButtonLabel\"\r\n        [link]=\"activeWarningNotification.link\"\r\n        [messageType]=\"activeWarningNotification.type\"\r\n        sliding\r\n        (buttonClicked)=\"onButtonClicked($event)\"\r\n        (notificationDismissed)=\"onNotificationDismissed($event, activeWarningNotification)\"\r\n        snackbarListener\r\n        #warningSnackbar\r\n        showHideSnackbar=\"warningSnackbar\"\r\n        [methodDescription]=\"warningStack.methodDescription\"\r\n      ></avl-snackbar>\r\n    </div>\r\n\r\n    <div class=\"stack-indicator-container\" *ngIf=\"warningStack.notificationList.length>1\" #warningStackIndicator>\r\n      <div class=\"stack-indicator\">\r\n        <div class=\"notification-container\">\r\n          <div [ngClass]=\"{'notification': true, 'has-action': warningStack.stackIndicatorButtonLabel}\">\r\n            <avl-icon icon=\"icons:warning\" id=\"warningIcon\" class=\"warning\"></avl-icon>\r\n            <p id=\"snackbarMessage\">{{ warningStack.previousNotification?.messageText }}</p>\r\n            <avl-icon-button id=\"closeButton\" icon=\"icons:close\"></avl-icon-button>\r\n          </div>\r\n          <button id=\"actionButton\" *ngIf=\"warningStack.stackIndicatorButtonLabel\" (click)=\"openFromStack(warningStack.previousNotification)\">\r\n            <div class=\"button-label\">{{ warningStack.stackIndicatorButtonLabel }}</div>\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div\r\n    class=\"snackbar-stack\"\r\n    id=\"infoStack\"\r\n    [animateStack]=\"infoStack?.stackAnimation\"\r\n    [previousStackHeight] = \"infoStack.notificationList.length>0 ? warningSnackElement.offsetHeight : 0\"\r\n    [snackbarMethodDescription] = \"infoStack.methodDescription\"\r\n    #infoStackElement\r\n  >\r\n    <div [animateSnackbar]=\"infoStack.snackbarAnimation\" id=\"infoSnack\" #infoSnackElement>\r\n      <avl-snackbar\r\n        id=\"infoSnackbar\"\r\n        *ngIf=\"infoStack.activeNotification$ | async as activeInfoNotification\"\r\n        [message]=\"activeInfoNotification.messageText\"\r\n        [actionButtonLabel]=\"infoStack.stackIndicatorButtonLabel\"\r\n        [link]=\"activeInfoNotification.link\"\r\n        [messageType]=\"activeInfoNotification.type\"\r\n        [displayIcon]=\"displayIcon\"\r\n        sliding\r\n        (buttonClicked)=\"onButtonClicked($event)\"\r\n        (notificationDismissed)=\"onNotificationDismissed($event, activeInfoNotification)\"\r\n        snackbarListener\r\n        #infoSnackbar\r\n        showHideSnackbar=\"infoSnackbar\"\r\n        [methodDescription]=\"infoStack.methodDescription\"\r\n      ></avl-snackbar>\r\n    </div>\r\n\r\n    <div class=\"stack-indicator-container\" *ngIf=\"infoStack.notificationList.length>1\" #infoStackIndicator>\r\n      <div class=\"stack-indicator\">\r\n        <div class=\"notification-container\">\r\n          <div [ngClass]=\"{'notification': true, 'has-action': infoStack.stackIndicatorButtonLabel}\">\r\n            <p id=\"snackbarMessage\">{{ infoStack.previousNotification?.messageText }}</p>\r\n            <avl-icon-button id=\"closeButton\" icon=\"icons:close\"></avl-icon-button>\r\n          </div>\r\n        </div>\r\n        <button id=\"actionButton\" *ngIf=\"infoStack.stackIndicatorButtonLabel\" (click)=\"openFromStack(infoStack.previousNotification)\">\r\n          <div class=\"button-label\">{{ infoStack.stackIndicatorButtonLabel }}</div>\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div\r\n    animateButton\r\n    [infoStackHeight]=\"infoStack?.notificationList?.length > 0 ? infoSnackElement.offsetHeight : 0\"\r\n    [warningStackHeight]=\"warningStack?.notificationList?.length > 0 ? warningSnackElement.offsetHeight : 0\"\r\n    [infoStackIndicatorHeight]=\"infoStackIndicatorElement?.nativeElement?.offsetHeight\"\r\n    [warningStackIndicatorHeight]=\"warningStackIndicatorElement?.nativeElement?.offsetHeight\"\r\n    class=\"dismiss-all\"\r\n    *ngIf=\"notificationList?.length > 1\"\r\n  >\r\n    <avl-button id=\"dismissAll\" (click)=\"dismissAll()\">{{'VizBox.NotificationContainer.DismissAll' | translate}}</avl-button>\r\n  </div>\r\n</div>\r\n\r\n\r\n",
            styles: [":host{position:fixed;right:0;width:445px;display:flex;flex-direction:column;--avl-snackbar-text-color:var(--avl-on-background-info-color)}.snackbar{width:100%;display:flex;flex-direction:column}.snackbar.displayed{flex:1;max-height:100%}.snackbar-stack{position:absolute;top:0;left:0;right:0;width:100%}.stack-indicator-container{margin:0 12px;position:absolute;width:calc(100% - 12px);top:12px;z-index:-1}.snackbar-container{margin-top:0;margin-left:0;margin-right:0;width:100%}.button-label{text-align:left;text-transform:none}.stack-indicator{background-color:var(--avl-background-message-color);top:0;left:0;width:calc(100% - 24px);border-radius:4px;position:relative;height:100%;z-index:-1;box-shadow:0 3px 5px -1px rgb(0 0 0 / 20%),0 6px 10px 0 rgb(0 0 0 / 14%),0 1px 18px 0 rgb(0 0 0 / 12%)}.notification{display:flex;flex:1 1 100%;align-items:center;flex-direction:row;padding:0 12px 0 16px;justify-content:flex-start;cursor:pointer;text-overflow:ellipsis}.notification p{flex-grow:1;-webkit-line-clamp:3;max-height:48px;text-overflow:ellipsis;line-height:19px;font-size:14px;margin:0 0 0 12px;padding:12px 0;font-family:var(--avl-font-family);color:var(--avl-on-background-info-color)}button#actionButton{font-family:var(--avl-font-family);font-weight:500;font-size:14px;color:var(--avl-on-background-message-link-color);background-color:var(--avl-button-background-default-color);max-height:48px;height:48px;width:100%;cursor:pointer;padding:12px;margin:-12px 0 0;border-radius:2px;border:0;outline:0}div#actionButton:hover{color:var(--avl-on-background-message-link-hover-color)}#warningIcon{--avl-icon-custom-color:var(--avl-on-background-message-warning-color);flex:0 0 24px;--avl-icon-custom-color:var(--avl-warning-color)}#errorIcon{--avl-icon-custom-color:var(--avl-on-background-message-error-color);flex:0 0 24px}#infoIcon{--avl-icon-custom-color:var(--avl-on-background-message-emphasis-medium-color);flex:0 0 24px}#OKIcon{--avl-icon-custom-color:var(--avl-on-background-message-ok-color);flex:0 0 24px}.dismiss-all{position:absolute;padding:0 16px;border-radius:25px;background-color:var(--avl-background-message-color);width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;top:12px}#dismissAll{--avl-flat-button-label-color:var(--avl-on-background-message-link-color)}avl-icon-button{flex:0 0 48px;margin-left:12px;cursor:pointer;--avl-icon-button-color:var(--avl-on-background-message-icon-default-color);--avl-icon-ink-hover-color:var(--avl-on-background-message-icon-hover-color);--avl-icon-ink-focus-color:var(--avl-on-background-message-icon-focus-color);--avl-icon-ink-pressed-color:var(--avl-on-background-message-icon-pressed-color)}@media only screen and (min-width:320px) and (max-width:376px){:host{width:calc(100% - 32px)}}@media only screen and (min-width:460px){:host{width:445px}}@media only screen and (min-width:376px) and (max-width:400px){:host{width:376px}}"]
        }),
        __metadata("design:paramtypes", [ChangeDetectorRef])
    ], AvlNotificationContainerComponent);
    return AvlNotificationContainerComponent;
}());
export { AvlNotificationContainerComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXZsLW5vdGlmaWNhdGlvbi1jb250YWluZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGF2bC1uZy1jb250cm9scy9ub3RpZmljYXRpb24vIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9hdmwtbm90aWZpY2F0aW9uLWNvbnRhaW5lci9hdmwtbm90aWZpY2F0aW9uLWNvbnRhaW5lci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsT0FBTyxFQUNMLGdCQUFnQixFQUNoQixpQkFBaUIsRUFDakIsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osV0FBVyxFQUNYLEtBQUssRUFDTCxTQUFTLEVBQ1QsTUFBTSxFQUNOLE1BQU0sRUFDTixTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNsQyxPQUFPLG1EQUFtRCxDQUFDO0FBRTNELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzQyxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSwyQ0FBMkMsQ0FBQztBQUN0RixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRS9CLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNqRCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUV6RSxJQUFNLGlCQUFpQixHQUFHLElBQUksR0FBRyxDQUFpQjtJQUNoRCxnQkFBNEIsT0FBTyxDQUFDO0lBQ3BDLGtCQUE4QixTQUFTLENBQUM7SUFDeEMsZUFBMkIsTUFBTSxDQUFDO0lBQ2xDLGFBQXlCLElBQUksQ0FBQztDQUMvQixDQUFDLENBQUM7QUFNSDtJQWdFRSwyQ0FBcUIsS0FBd0I7UUFBN0MsaUJBUUM7UUFSb0IsVUFBSyxHQUFMLEtBQUssQ0FBbUI7UUE3QzdDLHNHQUFzRztRQUN2RSxrQkFB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RCxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDdEMsQ0FBQzs7Z0JBakwyQixpQkFBaUI7O0lBOURuQjtRQUF6QixXQUFXLENBQUMsV0FBVyxDQUFDOzswRUFBcUI7SUFHWjtRQUFqQyxTQUFTLENBQUMscUJBQXFCLENBQUM7a0NBQXNCLFVBQVU7a0ZBQUM7SUFHbkM7UUFBOUIsU0FBUyxDQUFDLGtCQUFrQixDQUFDO2tDQUFtQixVQUFVOytFQUFDO0lBR3BCO1FBQXZDLFNBQVMsQ0FBQywyQkFBMkIsQ0FBQztrQ0FBNEIsVUFBVTt3RkFBQztJQUd0QztRQUF2QyxTQUFTLENBQUMsMkJBQTJCLENBQUM7a0NBQStCLFVBQVU7MkZBQUM7SUFHMUQ7UUFBdEIsS0FBSyxDQUFDLGNBQWMsQ0FBQzs7MEVBQTZCO0lBRzNCO1FBQXZCLEtBQUssQ0FBQyxlQUFlLENBQUM7a0NBQXVCLFVBQVU7NEVBb0J0RDtJQUVRO1FBQVQsTUFBTSxFQUFFO2tDQUFXLFlBQVk7dUVBQWtDO0lBMUN2RCxpQ0FBaUM7UUFMN0MsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLDRCQUE0QjtZQUN0QyxzNUpBQTBEOztTQUUzRCxDQUFDO3lDQWlFNEIsaUJBQWlCO09BaEVsQyxpQ0FBaUMsQ0FzUDdDO0lBQUQsd0NBQUM7Q0FBQSxBQXRQRCxJQXNQQztTQXRQWSxpQ0FBaUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIEFmdGVyVmlld0NoZWNrZWQsXHJcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXHJcbiAgQ29tcG9uZW50LFxyXG4gIEVsZW1lbnRSZWYsXHJcbiAgRXZlbnRFbWl0dGVyLFxyXG4gIEhvc3RCaW5kaW5nLFxyXG4gIElucHV0LFxyXG4gIE9uRGVzdHJveSxcclxuICBPbkluaXQsXHJcbiAgT3V0cHV0LFxyXG4gIFZpZXdDaGlsZFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCAnQGF2bC1jb250cm9scy9jb3JlL2Rpc3QvYXZsLXNuYWNrYmFyL2F2bC1zbmFja2Jhcic7XHJcbmltcG9ydCB7IEF2bE5vdGlmaWNhdGlvbiwgQXZsTm90aWZpY2F0aW9uVHlwZSB9IGZyb20gJ0BhdmwtY29udHJvbHMvaW50ZXJmYWNlcyc7XHJcbmltcG9ydCB7IHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgU25hY2tiYXJNZXRob2REZXNjcmlwdGlvbiB9IGZyb20gJy4vZGlyZWN0aXZlcy9zaG93LWhpZGUtc25hY2tiYXIuZGlyZWN0aXZlJztcclxuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBQb3NpdGlvbkFuaW1hdGlvbiB9IGZyb20gJy4vZGlyZWN0aXZlcy9hbmltYXRlLXN0YWNrLmRpcmVjdGl2ZSc7XHJcbmltcG9ydCB7IFNuYWNrYmFyU3RhY2sgfSBmcm9tICcuL3NuYWNrYmFyLXN0YWNrJztcclxuaW1wb3J0IHsgQU5JTUFUSU9OX0RVUkFUSU9OIH0gZnJvbSAnLi9hdmwtbm90aWZpY2F0aW9uLWNvbnRhaW5lci5jb25zdHMnO1xyXG5cclxuY29uc3QgTk9USUZJQ0FUSU9OX1RZUEUgPSBuZXcgTWFwPG51bWJlciwgc3RyaW5nPihbXHJcbiAgW0F2bE5vdGlmaWNhdGlvblR5cGUuRXJyb3IsICdFcnJvciddLFxyXG4gIFtBdmxOb3RpZmljYXRpb25UeXBlLldhcm5pbmcsICdXYXJuaW5nJ10sXHJcbiAgW0F2bE5vdGlmaWNhdGlvblR5cGUuSW5mbywgJ0luZm8nXSxcclxuICBbQXZsTm90aWZpY2F0aW9uVHlwZS5PSywgJ09LJ11cclxuXSk7XHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnYXZsLW5vdGlmaWNhdGlvbi1jb250YWluZXInLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9hdmwtbm90aWZpY2F0aW9uLWNvbnRhaW5lci5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vYXZsLW5vdGlmaWNhdGlvbi1jb250YWluZXIuY29tcG9uZW50LmNzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBBdmxOb3RpZmljYXRpb25Db250YWluZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgQWZ0ZXJWaWV3Q2hlY2tlZCB7XHJcbiAgLyoqIEBoaWRkZW4gKi9cclxuICBASG9zdEJpbmRpbmcoJ3N0eWxlLnRvcCcpIHBvc2l0aW9uVG9wOiBzdHJpbmc7XHJcblxyXG4gIC8qKiBAaGlkZGVuICovXHJcbiAgQFZpZXdDaGlsZCgnd2FybmluZ1N0YWNrRWxlbWVudCcpIHdhcm5pbmdTdGFja0VsZW1lbnQ6IEVsZW1lbnRSZWY7XHJcblxyXG4gIC8qKiBAaGlkZGVuICovXHJcbiAgQFZpZXdDaGlsZCgnaW5mb1N0YWNrRWxlbWVudCcpIGluZm9TdGFja0VsZW1lbnQ6IEVsZW1lbnRSZWY7XHJcbiBcclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIEBWaWV3Q2hpbGQoJ2luZm9TdGFja0luZGljYXRvckVsZW1lbnQnKSBpbmZvU3RhY2tJbmRpY2F0b3JFbGVtZW50OiBFbGVtZW50UmVmO1xyXG4gIFxyXG4gIC8qKiBAaGlkZGVuICovXHJcbiAgQFZpZXdDaGlsZCgnaW5mb1N0YWNrSW5kaWNhdG9yRWxlbWVudCcpIHdhcm5pbmdTdGFja0luZGljYXRvckVsZW1lbnQ6IEVsZW1lbnRSZWY7XHJcblxyXG4gIC8qKiBJZiBzZXQgb3B0aW9uYWwgaWNvbiAoZm9yIGluZm8gYW5kIE9LIG5vdGlmaWNhdGlvbnMpIGlzIGRpc3BsYXllZCwgaGlkZGVuIG90aGVyd2lzZS4gKi9cclxuICBASW5wdXQoJ2Rpc3BsYXktaWNvbicpIHB1YmxpYyBkaXNwbGF5SWNvbjogYm9vbGVhbjtcclxuXHJcbiAgLyoqIE9ic2VydmFibGUgZW1pdHMgbm90aWZpY2F0aW9ucy4gRGVmYXVsdCBvYnNlcnZhYmxlIGVtaXRzIGR1bW15IG5vdGlmaWNhdGlvbnMgZXZlcnkgM3MgZm9yIDEwMHMuICovXHJcbiAgQElucHV0KCdub3RpZmljYXRpb24kJykgcHVibGljIG5vdGlmaWNhdGlvbiQ6IE9ic2VydmFibGU8QXZsTm90aWZpY2F0aW9uPiA9IG5ldyBPYnNlcnZhYmxlKFxyXG4gICAgZnVuY3Rpb24gc3Vic2NyaWJlKHN1YnNjcmliZXIpIHtcclxuICAgICAgbGV0IGkgPSAwO1xyXG4gICAgICBjb25zdCBpbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHdhcm5pbmcgPSBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkpO1xyXG4gICAgICAgIHN1YnNjcmliZXIubmV4dCh7XHJcbiAgICAgICAgICBpZDogaSsrLFxyXG4gICAgICAgICAgbW9kdWxlOiAnbm90aWZpY2F0aW9uLWNvbnRhaW5lcicsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgICB0eXBlOiB3YXJuaW5nID8gQXZsTm90aWZpY2F0aW9uVHlwZS5XYXJuaW5nIDogQXZsTm90aWZpY2F0aW9uVHlwZS5JbmZvLFxyXG4gICAgICAgICAgbWVzc2FnZVRleHQ6ICdTbmFja2JhciB3aXRoIG5vdGlmaWNhdGlvbicgKyBuZXcgRGF0ZSgpLnRvVGltZVN0cmluZygpLFxyXG4gICAgICAgICAgcmVhZDogZmFsc2UsXHJcbiAgICAgICAgICBsaW5rOiAnaHR0cHM6Ly92aXpib3guYXZsLmNvbSdcclxuICAgICAgICB9KTtcclxuICAgICAgfSwgMzAwMCk7XHJcblxyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsSWQpO1xyXG4gICAgICB9LCAxMDAwMDApO1xyXG4gICAgfVxyXG4gICk7XHJcblxyXG4gIEBPdXRwdXQoKSBvcGVuTWVudTogRXZlbnRFbWl0dGVyPHZvaWQ+ID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xyXG5cclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIHB1YmxpYyB3YXJuaW5nU3RhY2s6IFNuYWNrYmFyU3RhY2s7XHJcbiAgLyoqIEBoaWRkZW4gKi9cclxuICBwdWJsaWMgaW5mb1N0YWNrOiBTbmFja2JhclN0YWNrO1xyXG5cclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIHB1YmxpYyBwcmV2aW91c05vdGlmaWNhdGlvbjogQXZsTm90aWZpY2F0aW9uO1xyXG5cclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIHB1YmxpYyBzdGFja0hlaWdodDogeyBba2V5OiBzdHJpbmddOiBudW1iZXIgfSA9IHt9O1xyXG5cclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIHB1YmxpYyByZW9wZW46IGJvb2xlYW47XHJcblxyXG4gIC8qKiBAaGlkZGVuICovXHJcbiAgcHVibGljIG5vdGlmaWNhdGlvbkxpc3Q6IEF2bE5vdGlmaWNhdGlvbltdID0gW107XHJcblxyXG4gIHByaXZhdGUgYWN0aXZlTm90aWZpY2F0aW9uOiBBdmxOb3RpZmljYXRpb247XHJcbiAgcHJpdmF0ZSBkZXN0cm95ZWQkOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3QoKTtcclxuXHJcbiAgY29uc3RydWN0b3IocmVhZG9ubHkgY2RSZWY6IENoYW5nZURldGVjdG9yUmVmKSB7XHJcbiAgICB0aGlzLndhcm5pbmdTdGFjayA9IG5ldyBTbmFja2JhclN0YWNrKFxyXG4gICAgICBTdHJpbmcoTk9USUZJQ0FUSU9OX1RZUEUuZ2V0KEF2bE5vdGlmaWNhdGlvblR5cGUuV2FybmluZykpLnRvTG93ZXJDYXNlKClcclxuICAgICk7XHJcblxyXG4gICAgdGhpcy5pbmZvU3RhY2sgPSBuZXcgU25hY2tiYXJTdGFjayhcclxuICAgICAgU3RyaW5nKE5PVElGSUNBVElPTl9UWVBFLmdldChBdmxOb3RpZmljYXRpb25UeXBlLkluZm8pKS50b0xvd2VyQ2FzZSgpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICB0aGlzLmRlc3Ryb3llZCQubmV4dCgpO1xyXG4gICAgdGhpcy5kZXN0cm95ZWQkLmNvbXBsZXRlKCk7XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0NoZWNrZWQoKTogdm9pZCB7XHJcbiAgICB0aGlzLmNkUmVmLmRldGVjdENoYW5nZXMoKTtcclxuICB9XHJcblxyXG4gIC8qKiBAaGlkZGVuICovXHJcbiAgcHVibGljIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5wb3NpdGlvblRvcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ21haW4nKT8ub2Zmc2V0VG9wICsgMTIgKyAncHgnO1xyXG4gICAgdGhpcy5ub3RpZmljYXRpb24kPy5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3llZCQpKS5zdWJzY3JpYmUobm90aWZpY2F0aW9uID0+IHtcclxuICAgICAgdGhpcy5oYW5kbGVOb3RpZmljYXRpb24obm90aWZpY2F0aW9uKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqIEBoaWRkZW4gKi9cclxuICBwdWJsaWMgb25CdXR0b25DbGlja2VkID0gKGV2ZW50OiBhbnkpOiB2b2lkID0+IHtcclxuICAgIGlmIChldmVudCkge1xyXG4gICAgICB0aGlzLm9wZW5NZW51LmVtaXQoKTtcclxuICAgICAgdGhpcy5kaXNtaXNzQWxsKCk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgLyoqIEBoaWRkZW4gKi9cclxuICBwdWJsaWMgb25Ob3RpZmljYXRpb25EaXNtaXNzZWQgPSAoZXZlbnQ6IGFueSwgbm90aWZpY2F0aW9uOiBBdmxOb3RpZmljYXRpb24pOiB2b2lkID0+IHtcclxuICAgIGlmIChldmVudCkge1xyXG4gICAgICBjb25zdCBzbmFja1R5cGUgPSAoZXZlbnQudGFyZ2V0IGFzIEhUTUxFbGVtZW50KT8uaWQ/LnJlcGxhY2UoJ1NuYWNrYmFyJywgJycpO1xyXG4gICAgICB0aGlzLnJlbW92ZU5vdGlmaWNhdGlvbihub3RpZmljYXRpb24sIHNuYWNrVHlwZSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgLyoqIEBoaWRkZW4gKi9cclxuICBwdWJsaWMgb3BlbkZyb21TdGFjayA9IChub3RpZmljYXRpb246IEF2bE5vdGlmaWNhdGlvbik6IHZvaWQgPT4ge1xyXG4gICAgY29uc3Qgc3RhY2tOYW1lID0gdGhpcy5nZXRTdGFja05hbWUobm90aWZpY2F0aW9uLnR5cGUpO1xyXG4gICAgdGhpc1tzdGFja05hbWVdLm1ldGhvZERlc2NyaXB0aW9uID0gbmV3IFNuYWNrYmFyTWV0aG9kRGVzY3JpcHRpb24oJ2hpZGUnLCB0cnVlKTtcclxuICB9O1xyXG5cclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIHB1YmxpYyBkaXNtaXNzQWxsID0gKCk6IHZvaWQgPT4ge1xyXG4gICAgdGhpcy5ub3RpZmljYXRpb25MaXN0ID0gW107XHJcbiAgICB0aGlzLndhcm5pbmdTdGFjay5hY3RpdmVOb3RpZmljYXRpb24kLm5leHQodW5kZWZpbmVkKTtcclxuICAgIHRoaXMuaW5mb1N0YWNrLmFjdGl2ZU5vdGlmaWNhdGlvbiQubmV4dCh1bmRlZmluZWQpO1xyXG4gIH07XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlTm90aWZpY2F0aW9uID0gKG5vdGlmaWNhdGlvbjogYW55KTogdm9pZCA9PiB7XHJcbiAgICB0aGlzLnByZXZpb3VzTm90aWZpY2F0aW9uID0gdGhpcy5ub3RpZmljYXRpb25MaXN0W3RoaXMubm90aWZpY2F0aW9uTGlzdC5sZW5ndGggLSAxXTtcclxuICAgIHRoaXMubm90aWZpY2F0aW9uTGlzdC5wdXNoKG5vdGlmaWNhdGlvbik7XHJcbiAgICB0aGlzLnVwZGF0ZVN0YWNrQWN0aXZlTm90aWZpY2F0aW9uKG5vdGlmaWNhdGlvbik7XHJcbiAgICB0aGlzLnNldFN0YWNrQW5pbWF0aW9uKG5vdGlmaWNhdGlvbi50eXBlKTtcclxuICB9O1xyXG5cclxuICBwcml2YXRlIHVwZGF0ZVN0YWNrQWN0aXZlTm90aWZpY2F0aW9uID0gKG5vdGlmaWNhdGlvbjogQXZsTm90aWZpY2F0aW9uKTogdm9pZCA9PiB7XHJcbiAgICBjb25zdCBzdGFja05hbWU6IHN0cmluZyA9IHRoaXMuZ2V0U3RhY2sobm90aWZpY2F0aW9uPy50eXBlKTtcclxuICAgIHRoaXMudXBkYXRlU3RhY2tOb3RpZmljYXRpb25MaXN0KG5vdGlmaWNhdGlvbi50eXBlKTtcclxuICAgIHRoaXMuYWN0aXZlTm90aWZpY2F0aW9uID0gbm90aWZpY2F0aW9uO1xyXG5cclxuICAgIGlmICh0aGlzW3N0YWNrTmFtZV0ubm90aWZpY2F0aW9uTGlzdC5sZW5ndGggPiAxKSB7XHJcbiAgICAgIHRoaXMucmVvcGVuID0gdHJ1ZTtcclxuICAgICAgaWYgKHRoaXMucHJldmlvdXNOb3RpZmljYXRpb24/LnR5cGUgPT09IG5vdGlmaWNhdGlvbi50eXBlKSB7XHJcbiAgICAgICAgdGhpc1tzdGFja05hbWVdLnNuYWNrYmFyQW5pbWF0aW9uID0gUG9zaXRpb25BbmltYXRpb24uVG9TdGFjaztcclxuXHJcbiAgICAgICAgLy8gc2lsZW50bHkgZGlzbWlzcyBub3RpZmljYXRpb24gYWZ0ZXIgcHJldmlvdXMgbm90aWZpY2F0aW9uIGFuaW1hdGlvblxyXG4gICAgICAgIGNvbnN0IHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgIHRoaXMuc2lsZW50bHlEaXNtaXNzTm90aWZpY2F0aW9uKHN0YWNrTmFtZSk7XHJcbiAgICAgICAgICB0aGlzW3N0YWNrTmFtZV0uc25hY2tiYXJBbmltYXRpb24gPSBudWxsO1xyXG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xyXG4gICAgICAgIH0sIEFOSU1BVElPTl9EVVJBVElPTik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5zaWxlbnRseURpc21pc3NOb3RpZmljYXRpb24oc3RhY2tOYW1lKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpc1tzdGFja05hbWVdLmFjdGl2ZU5vdGlmaWNhdGlvbiQubmV4dChub3RpZmljYXRpb24pO1xyXG4gICAgfVxyXG4gIH07XHJcbiAgcHJpdmF0ZSB1cGRhdGVTdGFja05vdGlmaWNhdGlvbkxpc3QgPSAoXHJcbiAgICBub3RpZmljYXRpb25UeXBlOiBBdmxOb3RpZmljYXRpb25UeXBlXHJcbiAgKTogQXZsTm90aWZpY2F0aW9uW10gPT4ge1xyXG4gICAgY29uc3Qgc3RhY2sgPSB0aGlzW3RoaXMuZ2V0U3RhY2sobm90aWZpY2F0aW9uVHlwZSldO1xyXG4gICAgaWYgKHN0YWNrKSB7XHJcbiAgICAgIHN0YWNrLm5vdGlmaWNhdGlvbkxpc3QgPSB0aGlzLm5vdGlmaWNhdGlvbkxpc3QuZmlsdGVyKGl0ZW0gPT4gaXRlbS50eXBlID09PSBub3RpZmljYXRpb25UeXBlKTtcclxuICAgIH1cclxuICAgIHJldHVybiBzdGFjay5ub3RpZmljYXRpb25MaXN0O1xyXG4gIH07XHJcblxyXG4gIHByaXZhdGUgc2lsZW50bHlEaXNtaXNzTm90aWZpY2F0aW9uID0gKHN0YWNrTmFtZTogc3RyaW5nKTogdm9pZCA9PiB7XHJcbiAgICB0aGlzW3N0YWNrTmFtZV0uZGlzbWlzc2VkU2lsZW50bHkgPSB0cnVlO1xyXG4gICAgdGhpc1tzdGFja05hbWVdLm1ldGhvZERlc2NyaXB0aW9uID0gbmV3IFNuYWNrYmFyTWV0aG9kRGVzY3JpcHRpb24oJ2hpZGUnLCBmYWxzZSk7XHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSBzZXRTdGFja0FuaW1hdGlvbiA9IChcclxuICAgIG5vdGlmaWNhdGlvblR5cGU6IEF2bE5vdGlmaWNhdGlvblR5cGUsXHJcbiAgICBhbmltYXRpb24/OiBQb3NpdGlvbkFuaW1hdGlvblxyXG4gICk6IHZvaWQgPT4ge1xyXG4gICAgY29uc3QgY3VycmVudFN0YWNrID0gdGhpcy5nZXRTdGFjayhub3RpZmljYXRpb25UeXBlKTtcclxuICAgIGNvbnN0IHByZXZpb3VzU3RhY2sgPSB0aGlzLmdldFN0YWNrKG5vdGlmaWNhdGlvblR5cGUsIHRydWUpO1xyXG5cclxuICAgIGlmIChcclxuICAgICAgdGhpc1twcmV2aW91c1N0YWNrXT8ubm90aWZpY2F0aW9uTGlzdD8ubGVuZ3RoID4gMCAmJlxyXG4gICAgICB0aGlzLnByZXZpb3VzTm90aWZpY2F0aW9uPy50eXBlICE9PSBub3RpZmljYXRpb25UeXBlXHJcbiAgICApIHtcclxuICAgICAgdGhpc1twcmV2aW91c1N0YWNrXS5zdGFja0FuaW1hdGlvbiA9IGFuaW1hdGlvbiB8fCBQb3NpdGlvbkFuaW1hdGlvbi5Ub0JvdHRvbTtcclxuXHJcbiAgICAgIHRoaXNbY3VycmVudFN0YWNrXS5zdGFja0FuaW1hdGlvbiA9XHJcbiAgICAgICAgYW5pbWF0aW9uID09PSBQb3NpdGlvbkFuaW1hdGlvbi5Ub1RvcFxyXG4gICAgICAgICAgPyBQb3NpdGlvbkFuaW1hdGlvbi5Ub0JvdHRvbVxyXG4gICAgICAgICAgOiBQb3NpdGlvbkFuaW1hdGlvbi5Ub1RvcDtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBwcml2YXRlIHJlbW92ZU5vdGlmaWNhdGlvbiA9IChub3RpZmljYXRpb246IEF2bE5vdGlmaWNhdGlvbiwgc25hY2tUeXBlPzogc3RyaW5nKTogdm9pZCA9PiB7XHJcbiAgICBjb25zdCBzdGFja05hbWU6IHN0cmluZyA9IHRoaXMuZ2V0U3RhY2sobm90aWZpY2F0aW9uPy50eXBlKTtcclxuICAgIGlmICh0aGlzW3N0YWNrTmFtZV0uZGlzbWlzc2VkU2lsZW50bHkpIHtcclxuICAgICAgLy9ub3RpZmljYXRpb24gZGlzbWlzc2VkIHNpbGVudGx5XHJcbiAgICAgIGNvbnN0IHN0YWNrTmFtZTogc3RyaW5nID0gdGhpcy5nZXRTdGFjayh0aGlzLmFjdGl2ZU5vdGlmaWNhdGlvbj8udHlwZSk7XHJcbiAgICAgIHRoaXNbc3RhY2tOYW1lXS5hY3RpdmVOb3RpZmljYXRpb24kLm5leHQodGhpcy5hY3RpdmVOb3RpZmljYXRpb24pO1xyXG4gICAgICB0aGlzLnJlb3BlbiA9IGZhbHNlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy9ub3RpZmljYXRpb24gZGlzbWlzc2VkXHJcbiAgICAgIHRoaXMubm90aWZpY2F0aW9uTGlzdCA9IHRoaXMubm90aWZpY2F0aW9uTGlzdC5maWx0ZXIoXHJcbiAgICAgICAgY3VycmVudE5vdGlmaWNhdGlvbiA9PiBjdXJyZW50Tm90aWZpY2F0aW9uLmlkICE9PSBub3RpZmljYXRpb24uaWRcclxuICAgICAgKTtcclxuICAgICAgdGhpcy5yZW9wZW5MYXN0Tm90aWZpY2F0aW9uKG5vdGlmaWNhdGlvbiwgc3RhY2tOYW1lKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBwcml2YXRlIHJlb3Blbkxhc3ROb3RpZmljYXRpb24gPSAobm90aWZpY2F0aW9uOiBBdmxOb3RpZmljYXRpb24sIHN0YWNrTmFtZTogc3RyaW5nKTogdm9pZCA9PiB7XHJcbiAgICBsZXQgc3RhY2tOb3RpZmljYXRpb25MaXN0OiBBdmxOb3RpZmljYXRpb25bXSA9IHRoaXNbc3RhY2tOYW1lXT8ubm90aWZpY2F0aW9uTGlzdDtcclxuICAgIGlmIChcclxuICAgICAgdGhpcy5pc0xhc3ROb3RpZmljYXRpb25EaXNtaXNzZWQobm90aWZpY2F0aW9uLCB0aGlzW3N0YWNrTmFtZV0pICYmXHJcbiAgICAgIHN0YWNrTm90aWZpY2F0aW9uTGlzdD8ubGVuZ3RoID4gMFxyXG4gICAgKSB7XHJcbiAgICAgIHRoaXNbc3RhY2tOYW1lXS5yZW9wZW4gPSB0cnVlO1xyXG5cclxuICAgICAgc3RhY2tOb3RpZmljYXRpb25MaXN0ID0gdGhpcy51cGRhdGVTdGFja05vdGlmaWNhdGlvbkxpc3Qobm90aWZpY2F0aW9uLnR5cGUpO1xyXG4gICAgICBjb25zdCBsYXN0Tm90aWZpY2F0aW9uID0gc3RhY2tOb3RpZmljYXRpb25MaXN0W3N0YWNrTm90aWZpY2F0aW9uTGlzdC5sZW5ndGggLSAxXTtcclxuICAgICAgaWYgKGxhc3ROb3RpZmljYXRpb24pIHtcclxuICAgICAgICB0aGlzW3N0YWNrTmFtZV0uYWN0aXZlTm90aWZpY2F0aW9uJC5uZXh0KGxhc3ROb3RpZmljYXRpb24pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXNbc3RhY2tOYW1lXS5zdGFja0luZGljYXRvciA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXNbc3RhY2tOYW1lXS5yZW9wZW4gPSBmYWxzZTtcclxuICAgICAgICB0aGlzW3N0YWNrTmFtZV0uYW5pbWF0ZVN0YWNrID0gUG9zaXRpb25BbmltYXRpb24uVG9Cb3R0b207XHJcbiAgICAgICAgdGhpcy5zZXRTdGFja0FuaW1hdGlvbihub3RpZmljYXRpb24udHlwZSwgUG9zaXRpb25BbmltYXRpb24uVG9Ub3ApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSBpc0xhc3ROb3RpZmljYXRpb25EaXNtaXNzZWQgPSAoXHJcbiAgICBub3RpZmljYXRpb246IEF2bE5vdGlmaWNhdGlvbixcclxuICAgIHN0YWNrOiBTbmFja2JhclN0YWNrXHJcbiAgKTogYm9vbGVhbiA9PiB7XHJcbiAgICBjb25zdCBsYXN0Tm90aWZpY2F0aW9uOiBBdmxOb3RpZmljYXRpb24gPVxyXG4gICAgICBzdGFjay5ub3RpZmljYXRpb25MaXN0W3N0YWNrLm5vdGlmaWNhdGlvbkxpc3QubGVuZ3RoIC0gMV07XHJcbiAgICByZXR1cm4gbGFzdE5vdGlmaWNhdGlvbj8uaWQgPT09IG5vdGlmaWNhdGlvbj8uaWQ7XHJcbiAgfTtcclxuICBwcml2YXRlIGdldFN0YWNrKG5vdGlmaWNhdGlvblR5cGU6IG51bWJlciwgcHJldmlvdXM/OiBib29sZWFuKTogc3RyaW5nIHtcclxuICAgIGxldCBzdGFja1R5cGU6IEF2bE5vdGlmaWNhdGlvblR5cGU7XHJcbiAgICBpZiAoXHJcbiAgICAgIG5vdGlmaWNhdGlvblR5cGUgPT09IEF2bE5vdGlmaWNhdGlvblR5cGUuV2FybmluZyB8fFxyXG4gICAgICBub3RpZmljYXRpb25UeXBlID09PSBBdmxOb3RpZmljYXRpb25UeXBlLkVycm9yXHJcbiAgICApIHtcclxuICAgICAgc3RhY2tUeXBlID0gcHJldmlvdXMgPyBBdmxOb3RpZmljYXRpb25UeXBlLkluZm8gOiBBdmxOb3RpZmljYXRpb25UeXBlLldhcm5pbmc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzdGFja1R5cGUgPSBwcmV2aW91cyA/IEF2bE5vdGlmaWNhdGlvblR5cGUuV2FybmluZyA6IEF2bE5vdGlmaWNhdGlvblR5cGUuSW5mbztcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmdldFN0YWNrTmFtZShzdGFja1R5cGUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRTdGFja05hbWUgPSAoc3RhY2tUeXBlOiBBdmxOb3RpZmljYXRpb25UeXBlKTogc3RyaW5nID0+IHtcclxuICAgIHJldHVybiBzdGFja1R5cGUgPT09IDEgPyAnd2FybmluZ1N0YWNrJyA6ICdpbmZvU3RhY2snO1xyXG4gIH07XHJcbn1cclxuIl19