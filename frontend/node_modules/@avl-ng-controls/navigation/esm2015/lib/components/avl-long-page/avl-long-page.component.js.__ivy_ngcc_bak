var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
import { Component, ViewEncapsulation, ContentChildren, QueryList, AfterViewInit, OnDestroy, Renderer2, Inject, PLATFORM_ID } from '@angular/core';
import { AvlParagraphDirective } from './avl-paragraph.directive';
import { Router, NavigationEnd } from '@angular/router';
import { isPlatformBrowser } from '@angular/common';
/**
* avl-long-page should only be used inside avl-app-layout. The only scrollable container should
* be avl-app-layout (already set by default) and avl-long-page and components that are using it must
* not scroll in order for avl-long-page to work properly.
*/
let AvlLongPageComponent = class AvlLongPageComponent {
    /**
    * @hidden
    */
    constructor(router, renderer, platformId) {
        this.router = router;
        this.renderer = renderer;
        this.platformId = platformId;
        this.scrollListener = (event) => {
            let newParagraph;
            if (this.scrollContainer.scrollHeight < Math.round(this.scrollContainer.scrollTop + this.scrollContainer.getBoundingClientRect().height)) {
                newParagraph = this.paragraphs.last;
            }
            else {
                this.paragraphs.forEach(paragraph => {
                    const p = paragraph.elementRef.nativeElement;
                    const rect = p.getBoundingClientRect();
                    if (rect.top < window.innerHeight * 0.1) {
                        newParagraph = paragraph;
                    }
                });
            }
            if (newParagraph) {
                this.currentFragment = newParagraph.paragraphName;
                this.router.navigate([], { queryParamsHandling: 'preserve', fragment: newParagraph.paragraphName });
            }
        };
    }
    handleRouteChange() {
        const paragraphName = this.router.parseUrl(this.router.url).fragment;
        const paragraph = this.paragraphs.find(p => p.paragraphName === paragraphName);
        if (this.currentFragment === paragraphName) {
            return;
        }
        if (paragraph) {
            setTimeout(() => paragraph.elementRef.nativeElement.scrollIntoView({ behavior: 'instant', block: 'start', inline: 'nearest' }), 0);
        }
    }
    /**
    * @hidden
    */
    ngAfterViewInit() {
        if (isPlatformBrowser(this.platformId)) {
            this.scrollContainer = document.querySelector('avl-app-layout main');
            this.scrollSubscription = this.renderer.listen(this.scrollContainer, 'scroll', this.scrollListener);
        }
        this.handleRouteChange();
        this.routerSubscription = this.router.events.subscribe(newRoute => {
            if (newRoute instanceof NavigationEnd) {
                this.handleRouteChange();
            }
        });
        this.paragraphsSubscription = this.paragraphs.changes.subscribe(_ => {
            /* if scrollIntoView has not occured yet try it with new paragraphs
               this is needed for components which render content (paragraphs)
               after view has been initialized
            */
            if (!this.currentFragment) {
                this.handleRouteChange();
            }
        });
    }
    /**
    * @hidden
    */
    ngOnDestroy() {
        if (this.routerSubscription) {
            this.routerSubscription.unsubscribe();
        }
        if (this.paragraphsSubscription) {
            this.paragraphsSubscription.unsubscribe();
        }
        if (this.scrollSubscription) {
            this.scrollSubscription();
        }
    }
};
AvlLongPageComponent.ctorParameters = () => [
    { type: Router },
    { type: Renderer2 },
    { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
];
__decorate([
    ContentChildren(AvlParagraphDirective),
    __metadata("design:type", QueryList)
], AvlLongPageComponent.prototype, "paragraphs", void 0);
AvlLongPageComponent = __decorate([
    Component({
        selector: 'avl-long-page',
        template: "<ng-content></ng-content>",
        encapsulation: ViewEncapsulation.None,
        styles: [":host{font-family:var(--avl-font-family)}"]
    }),
    __param(2, Inject(PLATFORM_ID)),
    __metadata("design:paramtypes", [Router, Renderer2, Object])
], AvlLongPageComponent);
export { AvlLongPageComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXZsLWxvbmctcGFnZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYXZsLW5nLWNvbnRyb2xzL25hdmlnYXRpb24vIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9hdmwtbG9uZy1wYWdlL2F2bC1sb25nLXBhZ2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsaUJBQWlCLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBRSxhQUFhLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25KLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFeEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFcEQ7Ozs7RUFJRTtBQVNGLElBQWEsb0JBQW9CLEdBQWpDLE1BQWEsb0JBQW9CO0lBbUIvQjs7TUFFRTtJQUNGLFlBQW9CLE1BQWMsRUFBVSxRQUFtQixFQUErQixVQUFrQjtRQUE1RixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUErQixlQUFVLEdBQVYsVUFBVSxDQUFRO1FBZ0J4RyxtQkFBYyxHQUFHLENBQUMsS0FBYyxFQUFFLEVBQUU7WUFDMUMsSUFBSSxZQUFtQyxDQUFDO1lBQ3hDLElBQUksSUFBSSxDQUFDLGVBQWUsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLHFCQUFxQixFQUFFLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQ3hJLFlBQVksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQzthQUNy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QzNDO1FBQ0QsSUFBSSxJQUFJLENBQUMsa0JBQWtCLEVBQUU7WUFDM0IsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7U0FDM0I7SUFDSCxDQUFDO0NBQ0YsQ0FBQTs7WUExRTZCLE1BQU07WUFBb0IsU0FBUztZQUEyQyxNQUFNLHVCQUE5QyxNQUFNLFNBQUMsV0FBVzs7QUFWNUM7SUFBdkMsZUFBZSxDQUFDLHFCQUFxQixDQUFDOzhCQUFxQixTQUFTO3dEQUF3QjtBQVpsRixvQkFBb0I7SUFSaEMsU0FBUyxDQUFDO1FBQ1QsUUFBUSxFQUFFLGVBQWU7UUFDekIscUNBQTZDO1FBSTdDLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJOztLQUN0QyxDQUFDO0lBdUJrRSxXQUFBLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQTtxQ0FBekQsTUFBTSxFQUFvQixTQUFTLEVBQTJDLE1BQU07R0F0QnJHLG9CQUFvQixDQWdHaEM7U0FoR1ksb0JBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBWaWV3RW5jYXBzdWxhdGlvbiwgQ29udGVudENoaWxkcmVuLCBRdWVyeUxpc3QsIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSwgUmVuZGVyZXIyLCBJbmplY3QsIFBMQVRGT1JNX0lEIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEF2bFBhcmFncmFwaERpcmVjdGl2ZSB9IGZyb20gJy4vYXZsLXBhcmFncmFwaC5kaXJlY3RpdmUnO1xyXG5pbXBvcnQgeyBSb3V0ZXIsIE5hdmlnYXRpb25FbmQgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xyXG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgaXNQbGF0Zm9ybUJyb3dzZXIgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xyXG5cclxuLyoqXHJcbiogYXZsLWxvbmctcGFnZSBzaG91bGQgb25seSBiZSB1c2VkIGluc2lkZSBhdmwtYXBwLWxheW91dC4gVGhlIG9ubHkgc2Nyb2xsYWJsZSBjb250YWluZXIgc2hvdWxkXHJcbiogYmUgYXZsLWFwcC1sYXlvdXQgKGFscmVhZHkgc2V0IGJ5IGRlZmF1bHQpIGFuZCBhdmwtbG9uZy1wYWdlIGFuZCBjb21wb25lbnRzIHRoYXQgYXJlIHVzaW5nIGl0IG11c3RcclxuKiBub3Qgc2Nyb2xsIGluIG9yZGVyIGZvciBhdmwtbG9uZy1wYWdlIHRvIHdvcmsgcHJvcGVybHkuXHJcbiovXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnYXZsLWxvbmctcGFnZScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2F2bC1sb25nLXBhZ2UuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogW1xyXG4gICAgJy4vYXZsLWxvbmctcGFnZS5jb21wb25lbnQuY3NzJ1xyXG4gIF0sXHJcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQXZsTG9uZ1BhZ2VDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xyXG4gIC8qKlxyXG4gKlxyXG4gKiAjIyMgU3R5bGluZ1xyXG4gKiBUaGUgZm9sbG93aW5nIGN1c3RvbSBwcm9wZXJ0aWVzIGFyZSBhdmFpbGFibGUgZm9yIHN0eWxpbmc6XHJcbiAqXHJcbiAqIEN1c3RvbSBwcm9wZXJ0eSAgICAgICAgICAgICAgICAgICAgICAgICAgfCBEZXNjcmlwdGlvbiAgICAgICAgICAgICAgICAgICAgICAgICB8IERlZmF1bHRcclxuICogOi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS18Oi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLXw6LS0tLS0tLS0tLS1cclxuICpcclxuICovXHJcbiAgX3N0eWxpbmc6IGFueTtcclxuXHJcbiAgQENvbnRlbnRDaGlsZHJlbihBdmxQYXJhZ3JhcGhEaXJlY3RpdmUpIHByaXZhdGUgcGFyYWdyYXBoczogUXVlcnlMaXN0PEF2bFBhcmFncmFwaERpcmVjdGl2ZT47XHJcbiAgcHJpdmF0ZSBjdXJyZW50RnJhZ21lbnQ6IHN0cmluZztcclxuICBwcml2YXRlIHNjcm9sbENvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XHJcbiAgcHJpdmF0ZSByb3V0ZXJTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuICBwcml2YXRlIHBhcmFncmFwaHNTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuICBwcml2YXRlIHNjcm9sbFN1YnNjcmlwdGlvbjogKCkgPT4gdm9pZDtcclxuXHJcbiAgLyoqXHJcbiAgKiBAaGlkZGVuXHJcbiAgKi9cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJvdXRlcjogUm91dGVyLCBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsIEBJbmplY3QoUExBVEZPUk1fSUQpIHByaXZhdGUgcGxhdGZvcm1JZDogT2JqZWN0KSB7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhbmRsZVJvdXRlQ2hhbmdlKCkge1xyXG4gICAgY29uc3QgcGFyYWdyYXBoTmFtZSA9IHRoaXMucm91dGVyLnBhcnNlVXJsKHRoaXMucm91dGVyLnVybCkuZnJhZ21lbnQ7XHJcbiAgICBjb25zdCBwYXJhZ3JhcGggPSB0aGlzLnBhcmFncmFwaHMuZmluZChwID0+IHAucGFyYWdyYXBoTmFtZSA9PT0gcGFyYWdyYXBoTmFtZSk7XHJcbiAgICBpZiAodGhpcy5jdXJyZW50RnJhZ21lbnQgPT09IHBhcmFncmFwaE5hbWUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHBhcmFncmFwaCkge1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+XHJcbiAgICAgICAgcGFyYWdyYXBoLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5zY3JvbGxJbnRvVmlldyh7IGJlaGF2aW9yOiAnaW5zdGFudCcsIGJsb2NrOiAnc3RhcnQnLCBpbmxpbmU6ICduZWFyZXN0JyB9KVxyXG4gICAgICAgICwgMCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNjcm9sbExpc3RlbmVyID0gKGV2ZW50OiBVSUV2ZW50KSA9PiB7XHJcbiAgICBsZXQgbmV3UGFyYWdyYXBoOiBBdmxQYXJhZ3JhcGhEaXJlY3RpdmU7XHJcbiAgICBpZiAodGhpcy5zY3JvbGxDb250YWluZXIuc2Nyb2xsSGVpZ2h0IDwgTWF0aC5yb3VuZCh0aGlzLnNjcm9sbENvbnRhaW5lci5zY3JvbGxUb3AgKyB0aGlzLnNjcm9sbENvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQpKSB7XHJcbiAgICAgIG5ld1BhcmFncmFwaCA9IHRoaXMucGFyYWdyYXBocy5sYXN0O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5wYXJhZ3JhcGhzLmZvckVhY2gocGFyYWdyYXBoID0+IHtcclxuICAgICAgICBjb25zdCBwID0gcGFyYWdyYXBoLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCBhcyBIVE1MRWxlbWVudDtcclxuICAgICAgICBjb25zdCByZWN0ID0gcC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICBpZiAocmVjdC50b3AgPCB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjEpIHtcclxuICAgICAgICAgIG5ld1BhcmFncmFwaCA9IHBhcmFncmFwaDtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgaWYgKG5ld1BhcmFncmFwaCkge1xyXG4gICAgICB0aGlzLmN1cnJlbnRGcmFnbWVudCA9IG5ld1BhcmFncmFwaC5wYXJhZ3JhcGhOYW1lO1xyXG4gICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbXSwgeyBxdWVyeVBhcmFtc0hhbmRsaW5nOiAncHJlc2VydmUnLCBmcmFnbWVudDogbmV3UGFyYWdyYXBoLnBhcmFncmFwaE5hbWUgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIEBoaWRkZW5cclxuICAqL1xyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgIGlmIChpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtSWQpKSB7XHJcbiAgICAgIHRoaXMuc2Nyb2xsQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYXZsLWFwcC1sYXlvdXQgbWFpbicpIGFzIEhUTUxFbGVtZW50O1xyXG4gICAgICB0aGlzLnNjcm9sbFN1YnNjcmlwdGlvbiA9IHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuc2Nyb2xsQ29udGFpbmVyLCAnc2Nyb2xsJywgdGhpcy5zY3JvbGxMaXN0ZW5lcik7XHJcbiAgICB9XHJcbiAgICB0aGlzLmhhbmRsZVJvdXRlQ2hhbmdlKCk7XHJcbiAgICB0aGlzLnJvdXRlclN1YnNjcmlwdGlvbiA9IHRoaXMucm91dGVyLmV2ZW50cy5zdWJzY3JpYmUobmV3Um91dGUgPT4ge1xyXG4gICAgICBpZiAobmV3Um91dGUgaW5zdGFuY2VvZiBOYXZpZ2F0aW9uRW5kKSB7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVSb3V0ZUNoYW5nZSgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMucGFyYWdyYXBoc1N1YnNjcmlwdGlvbiA9IHRoaXMucGFyYWdyYXBocy5jaGFuZ2VzLnN1YnNjcmliZShfID0+IHtcclxuICAgICAgLyogaWYgc2Nyb2xsSW50b1ZpZXcgaGFzIG5vdCBvY2N1cmVkIHlldCB0cnkgaXQgd2l0aCBuZXcgcGFyYWdyYXBoc1xyXG4gICAgICAgICB0aGlzIGlzIG5lZWRlZCBmb3IgY29tcG9uZW50cyB3aGljaCByZW5kZXIgY29udGVudCAocGFyYWdyYXBocylcclxuICAgICAgICAgYWZ0ZXIgdmlldyBoYXMgYmVlbiBpbml0aWFsaXplZFxyXG4gICAgICAqL1xyXG4gICAgICBpZiAoIXRoaXMuY3VycmVudEZyYWdtZW50KSB7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVSb3V0ZUNoYW5nZSgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogQGhpZGRlblxyXG4gICovXHJcbiAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICBpZiAodGhpcy5yb3V0ZXJTdWJzY3JpcHRpb24pIHtcclxuICAgICAgdGhpcy5yb3V0ZXJTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnBhcmFncmFwaHNTdWJzY3JpcHRpb24pIHtcclxuICAgICAgdGhpcy5wYXJhZ3JhcGhzU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5zY3JvbGxTdWJzY3JpcHRpb24pIHtcclxuICAgICAgdGhpcy5zY3JvbGxTdWJzY3JpcHRpb24oKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19