var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
import { Component, Output, EventEmitter, Input, HostBinding } from '@angular/core';
import { trigger, style, animate, transition } from '@angular/animations';
import { Router, ActivationEnd, ActivatedRoute } from '@angular/router';
import { filter } from 'rxjs/operators';
import '@avl-controls/core/dist/avl-icon/avl-icon';
const rowHeightPx = 48;
let AvlSideNavComponent = class AvlSideNavComponent {
    constructor(router, activeRoute) {
        this.router = router;
        this.activeRoute = activeRoute;
        this.openValue = false;
        /**
         * Emitted when the open property changes.
         */
        this.openChange = new EventEmitter();
        activeRoute.queryParams.subscribe(p => {
            this.params = p;
        });
        this.subscription = this.router.events
            .pipe(filter(event => event instanceof ActivationEnd))
            .subscribe((event) => {
            this.selectItems();
        });
    }
    /**
     * Can be set to open or close the side nav.
     * Returns the current state of the side nav.
     */
    get open() {
        return this.openValue;
    }
    set open(val) {
        this.openValue = val;
        this.openChange.next(val);
    }
    /**
     * @hidden
     */
    toggleOpen() {
        if (!this.manuallyOpened) {
            this.open = !this.open;
        }
    }
    /**
     * @hidden
     */
    arrowToggleOpen() {
        this.manuallyOpened = !this.open;
        this.open = !this.open;
    }
    /**
     * @hidden
     */
    mobileClose() {
        if (Math.max(document.documentElement.clientWidth, window.innerWidth) < 960) {
            this.open = false;
        }
    }
    /**
     * @hidden
     */
    groupClicked(item) {
        if (!this.open) {
            this.open = true;
            if (!item.expanded) {
                item.expanded = true;
            }
        }
        else {
            item.expanded = !item.expanded;
        }
    }
    /**
     * @hidden
     */
    getScrubberStyle() {
        return {
            height: this.selectedParagraph ? '14px' : '0px',
            top: `${this.selectedParagraphIndex * rowHeightPx}px`
        };
    }
    /**
    * @hidden
    */
    trimSlash(str) {
        if (str[0] === '/') {
            str = str.substring(1, str.length);
        }
        if (str[str.length - 1] === '/') {
            str = str.substring(0, str.length - 1);
        }
        return str;
    }
    selectItems() {
        if (!this.menuItems) {
            return;
        }
        const fragment = this.router.parseUrl(this.router.url).fragment;
        const url = this.router.url.split('#')[0];
        const queue = this.menuItems.slice();
        let currentGroup;
        this.selectedGroup = undefined;
        this.selectedPage = undefined;
        this.selectedParagraph = undefined;
        let fallbackSelectedPage;
        while (queue.length) {
            const item = queue.pop();
            if (isGroup(item)) {
                currentGroup = item;
                item.subItems.map(subitem => { queue.push(subitem); });
            }
            else {
                if (fallbackSelectedPage == null && this.trimSlash(url).startsWith(this.trimSlash(item.route))) {
                    fallbackSelectedPage = item;
                }
                if (item.route && this.trimSlash(url).endsWith(this.trimSlash(item.route + this.getUrlParams(item.params)))) {
                    if (this.selectedPage && this.selectedPage.route && this.selectedPage.route.length > item.route.length) {
                        continue;
                    }
                    if (item.params && item.params.length > 0) {
                        const object = new Object();
                        item.params.forEach(i => {
                            object[i.name] = i.value;
                        });
                        if (JSON.stringify(this.params) === JSON.stringify(object)) {
                            this.selectedPage = item;
                        }
                    }
                    else {
                        this.selectedPage = item;
                    }
                    if (isTopLevelPage(item)) {
                        this.selectedGroup = undefined;
                    }
                    else {
                        this.selectedGroup = currentGroup;
                    }
                    if (item.paragraphs && item.paragraphs.length > 0) {
                        const paragraphIndex = item.paragraphs.findIndex((p) => p.id === fragment);
                        if (fragment && item.paragraphs && paragraphIndex !== -1) {
                            this.selectedParagraph = fragment;
                            this.selectedParagraphIndex = paragraphIndex;
                        }
                    }
                }
            }
        }
        if (this.selectedPage == null) {
            this.selectedPage = fallbackSelectedPage;
        }
    }
    /**
    * @hidden
    */
    ngOnChanges(changes) {
        if (changes['menuItems']) {
            this.selectItems();
        }
    }
    /**
    * @hidden
    */
    ngOnDestroy() {
        this.subscription.unsubscribe();
    }
    /**
    * @hidden
    */
    getParams(params) {
        if (params && params.length > 0) {
            const object = {};
            params.forEach(param => {
                object[param.name] = param.value;
            });
            return object;
        }
        else {
            return null;
        }
    }
    /**
    * @hidden
    */
    getUrlParams(params) {
        if (params && params.length > 0) {
            let url = '?';
            params.forEach(param => {
                url += param.name + '=' + param.value + '&';
            });
            return url.slice(0, -1);
        }
        else {
            return '';
        }
    }
};
AvlSideNavComponent.ctorParameters = () => [
    { type: Router },
    { type: ActivatedRoute }
];
__decorate([
    Input(),
    HostBinding('class.open'),
    __metadata("design:type", Boolean),
    __metadata("design:paramtypes", [Boolean])
], AvlSideNavComponent.prototype, "open", null);
__decorate([
    Input(),
    __metadata("design:type", Array)
], AvlSideNavComponent.prototype, "menuItems", void 0);
__decorate([
    Input(),
    HostBinding('class.responsive'),
    __metadata("design:type", Boolean)
], AvlSideNavComponent.prototype, "responsive", void 0);
__decorate([
    Input(),
    HostBinding('class.mobile'),
    __metadata("design:type", Boolean)
], AvlSideNavComponent.prototype, "mobile", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], AvlSideNavComponent.prototype, "openChange", void 0);
AvlSideNavComponent = __decorate([
    Component({
        selector: 'avl-side-nav',
        template: "<div #outerContainer [class.closed]=\"!open\" class=\"outer-container toolbar-spacing\">\r\n  <div class=\"item-scroll\">\r\n    <div #innerContainer class=\"inner-container\">\r\n      <ng-template ngFor let-item [ngForOf]=\"menuItems\">\r\n        <!-- Top level page -->\r\n        <a *ngIf=\"!item.subItems\" tabindex=\"0\" class=\"item top-level-page\" routerLink={{item.route}} [queryParams]=\"getParams(item.params)\" [class.selected]=\"item === selectedPage\" (click)=\"mobileClose()\">\r\n          <div class=\"image-div\">\r\n            <avl-icon *ngIf=\"item.icon\" attr.icon=\"{{item.icon}}\"></avl-icon>\r\n            <img *ngIf=\"item.iconUrl\" [src]=\"item.iconUrl\">\r\n          </div>\r\n          <div class=\"label-div\">{{item.label}}</div>\r\n          <div class=\"item-overlay\"></div>\r\n        </a>\r\n        <!-- Paragraphs of a top level page -->\r\n        <div class=\"child-container\" *ngIf=\"open && item.paragraphs && item.paragraphs.length > 0 && item === selectedPage\" [@expandCollapse]>\r\n          <!-- div for preventing reversing of the items by flex-direction: column-reverse -->\r\n          <div>\r\n            <a *ngFor=\"let paragraph of item.paragraphs\" class=\"item top-level-paragraph\"\r\n              href=\"{{trimSlash(item.route + getUrlParams(item.params) + '#' + paragraph.id)}}\" [class.selected]=\"paragraph.id === selectedParagraph\" (click)=\"mobileClose()\">\r\n              <div class=\"label-div\">{{paragraph.label}}</div>\r\n            </a>\r\n          </div>\r\n          <div class=\"page-progress-bar\">\r\n            <div class=\"page-progress-bar-background\"></div>\r\n            <div class=\"page-progress-bar-scrubber\" [ngStyle]=\"getScrubberStyle()\"></div>\r\n          </div>\r\n        </div>\r\n        <!-- Group -->\r\n        <div *ngIf=\"item.subItems\" tabindex=\"0\" class=\"item group\" [class.expanded]=\"item.expanded\" (click)=\"groupClicked(item)\"\r\n          [class.selected]=\"!open && item === selectedGroup\">\r\n          <div class=\"image-div\">\r\n            <avl-icon *ngIf=\"item.icon\" attr.icon=\"{{item.icon}}\"></avl-icon>\r\n            <img *ngIf=\"item.iconUrl\" [src]=\"item.iconUrl\">\r\n          </div>\r\n          <div class=\"label-div group\">{{item.label}}</div>\r\n          <avl-icon class=\"group-arrow\" icon=\"arrow-drop-down\"></avl-icon>\r\n          <div class=\"item-overlay\"></div>\r\n        </div>\r\n        <!-- Subpages -->\r\n        <div class=\"child-container\" *ngIf=\"open && item.subItems && item.subItems.length > 0 && item.expanded\" [@expandCollapse] (click)=\"toggleOpen()\">\r\n          <!-- div for preventing reversing of the items by flex-direction: column-reverse -->\r\n          <div>\r\n            <ng-template ngFor let-subItem [ngForOf]=\"item.subItems\">\r\n              <a class=\"item subpage\" routerLink={{subItem.route}} [queryParams]=\"getParams(subItem.params)\" [class.selected]=\"subItem === selectedPage\" (click)=\"mobileClose()\">\r\n                <div class=\"label-div\">{{subItem.label}}</div>\r\n                <div class=\"item-overlay\"></div>\r\n              </a>\r\n              <!-- Paragraphs of a subpage -->\r\n              <div class=\"child-container\" *ngIf=\"subItem.paragraphs && subItem.paragraphs.length > 0 && subItem === selectedPage\" [@expandCollapse]>\r\n                <!-- div for preventing reversing of the items by flex-direction: column-reverse -->\r\n                <div>\r\n                  <a *ngFor=\"let paragraph of subItem.paragraphs\" class=\"item subpage-paragraph\" href=\"{{subItem.route}}{{getUrlParams(item.params)}}#{{paragraph.id}}\"\r\n                    [class.selected]=\"paragraph.id === selectedParagraph\" (click)=\"mobileClose()\">\r\n                    <div class=\"label-div\">{{paragraph.label}}</div>\r\n                  </a>\r\n                </div>\r\n                <div class=\"page-progress-bar\">\r\n                  <div class=\"page-progress-bar-background\"></div>\r\n                  <div class=\"page-progress-bar-scrubber\" [ngStyle]=\"getScrubberStyle()\"></div>\r\n                </div>\r\n              </div>\r\n            </ng-template>\r\n          </div>\r\n        </div>\r\n      </ng-template>\r\n    </div>\r\n  </div>\r\n  <div class=\"arrow-spacer\"></div>\r\n\r\n  <svg (click)=\"arrowToggleOpen()\" [class.closed]=\"!open\" class=\"open-close-arrow\"  id=\"Layer_1\" data-name=\"Layer 1\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">\r\n    <g transform=\"translate(405 102) rotate(-180)\">\r\n      <path d=\"M-972.955,492l6.774-6,1.581,1.4-5.194,4.6,5.194,4.6-1.581,1.4Zm-5.645,0,6.773-6,1.581,1.4-5.193,4.6,5.193,4.6-1.581,1.4Z\" transform=\"translate(1364.6 -402)\"/>\r\n    </g>\r\n  </svg>\r\n\r\n</div>\r\n<div class=\"scrim\" (click)=\"open = false;\"></div>",
        animations: [
            trigger('expandCollapse', [
                transition(':enter', [
                    style({ 'max-height': '0px' }),
                    animate('225ms ease-in', style({ transform: 'translateY(0%)', 'max-height': '200px' }))
                ]),
                transition(':leave', [
                    style({ 'max-height': '200px' }),
                    animate('180ms ease-in', style({ 'max-height': '0px' }))
                ])
            ])
        ],
        styles: [":host{font-family:var(--avl-font-family);height:100%;display:block;--text-color:var(--avl-side-nav-text-color, var(--avl-emphasis-high-color));--icons-color:var(--avl-side-nav-icons-color, var(--avl-emphasis-medium-color));--background-color:var(--avl-side-nav-background-color, var(--avl-side-nav-color));--item-icon-width:72px;--side-nav-mini-width:var(--item-icon-width);--side-nav-open-width:var(--avl-side-nav-open-width, 256px);--item-height:48px;box-shadow:var(--avl-box-shadow-12dp);z-index:3}.outer-container{position:relative;box-sizing:content-box;height:calc(100% - var(--avl-app-bar-height,56px));background-color:var(--background-color);width:var(--side-nav-open-width);overflow:hidden}.inner-container{width:var(--side-nav-open-width)}.toolbar-spacing{padding-top:var(--avl-app-bar-height,56px)}.open-close-arrow{position:absolute;bottom:12px;right:24px;font-size:24px;fill:var(--icons-color);cursor:pointer;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:24px}.open-close-arrow:not(.closed){transform:scale(-1,1)}.outer-container.closed{width:var(--side-nav-mini-width);-webkit-animation-name:closing;animation-name:closing;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1);transition-duration:195ms}.arrow-spacer{height:48px}.item-scroll{height:calc(100% - 48px);overflow-y:auto;overflow-x:hidden}.item{display:flex;align-items:center;cursor:pointer;color:var(--text-color);height:var(--item-height);position:relative;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;isolation:isolate;outline:0;white-space:pre-wrap;padding-right:24px}.item:active{color:var(--text-color)}.top-level-paragraph{padding-left:88px}.subpage{padding-left:72px}.subpage-paragraph{padding-left:88px}.label-div{z-index:10;font-family:Roboto;max-width:160px;overflow:hidden;text-overflow:ellipsis;max-height:40px;word-break:break-word;-webkit-box-orient:vertical;display:-webkit-box;-webkit-line-clamp:2}.group.expanded>.label-div.group{font-family:Roboto-Medium}.label-div.group{max-width:calc(100% - 112px)}.image-div{color:var(--avl-emphasis-medium-color);display:flex;align-items:center;justify-content:center;width:var(--item-icon-width);height:var(--item-height);margin-right:0;z-index:9}img{height:auto;width:auto;max-height:24px;max-width:24px}avl-icon{margin-bottom:0;font-size:24px;color:var(--avl-emphasis-medium-color)}.group-arrow{position:absolute;right:24px}.group.expanded>.group-arrow{transform:rotate(180deg)}.item-overlay{box-sizing:border-box;position:absolute;height:100%;width:100%;left:0;z-index:0}.item.selected>.item-overlay{background-color:var(--avl-side-nav-product-color,var(--avl-product-focus-color))}.item:hover:not(.selected)>.item-overlay{background-color:var(--avl-side-nav-product-color-hover,var(--avl-product-hover-color))}.item.selected{font-weight:500}.child-container{position:relative;display:flex;overflow:hidden;flex-direction:column-reverse}.page-progress-bar{position:absolute;left:72px;top:11px;bottom:11px;width:2px;overflow:hidden}.page-progress-bar-background{background-color:var(--text-color);opacity:.2;width:100%;height:100%}.page-progress-bar-scrubber{position:absolute;width:100%;background-color:var(--text-color);opacity:1;transition:height .2s,top .2s;margin-top:6px;margin-bottom:2px}@-webkit-keyframes closing{from{width:var(--side-nav-open-width)}to{width:var(--side-nav-mini-width)}}@keyframes closing{from{width:var(--side-nav-open-width)}to{width:var(--side-nav-mini-width)}}@-webkit-keyframes opening{from{width:var(--side-nav-mini-width)}to{width:var(--side-nav-open-width)}}@keyframes opening{from{width:var(--side-nav-mini-width)}to{width:var(--side-nav-open-width)}}.outer-container:not(.closed){-webkit-animation-name:opening;animation-name:opening;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1);transition-duration:225ms}@media (max-width:960px){:host(.responsive){position:absolute;--side-nav-mini-width:0;transition:box-shadow 250ms}:host(.responsive[slot=left-side]){left:0}:host(.responsive[slot=right-side]){right:0}:host(.responsive:not(.open)){box-shadow:none}:host(.responsive) .item-scroll{height:100%}:host(.responsive) .open-close-arrow{display:none}:host(.responsive) .arrow-spacer{display:none;visibility:hidden}:host(.responsive) .scrim{transition:250ms;transition-duration:250px}:host(.responsive[slot=left-side]:not(.open)) .scrim{visibility:hidden;left:0}:host(.responsive.open) .scrim{background-color:var(--avl-scrim-color);position:fixed;visibility:visible;top:0;width:100%;height:100%}:host(.responsive[slot=left-side].open) .scrim{left:var(--side-nav-open-width)}:host(.responsive[slot=right-side].open) .scrim{right:var(--side-nav-open-width)}:host(.responsive[slot=right-side]:not(.open)) .scrim{visibility:hidden;right:0}}:host(.mobile){position:absolute;--side-nav-mini-width:0;transition:box-shadow 250ms}:host(.mobile[slot=left-side]){left:0}:host(.mobile[slot=right-side]){right:0}:host(.mobile:not(.open)){box-shadow:none}:host(.mobile) .item-scroll{height:100%}:host(.mobile) .open-close-arrow{display:none}:host(.mobile) .arrow-spacer{display:none;visibility:hidden}:host(.mobile) .scrim{transition:250ms;transition-duration:250px}:host(.mobile[slot=left-side]:not(.open)) .scrim{visibility:hidden;left:0}:host(.mobile.open) .scrim{background-color:var(--avl-scrim-color);position:fixed;visibility:visible;top:0;width:100%;height:100%}:host(.mobile[slot=left-side].open) .scrim{left:var(--side-nav-open-width)}:host(.mobile[slot=right-side].open) .scrim{right:var(--side-nav-open-width)}:host(.mobile[slot=right-side]:not(.open)) .scrim{visibility:hidden;right:0}"]
    }),
    __metadata("design:paramtypes", [Router,
        ActivatedRoute])
], AvlSideNavComponent);
export { AvlSideNavComponent };
/**
* @hidden
*/
function isGroup(item) {
    return item.subItems !== undefined && item.subItems.length > 0;
}
/**
* @hidden
*/
function isTopLevelPage(item) {
    return !isGroup(item) && (item.icon !== undefined || item.iconUrl !== undefined);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXZsLXNpZGUtbmF2LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhdmwtbmctY29udHJvbHMvbmF2aWdhdGlvbi8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2F2bC1zaWRlLW5hdi9hdmwtc2lkZS1uYXYuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQXVDLFdBQVcsRUFDekYsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBR3pFLE9BQU8sRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFFLGNBQWMsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3hFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV4QyxPQUFPLDJDQUEyQyxDQUFDO0FBRW5ELE1BQU0sV0FBVyxHQUFHLEVBQUUsQ0FBQztBQW1CdkIsSUFBYSxtQkFBbUIsR0FBaEMsTUFBYSxtQkFBbUI7SUFvRjlCLFlBQ1UsTUFBYyxFQUVmLFdBQTJCO1FBRjFCLFdBQU0sR0FBTixNQUFNLENBQVE7UUFFZixnQkFBVyxHQUFYLFdBQVcsQ0FBZ0I7UUFuRTVCLGNBQVMsR0FBRyxLQUFLLENBQUM7UUFrQzFCOztXQUVHO1FBRUksZUFBVSxHQUEwQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBK0I1RCxXQUFXLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUNwQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztRQUNsQixDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNO2FBQ25DLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFD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bUJBQW1CO0FBNFFoQzs7RUFFRTtBQUNGLFNBQVMsT0FBTyxDQUFDLElBQWtCO0lBQ2pDLE9BQVEsSUFBYyxDQUFDLFFBQVEsS0FBSyxTQUFTLElBQUssSUFBYyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0FBQ3ZGLENBQUM7QUFFRDs7RUFFRTtBQUNGLFNBQVMsY0FBYyxDQUFDLElBQWtCO0lBQ3hDLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBRSxJQUFxQixDQUFDLElBQUksS0FBSyxTQUFTLElBQUssSUFBcUIsQ0FBQyxPQUFPLEtBQUssU0FBUyxDQUFDLENBQUM7QUFDdkgsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQ29tcG9uZW50LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uRGVzdHJveSwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBIb3N0QmluZGluZ1xyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyB0cmlnZ2VyLCBzdHlsZSwgYW5pbWF0ZSwgdHJhbnNpdGlvbn0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XHJcbmltcG9ydCB7IFRvcExldmVsUGFnZSwgR3JvdXAsIFBhZ2UsIFBhcmFtcyB9IGZyb20gJy4vbWVudS1pdGVtcyc7XHJcblxyXG5pbXBvcnQgeyBSb3V0ZXIsIEFjdGl2YXRpb25FbmQsIEFjdGl2YXRlZFJvdXRlIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcclxuaW1wb3J0IHsgZmlsdGVyIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuaW1wb3J0ICdAYXZsLWNvbnRyb2xzL2NvcmUvZGlzdC9hdmwtaWNvbi9hdmwtaWNvbic7XHJcblxyXG5jb25zdCByb3dIZWlnaHRQeCA9IDQ4O1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdhdmwtc2lkZS1uYXYnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9hdmwtc2lkZS1uYXYuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2F2bC1zaWRlLW5hdi5jb21wb25lbnQuY3NzJ10sXHJcbiAgYW5pbWF0aW9uczogW1xyXG4gICAgdHJpZ2dlcignZXhwYW5kQ29sbGFwc2UnLCBbXHJcbiAgICAgIHRyYW5zaXRpb24oJzplbnRlcicsIFtcclxuICAgICAgICBzdHlsZSh7ICdtYXgtaGVpZ2h0JzogJzBweCcgfSksXHJcbiAgICAgICAgYW5pbWF0ZSgnMjI1bXMgZWFzZS1pbicsIHN0eWxlKHsgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgwJSknLCAnbWF4LWhlaWdodCc6ICcyMDBweCcgfSkpXHJcbiAgICAgIF0pLFxyXG4gICAgICB0cmFuc2l0aW9uKCc6bGVhdmUnLCBbXHJcbiAgICAgICAgc3R5bGUoeyAnbWF4LWhlaWdodCc6ICcyMDBweCcgfSksXHJcbiAgICAgICAgYW5pbWF0ZSgnMTgwbXMgZWFzZS1pbicsIHN0eWxlKHsgJ21heC1oZWlnaHQnOiAnMHB4JyB9KSlcclxuICAgICAgXSlcclxuICAgIF0pXHJcbiAgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQXZsU2lkZU5hdkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uRGVzdHJveSwgT25DaGFuZ2VzIHtcclxuXHJcbiAgLyoqXHJcbiAgICpcclxuICAgKiAjIyMgU3R5bGluZ1xyXG4gICAqIFRoZSBmb2xsb3dpbmcgY3VzdG9tIHByb3BlcnRpZXMgYXJlIGF2YWlsYWJsZSBmb3Igc3R5bGluZzpcclxuICAgKlxyXG4gICAqIEN1c3RvbSBwcm9wZXJ0eSAgICAgICAgICAgICAgICAgICAgICAgICAgfCBEZXNjcmlwdGlvbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IERlZmF1bHRcclxuICAgKiA6LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLXw6LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tfDotLS0tLS0tLS1cclxuICAgKiBgLS1hdmwtYXBwLWJhci1oZWlnaHRgICAgICAgICAgICAgICAgICAgIHwgSGVpZ2h0IG9mIHRoZSB0b29sYmFyLiBOZWVkZWQgc28gdGhhdCB0aGUgYXZsLXNpZGUtbmF2IGNhbiBiZSBjb3JyZWN0bHkgcG9zaXRpb25lZCBiZWxvdyB0aGUgdG9vbGJhci4gfCBgNTZweGBcclxuICAgKiBgLS1hdmwtc2lkZS1uYXYtcHJvZHVjdC1jb2xvcmAgICAgICAgICAgIHwgVXNlZCBmb3Igc2VsZWN0ZWQgY29sb3IgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBgLS1hdmwtcHJvZHVjdC1zZWxlY3RlZGBcclxuICAgKiBgLS1hdmwtc2lkZS1uYXYtcHJvZHVjdC1jb2xvci1ob3ZlcmAgICAgIHwgVXNlZCBmb3IgaG92ZXIgY29sb3IuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBgLS1hdmwtcHJvZHVjdC1ob3ZlcmBcclxuICAgKiBgLS1hdmwtc2lkZS1uYXYtdGV4dC1jb2xvcmAgICAgICAgICAgICAgIHwgQ29sb3Igb2YgdGhlIHRleHQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBgLS1hdmwtZW1waGFzaXMtaGlnaC1jb2xvcmBcclxuICAgKiBgLS1hdmwtc2lkZS1uYXYtaWNvbnMtY29sb3JgICAgICAgICAgICAgIHwgQ29sb3Igb2YgaWNvbnMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBgLS1hdmwtZW1waGFzaXMtbWVkaXVtLWNvbG9yYFxyXG4gICAqIGAtLWF2bC1zaWRlLW5hdi1iYWNrZ3JvdW5kLWNvbG9yYCAgICAgICAgfCBCYWNrZ3JvdW5kIGNvbG9yIG9mIHRoZSBhdmwtc2lkZS1uYXYgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IGAtLWF2bC1zaWRlLW5hdi1jb2xvcmBcclxuICAgKiBgLS1hdmwtc2lkZS1uYXYtb3Blbi13aWR0aGAgICAgICAgICAgICAgIHwgV2lkdGggb2YgdGhlIGF2bC1zaWRlLW5hdiBpbiB0aGUgb3BlbiBzdGF0ZS4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBgMjU2cHhgXHJcbiAgICpcclxuICAgKi9cclxuICBfc3R5bGluZzogYW55O1xyXG5cclxuICBwcml2YXRlIG9wZW5WYWx1ZSA9IGZhbHNlO1xyXG5cclxuICAvKipcclxuICAgKiBDYW4gYmUgc2V0IHRvIG9wZW4gb3IgY2xvc2UgdGhlIHNpZGUgbmF2LlxyXG4gICAqIFJldHVybnMgdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIHNpZGUgbmF2LlxyXG4gICAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5vcGVuJylcclxuICBwdWJsaWMgZ2V0IG9wZW4oKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5vcGVuVmFsdWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJdGVtcyB0aGF0IGFyZSBzaG93biBpbiB0aGUgc2lkZSBuYXYuXHJcbiAgICovXHJcbiAgQElucHV0KClcclxuICBwdWJsaWMgbWVudUl0ZW1zOiBBcnJheTxUb3BMZXZlbFBhZ2UgfCBHcm91cD47XHJcblxyXG4gIC8qKlxyXG4gICAqIEJvb2xlYW4gdG8gdG9nZ2xlIHJlc3BvbnNpdmUgZmVhdHVyZXNcclxuICAgKiBPbiBtb2JpbGUgc2NyZWVucyBzaWRlbmF2IHRvZ2dsaW5nIGlzIHRyaWdnZXJlZCBieSBidXJnZXIgaWNvbiBpbiBhcHAtYmFyIGFzIHBhcnQgb2YgYXBwLWxheW91dFxyXG4gICAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5yZXNwb25zaXZlJylcclxuICBwdWJsaWMgcmVzcG9uc2l2ZTogYm9vbGVhbjtcclxuXHJcbiAgLyoqXHJcbiAgICogQm9vbGVhbiB0byBzZXQgb25seSBtb2JpbGUgZmVhdHVyZXMgb25cclxuICAgKiBPbiBtb2JpbGUgc2NyZWVucyBzaWRlbmF2IHRvZ2dsaW5nIGlzIHRyaWdnZXJlZCBieSBidXJnZXIgaWNvbiBpbiBhcHAtYmFyIGFzIHBhcnQgb2YgYXBwLWxheW91dFxyXG4gICAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5tb2JpbGUnKVxyXG4gIHB1YmxpYyBtb2JpbGU6IGJvb2xlYW47XHJcblxyXG4gIC8qKlxyXG4gICAqIEVtaXR0ZWQgd2hlbiB0aGUgb3BlbiBwcm9wZXJ0eSBjaGFuZ2VzLlxyXG4gICAqL1xyXG4gIEBPdXRwdXQoKVxyXG4gIHB1YmxpYyBvcGVuQ2hhbmdlOiBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gIHB1YmxpYyBzZXQgb3Blbih2YWw6IGJvb2xlYW4pIHtcclxuICAgIHRoaXMub3BlblZhbHVlID0gdmFsO1xyXG4gICAgdGhpcy5vcGVuQ2hhbmdlLm5leHQodmFsKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcblxyXG4gIC8qKlxyXG4gICAqIEBoaWRkZW5cclxuICAgKi9cclxuICBwdWJsaWMgc2VsZWN0ZWRHcm91cDogR3JvdXA7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBoaWRkZW5cclxuICAgKi9cclxuICBwdWJsaWMgc2VsZWN0ZWRQYWdlOiBQYWdlO1xyXG5cclxuICAvKipcclxuICAgKiBAaGlkZGVuXHJcbiAgICovXHJcbiAgcHVibGljIHNlbGVjdGVkUGFyYWdyYXBoOiBzdHJpbmc7XHJcbiAgcHJpdmF0ZSBzZWxlY3RlZFBhcmFncmFwaEluZGV4OiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBwYXJhbXM6IGFueTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHJvdXRlcjogUm91dGVyLFxyXG5cclxuICAgIHB1YmxpYyBhY3RpdmVSb3V0ZTogQWN0aXZhdGVkUm91dGVcclxuICAgICkge1xyXG4gICAgYWN0aXZlUm91dGUucXVlcnlQYXJhbXMuc3Vic2NyaWJlKHAgPT4ge1xyXG4gICAgICB0aGlzLnBhcmFtcyA9IHA7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuc3Vic2NyaXB0aW9uID0gdGhpcy5yb3V0ZXIuZXZlbnRzXHJcbiAgICAgIC5waXBlKGZpbHRlcihldmVudCA9PiBldmVudCBpbnN0YW5jZW9mIEFjdGl2YXRpb25FbmQpKVxyXG4gICAgICAuc3Vic2NyaWJlKChldmVudDogQWN0aXZhdGlvbkVuZCkgPT4ge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0SXRlbXMoKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAaGlkZGVuXHJcbiAgICovXHJcbiAgcHVibGljIHRvZ2dsZU9wZW4oKSB7XHJcbiAgICBpZighdGhpcy5tYW51YWxseU9wZW5lZCkge1xyXG4gICAgICB0aGlzLm9wZW4gPSAhdGhpcy5vcGVuO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBtYW51YWxseU9wZW5lZDogYm9vbGVhbjtcclxuXHJcbiAgLyoqXHJcbiAgICogQGhpZGRlblxyXG4gICAqL1xyXG4gIHB1YmxpYyBhcnJvd1RvZ2dsZU9wZW4oKSB7XHJcbiAgICAgIHRoaXMubWFudWFsbHlPcGVuZWQgPSAhdGhpcy5vcGVuO1xyXG4gICAgICB0aGlzLm9wZW4gPSAhdGhpcy5vcGVuO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGhpZGRlblxyXG4gICAqL1xyXG4gIHB1YmxpYyBtb2JpbGVDbG9zZSgpIHtcclxuICAgIGlmKE1hdGgubWF4KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCwgd2luZG93LmlubmVyV2lkdGgpIDwgOTYwKSB7XHJcbiAgICAgIHRoaXMub3BlbiA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGhpZGRlblxyXG4gICAqL1xyXG4gIHB1YmxpYyBncm91cENsaWNrZWQoaXRlbSkge1xyXG4gICAgaWYgKCF0aGlzLm9wZW4pIHtcclxuICAgICAgdGhpcy5vcGVuID0gdHJ1ZTtcclxuICAgICAgaWYgKCFpdGVtLmV4cGFuZGVkKSB7XHJcbiAgICAgICAgaXRlbS5leHBhbmRlZCA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGl0ZW0uZXhwYW5kZWQgPSAhaXRlbS5leHBhbmRlZDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBoaWRkZW5cclxuICAgKi9cclxuICBwdWJsaWMgZ2V0U2NydWJiZXJTdHlsZSgpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGhlaWdodDogdGhpcy5zZWxlY3RlZFBhcmFncmFwaCA/ICcxNHB4JyA6ICcwcHgnLFxyXG4gICAgICB0b3A6IGAke3RoaXMuc2VsZWN0ZWRQYXJhZ3JhcGhJbmRleCAqIHJvd0hlaWdodFB4fXB4YFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogQGhpZGRlblxyXG4gICovXHJcbiAgcHVibGljIHRyaW1TbGFzaChzdHI6IHN0cmluZykge1xyXG4gICAgaWYgKHN0clswXSA9PT0gJy8nKSB7XHJcbiAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoMSwgc3RyLmxlbmd0aCk7XHJcbiAgICB9XHJcbiAgICBpZiAoc3RyW3N0ci5sZW5ndGggLSAxXSA9PT0gJy8nKSB7XHJcbiAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoMCwgc3RyLmxlbmd0aCAtIDEpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHN0cjtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2VsZWN0SXRlbXMoKSB7XHJcbiAgICBpZiAoIXRoaXMubWVudUl0ZW1zKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGZyYWdtZW50ID0gdGhpcy5yb3V0ZXIucGFyc2VVcmwodGhpcy5yb3V0ZXIudXJsKS5mcmFnbWVudDtcclxuICAgIGNvbnN0IHVybCA9IHRoaXMucm91dGVyLnVybC5zcGxpdCgnIycpWzBdO1xyXG4gICAgY29uc3QgcXVldWU6IEFycmF5PFBhZ2UgfCBHcm91cD4gPSB0aGlzLm1lbnVJdGVtcy5zbGljZSgpO1xyXG4gICAgbGV0IGN1cnJlbnRHcm91cDogR3JvdXA7XHJcbiAgICB0aGlzLnNlbGVjdGVkR3JvdXAgPSB1bmRlZmluZWQ7XHJcbiAgICB0aGlzLnNlbGVjdGVkUGFnZSA9IHVuZGVmaW5lZDtcclxuICAgIHRoaXMuc2VsZWN0ZWRQYXJhZ3JhcGggPSB1bmRlZmluZWQ7XHJcbiAgICBsZXQgZmFsbGJhY2tTZWxlY3RlZFBhZ2U6IGFueTtcclxuICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHtcclxuICAgICAgY29uc3QgaXRlbSA9IHF1ZXVlLnBvcCgpO1xyXG4gICAgICBpZiAoaXNHcm91cChpdGVtKSkge1xyXG4gICAgICAgIGN1cnJlbnRHcm91cCA9IGl0ZW07XHJcbiAgICAgICAgaXRlbS5zdWJJdGVtcy5tYXAoc3ViaXRlbSA9PiB7IHF1ZXVlLnB1c2goc3ViaXRlbSk7IH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmIChmYWxsYmFja1NlbGVjdGVkUGFnZSA9PSBudWxsICYmIHRoaXMudHJpbVNsYXNoKHVybCkuc3RhcnRzV2l0aCh0aGlzLnRyaW1TbGFzaChpdGVtLnJvdXRlKSkpIHtcclxuICAgICAgICAgIGZhbGxiYWNrU2VsZWN0ZWRQYWdlID0gaXRlbTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGl0ZW0ucm91dGUgJiYgdGhpcy50cmltU2xhc2godXJsKS5lbmRzV2l0aCh0aGlzLnRyaW1TbGFzaChpdGVtLnJvdXRlICsgdGhpcy5nZXRVcmxQYXJhbXMoaXRlbS5wYXJhbXMpKSkpIHtcclxuICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkUGFnZSAmJiB0aGlzLnNlbGVjdGVkUGFnZS5yb3V0ZSAmJiB0aGlzLnNlbGVjdGVkUGFnZS5yb3V0ZS5sZW5ndGggPiBpdGVtLnJvdXRlLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmIChpdGVtLnBhcmFtcyAmJiBpdGVtLnBhcmFtcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9iamVjdCA9IG5ldyBPYmplY3QoKTtcclxuICAgICAgICAgICAgaXRlbS5wYXJhbXMuZm9yRWFjaChpID0+IHtcclxuICAgICAgICAgICAgICBvYmplY3RbaS5uYW1lXSA9IGkudmFsdWU7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpZiAoSlNPTi5zdHJpbmdpZnkodGhpcy5wYXJhbXMpID09PSBKU09OLnN0cmluZ2lmeShvYmplY3QpKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFBhZ2UgPSBpdGVtO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkUGFnZSA9IGl0ZW07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiAoaXNUb3BMZXZlbFBhZ2UoaXRlbSkpIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEdyb3VwID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEdyb3VwID0gY3VycmVudEdyb3VwO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGlmIChpdGVtLnBhcmFncmFwaHMgJiYgaXRlbS5wYXJhZ3JhcGhzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc3QgcGFyYWdyYXBoSW5kZXggPSBpdGVtLnBhcmFncmFwaHMuZmluZEluZGV4KChwKSA9PiBwLmlkID09PSBmcmFnbWVudCk7XHJcbiAgICAgICAgICAgIGlmIChmcmFnbWVudCAmJiBpdGVtLnBhcmFncmFwaHMgJiYgcGFyYWdyYXBoSW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFBhcmFncmFwaCA9IGZyYWdtZW50O1xyXG4gICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRQYXJhZ3JhcGhJbmRleCA9IHBhcmFncmFwaEluZGV4O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5zZWxlY3RlZFBhZ2UgPT0gbnVsbCkge1xyXG4gICAgICB0aGlzLnNlbGVjdGVkUGFnZSA9IGZhbGxiYWNrU2VsZWN0ZWRQYWdlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBAaGlkZGVuXHJcbiAgKi9cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICBpZiAoY2hhbmdlc1snbWVudUl0ZW1zJ10pIHtcclxuICAgICAgdGhpcy5zZWxlY3RJdGVtcygpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBAaGlkZGVuXHJcbiAgKi9cclxuICBuZ09uRGVzdHJveSgpIHtcclxuICAgIHRoaXMuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIEBoaWRkZW5cclxuICAqL1xyXG4gIGdldFBhcmFtcyhwYXJhbXM6IFBhcmFtc1tdKSB7XHJcbiAgICBpZiAocGFyYW1zICYmIHBhcmFtcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IG9iamVjdCA9IHt9O1xyXG4gICAgICBwYXJhbXMuZm9yRWFjaChwYXJhbSA9PiB7XHJcbiAgICAgICAgb2JqZWN0W3BhcmFtLm5hbWVdID0gcGFyYW0udmFsdWU7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gb2JqZWN0O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIEBoaWRkZW5cclxuICAqL1xyXG4gZ2V0VXJsUGFyYW1zKHBhcmFtczogUGFyYW1zW10pIHtcclxuICBpZiAocGFyYW1zICYmIHBhcmFtcy5sZW5ndGggPiAwKSB7XHJcbiAgICBsZXQgdXJsID0gJz8nO1xyXG4gICAgcGFyYW1zLmZvckVhY2gocGFyYW0gPT4ge1xyXG4gICAgICB1cmwgKz0gcGFyYW0ubmFtZSArICc9JyArIHBhcmFtLnZhbHVlICsgJyYnO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gdXJsLnNsaWNlKDAsIC0xKTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuICcnO1xyXG4gIH1cclxufVxyXG59XHJcblxyXG4vKipcclxuKiBAaGlkZGVuXHJcbiovXHJcbmZ1bmN0aW9uIGlzR3JvdXAoaXRlbTogUGFnZSB8IEdyb3VwKTogaXRlbSBpcyBHcm91cCB7XHJcbiAgcmV0dXJuIChpdGVtIGFzIEdyb3VwKS5zdWJJdGVtcyAhPT0gdW5kZWZpbmVkICYmIChpdGVtIGFzIEdyb3VwKS5zdWJJdGVtcy5sZW5ndGggPiAwO1xyXG59XHJcblxyXG4vKipcclxuKiBAaGlkZGVuXHJcbiovXHJcbmZ1bmN0aW9uIGlzVG9wTGV2ZWxQYWdlKGl0ZW06IFBhZ2UgfCBHcm91cCk6IGl0ZW0gaXMgVG9wTGV2ZWxQYWdlIHtcclxuICByZXR1cm4gIWlzR3JvdXAoaXRlbSkgJiYgKChpdGVtIGFzIFRvcExldmVsUGFnZSkuaWNvbiAhPT0gdW5kZWZpbmVkIHx8IChpdGVtIGFzIFRvcExldmVsUGFnZSkuaWNvblVybCAhPT0gdW5kZWZpbmVkKTtcclxufVxyXG5cclxuIl19