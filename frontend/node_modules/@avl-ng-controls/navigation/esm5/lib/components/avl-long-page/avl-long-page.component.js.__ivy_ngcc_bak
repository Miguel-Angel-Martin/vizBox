var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
import { Component, ViewEncapsulation, ContentChildren, QueryList, AfterViewInit, OnDestroy, Renderer2, Inject, PLATFORM_ID } from '@angular/core';
import { AvlParagraphDirective } from './avl-paragraph.directive';
import { Router, NavigationEnd } from '@angular/router';
import { isPlatformBrowser } from '@angular/common';
/**
* avl-long-page should only be used inside avl-app-layout. The only scrollable container should
* be avl-app-layout (already set by default) and avl-long-page and components that are using it must
* not scroll in order for avl-long-page to work properly.
*/
var AvlLongPageComponent = /** @class */ (function () {
    /**
    * @hidden
    */
    function AvlLongPageComponent(router, renderer, platformId) {
        var _this = this;
        this.router = router;
        this.renderer = renderer;
        this.platformId = platformId;
        this.scrollListener = function (event) {
            var newParagraph;
            if (_this.scrollContainer.scrollHeight < Math.round(_this.scrollContainer.scrollTop + _this.scrollContainer.getBoundingClientRect().height)) {
                newParagraph = _this.paragraphs.last;
            }
            else {
                _this.paragraphs.forEach(function (paragraph) {
                    var p = paragraph.elementRef.nativeElement;
                    var rect = p.getBoundingClientRect();
                    if (rect.top < window.innerHeight * 0.1) {
                        newParagraph = paragraph;
                    }
                });
            }
            if (newParagraph) {
                _this.currentFragment = newParagraph.paragraphName;
                _this.router.navigate([], { queryParamsHandling: 'preserve', fragment: newParagraph.paragraphName });
            }
        };
    }
    AvlLongPageComponent.prototype.handleRouteChange = function () {
        var paragraphName = this.router.parseUrl(this.router.url).fragment;
        var paragraph = this.paragraphs.find(function (p) { return p.paragraphName === paragraphName; });
        if (this.currentFragment === paragraphName) {
            return;
        }
        if (paragraph) {
            setTimeout(function () {
                return paragraph.elementRef.nativeElement.scrollIntoView({ behavior: 'instant', block: 'start', inline: 'nearest' });
            }, 0);
        }
    };
    /**
    * @hidden
    */
    AvlLongPageComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        if (isPlatformBrowser(this.platformId)) {
            this.scrollContainer = document.querySelector('avl-app-layout main');
            this.scrollSubscription = this.renderer.listen(this.scrollContainer, 'scroll', this.scrollListener);
        }
        this.handleRouteChange();
        this.routerSubscription = this.router.events.subscribe(function (newRoute) {
            if (newRoute instanceof NavigationEnd) {
                _this.handleRouteChange();
            }
        });
        this.paragraphsSubscription = this.paragraphs.changes.subscribe(function (_) {
            /* if scrollIntoView has not occured yet try it with new paragraphs
               this is needed for components which render content (paragraphs)
               after view has been initialized
            */
            if (!_this.currentFragment) {
                _this.handleRouteChange();
            }
        });
    };
    /**
    * @hidden
    */
    AvlLongPageComponent.prototype.ngOnDestroy = function () {
        if (this.routerSubscription) {
            this.routerSubscription.unsubscribe();
        }
        if (this.paragraphsSubscription) {
            this.paragraphsSubscription.unsubscribe();
        }
        if (this.scrollSubscription) {
            this.scrollSubscription();
        }
    };
    AvlLongPageComponent.ctorParameters = function () { return [
        { type: Router },
        { type: Renderer2 },
        { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
    ]; };
    __decorate([
        ContentChildren(AvlParagraphDirective),
        __metadata("design:type", QueryList)
    ], AvlLongPageComponent.prototype, "paragraphs", void 0);
    AvlLongPageComponent = __decorate([
        Component({
            selector: 'avl-long-page',
            template: "<ng-content></ng-content>",
            encapsulation: ViewEncapsulation.None,
            styles: [":host{font-family:var(--avl-font-family)}"]
        }),
        __param(2, Inject(PLATFORM_ID)),
        __metadata("design:paramtypes", [Router, Renderer2, Object])
    ], AvlLongPageComponent);
    return AvlLongPageComponent;
}());
export { AvlLongPageComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXZsLWxvbmctcGFnZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYXZsLW5nLWNvbnRyb2xzL25hdmlnYXRpb24vIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9hdmwtbG9uZy1wYWdlL2F2bC1sb25nLXBhZ2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsaUJBQWlCLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBRSxhQUFhLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25KLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFeEQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFcEQ7Ozs7RUFJRTtBQVNGO0lBbUJFOztNQUVFO0lBQ0YsOEJBQW9CLE1BQWMsRUFBVSxRQUFtQixFQUErQixVQUFrQjtRQUFoSCxpQkFDQztRQURtQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUErQixlQUFVLEdBQVYsVUFBVSxDQUFRO1FBZ0J4RyxtQkFBYyxHQUFHLFVBQUMsS0FBYztZQUN0QyxJQUFJLFlBQW1DLENBQUM7WUFDeEMsSUFBSSxLQUFJLENBQUMsZUFBZSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUksQ0FBQyxlQUFlLENBQUMsU0FBUyxHQUFHLEtBQUksQ0FBQyxlQUFlLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxNQUFNLENBQUMsRUFBRTtnQkFDeEksWUFBWSxHQUFHLEtBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDO2FBQ3JDO2lCQUFNO2dCQUNMLEtBQUksQ0FBQyxVQUFV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Q0FBQztTQUMzQztRQUNELElBQUksSUFBSSxDQUFDLGtCQUFrQixFQUFFO1lBQzNCLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1NBQzNCO0lBQ0gsQ0FBQzs7Z0JBekUyQixNQUFNO2dCQUFvQixTQUFTO2dCQUEyQyxNQUFNLHVCQUE5QyxNQUFNLFNBQUMsV0FBVzs7SUFWNUM7UUFBdkMsZUFBZSxDQUFDLHFCQUFxQixDQUFDO2tDQUFxQixTQUFTOzREQUF3QjtJQVpsRixvQkFBb0I7UUFSaEMsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLGVBQWU7WUFDekIscUNBQTZDO1lBSTdDLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJOztTQUN0QyxDQUFDO1FBdUJrRSxXQUFBLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQTt5Q0FBekQsTUFBTSxFQUFvQixTQUFTLEVBQTJDLE1BQU07T0F0QnJHLG9CQUFvQixDQWdHaEM7SUFBRCwyQkFBQztDQUFBLEFBaEdELElBZ0dDO1NBaEdZLG9CQUFvQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgVmlld0VuY2Fwc3VsYXRpb24sIENvbnRlbnRDaGlsZHJlbiwgUXVlcnlMaXN0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3ksIFJlbmRlcmVyMiwgSW5qZWN0LCBQTEFURk9STV9JRCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBBdmxQYXJhZ3JhcGhEaXJlY3RpdmUgfSBmcm9tICcuL2F2bC1wYXJhZ3JhcGguZGlyZWN0aXZlJztcclxuaW1wb3J0IHsgUm91dGVyLCBOYXZpZ2F0aW9uRW5kIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcclxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGlzUGxhdGZvcm1Ccm93c2VyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuXHJcbi8qKlxyXG4qIGF2bC1sb25nLXBhZ2Ugc2hvdWxkIG9ubHkgYmUgdXNlZCBpbnNpZGUgYXZsLWFwcC1sYXlvdXQuIFRoZSBvbmx5IHNjcm9sbGFibGUgY29udGFpbmVyIHNob3VsZFxyXG4qIGJlIGF2bC1hcHAtbGF5b3V0IChhbHJlYWR5IHNldCBieSBkZWZhdWx0KSBhbmQgYXZsLWxvbmctcGFnZSBhbmQgY29tcG9uZW50cyB0aGF0IGFyZSB1c2luZyBpdCBtdXN0XHJcbiogbm90IHNjcm9sbCBpbiBvcmRlciBmb3IgYXZsLWxvbmctcGFnZSB0byB3b3JrIHByb3Blcmx5LlxyXG4qL1xyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2F2bC1sb25nLXBhZ2UnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9hdmwtbG9uZy1wYWdlLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFtcclxuICAgICcuL2F2bC1sb25nLXBhZ2UuY29tcG9uZW50LmNzcydcclxuICBdLFxyXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcclxufSlcclxuZXhwb3J0IGNsYXNzIEF2bExvbmdQYWdlQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcclxuICAvKipcclxuICpcclxuICogIyMjIFN0eWxpbmdcclxuICogVGhlIGZvbGxvd2luZyBjdXN0b20gcHJvcGVydGllcyBhcmUgYXZhaWxhYmxlIGZvciBzdHlsaW5nOlxyXG4gKlxyXG4gKiBDdXN0b20gcHJvcGVydHkgICAgICAgICAgICAgICAgICAgICAgICAgIHwgRGVzY3JpcHRpb24gICAgICAgICAgICAgICAgICAgICAgICAgfCBEZWZhdWx0XHJcbiAqIDotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tfDotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS18Oi0tLS0tLS0tLS0tXHJcbiAqXHJcbiAqL1xyXG4gIF9zdHlsaW5nOiBhbnk7XHJcblxyXG4gIEBDb250ZW50Q2hpbGRyZW4oQXZsUGFyYWdyYXBoRGlyZWN0aXZlKSBwcml2YXRlIHBhcmFncmFwaHM6IFF1ZXJ5TGlzdDxBdmxQYXJhZ3JhcGhEaXJlY3RpdmU+O1xyXG4gIHByaXZhdGUgY3VycmVudEZyYWdtZW50OiBzdHJpbmc7XHJcbiAgcHJpdmF0ZSBzY3JvbGxDb250YWluZXI6IEhUTUxFbGVtZW50O1xyXG4gIHByaXZhdGUgcm91dGVyU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcbiAgcHJpdmF0ZSBwYXJhZ3JhcGhzU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcbiAgcHJpdmF0ZSBzY3JvbGxTdWJzY3JpcHRpb246ICgpID0+IHZvaWQ7XHJcblxyXG4gIC8qKlxyXG4gICogQGhpZGRlblxyXG4gICovXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByb3V0ZXI6IFJvdXRlciwgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLCBASW5qZWN0KFBMQVRGT1JNX0lEKSBwcml2YXRlIHBsYXRmb3JtSWQ6IE9iamVjdCkge1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYW5kbGVSb3V0ZUNoYW5nZSgpIHtcclxuICAgIGNvbnN0IHBhcmFncmFwaE5hbWUgPSB0aGlzLnJvdXRlci5wYXJzZVVybCh0aGlzLnJvdXRlci51cmwpLmZyYWdtZW50O1xyXG4gICAgY29uc3QgcGFyYWdyYXBoID0gdGhpcy5wYXJhZ3JhcGhzLmZpbmQocCA9PiBwLnBhcmFncmFwaE5hbWUgPT09IHBhcmFncmFwaE5hbWUpO1xyXG4gICAgaWYgKHRoaXMuY3VycmVudEZyYWdtZW50ID09PSBwYXJhZ3JhcGhOYW1lKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChwYXJhZ3JhcGgpIHtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PlxyXG4gICAgICAgIHBhcmFncmFwaC5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsSW50b1ZpZXcoeyBiZWhhdmlvcjogJ2luc3RhbnQnLCBibG9jazogJ3N0YXJ0JywgaW5saW5lOiAnbmVhcmVzdCcgfSlcclxuICAgICAgICAsIDApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzY3JvbGxMaXN0ZW5lciA9IChldmVudDogVUlFdmVudCkgPT4ge1xyXG4gICAgbGV0IG5ld1BhcmFncmFwaDogQXZsUGFyYWdyYXBoRGlyZWN0aXZlO1xyXG4gICAgaWYgKHRoaXMuc2Nyb2xsQ29udGFpbmVyLnNjcm9sbEhlaWdodCA8IE1hdGgucm91bmQodGhpcy5zY3JvbGxDb250YWluZXIuc2Nyb2xsVG9wICsgdGhpcy5zY3JvbGxDb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0KSkge1xyXG4gICAgICBuZXdQYXJhZ3JhcGggPSB0aGlzLnBhcmFncmFwaHMubGFzdDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMucGFyYWdyYXBocy5mb3JFYWNoKHBhcmFncmFwaCA9PiB7XHJcbiAgICAgICAgY29uc3QgcCA9IHBhcmFncmFwaC5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgICAgY29uc3QgcmVjdCA9IHAuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgaWYgKHJlY3QudG9wIDwgd2luZG93LmlubmVySGVpZ2h0ICogMC4xKSB7XHJcbiAgICAgICAgICBuZXdQYXJhZ3JhcGggPSBwYXJhZ3JhcGg7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIGlmIChuZXdQYXJhZ3JhcGgpIHtcclxuICAgICAgdGhpcy5jdXJyZW50RnJhZ21lbnQgPSBuZXdQYXJhZ3JhcGgucGFyYWdyYXBoTmFtZTtcclxuICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoW10sIHsgcXVlcnlQYXJhbXNIYW5kbGluZzogJ3ByZXNlcnZlJywgZnJhZ21lbnQ6IG5ld1BhcmFncmFwaC5wYXJhZ3JhcGhOYW1lIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBAaGlkZGVuXHJcbiAgKi9cclxuICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybUlkKSkge1xyXG4gICAgICB0aGlzLnNjcm9sbENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2F2bC1hcHAtbGF5b3V0IG1haW4nKSBhcyBIVE1MRWxlbWVudDtcclxuICAgICAgdGhpcy5zY3JvbGxTdWJzY3JpcHRpb24gPSB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLnNjcm9sbENvbnRhaW5lciwgJ3Njcm9sbCcsIHRoaXMuc2Nyb2xsTGlzdGVuZXIpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5oYW5kbGVSb3V0ZUNoYW5nZSgpO1xyXG4gICAgdGhpcy5yb3V0ZXJTdWJzY3JpcHRpb24gPSB0aGlzLnJvdXRlci5ldmVudHMuc3Vic2NyaWJlKG5ld1JvdXRlID0+IHtcclxuICAgICAgaWYgKG5ld1JvdXRlIGluc3RhbmNlb2YgTmF2aWdhdGlvbkVuZCkge1xyXG4gICAgICAgIHRoaXMuaGFuZGxlUm91dGVDaGFuZ2UoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLnBhcmFncmFwaHNTdWJzY3JpcHRpb24gPSB0aGlzLnBhcmFncmFwaHMuY2hhbmdlcy5zdWJzY3JpYmUoXyA9PiB7XHJcbiAgICAgIC8qIGlmIHNjcm9sbEludG9WaWV3IGhhcyBub3Qgb2NjdXJlZCB5ZXQgdHJ5IGl0IHdpdGggbmV3IHBhcmFncmFwaHNcclxuICAgICAgICAgdGhpcyBpcyBuZWVkZWQgZm9yIGNvbXBvbmVudHMgd2hpY2ggcmVuZGVyIGNvbnRlbnQgKHBhcmFncmFwaHMpXHJcbiAgICAgICAgIGFmdGVyIHZpZXcgaGFzIGJlZW4gaW5pdGlhbGl6ZWRcclxuICAgICAgKi9cclxuICAgICAgaWYgKCF0aGlzLmN1cnJlbnRGcmFnbWVudCkge1xyXG4gICAgICAgIHRoaXMuaGFuZGxlUm91dGVDaGFuZ2UoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIEBoaWRkZW5cclxuICAqL1xyXG4gIG5nT25EZXN0cm95KCkge1xyXG4gICAgaWYgKHRoaXMucm91dGVyU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgIHRoaXMucm91dGVyU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5wYXJhZ3JhcGhzU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgIHRoaXMucGFyYWdyYXBoc1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuc2Nyb2xsU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgIHRoaXMuc2Nyb2xsU3Vic2NyaXB0aW9uKCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==