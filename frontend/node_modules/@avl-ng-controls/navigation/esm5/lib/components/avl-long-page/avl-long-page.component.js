import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/router';

var _c0 = ["*"];
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
import { Component, ViewEncapsulation, ContentChildren, QueryList, AfterViewInit, OnDestroy, Renderer2, Inject, PLATFORM_ID } from '@angular/core';
import { AvlParagraphDirective } from './avl-paragraph.directive';
import { Router, NavigationEnd } from '@angular/router';
import { isPlatformBrowser } from '@angular/common';
/**
* avl-long-page should only be used inside avl-app-layout. The only scrollable container should
* be avl-app-layout (already set by default) and avl-long-page and components that are using it must
* not scroll in order for avl-long-page to work properly.
*/
var AvlLongPageComponent = /** @class */ (function () {
    /**
    * @hidden
    */
    function AvlLongPageComponent(router, renderer, platformId) {
        var _this = this;
        this.router = router;
        this.renderer = renderer;
        this.platformId = platformId;
        this.scrollListener = function (event) {
            var newParagraph;
            if (_this.scrollContainer.scrollHeight < Math.round(_this.scrollContainer.scrollTop + _this.scrollContainer.getBoundingClientRect().height)) {
                newParagraph = _this.paragraphs.last;
            }
            else {
                _this.paragraphs.forEach(function (paragraph) {
                    var p = paragraph.elementRef.nativeElement;
                    var rect = p.getBoundingClientRect();
                    if (rect.top < window.innerHeight * 0.1) {
                        newParagraph = paragraph;
                    }
                });
            }
            if (newParagraph) {
                _this.currentFragment = newParagraph.paragraphName;
                _this.router.navigate([], { queryParamsHandling: 'preserve', fragment: newParagraph.paragraphName });
            }
        };
    }
    AvlLongPageComponent.prototype.handleRouteChange = function () {
        var paragraphName = this.router.parseUrl(this.router.url).fragment;
        var paragraph = this.paragraphs.find(function (p) { return p.paragraphName === paragraphName; });
        if (this.currentFragment === paragraphName) {
            return;
        }
        if (paragraph) {
            setTimeout(function () {
                return paragraph.elementRef.nativeElement.scrollIntoView({ behavior: 'instant', block: 'start', inline: 'nearest' });
            }, 0);
        }
    };
    /**
    * @hidden
    */
    AvlLongPageComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        if (isPlatformBrowser(this.platformId)) {
            this.scrollContainer = document.querySelector('avl-app-layout main');
            this.scrollSubscription = this.renderer.listen(this.scrollContainer, 'scroll', this.scrollListener);
        }
        this.handleRouteChange();
        this.routerSubscription = this.router.events.subscribe(function (newRoute) {
            if (newRoute instanceof NavigationEnd) {
                _this.handleRouteChange();
            }
        });
        this.paragraphsSubscription = this.paragraphs.changes.subscribe(function (_) {
            /* if scrollIntoView has not occured yet try it with new paragraphs
               this is needed for components which render content (paragraphs)
               after view has been initialized
            */
            if (!_this.currentFragment) {
                _this.handleRouteChange();
            }
        });
    };
    /**
    * @hidden
    */
    AvlLongPageComponent.prototype.ngOnDestroy = function () {
        if (this.routerSubscription) {
            this.routerSubscription.unsubscribe();
        }
        if (this.paragraphsSubscription) {
            this.paragraphsSubscription.unsubscribe();
        }
        if (this.scrollSubscription) {
            this.scrollSubscription();
        }
    };
    AvlLongPageComponent.ctorParameters = function () { return [
        { type: Router },
        { type: Renderer2 },
        { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
    ]; };
    __decorate([
        ContentChildren(AvlParagraphDirective),
        __metadata("design:type", QueryList)
    ], AvlLongPageComponent.prototype, "paragraphs", void 0);
    AvlLongPageComponent = __decorate([ __param(2, Inject(PLATFORM_ID)),
        __metadata("design:paramtypes", [Router, Renderer2, Object])
    ], AvlLongPageComponent);
AvlLongPageComponent.ɵfac = function AvlLongPageComponent_Factory(t) { return new (t || AvlLongPageComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.Router), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(PLATFORM_ID)); };
AvlLongPageComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: AvlLongPageComponent, selectors: [["avl-long-page"]], contentQueries: function AvlLongPageComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, AvlParagraphDirective, false);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.paragraphs = _t);
    } }, ngContentSelectors: _c0, decls: 1, vars: 0, template: function AvlLongPageComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵprojection(0);
    } }, styles: [":host{font-family:var(--avl-font-family)}"], encapsulation: 2 });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(AvlLongPageComponent, [{
        type: Component,
        args: [{
                selector: 'avl-long-page',
                template: "<ng-content></ng-content>",
                encapsulation: ViewEncapsulation.None,
                styles: [":host{font-family:var(--avl-font-family)}"]
            }]
    }], function () { return [{ type: ɵngcc1.Router }, { type: ɵngcc0.Renderer2 }, { type: Object, decorators: [{
                type: Inject,
                args: [PLATFORM_ID]
            }] }]; }, { paragraphs: [{
            type: ContentChildren,
            args: [AvlParagraphDirective]
        }] }); })();
    return AvlLongPageComponent;
}());
export { AvlLongPageComponent };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXZsLWxvbmctcGFnZS5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIm5nOi9AYXZsLW5nLWNvbnRyb2xzL25hdmlnYXRpb24vbGliL2NvbXBvbmVudHMvYXZsLWxvbmctcGFnZS9hdmwtbG9uZy1wYWdlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxlQUFlLEVBQUUsU0FBUyxFQUFFLGFBQWEsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkosT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDbEUsT0FBTyxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUV4RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUVwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFTRjtBQUF3RCxJQW1CdEQ7QUFDRjtBQUNFLE1BQUU7QUFDSixJQUFFLDhCQUFvQixNQUFjLEVBQVUsUUFBbUIsRUFBK0IsVUFBa0I7QUFDbEgsUUFERSxpQkFDQztBQUNILFFBRnNCLFdBQU0sR0FBTixNQUFNLENBQVE7QUFBQyxRQUFTLGFBQVEsR0FBUixRQUFRLENBQVc7QUFBQyxRQUE4QixlQUFVLEdBQVYsVUFBVSxDQUFRO0FBQUMsUUFnQnpHLG1CQUFjLEdBQUcsVUFBQyxLQUFjO0FBQUksWUFDMUMsSUFBSSxZQUFtQyxDQUFDO0FBQzVDLFlBQUksSUFBSSxLQUFJLENBQUMsZUFBZSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUksQ0FBQyxlQUFlLENBQUMsU0FBUyxHQUFHLEtBQUksQ0FBQyxlQUFlLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxNQUFNLENBQUMsRUFBRTtBQUM5SSxnQkFBTSxZQUFZLEdB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b0JBa0dGO0FBQUMsSUFERCwyQkFBQztBQUNBLENBREEsQUFoR0QsSUFnR0M7O0FBbkhBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUlBLEFBU0EsQUFtQkEsQUFFQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQURBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQWdCQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFoQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQXFCQSxBQUVBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFvQkEsQUFuQkEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUdBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBRUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUF6RUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFWQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFaQSxBQUFBLEFBUkEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBSUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQXVCQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQXRCQSxBQUFBLEFBZ0dBLEFBQUEsQUFBQSxBQUFBLEFBaEdBLEFBZ0dBLEFBaEdBLEFBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIFZpZXdFbmNhcHN1bGF0aW9uLCBDb250ZW50Q2hpbGRyZW4sIFF1ZXJ5TGlzdCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95LCBSZW5kZXJlcjIsIEluamVjdCwgUExBVEZPUk1fSUQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQXZsUGFyYWdyYXBoRGlyZWN0aXZlIH0gZnJvbSAnLi9hdmwtcGFyYWdyYXBoLmRpcmVjdGl2ZSc7XHJcbmltcG9ydCB7IFJvdXRlciwgTmF2aWdhdGlvbkVuZCB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBpc1BsYXRmb3JtQnJvd3NlciB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcblxyXG4vKipcclxuKiBhdmwtbG9uZy1wYWdlIHNob3VsZCBvbmx5IGJlIHVzZWQgaW5zaWRlIGF2bC1hcHAtbGF5b3V0LiBUaGUgb25seSBzY3JvbGxhYmxlIGNvbnRhaW5lciBzaG91bGRcclxuKiBiZSBhdmwtYXBwLWxheW91dCAoYWxyZWFkeSBzZXQgYnkgZGVmYXVsdCkgYW5kIGF2bC1sb25nLXBhZ2UgYW5kIGNvbXBvbmVudHMgdGhhdCBhcmUgdXNpbmcgaXQgbXVzdFxyXG4qIG5vdCBzY3JvbGwgaW4gb3JkZXIgZm9yIGF2bC1sb25nLXBhZ2UgdG8gd29yayBwcm9wZXJseS5cclxuKi9cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdhdmwtbG9uZy1wYWdlJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vYXZsLWxvbmctcGFnZS5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbXHJcbiAgICAnLi9hdmwtbG9uZy1wYWdlLmNvbXBvbmVudC5jc3MnXHJcbiAgXSxcclxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBBdmxMb25nUGFnZUNvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XHJcbiAgLyoqXHJcbiAqXHJcbiAqICMjIyBTdHlsaW5nXHJcbiAqIFRoZSBmb2xsb3dpbmcgY3VzdG9tIHByb3BlcnRpZXMgYXJlIGF2YWlsYWJsZSBmb3Igc3R5bGluZzpcclxuICpcclxuICogQ3VzdG9tIHByb3BlcnR5ICAgICAgICAgICAgICAgICAgICAgICAgICB8IERlc2NyaXB0aW9uICAgICAgICAgICAgICAgICAgICAgICAgIHwgRGVmYXVsdFxyXG4gKiA6LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLXw6LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tfDotLS0tLS0tLS0tLVxyXG4gKlxyXG4gKi9cclxuICBfc3R5bGluZzogYW55O1xyXG5cclxuICBAQ29udGVudENoaWxkcmVuKEF2bFBhcmFncmFwaERpcmVjdGl2ZSkgcHJpdmF0ZSBwYXJhZ3JhcGhzOiBRdWVyeUxpc3Q8QXZsUGFyYWdyYXBoRGlyZWN0aXZlPjtcclxuICBwcml2YXRlIGN1cnJlbnRGcmFnbWVudDogc3RyaW5nO1xyXG4gIHByaXZhdGUgc2Nyb2xsQ29udGFpbmVyOiBIVE1MRWxlbWVudDtcclxuICBwcml2YXRlIHJvdXRlclN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG4gIHByaXZhdGUgcGFyYWdyYXBoc1N1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG4gIHByaXZhdGUgc2Nyb2xsU3Vic2NyaXB0aW9uOiAoKSA9PiB2b2lkO1xyXG5cclxuICAvKipcclxuICAqIEBoaWRkZW5cclxuICAqL1xyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMiwgQEluamVjdChQTEFURk9STV9JRCkgcHJpdmF0ZSBwbGF0Zm9ybUlkOiBPYmplY3QpIHtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlUm91dGVDaGFuZ2UoKSB7XHJcbiAgICBjb25zdCBwYXJhZ3JhcGhOYW1lID0gdGhpcy5yb3V0ZXIucGFyc2VVcmwodGhpcy5yb3V0ZXIudXJsKS5mcmFnbWVudDtcclxuICAgIGNvbnN0IHBhcmFncmFwaCA9IHRoaXMucGFyYWdyYXBocy5maW5kKHAgPT4gcC5wYXJhZ3JhcGhOYW1lID09PSBwYXJhZ3JhcGhOYW1lKTtcclxuICAgIGlmICh0aGlzLmN1cnJlbnRGcmFnbWVudCA9PT0gcGFyYWdyYXBoTmFtZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAocGFyYWdyYXBoKSB7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT5cclxuICAgICAgICBwYXJhZ3JhcGguZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnNjcm9sbEludG9WaWV3KHsgYmVoYXZpb3I6ICdpbnN0YW50JywgYmxvY2s6ICdzdGFydCcsIGlubGluZTogJ25lYXJlc3QnIH0pXHJcbiAgICAgICAgLCAwKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2Nyb2xsTGlzdGVuZXIgPSAoZXZlbnQ6IFVJRXZlbnQpID0+IHtcclxuICAgIGxldCBuZXdQYXJhZ3JhcGg6IEF2bFBhcmFncmFwaERpcmVjdGl2ZTtcclxuICAgIGlmICh0aGlzLnNjcm9sbENvbnRhaW5lci5zY3JvbGxIZWlnaHQgPCBNYXRoLnJvdW5kKHRoaXMuc2Nyb2xsQ29udGFpbmVyLnNjcm9sbFRvcCArIHRoaXMuc2Nyb2xsQ29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCkpIHtcclxuICAgICAgbmV3UGFyYWdyYXBoID0gdGhpcy5wYXJhZ3JhcGhzLmxhc3Q7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnBhcmFncmFwaHMuZm9yRWFjaChwYXJhZ3JhcGggPT4ge1xyXG4gICAgICAgIGNvbnN0IHAgPSBwYXJhZ3JhcGguZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50IGFzIEhUTUxFbGVtZW50O1xyXG4gICAgICAgIGNvbnN0IHJlY3QgPSBwLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgIGlmIChyZWN0LnRvcCA8IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuMSkge1xyXG4gICAgICAgICAgbmV3UGFyYWdyYXBoID0gcGFyYWdyYXBoO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBpZiAobmV3UGFyYWdyYXBoKSB7XHJcbiAgICAgIHRoaXMuY3VycmVudEZyYWdtZW50ID0gbmV3UGFyYWdyYXBoLnBhcmFncmFwaE5hbWU7XHJcbiAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFtdLCB7IHF1ZXJ5UGFyYW1zSGFuZGxpbmc6ICdwcmVzZXJ2ZScsIGZyYWdtZW50OiBuZXdQYXJhZ3JhcGgucGFyYWdyYXBoTmFtZSB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICogQGhpZGRlblxyXG4gICovXHJcbiAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgaWYgKGlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm1JZCkpIHtcclxuICAgICAgdGhpcy5zY3JvbGxDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdhdmwtYXBwLWxheW91dCBtYWluJykgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgIHRoaXMuc2Nyb2xsU3Vic2NyaXB0aW9uID0gdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy5zY3JvbGxDb250YWluZXIsICdzY3JvbGwnLCB0aGlzLnNjcm9sbExpc3RlbmVyKTtcclxuICAgIH1cclxuICAgIHRoaXMuaGFuZGxlUm91dGVDaGFuZ2UoKTtcclxuICAgIHRoaXMucm91dGVyU3Vic2NyaXB0aW9uID0gdGhpcy5yb3V0ZXIuZXZlbnRzLnN1YnNjcmliZShuZXdSb3V0ZSA9PiB7XHJcbiAgICAgIGlmIChuZXdSb3V0ZSBpbnN0YW5jZW9mIE5hdmlnYXRpb25FbmQpIHtcclxuICAgICAgICB0aGlzLmhhbmRsZVJvdXRlQ2hhbmdlKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgdGhpcy5wYXJhZ3JhcGhzU3Vic2NyaXB0aW9uID0gdGhpcy5wYXJhZ3JhcGhzLmNoYW5nZXMuc3Vic2NyaWJlKF8gPT4ge1xyXG4gICAgICAvKiBpZiBzY3JvbGxJbnRvVmlldyBoYXMgbm90IG9jY3VyZWQgeWV0IHRyeSBpdCB3aXRoIG5ldyBwYXJhZ3JhcGhzXHJcbiAgICAgICAgIHRoaXMgaXMgbmVlZGVkIGZvciBjb21wb25lbnRzIHdoaWNoIHJlbmRlciBjb250ZW50IChwYXJhZ3JhcGhzKVxyXG4gICAgICAgICBhZnRlciB2aWV3IGhhcyBiZWVuIGluaXRpYWxpemVkXHJcbiAgICAgICovXHJcbiAgICAgIGlmICghdGhpcy5jdXJyZW50RnJhZ21lbnQpIHtcclxuICAgICAgICB0aGlzLmhhbmRsZVJvdXRlQ2hhbmdlKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBAaGlkZGVuXHJcbiAgKi9cclxuICBuZ09uRGVzdHJveSgpIHtcclxuICAgIGlmICh0aGlzLnJvdXRlclN1YnNjcmlwdGlvbikge1xyXG4gICAgICB0aGlzLnJvdXRlclN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMucGFyYWdyYXBoc1N1YnNjcmlwdGlvbikge1xyXG4gICAgICB0aGlzLnBhcmFncmFwaHNTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnNjcm9sbFN1YnNjcmlwdGlvbikge1xyXG4gICAgICB0aGlzLnNjcm9sbFN1YnNjcmlwdGlvbigpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=