var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
import { Component, ElementRef, Input, Output, EventEmitter, ViewChild, ViewEncapsulation, ContentChild, TemplateRef, HostBinding, HostListener } from '@angular/core';
import { ConfigurableFocusTrapFactory } from '@angular/cdk/a11y';
import { NgForm } from '@angular/forms';
var AvlDialogComponent = /** @class */ (function () {
    function AvlDialogComponent(focusTrap) {
        this.focusTrap = focusTrap;
        this._open = false;
        this._dirty = false;
        this._warningOnClose = false;
        this._warningHeaderText = '';
        this._warningDialogText = '';
        this.openWarning = false;
        /**
         * If true, the dialog can be closed by clicking on scrim
         */
        this.closeOnScrimClick = true;
        /**
         * If true, new dialog can open inside a dialog
         */
        this.complex = false;
        /**
         * When checked, dialog opens in fullscreen mode
         */
        this.fullscreen = false;
        this.openChange = new EventEmitter();
    }
    Object.defineProperty(AvlDialogComponent.prototype, "warningHeaderText", {
        /**
         * Sets the text for warning dialog header.
         */
        get: function () {
            return this._warningHeaderText;
        },
        set: function (value) {
            if (this._warningHeaderText !== value) {
                this._warningHeaderText = value;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AvlDialogComponent.prototype, "warningDialogText", {
        /**
         * Sets the main warning dialog text.
         */
        get: function () {
            return this._warningDialogText;
        },
        set: function (value) {
            if (this._warningDialogText !== value) {
                this._warningDialogText = value;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AvlDialogComponent.prototype, "open", {
        /**
         * Can be set to open or close the dialog.
         * Returns the current state of the dialog.
         */
        get: function () {
            return this._open;
        },
        set: function (value) {
            if (this._open !== value) {
                this._open = !!value;
                this.openChange.emit(this._open);
                this.focusTrap.create(this.element.nativeElement).focusFirstTabbableElementWhenReady();
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AvlDialogComponent.prototype, "dirty", {
        /**
         * Indicates if the form has been touched.
         * Returns the current value of the attribute.
         */
        get: function () {
            return !!this._dirty;
        },
        set: function (value) {
            if (this._dirty !== value) {
                this._dirty = !!value;
                this.focusTrap.create(this.element.nativeElement).focusFirstTabbableElementWhenReady();
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AvlDialogComponent.prototype, "warningOnClose", {
        /**
         * Can be set to indicate if the warning dialog should be opened.
         * Returns the current value of the attribute.
         */
        get: function () {
            return !!this._warningOnClose;
        },
        set: function (value) {
            if (this._warningOnClose !== value) {
                this._warningOnClose = !!value;
                this.focusTrap.create(this.element.nativeElement).focusFirstTabbableElementWhenReady();
            }
        },
        enumerable: true,
        configurable: true
    });
    /** @hidden */
    AvlDialogComponent.prototype.close = function (event) {
        var target = event.target;
        if (this.closeOnScrimClick && target.classList.contains('scrim')) {
            if (this.warningOnClose) {
                if (this.openWarning === false) {
                    this.openWarning = true;
                }
            }
            else {
                if (this.dirty === true) {
                    this.openWarning = true;
                }
                else {
                    this.open = false;
                }
            }
        }
    };
    /**
     * Opens a dialog.
     */
    AvlDialogComponent.prototype.openDialog = function () {
        this.open = true;
    };
    /**
     * Closes a dialog.
     */
    AvlDialogComponent.prototype.closeDialog = function () {
        if (this.warningOnClose || this.dirty) {
            this.openWarning = !this.openWarning;
        }
        else {
            this.open = false;
        }
    };
    /**
     * Closes all dialogs.
     */
    AvlDialogComponent.prototype.closeAllDialogs = function () {
        this.openWarning = false;
        this.open = false;
        this.dirty = false;
    };
    /**
     * Opens a warning dialog.
     */
    AvlDialogComponent.prototype.openWarningDialog = function () {
        this.openWarning = true;
    };
    /**
     * Closes a warning dialog.
     */
    AvlDialogComponent.prototype.closeWarningDialog = function () {
        this.openWarning = false;
    };
    /** @hidden */
    AvlDialogComponent.prototype.keyEvent = function (event) {
        if (event.key === 'Esc' || event.key === 'Escape') {
            this.closeDialog();
        }
    };
    Object.defineProperty(AvlDialogComponent.prototype, "openedClosed", {
        /** @hidden */
        get: function () {
            return this._open;
        },
        enumerable: true,
        configurable: true
    });
    /** @hidden */
    AvlDialogComponent.prototype.ngOnInit = function () {
        if (this.complex != null && this.complex !== false) {
            this.complex = true;
        }
    };
    AvlDialogComponent.ctorParameters = function () { return [
        { type: ConfigurableFocusTrapFactory }
    ]; };
    __decorate([
        ContentChild(TemplateRef),
        __metadata("design:type", TemplateRef)
    ], AvlDialogComponent.prototype, "content", void 0);
    __decorate([
        ViewChild('element', { static: true }),
        __metadata("design:type", ElementRef)
    ], AvlDialogComponent.prototype, "element", void 0);
    __decorate([
        ViewChild('optionForm', { read: NgForm }),
        __metadata("design:type", Object)
    ], AvlDialogComponent.prototype, "optionForm", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], AvlDialogComponent.prototype, "closeOnScrimClick", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], AvlDialogComponent.prototype, "complex", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String),
        __metadata("design:paramtypes", [String])
    ], AvlDialogComponent.prototype, "warningHeaderText", null);
    __decorate([
        Input(),
        __metadata("design:type", String),
        __metadata("design:paramtypes", [String])
    ], AvlDialogComponent.prototype, "warningDialogText", null);
    __decorate([
        HostBinding('class.fullscreen'),
        Input(),
        __metadata("design:type", Object)
    ], AvlDialogComponent.prototype, "fullscreen", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Boolean),
        __metadata("design:paramtypes", [Boolean])
    ], AvlDialogComponent.prototype, "open", null);
    __decorate([
        Input(),
        __metadata("design:type", Boolean),
        __metadata("design:paramtypes", [Boolean])
    ], AvlDialogComponent.prototype, "dirty", null);
    __decorate([
        Input(),
        __metadata("design:type", Boolean),
        __metadata("design:paramtypes", [Boolean])
    ], AvlDialogComponent.prototype, "warningOnClose", null);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], AvlDialogComponent.prototype, "openChange", void 0);
    __decorate([
        HostListener('keydown', ['$event']),
        __metadata("design:type", Function),
        __metadata("design:paramtypes", [KeyboardEvent]),
        __metadata("design:returntype", void 0)
    ], AvlDialogComponent.prototype, "keyEvent", null);
    __decorate([
        HostBinding('class.opened'),
        __metadata("design:type", Object),
        __metadata("design:paramtypes", [])
    ], AvlDialogComponent.prototype, "openedClosed", null);
    AvlDialogComponent = __decorate([
        Component({
            selector: 'avl-dialog',
            template: "<div class=\"scrim\" (click)=\"close($event)\">\r\n  <div #element class=\"dialog\" [class.complex]=\"complex\" tabindex=\"0\">\r\n    <div *ngIf=\"open; then content\"></div>\r\n  </div>\r\n\r\n  <div *ngIf=\"openWarning\" #element class=\"dialog warning-dialog\" [class.complex]=\"complex\" tabindex=\"0\">\r\n    <avl-dialog-header>\r\n      {{ warningHeaderText || 'Warning Header' }}\r\n    </avl-dialog-header>\r\n    <avl-dialog-content class=\"warning\">\r\n      <section class=\"supporting-text\">\r\n        <div class=\"column\">\r\n          <avl-icon icon=\"icons:warning\"></avl-icon>\r\n        </div>\r\n        <div class=\"column\">\r\n          <h3>All changes will be lost if you proceed without saving.</h3>\r\n          <p id=\"customText\">{{ warningDialogText }}</p>\r\n        </div>\r\n      </section>\r\n      <section class=\"warning-buttons\">\r\n        <avl-button contained (click)=\"closeAllDialogs()\">Proceed</avl-button>\r\n        <avl-button (click)=\"closeWarningDialog()\">Cancel</avl-button>\r\n      </section>\r\n    </avl-dialog-content>\r\n  </div>\r\n</div>\r\n",
            encapsulation: ViewEncapsulation.Emulated,
            styles: [":host(){font-family:var(--avl-font-family);--avl-dialog-background-color:var(--avl-background-color);--avl-dialog-header-title-color:var(--avl-foreground-color);--avl-dialog-text-color:var(--avl-emphasis-medium-color);--avl-dialog-close-icon-color:var(--avl-icon-default-color);--avl-dialog-separator-color:var(--avl-divider-color);--avl-dialog-close-icon-ink-pressed-color:var(--avl-ink-default-pressed-color);--avl-dialog-close-icon-ink-focus-color:var(--avl-ink-default-focus-color);--avl-dialog-close-icon-ink-hover-color:var(--avl-ink-default-hover-color);display:none}.supporting-text{display:flex}.column{display:flex;flex-direction:column;flex-wrap:nowrap;align-items:flex-start}.supporting-text p#customText{margin-top:-6px;margin-bottom:11px}.supporting-text h3{font-size:16px;margin-top:7px;font-weight:700}form{margin-bottom:24px;margin-left:24px}.supporting-text avl-icon{width:40px;height:40px;margin-right:15px;margin-top:6px;flex-shrink:0;--avl-icon-custom-color:var(--avl-warning-color)}.warning-buttons{display:flex;justify-content:flex-end;margin-bottom:16px}.warning-buttons>avl-button{margin-top:4px}.warning-buttons>avl-button:last-child{margin-left:-7px}:host(.opened){display:block}.scrim{position:fixed;z-index:50;left:0;top:0;width:100%;height:100%;background-color:var(--avl-scrim-color);display:flex;flex-flow:column nowrap;justify-content:center;align-items:center}.dialog{box-sizing:border-box;height:calc(var(--avl-dialog-height) - 2px);outline:0;display:flex;flex-direction:column;position:absolute;width:var(--avl-dialog-width);min-width:280px;min-height:230px;max-width:calc(100vw - 96px);max-height:calc(100vh - 96px);background-color:var(--avl-dialog-background-color);color:var(--avl-dialog-text-color);box-shadow:var(--avl-box-shadow-24dp);min-width:444px}.warning-dialog{min-height:211px!important}:host(.fullscreen)>div>.dialog{width:100%;height:100%;max-width:100%;max-height:100%}"]
        }),
        __metadata("design:paramtypes", [ConfigurableFocusTrapFactory])
    ], AvlDialogComponent);
    return AvlDialogComponent;
}());
export { AvlDialogComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXZsLWRpYWxvZy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYXZsLW5nLWNvbnRyb2xzL2RpYWxvZy8iLCJzb3VyY2VzIjpbImxpYi9hdmwtZGlhbG9nL2F2bC1kaWFsb2cuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsVUFBVSxFQUNWLEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxFQUNaLFNBQVMsRUFDVCxpQkFBaUIsRUFDakIsWUFBWSxFQUNaLFdBQVcsRUFDWCxXQUFXLEVBQ1gsWUFBWSxFQUViLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQVF4QztJQXVMRSw0QkFBb0IsU0FBdUM7UUFBdkMsY0FBUyxHQUFULFNBQVMsQ0FBOEI7UUF0TG5ELFVBQUssR0FBRyxLQUFLLENBQUM7UUFDZCxXQUFNLEdBQVksS0FBSyxDQUFDO1FBQ3hCLG9CQUFlLEdBQUcsS0FBSyxDQUFDO1FBQ3hCLHVCQUFrQixHQUFHLEVBQUUsQ0FBQztRQUN4Qix1QkFBa0IsR0FBRyxFQUFFLENBQUM7UUFDekIsZ0JBQVcsR0FBRyxLQUFLLENBQUM7UUFhM0I7O1dBRUc7UUFDTSxzQkFBaUIsR0FBWSxJQUFJLENBQUM7UUFFM0M7O1dBRUc7UUFDTSxZQUFPLEdBQVksS0FBSyxDQUFDO1FBNEJsQzs7V0FFRztRQUdILGVBQVUsR0FBRyxLQUFLLENBQUM7UUFnRFQsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFXLENBQUM7SUEyRVcsQ0FBQztJQXRKL0Qsc0JBQUksaURBQWlCO1FBSnJCOztXQUVHO2FBRUg7WUFDRSxPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQztRQUNqQyxDQUFDO2FBQ0QsVUFBc0IsS0FBYTtZQUNqQyxJQUFJLElBQUksQ0FBQyxr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Q0FBQyxTQUFTLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7a0NBQVUsVUFBVTt1REFBQztJQUdqQjtRQUExQyxTQUFTLENBQUMsWUFBWSxFQUFFLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxDQUFDOzswREFBaUI7SUFLbEQ7UUFBUixLQUFLLEVBQUU7O2lFQUFtQztJQUtsQztRQUFSLEtBQUssRUFBRTs7dURBQTBCO0lBTWxDO1FBREMsS0FBSyxFQUFFOzs7K0RBR1A7SUFXRDtRQURDLEtBQUssRUFBRTs7OytEQUdQO0lBWUQ7UUFGQyxXQUFXLENBQUMsa0JBQWtCLENBQUM7UUFDL0IsS0FBSyxFQUFFOzswREFDVztJQU9uQjtRQURDLEtBQUssRUFBRTs7O2tEQUdQO0lBY0Q7UUFEQyxLQUFLLEVBQUU7OzttREFHUDtJQWFEO1FBREMsS0FBSyxFQUFFOzs7NERBR1A7SUFRUztRQUFULE1BQU0sRUFBRTs7MERBQTBDO0lBK0RuRDtRQURDLFlBQVksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQzs7eUNBQ3BCLGFBQWE7O3NEQUk1QjtJQUlEO1FBREMsV0FBVyxDQUFDLGNBQWMsQ0FBQzs7OzBEQUczQjtJQXJMVSxrQkFBa0I7UUFOOUIsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLFlBQVk7WUFDdEIsaW1DQUEwQztZQUUxQyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsUUFBUTs7U0FDMUMsQ0FBQzt5Q0F3TCtCLDRCQUE0QjtPQXZMaEQsa0JBQWtCLENBb045QjtJQUFELHlCQUFDO0NBQUEsQUFwTkQsSUFvTkM7U0FwTlksa0JBQWtCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBDb21wb25lbnQsXHJcbiAgRWxlbWVudFJlZixcclxuICBJbnB1dCxcclxuICBPdXRwdXQsXHJcbiAgRXZlbnRFbWl0dGVyLFxyXG4gIFZpZXdDaGlsZCxcclxuICBWaWV3RW5jYXBzdWxhdGlvbixcclxuICBDb250ZW50Q2hpbGQsXHJcbiAgVGVtcGxhdGVSZWYsXHJcbiAgSG9zdEJpbmRpbmcsXHJcbiAgSG9zdExpc3RlbmVyLFxyXG4gIE9uSW5pdFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBDb25maWd1cmFibGVGb2N1c1RyYXBGYWN0b3J5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2ExMXknO1xyXG5pbXBvcnQgeyBOZ0Zvcm0gfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2F2bC1kaWFsb2cnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9hdmwtZGlhbG9nLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9hdmwtZGlhbG9nLmNvbXBvbmVudC5jc3MnXSxcclxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5FbXVsYXRlZFxyXG59KVxyXG5leHBvcnQgY2xhc3MgQXZsRGlhbG9nQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICBwcml2YXRlIF9vcGVuID0gZmFsc2U7XHJcbiAgcHJpdmF0ZSBfZGlydHk6IGJvb2xlYW4gPSBmYWxzZTtcclxuICBwcml2YXRlIF93YXJuaW5nT25DbG9zZSA9IGZhbHNlO1xyXG4gIHByaXZhdGUgX3dhcm5pbmdIZWFkZXJUZXh0ID0gJyc7XHJcbiAgcHJpdmF0ZSBfd2FybmluZ0RpYWxvZ1RleHQgPSAnJztcclxuICBwdWJsaWMgb3Blbldhcm5pbmcgPSBmYWxzZTtcclxuXHJcbiAgLyoqXHJcbiAgICogRGlhbG9nIGNvbnRlbnRcclxuICAgKi9cclxuICBAQ29udGVudENoaWxkKFRlbXBsYXRlUmVmKSBjb250ZW50OiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG5cclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIEBWaWV3Q2hpbGQoJ2VsZW1lbnQnLCB7IHN0YXRpYzogdHJ1ZSB9KSBlbGVtZW50OiBFbGVtZW50UmVmO1xyXG5cclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIEBWaWV3Q2hpbGQoJ29wdGlvbkZvcm0nLCB7IHJlYWQ6IE5nRm9ybSB9KSBvcHRpb25Gb3JtOiBhbnk7XHJcblxyXG4gIC8qKlxyXG4gICAqIElmIHRydWUsIHRoZSBkaWFsb2cgY2FuIGJlIGNsb3NlZCBieSBjbGlja2luZyBvbiBzY3JpbVxyXG4gICAqL1xyXG4gIEBJbnB1dCgpIGNsb3NlT25TY3JpbUNsaWNrOiBib29sZWFuID0gdHJ1ZTtcclxuXHJcbiAgLyoqXHJcbiAgICogSWYgdHJ1ZSwgbmV3IGRpYWxvZyBjYW4gb3BlbiBpbnNpZGUgYSBkaWFsb2dcclxuICAgKi9cclxuICBASW5wdXQoKSBjb21wbGV4OiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHMgdGhlIHRleHQgZm9yIHdhcm5pbmcgZGlhbG9nIGhlYWRlci5cclxuICAgKi9cclxuICBASW5wdXQoKVxyXG4gIGdldCB3YXJuaW5nSGVhZGVyVGV4dCgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuX3dhcm5pbmdIZWFkZXJUZXh0O1xyXG4gIH1cclxuICBzZXQgd2FybmluZ0hlYWRlclRleHQodmFsdWU6IHN0cmluZykge1xyXG4gICAgaWYgKHRoaXMuX3dhcm5pbmdIZWFkZXJUZXh0ICE9PSB2YWx1ZSkge1xyXG4gICAgICB0aGlzLl93YXJuaW5nSGVhZGVyVGV4dCA9IHZhbHVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0cyB0aGUgbWFpbiB3YXJuaW5nIGRpYWxvZyB0ZXh0LlxyXG4gICAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgZ2V0IHdhcm5pbmdEaWFsb2dUZXh0KCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gdGhpcy5fd2FybmluZ0RpYWxvZ1RleHQ7XHJcbiAgfVxyXG4gIHNldCB3YXJuaW5nRGlhbG9nVGV4dCh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICBpZiAodGhpcy5fd2FybmluZ0RpYWxvZ1RleHQgIT09IHZhbHVlKSB7XHJcbiAgICAgIHRoaXMuX3dhcm5pbmdEaWFsb2dUZXh0ID0gdmFsdWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBXaGVuIGNoZWNrZWQsIGRpYWxvZyBvcGVucyBpbiBmdWxsc2NyZWVuIG1vZGVcclxuICAgKi9cclxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLmZ1bGxzY3JlZW4nKVxyXG4gIEBJbnB1dCgpXHJcbiAgZnVsbHNjcmVlbiA9IGZhbHNlO1xyXG5cclxuICAvKipcclxuICAgKiBDYW4gYmUgc2V0IHRvIG9wZW4gb3IgY2xvc2UgdGhlIGRpYWxvZy5cclxuICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IHN0YXRlIG9mIHRoZSBkaWFsb2cuXHJcbiAgICovXHJcbiAgQElucHV0KClcclxuICBnZXQgb3BlbigpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLl9vcGVuO1xyXG4gIH1cclxuICBzZXQgb3Blbih2YWx1ZTogYm9vbGVhbikge1xyXG4gICAgaWYgKHRoaXMuX29wZW4gIT09IHZhbHVlKSB7XHJcbiAgICAgIHRoaXMuX29wZW4gPSAhIXZhbHVlO1xyXG4gICAgICB0aGlzLm9wZW5DaGFuZ2UuZW1pdCh0aGlzLl9vcGVuKTtcclxuICAgICAgdGhpcy5mb2N1c1RyYXAuY3JlYXRlKHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50KS5mb2N1c0ZpcnN0VGFiYmFibGVFbGVtZW50V2hlblJlYWR5KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJbmRpY2F0ZXMgaWYgdGhlIGZvcm0gaGFzIGJlZW4gdG91Y2hlZC5cclxuICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IHZhbHVlIG9mIHRoZSBhdHRyaWJ1dGUuXHJcbiAgICovXHJcbiAgQElucHV0KClcclxuICBnZXQgZGlydHkoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gISF0aGlzLl9kaXJ0eTtcclxuICB9XHJcbiAgc2V0IGRpcnR5KHZhbHVlOiBib29sZWFuKSB7XHJcbiAgICBpZiAodGhpcy5fZGlydHkgIT09IHZhbHVlKSB7XHJcbiAgICAgIHRoaXMuX2RpcnR5ID0gISF2YWx1ZTtcclxuICAgICAgdGhpcy5mb2N1c1RyYXAuY3JlYXRlKHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50KS5mb2N1c0ZpcnN0VGFiYmFibGVFbGVtZW50V2hlblJlYWR5KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDYW4gYmUgc2V0IHRvIGluZGljYXRlIGlmIHRoZSB3YXJuaW5nIGRpYWxvZyBzaG91bGQgYmUgb3BlbmVkLlxyXG4gICAqIFJldHVybnMgdGhlIGN1cnJlbnQgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZS5cclxuICAgKi9cclxuICBASW5wdXQoKVxyXG4gIGdldCB3YXJuaW5nT25DbG9zZSgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiAhIXRoaXMuX3dhcm5pbmdPbkNsb3NlO1xyXG4gIH1cclxuICBzZXQgd2FybmluZ09uQ2xvc2UodmFsdWU6IGJvb2xlYW4pIHtcclxuICAgIGlmICh0aGlzLl93YXJuaW5nT25DbG9zZSAhPT0gdmFsdWUpIHtcclxuICAgICAgdGhpcy5fd2FybmluZ09uQ2xvc2UgPSAhIXZhbHVlO1xyXG4gICAgICB0aGlzLmZvY3VzVHJhcC5jcmVhdGUodGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQpLmZvY3VzRmlyc3RUYWJiYWJsZUVsZW1lbnRXaGVuUmVhZHkoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIEBPdXRwdXQoKSBvcGVuQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xyXG5cclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIGNsb3NlKGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcbiAgICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICBpZiAodGhpcy5jbG9zZU9uU2NyaW1DbGljayAmJiB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzY3JpbScpKSB7XHJcbiAgICAgIGlmICh0aGlzLndhcm5pbmdPbkNsb3NlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMub3Blbldhcm5pbmcgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICB0aGlzLm9wZW5XYXJuaW5nID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlydHkgPT09IHRydWUpIHtcclxuICAgICAgICAgIHRoaXMub3Blbldhcm5pbmcgPSB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLm9wZW4gPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE9wZW5zIGEgZGlhbG9nLlxyXG4gICAqL1xyXG4gIG9wZW5EaWFsb2coKSB7XHJcbiAgICB0aGlzLm9wZW4gPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2xvc2VzIGEgZGlhbG9nLlxyXG4gICAqL1xyXG4gIGNsb3NlRGlhbG9nKCkge1xyXG4gICAgaWYgKHRoaXMud2FybmluZ09uQ2xvc2UgfHwgdGhpcy5kaXJ0eSkge1xyXG4gICAgICB0aGlzLm9wZW5XYXJuaW5nID0gIXRoaXMub3Blbldhcm5pbmc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm9wZW4gPSBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENsb3NlcyBhbGwgZGlhbG9ncy5cclxuICAgKi9cclxuICBjbG9zZUFsbERpYWxvZ3MoKSB7XHJcbiAgICB0aGlzLm9wZW5XYXJuaW5nID0gZmFsc2U7XHJcbiAgICB0aGlzLm9wZW4gPSBmYWxzZTtcclxuICAgIHRoaXMuZGlydHkgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE9wZW5zIGEgd2FybmluZyBkaWFsb2cuXHJcbiAgICovXHJcbiAgb3Blbldhcm5pbmdEaWFsb2coKSB7XHJcbiAgICB0aGlzLm9wZW5XYXJuaW5nID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENsb3NlcyBhIHdhcm5pbmcgZGlhbG9nLlxyXG4gICAqL1xyXG4gIGNsb3NlV2FybmluZ0RpYWxvZygpIHtcclxuICAgIHRoaXMub3Blbldhcm5pbmcgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKiBAaGlkZGVuICovXHJcbiAgQEhvc3RMaXN0ZW5lcigna2V5ZG93bicsIFsnJGV2ZW50J10pXHJcbiAga2V5RXZlbnQoZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcclxuICAgIGlmIChldmVudC5rZXkgPT09ICdFc2MnIHx8IGV2ZW50LmtleSA9PT0gJ0VzY2FwZScpIHtcclxuICAgICAgICB0aGlzLmNsb3NlRGlhbG9nKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIEBIb3N0QmluZGluZygnY2xhc3Mub3BlbmVkJylcclxuICBnZXQgb3BlbmVkQ2xvc2VkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX29wZW47XHJcbiAgfVxyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGZvY3VzVHJhcDogQ29uZmlndXJhYmxlRm9jdXNUcmFwRmFjdG9yeSkge31cclxuXHJcbiAgLyoqIEBoaWRkZW4gKi9cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIGlmICh0aGlzLmNvbXBsZXggIT0gbnVsbCAmJiB0aGlzLmNvbXBsZXggIT09IGZhbHNlKSB7XHJcbiAgICAgIHRoaXMuY29tcGxleCA9IHRydWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKlxyXG4gICAqICMjIyBTdHlsaW5nXHJcbiAgICogVGhlIGZvbGxvd2luZyBjdXN0b20gcHJvcGVydGllcyBhcmUgYXZhaWxhYmxlIGZvciBzdHlsaW5nOlxyXG4gICAqXHJcbiAgICogQ3VzdG9tIHByb3BlcnR5ICAgICAgICAgICAgICAgICAgICAgfCBEZXNjcmlwdGlvbiAgICAgICAgICAgICAgICAgICAgICAgfCBEZWZhdWx0XHJcbiAgICogOi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLXw6LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS18Oi0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICAgKiBgLS1hdmwtZGlhbG9nLWJhY2tncm91bmQtY29sb3JgICAgICB8IEJhY2tncm91bmQgY29sb3Igb2YgZGlhbG9nICAgICAgICB8IGAtLWF2bC1iYWNrZ3JvdW5kLWNvbG9yYFxyXG4gICAqIGAtLWF2bC1kaWFsb2ctdGV4dC1jb2xvcmAgICAgICAgICAgIHwgQ29sb3Igb2YgdGV4dCBpbiBjb250ZW50ICAgICAgICAgIHwgYC0tYXZsLWVtcGhhc2lzLW1lZGl1bS1jb2xvcmBcclxuICAgKiBgLS1hdmwtZGlhbG9nLWhlYWRlci10aXRsZS1jb2xvcmAgICB8IENvbG9yIG9mIHRleHQgaW4gaGVhZGVyICAgICAgICAgICB8IGAtLWF2bC1mb3JlZ3JvdW5kLWNvbG9yYFxyXG4gICAqIGAtLWF2bC1kaWFsb2ctY2xvc2UtaWNvbi1jb2xvcmAgICAgIHwgQ29sb3Igb2YgY2xvc2UgaWNvbiBpbiBoZWFkZXIgICAgIHwgYC0tYXZsLWljb24tZGVmYXVsdC1jb2xvcmBcclxuICAgKiBgLS1hdmwtZGlhbG9nLXdpZHRoYCAgICAgICAgICAgICAgICB8IERpYWxvZyB3aWR0aCAgICAgICAgICAgICAgICAgICAgICB8IGAyODAgcHhgXHJcbiAgICogYC0tYXZsLWRpYWxvZy1oZWlnaHRgICAgICAgICAgICAgICAgfCBEaWFsb2cgaGVpZ2h0ICAgICAgICAgICAgICAgICAgICAgfCBgMTAwJSAtIDk2cHhgXHJcbiAgICogYC0tYXZsLWRpYWxvZy1zZXBhcmF0b3ItY29sb3JgICAgICAgfCBDb2xvciBvZiBzZXBhcmF0b3Igb2YgZGlhbG9nIHBhcnRzfCBgLS1hdmwtZGl2aWRlci1jb2xvcmBcclxuICAgKiBgLS1hdmwtZGlhbG9nLWNsb3NlLWljb24taW5rLXByZXNzZWQtY29sb3JgfCBDb2xvciBvZiBwcmVzc2VkIGNsb3NlIGljb24gaW4gaGVhZGVyIHwgYC0tYXZsLWluay1kZWZhdWx0LXByZXNzZWQtY29sb3JgXHJcbiAgICogYC0tYXZsLWRpYWxvZy1jbG9zZS1pY29uLWluay1mb2N1cy1jb2xvcmAgIHwgQ29sb3Igb2YgZm9jdXNlZCBjbG9zZSBpY29uIGluIGhlYWRlciB8IGAtLWF2bC1pbmstZGVmYXVsdC1mb2N1cy1jb2xvcmBcclxuICAgKiBgLS1hdmwtZGlhbG9nLWNsb3NlLWljb24taW5rLWhvdmVyLWNvbG9yYCAgfCBDb2xvciBvZiBob3ZlcmVkIGNsb3NlIGljb24gaW4gaGVhZGVyIHwgYC0tYXZsLWluay1kZWZhdWx0LWhvdmVyLWNvbG9yYFxyXG4gICAqXHJcbiAgICovXHJcbiAgX3N0eWxpbmc6IGFueTtcclxufVxyXG4iXX0=