import { Component, Input, Output, EventEmitter, ViewChild, ViewEncapsulation, ContentChild, TemplateRef, HostBinding, HostListener } from '@angular/core';
import { NgForm } from '@angular/forms';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/a11y";
import * as i2 from "./avl-dialog-header/avl-dialog-header.component";
import * as i3 from "./avl-dialog-content/avl-dialog-content.component";
import * as i4 from "@angular/common";
import * as i5 from "@avl-controls/ng-binders";
export class AvlDialogComponent {
    constructor(focusTrap) {
        this.focusTrap = focusTrap;
        this._open = false;
        this._dirty = false;
        this._warningOnClose = false;
        this._warningHeaderText = '';
        this._warningDialogText = '';
        this.openWarning = false;
        /**
         * If true, the dialog can be closed by clicking on scrim
         */
        this.closeOnScrimClick = true;
        /**
         * If true, new dialog can open inside a dialog
         */
        this.complex = false;
        /**
         * When checked, dialog opens in fullscreen mode
         */
        this.fullscreen = false;
        this.openChange = new EventEmitter();
    }
    /**
     * Sets the text for warning dialog header.
     */
    get warningHeaderText() {
        return this._warningHeaderText;
    }
    set warningHeaderText(value) {
        if (this._warningHeaderText !== value) {
            this._warningHeaderText = value;
        }
    }
    /**
     * Sets the main warning dialog text.
     */
    get warningDialogText() {
        return this._warningDialogText;
    }
    set warningDialogText(value) {
        if (this._warningDialogText !== value) {
            this._warningDialogText = value;
        }
    }
    /**
     * Can be set to open or close the dialog.
     * Returns the current state of the dialog.
     */
    get open() {
        return this._open;
    }
    set open(value) {
        if (this._open !== value) {
            this._open = !!value;
            this.openChange.emit(this._open);
            this.focusTrap.create(this.element.nativeElement).focusFirstTabbableElementWhenReady();
        }
    }
    /**
     * Indicates if the form has been touched.
     * Returns the current value of the attribute.
     */
    get dirty() {
        return !!this._dirty;
    }
    set dirty(value) {
        if (this._dirty !== value) {
            this._dirty = !!value;
            this.focusTrap.create(this.element.nativeElement).focusFirstTabbableElementWhenReady();
        }
    }
    /**
     * Can be set to indicate if the warning dialog should be opened.
     * Returns the current value of the attribute.
     */
    get warningOnClose() {
        return !!this._warningOnClose;
    }
    set warningOnClose(value) {
        if (this._warningOnClose !== value) {
            this._warningOnClose = !!value;
            this.focusTrap.create(this.element.nativeElement).focusFirstTabbableElementWhenReady();
        }
    }
    /** @hidden */
    close(event) {
        const target = event.target;
        if (this.closeOnScrimClick && target.classList.contains('scrim')) {
            if (this.warningOnClose) {
                if (this.openWarning === false) {
                    this.openWarning = true;
                }
            }
            else {
                if (this.dirty === true) {
                    this.openWarning = true;
                }
                else {
                    this.open = false;
                }
            }
        }
    }
    /**
     * Opens a dialog.
     */
    openDialog() {
        this.open = true;
    }
    /**
     * Closes a dialog.
     */
    closeDialog() {
        if (this.warningOnClose || this.dirty) {
            this.openWarning = !this.openWarning;
        }
        else {
            this.open = false;
        }
    }
    /**
     * Closes all dialogs.
     */
    closeAllDialogs() {
        this.openWarning = false;
        this.open = false;
        this.dirty = false;
    }
    /**
     * Opens a warning dialog.
     */
    openWarningDialog() {
        this.openWarning = true;
    }
    /**
     * Closes a warning dialog.
     */
    closeWarningDialog() {
        this.openWarning = false;
    }
    /** @hidden */
    keyEvent(event) {
        if (event.key === 'Esc' || event.key === 'Escape') {
            this.closeDialog();
        }
    }
    /** @hidden */
    headerCloseClicked() {
        this.closeDialog();
    }
    /** @hidden */
    get openedClosed() {
        return this._open;
    }
    /** @hidden */
    ngOnInit() {
        if (this.complex != null && this.complex !== false) {
            this.complex = true;
        }
    }
}
AvlDialogComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.0.3", ngImport: i0, type: AvlDialogComponent, deps: [{ token: i1.ConfigurableFocusTrapFactory }], target: i0.ɵɵFactoryTarget.Component });
AvlDialogComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.0.3", type: AvlDialogComponent, selector: "avl-dialog", inputs: { closeOnScrimClick: "closeOnScrimClick", complex: "complex", warningHeaderText: "warningHeaderText", warningDialogText: "warningDialogText", fullscreen: "fullscreen", open: "open", dirty: "dirty", warningOnClose: "warningOnClose" }, outputs: { openChange: "openChange" }, host: { listeners: { "keydown": "keyEvent($event)", "headerCloseClicked": "headerCloseClicked($event)" }, properties: { "class.fullscreen": "this.fullscreen", "class.opened": "this.openedClosed" } }, queries: [{ propertyName: "content", first: true, predicate: TemplateRef, descendants: true }], viewQueries: [{ propertyName: "element", first: true, predicate: ["element"], descendants: true, static: true }, { propertyName: "optionForm", first: true, predicate: ["optionForm"], descendants: true, read: NgForm }], ngImport: i0, template: "<div class=\"scrim\" (click)=\"close($event)\">\r\n  <div #element class=\"dialog\" [class.complex]=\"complex\" tabindex=\"0\">\r\n    <div *ngIf=\"open; then content\"></div>\r\n  </div>\r\n\r\n  <div *ngIf=\"openWarning\" #element class=\"dialog warning-dialog\" [class.complex]=\"complex\" tabindex=\"0\">\r\n    <avl-dialog-header>\r\n      {{ warningHeaderText || 'Warning Header' }}\r\n    </avl-dialog-header>\r\n    <avl-dialog-content class=\"warning\">\r\n      <section class=\"supporting-text\">\r\n        <div class=\"column\">\r\n          <avl-icon icon=\"icons:warning\"></avl-icon>\r\n        </div>\r\n        <div class=\"column\">\r\n          <h3>All changes will be lost if you proceed without saving.</h3>\r\n          <p id=\"customText\">{{ warningDialogText }}</p>\r\n        </div>\r\n      </section>\r\n      <section class=\"warning-buttons\">\r\n        <avl-button contained (click)=\"closeAllDialogs()\">Proceed</avl-button>\r\n        <avl-button (click)=\"closeWarningDialog()\">Cancel</avl-button>\r\n      </section>\r\n    </avl-dialog-content>\r\n  </div>\r\n</div>\r\n", styles: [":host{font-family:var(--avl-font-family);--avl-dialog-background-color:var(--avl-background-color);--avl-dialog-header-title-color:var(--avl-foreground-color);--avl-dialog-text-color:var(--avl-foreground-medium-color);--avl-dialog-close-icon-color:var(--avl-icon-default-color);--avl-dialog-separator-color:var(--avl-divider-color);--avl-dialog-close-icon-ink-pressed-color:var(--avl-ink-default-pressed-color);--avl-dialog-close-icon-ink-focus-color:var(--avl-ink-default-focus-color);--avl-dialog-close-icon-ink-hover-color:var(--avl-ink-default-hover-color);display:none}.supporting-text{display:flex;flex-direction:column}.supporting-text p{margin:0 0 16px}.column{display:flex;flex-direction:column;flex-wrap:nowrap;align-items:flex-start}#customText{margin-top:-6px;margin-bottom:11px}.supporting-text h3{font-size:16px;margin-top:7px;font-weight:700}form{margin-bottom:24px;margin-left:24px}.supporting-text avl-icon{width:40px;height:40px;margin-right:15px;margin-top:6px;flex-shrink:0;--avl-icon-custom-color:var(--avl-warning-color)}.warning-buttons{display:flex;justify-content:flex-end;margin-bottom:16px}.warning-buttons>avl-button{margin-top:4px}.warning-buttons>avl-button:last-child{margin-left:-7px}:host(.opened){display:block}.scrim{position:fixed;z-index:50;left:0;top:0;width:100%;height:100%;background-color:var(--avl-scrim-color);display:flex;flex-flow:column nowrap;justify-content:center;align-items:center}.dialog{box-sizing:border-box;height:calc(var(--avl-dialog-height) - 2px);outline:none;display:flex;flex-direction:column;position:absolute;width:var(--avl-dialog-width);min-width:280px;min-height:230px;max-width:calc(100vw - 96px);max-height:calc(100vh - 96px);background-color:var(--avl-dialog-background-color);color:var(--avl-dialog-text-color);box-shadow:var(--avl-box-shadow-24dp);min-width:444px}.warning-dialog{min-height:211px!important}:host(.fullscreen)>div>.dialog{width:100%;height:100%;max-width:100%;max-height:100%}"], components: [{ type: i2.AvlDialogHeaderComponent, selector: "avl-dialog-header" }, { type: i3.AvlDialogContentComponent, selector: "avl-dialog-content" }], directives: [{ type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i5.AvlInteractionControlDirective, selector: "avl-button,avl-icon-button,avl-item,avl-search-bar,avl-radio-button,avl-upload,avl-snackbar", outputs: ["focusedChange"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.0.3", ngImport: i0, type: AvlDialogComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'avl-dialog',
                    templateUrl: './avl-dialog.component.html',
                    styleUrls: ['./avl-dialog.component.css'],
                    encapsulation: ViewEncapsulation.Emulated
                }]
        }], ctorParameters: function () { return [{ type: i1.ConfigurableFocusTrapFactory }]; }, propDecorators: { content: [{
                type: ContentChild,
                args: [TemplateRef]
            }], element: [{
                type: ViewChild,
                args: ['element', { static: true }]
            }], optionForm: [{
                type: ViewChild,
                args: ['optionForm', { read: NgForm }]
            }], closeOnScrimClick: [{
                type: Input
            }], complex: [{
                type: Input
            }], warningHeaderText: [{
                type: Input
            }], warningDialogText: [{
                type: Input
            }], fullscreen: [{
                type: HostBinding,
                args: ['class.fullscreen']
            }, {
                type: Input
            }], open: [{
                type: Input
            }], dirty: [{
                type: Input
            }], warningOnClose: [{
                type: Input
            }], openChange: [{
                type: Output
            }], keyEvent: [{
                type: HostListener,
                args: ['keydown', ['$event']]
            }], headerCloseClicked: [{
                type: HostListener,
                args: ['headerCloseClicked', ['$event']]
            }], openedClosed: [{
                type: HostBinding,
                args: ['class.opened']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXZsLWRpYWxvZy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9kaWFsb2cvc3JjL2xpYi9hdmwtZGlhbG9nL2F2bC1kaWFsb2cuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvZGlhbG9nL3NyYy9saWIvYXZsLWRpYWxvZy9hdmwtZGlhbG9nLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUNMLE1BQU0sRUFDTixZQUFZLEVBQ1osU0FBUyxFQUNULGlCQUFpQixFQUNqQixZQUFZLEVBQ1osV0FBVyxFQUNYLFdBQVcsRUFDWCxZQUFZLEVBRWIsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7O0FBU3hDLE1BQU0sT0FBTyxrQkFBa0I7SUE2TDdCLFlBQW9CLFNBQXVDO1FBQXZDLGNBQVMsR0FBVCxTQUFTLENBQThCO1FBNUxuRCxVQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ2QsV0FBTSxHQUFHLEtBQUssQ0FBQztRQUNmLG9CQUFlLEdBQUcsS0FBSyxDQUFDO1FBQ3hCLHVCQUFrQixHQUFHLEVBQUUsQ0FBQztRQUN4Qix1QkFBa0IsR0FBRyxFQUFFLENBQUM7UUFDekIsZ0JBQVcsR0FBRyxLQUFLLENBQUM7UUFhM0I7O1dBRUc7UUFDTSxzQkFBaUIsR0FBWSxJQUFJLENBQUM7UUFFM0M7O1dBRUc7UUFDTSxZQUFPLEdBQVksS0FBSyxDQUFDO1FBNEJsQzs7V0FFRztRQUdILGVBQVUsR0FBRyxLQUFLLENBQUM7UUFnRFQsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFXLENBQUM7SUFpRlcsQ0FBQztJQWhLL0Q7O09BRUc7SUFDSCxJQUNJLGlCQUFpQjtRQUNuQixPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQztJQUNqQyxDQUFDO0lB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QkE7MkZESGEsa0JBQWtCO2tCQU45QixTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxZQUFZO29CQUN0QixXQUFXLEVBQUUsNkJBQTZCO29CQUMxQyxTQUFTLEVBQUUsQ0FBQyw0QkFBNEIsQ0FBQztvQkFDekMsYUFBYSxFQUFFLGlCQUFpQixDQUFDLFFBQVE7aUJBQzFDO21IQVk0QixPQUFPO3NCQUFqQyxZQUFZO3VCQUFDLFdBQVc7Z0JBR2UsT0FBTztzQkFBOUMsU0FBUzt1QkFBQyxTQUFTLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO2dCQUdLLFVBQVU7c0JBQXBELFNBQVM7dUJBQUMsWUFBWSxFQUFFLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRTtnQkFLaEMsaUJBQWlCO3NCQUF6QixLQUFLO2dCQUtHLE9BQU87c0JBQWYsS0FBSztnQkFNRixpQkFBaUI7c0JBRHBCLEtBQUs7Z0JBY0YsaUJBQWlCO3NCQURwQixLQUFLO2dCQWVOLFVBQVU7c0JBRlQsV0FBVzt1QkFBQyxrQkFBa0I7O3NCQUM5QixLQUFLO2dCQVFGLElBQUk7c0JBRFAsS0FBSztnQkFpQkYsS0FBSztzQkFEUixLQUFLO2dCQWdCRixjQUFjO3NCQURqQixLQUFLO2dCQVdJLFVBQVU7c0JBQW5CLE1BQU07Z0JBK0RQLFFBQVE7c0JBRFAsWUFBWTt1QkFBQyxTQUFTLEVBQUUsQ0FBQyxRQUFRLENBQUM7Z0JBU25DLGtCQUFrQjtzQkFEakIsWUFBWTt1QkFBQyxvQkFBb0IsRUFBRSxDQUFDLFFBQVEsQ0FBQztnQkFPMUMsWUFBWTtzQkFEZixXQUFXO3VCQUFDLGNBQWMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIENvbXBvbmVudCxcclxuICBJbnB1dCxcclxuICBPdXRwdXQsXHJcbiAgRXZlbnRFbWl0dGVyLFxyXG4gIFZpZXdDaGlsZCxcclxuICBWaWV3RW5jYXBzdWxhdGlvbixcclxuICBDb250ZW50Q2hpbGQsXHJcbiAgVGVtcGxhdGVSZWYsXHJcbiAgSG9zdEJpbmRpbmcsXHJcbiAgSG9zdExpc3RlbmVyLFxyXG4gIE9uSW5pdFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBDb25maWd1cmFibGVGb2N1c1RyYXBGYWN0b3J5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2ExMXknO1xyXG5pbXBvcnQgeyBOZ0Zvcm0gfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcblxyXG5pbXBvcnQgdHlwZSB7IEVsZW1lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdhdmwtZGlhbG9nJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vYXZsLWRpYWxvZy5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vYXZsLWRpYWxvZy5jb21wb25lbnQuY3NzJ10sXHJcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uRW11bGF0ZWRcclxufSlcclxuZXhwb3J0IGNsYXNzIEF2bERpYWxvZ0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgcHJpdmF0ZSBfb3BlbiA9IGZhbHNlO1xyXG4gIHByaXZhdGUgX2RpcnR5ID0gZmFsc2U7XHJcbiAgcHJpdmF0ZSBfd2FybmluZ09uQ2xvc2UgPSBmYWxzZTtcclxuICBwcml2YXRlIF93YXJuaW5nSGVhZGVyVGV4dCA9ICcnO1xyXG4gIHByaXZhdGUgX3dhcm5pbmdEaWFsb2dUZXh0ID0gJyc7XHJcbiAgcHVibGljIG9wZW5XYXJuaW5nID0gZmFsc2U7XHJcblxyXG4gIC8qKlxyXG4gICAqIERpYWxvZyBjb250ZW50XHJcbiAgICovXHJcbiAgQENvbnRlbnRDaGlsZChUZW1wbGF0ZVJlZikgY29udGVudDogVGVtcGxhdGVSZWY8YW55PjtcclxuXHJcbiAgLyoqIEBoaWRkZW4gKi9cclxuICBAVmlld0NoaWxkKCdlbGVtZW50JywgeyBzdGF0aWM6IHRydWUgfSkgZWxlbWVudDogRWxlbWVudFJlZjtcclxuXHJcbiAgLyoqIEBoaWRkZW4gKi9cclxuICBAVmlld0NoaWxkKCdvcHRpb25Gb3JtJywgeyByZWFkOiBOZ0Zvcm0gfSkgb3B0aW9uRm9ybTogYW55O1xyXG5cclxuICAvKipcclxuICAgKiBJZiB0cnVlLCB0aGUgZGlhbG9nIGNhbiBiZSBjbG9zZWQgYnkgY2xpY2tpbmcgb24gc2NyaW1cclxuICAgKi9cclxuICBASW5wdXQoKSBjbG9zZU9uU2NyaW1DbGljazogYm9vbGVhbiA9IHRydWU7XHJcblxyXG4gIC8qKlxyXG4gICAqIElmIHRydWUsIG5ldyBkaWFsb2cgY2FuIG9wZW4gaW5zaWRlIGEgZGlhbG9nXHJcbiAgICovXHJcbiAgQElucHV0KCkgY29tcGxleDogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICAvKipcclxuICAgKiBTZXRzIHRoZSB0ZXh0IGZvciB3YXJuaW5nIGRpYWxvZyBoZWFkZXIuXHJcbiAgICovXHJcbiAgQElucHV0KClcclxuICBnZXQgd2FybmluZ0hlYWRlclRleHQoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLl93YXJuaW5nSGVhZGVyVGV4dDtcclxuICB9XHJcbiAgc2V0IHdhcm5pbmdIZWFkZXJUZXh0KHZhbHVlOiBzdHJpbmcpIHtcclxuICAgIGlmICh0aGlzLl93YXJuaW5nSGVhZGVyVGV4dCAhPT0gdmFsdWUpIHtcclxuICAgICAgdGhpcy5fd2FybmluZ0hlYWRlclRleHQgPSB2YWx1ZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHMgdGhlIG1haW4gd2FybmluZyBkaWFsb2cgdGV4dC5cclxuICAgKi9cclxuICBASW5wdXQoKVxyXG4gIGdldCB3YXJuaW5nRGlhbG9nVGV4dCgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuX3dhcm5pbmdEaWFsb2dUZXh0O1xyXG4gIH1cclxuICBzZXQgd2FybmluZ0RpYWxvZ1RleHQodmFsdWU6IHN0cmluZykge1xyXG4gICAgaWYgKHRoaXMuX3dhcm5pbmdEaWFsb2dUZXh0ICE9PSB2YWx1ZSkge1xyXG4gICAgICB0aGlzLl93YXJuaW5nRGlhbG9nVGV4dCA9IHZhbHVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogV2hlbiBjaGVja2VkLCBkaWFsb2cgb3BlbnMgaW4gZnVsbHNjcmVlbiBtb2RlXHJcbiAgICovXHJcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5mdWxsc2NyZWVuJylcclxuICBASW5wdXQoKVxyXG4gIGZ1bGxzY3JlZW4gPSBmYWxzZTtcclxuXHJcbiAgLyoqXHJcbiAgICogQ2FuIGJlIHNldCB0byBvcGVuIG9yIGNsb3NlIHRoZSBkaWFsb2cuXHJcbiAgICogUmV0dXJucyB0aGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgZGlhbG9nLlxyXG4gICAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgZ2V0IG9wZW4oKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5fb3BlbjtcclxuICB9XHJcbiAgc2V0IG9wZW4odmFsdWU6IGJvb2xlYW4pIHtcclxuICAgIGlmICh0aGlzLl9vcGVuICE9PSB2YWx1ZSkge1xyXG4gICAgICB0aGlzLl9vcGVuID0gISF2YWx1ZTtcclxuICAgICAgdGhpcy5vcGVuQ2hhbmdlLmVtaXQodGhpcy5fb3Blbik7XHJcbiAgICAgIHRoaXMuZm9jdXNUcmFwLmNyZWF0ZSh0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCkuZm9jdXNGaXJzdFRhYmJhYmxlRWxlbWVudFdoZW5SZWFkeSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSW5kaWNhdGVzIGlmIHRoZSBmb3JtIGhhcyBiZWVuIHRvdWNoZWQuXHJcbiAgICogUmV0dXJucyB0aGUgY3VycmVudCB2YWx1ZSBvZiB0aGUgYXR0cmlidXRlLlxyXG4gICAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgZ2V0IGRpcnR5KCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuICEhdGhpcy5fZGlydHk7XHJcbiAgfVxyXG4gIHNldCBkaXJ0eSh2YWx1ZTogYm9vbGVhbikge1xyXG4gICAgaWYgKHRoaXMuX2RpcnR5ICE9PSB2YWx1ZSkge1xyXG4gICAgICB0aGlzLl9kaXJ0eSA9ICEhdmFsdWU7XHJcbiAgICAgIHRoaXMuZm9jdXNUcmFwLmNyZWF0ZSh0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCkuZm9jdXNGaXJzdFRhYmJhYmxlRWxlbWVudFdoZW5SZWFkeSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2FuIGJlIHNldCB0byBpbmRpY2F0ZSBpZiB0aGUgd2FybmluZyBkaWFsb2cgc2hvdWxkIGJlIG9wZW5lZC5cclxuICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IHZhbHVlIG9mIHRoZSBhdHRyaWJ1dGUuXHJcbiAgICovXHJcbiAgQElucHV0KClcclxuICBnZXQgd2FybmluZ09uQ2xvc2UoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gISF0aGlzLl93YXJuaW5nT25DbG9zZTtcclxuICB9XHJcbiAgc2V0IHdhcm5pbmdPbkNsb3NlKHZhbHVlOiBib29sZWFuKSB7XHJcbiAgICBpZiAodGhpcy5fd2FybmluZ09uQ2xvc2UgIT09IHZhbHVlKSB7XHJcbiAgICAgIHRoaXMuX3dhcm5pbmdPbkNsb3NlID0gISF2YWx1ZTtcclxuICAgICAgdGhpcy5mb2N1c1RyYXAuY3JlYXRlKHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50KS5mb2N1c0ZpcnN0VGFiYmFibGVFbGVtZW50V2hlblJlYWR5KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBAT3V0cHV0KCkgb3BlbkNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcclxuXHJcbiAgLyoqIEBoaWRkZW4gKi9cclxuICBjbG9zZShldmVudDogTW91c2VFdmVudCkge1xyXG4gICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IGFzIEhUTUxFbGVtZW50O1xyXG4gICAgaWYgKHRoaXMuY2xvc2VPblNjcmltQ2xpY2sgJiYgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnc2NyaW0nKSkge1xyXG4gICAgICBpZiAodGhpcy53YXJuaW5nT25DbG9zZSkge1xyXG4gICAgICAgIGlmICh0aGlzLm9wZW5XYXJuaW5nID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgdGhpcy5vcGVuV2FybmluZyA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmICh0aGlzLmRpcnR5ID09PSB0cnVlKSB7XHJcbiAgICAgICAgICB0aGlzLm9wZW5XYXJuaW5nID0gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5vcGVuID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBPcGVucyBhIGRpYWxvZy5cclxuICAgKi9cclxuICBvcGVuRGlhbG9nKCkge1xyXG4gICAgdGhpcy5vcGVuID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENsb3NlcyBhIGRpYWxvZy5cclxuICAgKi9cclxuICBjbG9zZURpYWxvZygpIHtcclxuICAgIGlmICh0aGlzLndhcm5pbmdPbkNsb3NlIHx8IHRoaXMuZGlydHkpIHtcclxuICAgICAgdGhpcy5vcGVuV2FybmluZyA9ICF0aGlzLm9wZW5XYXJuaW5nO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5vcGVuID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDbG9zZXMgYWxsIGRpYWxvZ3MuXHJcbiAgICovXHJcbiAgY2xvc2VBbGxEaWFsb2dzKCkge1xyXG4gICAgdGhpcy5vcGVuV2FybmluZyA9IGZhbHNlO1xyXG4gICAgdGhpcy5vcGVuID0gZmFsc2U7XHJcbiAgICB0aGlzLmRpcnR5ID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBPcGVucyBhIHdhcm5pbmcgZGlhbG9nLlxyXG4gICAqL1xyXG4gIG9wZW5XYXJuaW5nRGlhbG9nKCkge1xyXG4gICAgdGhpcy5vcGVuV2FybmluZyA9IHRydWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDbG9zZXMgYSB3YXJuaW5nIGRpYWxvZy5cclxuICAgKi9cclxuICBjbG9zZVdhcm5pbmdEaWFsb2coKSB7XHJcbiAgICB0aGlzLm9wZW5XYXJuaW5nID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIEBIb3N0TGlzdGVuZXIoJ2tleWRvd24nLCBbJyRldmVudCddKVxyXG4gIGtleUV2ZW50KGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XHJcbiAgICBpZiAoZXZlbnQua2V5ID09PSAnRXNjJyB8fCBldmVudC5rZXkgPT09ICdFc2NhcGUnKSB7XHJcbiAgICAgIHRoaXMuY2xvc2VEaWFsb2coKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKiBAaGlkZGVuICovXHJcbiAgQEhvc3RMaXN0ZW5lcignaGVhZGVyQ2xvc2VDbGlja2VkJywgWyckZXZlbnQnXSlcclxuICBoZWFkZXJDbG9zZUNsaWNrZWQoKSB7XHJcbiAgICB0aGlzLmNsb3NlRGlhbG9nKCk7XHJcbiAgfVxyXG5cclxuICAvKiogQGhpZGRlbiAqL1xyXG4gIEBIb3N0QmluZGluZygnY2xhc3Mub3BlbmVkJylcclxuICBnZXQgb3BlbmVkQ2xvc2VkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX29wZW47XHJcbiAgfVxyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGZvY3VzVHJhcDogQ29uZmlndXJhYmxlRm9jdXNUcmFwRmFjdG9yeSkge31cclxuXHJcbiAgLyoqIEBoaWRkZW4gKi9cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIGlmICh0aGlzLmNvbXBsZXggIT0gbnVsbCAmJiB0aGlzLmNvbXBsZXggIT09IGZhbHNlKSB7XHJcbiAgICAgIHRoaXMuY29tcGxleCA9IHRydWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKlxyXG4gICAqICMjIyBTdHlsaW5nXHJcbiAgICogVGhlIGZvbGxvd2luZyBjdXN0b20gcHJvcGVydGllcyBhcmUgYXZhaWxhYmxlIGZvciBzdHlsaW5nOlxyXG4gICAqXHJcbiAgICogQ3VzdG9tIHByb3BlcnR5ICAgICAgICAgICAgICAgICAgICAgfCBEZXNjcmlwdGlvbiAgICAgICAgICAgICAgICAgICAgICAgfCBEZWZhdWx0XHJcbiAgICogOi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLXw6LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS18Oi0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICAgKiBgLS1hdmwtZGlhbG9nLWJhY2tncm91bmQtY29sb3JgICAgICB8IEJhY2tncm91bmQgY29sb3Igb2YgZGlhbG9nICAgICAgICB8IGAtLWF2bC1iYWNrZ3JvdW5kLWNvbG9yYFxyXG4gICAqIGAtLWF2bC1kaWFsb2ctdGV4dC1jb2xvcmAgICAgICAgICAgIHwgQ29sb3Igb2YgdGV4dCBpbiBjb250ZW50ICAgICAgICAgIHwgYC0tYXZsLWZvcmVncm91bmQtbWVkaXVtLWNvbG9yYFxyXG4gICAqIGAtLWF2bC1kaWFsb2ctaGVhZGVyLXRpdGxlLWNvbG9yYCAgIHwgQ29sb3Igb2YgdGV4dCBpbiBoZWFkZXIgICAgICAgICAgIHwgYC0tYXZsLWZvcmVncm91bmQtY29sb3JgXHJcbiAgICogYC0tYXZsLWRpYWxvZy1jbG9zZS1pY29uLWNvbG9yYCAgICAgfCBDb2xvciBvZiBjbG9zZSBpY29uIGluIGhlYWRlciAgICAgfCBgLS1hdmwtaWNvbi1kZWZhdWx0LWNvbG9yYFxyXG4gICAqIGAtLWF2bC1kaWFsb2ctd2lkdGhgICAgICAgICAgICAgICAgIHwgRGlhbG9nIHdpZHRoICAgICAgICAgICAgICAgICAgICAgIHwgYDI4MCBweGBcclxuICAgKiBgLS1hdmwtZGlhbG9nLWhlaWdodGAgICAgICAgICAgICAgICB8IERpYWxvZyBoZWlnaHQgICAgICAgICAgICAgICAgICAgICB8IGAxMDAlIC0gOTZweGBcclxuICAgKiBgLS1hdmwtZGlhbG9nLXNlcGFyYXRvci1jb2xvcmAgICAgICB8IENvbG9yIG9mIHNlcGFyYXRvciBvZiBkaWFsb2cgcGFydHN8IGAtLWF2bC1kaXZpZGVyLWNvbG9yYFxyXG4gICAqIGAtLWF2bC1kaWFsb2ctY2xvc2UtaWNvbi1pbmstcHJlc3NlZC1jb2xvcmB8IENvbG9yIG9mIHByZXNzZWQgY2xvc2UgaWNvbiBpbiBoZWFkZXIgfCBgLS1hdmwtaW5rLWRlZmF1bHQtcHJlc3NlZC1jb2xvcmBcclxuICAgKiBgLS1hdmwtZGlhbG9nLWNsb3NlLWljb24taW5rLWZvY3VzLWNvbG9yYCAgfCBDb2xvciBvZiBmb2N1c2VkIGNsb3NlIGljb24gaW4gaGVhZGVyIHwgYC0tYXZsLWluay1kZWZhdWx0LWZvY3VzLWNvbG9yYFxyXG4gICAqIGAtLWF2bC1kaWFsb2ctY2xvc2UtaWNvbi1pbmstaG92ZXItY29sb3JgICB8IENvbG9yIG9mIGhvdmVyZWQgY2xvc2UgaWNvbiBpbiBoZWFkZXIgfCBgLS1hdmwtaW5rLWRlZmF1bHQtaG92ZXItY29sb3JgXHJcbiAgICpcclxuICAgKi9cclxuICBfc3R5bGluZzogYW55O1xyXG59XHJcbiIsIjxkaXYgY2xhc3M9XCJzY3JpbVwiIChjbGljayk9XCJjbG9zZSgkZXZlbnQpXCI+XHJcbiAgPGRpdiAjZWxlbWVudCBjbGFzcz1cImRpYWxvZ1wiIFtjbGFzcy5jb21wbGV4XT1cImNvbXBsZXhcIiB0YWJpbmRleD1cIjBcIj5cclxuICAgIDxkaXYgKm5nSWY9XCJvcGVuOyB0aGVuIGNvbnRlbnRcIj48L2Rpdj5cclxuICA8L2Rpdj5cclxuXHJcbiAgPGRpdiAqbmdJZj1cIm9wZW5XYXJuaW5nXCIgI2VsZW1lbnQgY2xhc3M9XCJkaWFsb2cgd2FybmluZy1kaWFsb2dcIiBbY2xhc3MuY29tcGxleF09XCJjb21wbGV4XCIgdGFiaW5kZXg9XCIwXCI+XHJcbiAgICA8YXZsLWRpYWxvZy1oZWFkZXI+XHJcbiAgICAgIHt7IHdhcm5pbmdIZWFkZXJUZXh0IHx8ICdXYXJuaW5nIEhlYWRlcicgfX1cclxuICAgIDwvYXZsLWRpYWxvZy1oZWFkZXI+XHJcbiAgICA8YXZsLWRpYWxvZy1jb250ZW50IGNsYXNzPVwid2FybmluZ1wiPlxyXG4gICAgICA8c2VjdGlvbiBjbGFzcz1cInN1cHBvcnRpbmctdGV4dFwiPlxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2x1bW5cIj5cclxuICAgICAgICAgIDxhdmwtaWNvbiBpY29uPVwiaWNvbnM6d2FybmluZ1wiPjwvYXZsLWljb24+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbHVtblwiPlxyXG4gICAgICAgICAgPGgzPkFsbCBjaGFuZ2VzIHdpbGwgYmUgbG9zdCBpZiB5b3UgcHJvY2VlZCB3aXRob3V0IHNhdmluZy48L2gzPlxyXG4gICAgICAgICAgPHAgaWQ9XCJjdXN0b21UZXh0XCI+e3sgd2FybmluZ0RpYWxvZ1RleHQgfX08L3A+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgIDwvc2VjdGlvbj5cclxuICAgICAgPHNlY3Rpb24gY2xhc3M9XCJ3YXJuaW5nLWJ1dHRvbnNcIj5cclxuICAgICAgICA8YXZsLWJ1dHRvbiBjb250YWluZWQgKGNsaWNrKT1cImNsb3NlQWxsRGlhbG9ncygpXCI+UHJvY2VlZDwvYXZsLWJ1dHRvbj5cclxuICAgICAgICA8YXZsLWJ1dHRvbiAoY2xpY2spPVwiY2xvc2VXYXJuaW5nRGlhbG9nKClcIj5DYW5jZWw8L2F2bC1idXR0b24+XHJcbiAgICAgIDwvc2VjdGlvbj5cclxuICAgIDwvYXZsLWRpYWxvZy1jb250ZW50PlxyXG4gIDwvZGl2PlxyXG48L2Rpdj5cclxuIl19