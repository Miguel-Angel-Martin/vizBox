import { __decorate, __metadata } from "tslib";
import { Injectable } from '@angular/core';
import { HttpClient, HttpEventType, HttpErrorResponse } from '@angular/common/http';
import { map, catchError } from 'rxjs/operators';
import { of } from 'rxjs';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common/http';
var UploadService = /** @class */ (function () {
    function UploadService(httpClient) {
        this.httpClient = httpClient;
    }
    UploadService.prototype.downloadFile = function (url, progressCallback, completeCallback, failCallback) {
        var req = this.httpClient.get(url, { reportProgress: true, responseType: "blob", observe: 'events' })
            .pipe(map(function (event) {
            if (event.type === HttpEventType.DownloadProgress) {
                progressCallback === null || progressCallback === void 0 ? void 0 : progressCallback(event);
            }
            if (event.type === HttpEventType.Response && event.body != null) {
                completeCallback === null || completeCallback === void 0 ? void 0 : completeCallback(event.body);
            }
        }), catchError(function (err) {
            var response = err.error instanceof Event ? err.error.target.response : err.error;
            if (failCallback)
                failCallback({
                    status: err.status,
                    response: response
                });
            return of(null);
        }));
        var subscription = req.subscribe();
        return subscription.unsubscribe.bind(subscription);
    };
    UploadService.prototype.uploadFile = function (file, target, progressCallback, completeCallback, failCallback) {
        var formData = new FormData();
        formData.append('file', file.file);
        var uploadReq = this.httpClient.post(target, formData, { reportProgress: true, observe: 'events' })
            .pipe(map(function (event) {
            if (event.type === HttpEventType.UploadProgress) {
                progressCallback === null || progressCallback === void 0 ? void 0 : progressCallback(event);
            }
            if (event.type === HttpEventType.Response) {
                if (event.body != null && event.body.downloadUrl) {
                    completeCallback === null || completeCallback === void 0 ? void 0 : completeCallback(event.body.downloadUrl);
                }
                else {
                    completeCallback === null || completeCallback === void 0 ? void 0 : completeCallback();
                }
            }
        }), catchError(function (err, caught) {
            var response = err.error instanceof Event ? err.error.target.response : err.error;
            if (failCallback)
                failCallback({
                    status: err.status,
                    response: response
                });
            return of(null);
        }));
        var subscription = uploadReq.subscribe();
        return subscription.unsubscribe.bind(subscription);
    };
    UploadService.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    UploadService = __decorate([ __metadata("design:paramtypes", [HttpClient])
    ], UploadService);
UploadService.ɵfac = function UploadService_Factory(t) { return new (t || UploadService)(ɵngcc0.ɵɵinject(ɵngcc1.HttpClient)); };
UploadService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: UploadService, factory: function (t) { return UploadService.ɵfac(t); } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(UploadService, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc1.HttpClient }]; }, null); })();
    return UploadService;
}());
export { UploadService };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBsb2FkLnNlcnZpY2UuanMiLCJzb3VyY2VzIjpbIm5nOi9AYXZsLWNvbnRyb2xzL25nLWJpbmRlcnMvbGliL3NlcnZpY2VzL3VwbG9hZC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxVQUFVLEVBQUUsYUFBYSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFHcEYsT0FBTyxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNqRCxPQUFPLEVBQWMsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDOzs7QUFHdEM7QUFBaUQsSUFDL0MsdUJBQW9CLFVBQXNCO0FBQUksUUFBMUIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtBQUFDLElBQUcsQ0FBQztBQUNqRCxJQUNFLG9DQUFZLEdBQVosVUFDRSxHQUFXLEVBQ1gsZ0JBQTZELEVBQzdELGdCQUF1QyxFQUN2QyxZQUE0RDtBQUM3RCxRQUNDLElBQU0sR0FBRyxHQUFvQixJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxDQUFDO0FBQzVILGFBQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFBLEtBQUs7QUFBSSxZQUNqQixJQUFJLEtBQUssQ0FBQyxJQUFJLEtBQUssYUFBYSxDQUFDLGdCQUFnQixFQUFFO0FBQzNELGdCQUFVLGdCQUFnQixhQUFoQixnQkFBZ0IsdUJBQWhCLGdCQUFnQixDQUFHLEtBQUssRUFBRTtBQUNwQyxhQUFTO0FBQ1QsWUFBUSxJQUFJLEtBQUssQ0FBQyxJQUFJLEtBQUssYUFBYSxDQUFDLFFBQVEsSUFBSSxLQUFLLENBQUMsSUFBSSxJQUFJLElBQUksRUFBRTtBQUN6RSxnQkFBVSxnQkFBZ0IsYUFB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LEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUE1REEsQUFBQSxBQURBLEFBQUEsQUFEQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBREEsQUFBQSxBQThEQSxBQUFBLEFBQUEsQUFBQSxBQTlEQSxBQThEQSxBQTlEQSxBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwRXZlbnRUeXBlLCBIdHRwRXJyb3JSZXNwb25zZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgQXZsVXBsb2FkU2VydmljZSwgQXZsRmlsZSwgQXZsQWJvcnRVcGxvYWRBY3Rpb24sIEF2bFVwbG9hZFByb2dyZXNzRXZlbnQsIEF2bEh0dHBFcnJvclJlc3BvbnNlIH0gZnJvbSAnQGF2bC1jb250cm9scy9pbnRlcmZhY2VzJztcclxuXHJcbmltcG9ydCB7IG1hcCwgY2F0Y2hFcnJvciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFVwbG9hZFNlcnZpY2UgaW1wbGVtZW50cyBBdmxVcGxvYWRTZXJ2aWNlIHtcclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHBDbGllbnQ6IEh0dHBDbGllbnQpIHsgfVxyXG5cclxuICBkb3dubG9hZEZpbGUoXHJcbiAgICB1cmw6IHN0cmluZyxcclxuICAgIHByb2dyZXNzQ2FsbGJhY2s/OiAocHJvZ3Jlc3M6IEF2bFVwbG9hZFByb2dyZXNzRXZlbnQpID0+IHZvaWQsXHJcbiAgICBjb21wbGV0ZUNhbGxiYWNrPzogKGJsb2I6IEJsb2IpID0+IHZvaWQsXHJcbiAgICBmYWlsQ2FsbGJhY2s/OiAoZXJyb3JSZXNwb25zZTogQXZsSHR0cEVycm9yUmVzcG9uc2UpID0+IHZvaWRcclxuICApOiBBdmxBYm9ydFVwbG9hZEFjdGlvbiB7XHJcbiAgICBjb25zdCByZXE6IE9ic2VydmFibGU8YW55PiA9IHRoaXMuaHR0cENsaWVudC5nZXQodXJsLCB7IHJlcG9ydFByb2dyZXNzOiB0cnVlLCByZXNwb25zZVR5cGU6IFwiYmxvYlwiLCBvYnNlcnZlOiAnZXZlbnRzJyB9KVxyXG4gICAgICAucGlwZShtYXAoZXZlbnQgPT4ge1xyXG4gICAgICAgIGlmIChldmVudC50eXBlID09PSBIdHRwRXZlbnRUeXBlLkRvd25sb2FkUHJvZ3Jlc3MpIHtcclxuICAgICAgICAgIHByb2dyZXNzQ2FsbGJhY2s/LihldmVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChldmVudC50eXBlID09PSBIdHRwRXZlbnRUeXBlLlJlc3BvbnNlICYmIGV2ZW50LmJvZHkgIT0gbnVsbCkge1xyXG4gICAgICAgICAgY29tcGxldGVDYWxsYmFjaz8uKGV2ZW50LmJvZHkpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSksIGNhdGNoRXJyb3IoKGVycjogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGVyci5lcnJvciBpbnN0YW5jZW9mIEV2ZW50ID8gKDxYTUxIdHRwUmVxdWVzdD5lcnIuZXJyb3IudGFyZ2V0KS5yZXNwb25zZSA6IGVyci5lcnJvcjtcclxuICAgICAgICBpZiAoZmFpbENhbGxiYWNrKSBmYWlsQ2FsbGJhY2soe1xyXG4gICAgICAgICAgc3RhdHVzOiBlcnIuc3RhdHVzLFxyXG4gICAgICAgICAgcmVzcG9uc2U6IHJlc3BvbnNlXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gICAgICB9KSk7XHJcbiAgICBjb25zdCBzdWJzY3JpcHRpb24gPSByZXEuc3Vic2NyaWJlKCk7XHJcbiAgICByZXR1cm4gc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlLmJpbmQoc3Vic2NyaXB0aW9uKTtcclxuICB9XHJcblxyXG4gIHVwbG9hZEZpbGUoXHJcbiAgICBmaWxlOiBBdmxGaWxlLFxyXG4gICAgdGFyZ2V0OiBzdHJpbmcsXHJcbiAgICBwcm9ncmVzc0NhbGxiYWNrPzogKHByb2dyZXNzOiBBdmxVcGxvYWRQcm9ncmVzc0V2ZW50KSA9PiB2b2lkLFxyXG4gICAgY29tcGxldGVDYWxsYmFjaz86IChkb3dubG9hZFVybD86IHN0cmluZykgPT4gdm9pZCxcclxuICAgIGZhaWxDYWxsYmFjaz86IChlcnJvclJlc3BvbnNlOiBBdmxIdHRwRXJyb3JSZXNwb25zZSkgPT4gdm9pZFxyXG4gICk6IEF2bEFib3J0VXBsb2FkQWN0aW9uIHtcclxuICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCBmaWxlLmZpbGUpO1xyXG4gICAgY29uc3QgdXBsb2FkUmVxOiBPYnNlcnZhYmxlPGFueT4gPSB0aGlzLmh0dHBDbGllbnQucG9zdDx7ZG93bmxvYWRVcmw/OiBzdHJpbmd9Pih0YXJnZXQsIGZvcm1EYXRhLCB7IHJlcG9ydFByb2dyZXNzOiB0cnVlLCBvYnNlcnZlOiAnZXZlbnRzJyB9IClcclxuICAgICAgLnBpcGUobWFwKGV2ZW50ID0+IHtcclxuICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gSHR0cEV2ZW50VHlwZS5VcGxvYWRQcm9ncmVzcykge1xyXG4gICAgICAgICAgcHJvZ3Jlc3NDYWxsYmFjaz8uKGV2ZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoZXZlbnQudHlwZSA9PT0gSHR0cEV2ZW50VHlwZS5SZXNwb25zZSkge1xyXG4gICAgICAgICAgaWYgKGV2ZW50LmJvZHkgIT0gbnVsbCAmJiBldmVudC5ib2R5LmRvd25sb2FkVXJsKSB7XHJcbiAgICAgICAgICAgIGNvbXBsZXRlQ2FsbGJhY2s/LihldmVudC5ib2R5LmRvd25sb2FkVXJsKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb21wbGV0ZUNhbGxiYWNrPy4oKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pLCBjYXRjaEVycm9yKCAoZXJyOiBIdHRwRXJyb3JSZXNwb25zZSwgY2F1Z2h0KSA9PiB7XHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBlcnIuZXJyb3IgaW5zdGFuY2VvZiBFdmVudCA/ICg8WE1MSHR0cFJlcXVlc3Q+ZXJyLmVycm9yLnRhcmdldCkucmVzcG9uc2UgOiBlcnIuZXJyb3I7XHJcbiAgICAgICAgaWYoZmFpbENhbGxiYWNrKSBmYWlsQ2FsbGJhY2soe1xyXG4gICAgICAgICAgc3RhdHVzOiBlcnIuc3RhdHVzLFxyXG4gICAgICAgICAgcmVzcG9uc2U6IHJlc3BvbnNlXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gICAgICB9KSk7XHJcbiAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHVwbG9hZFJlcS5zdWJzY3JpYmUoKTtcclxuICAgICAgcmV0dXJuIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZS5iaW5kKHN1YnNjcmlwdGlvbik7XHJcbiAgfVxyXG59XHJcbiJdfQ==