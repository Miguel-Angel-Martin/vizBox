import { __decorate, __extends, __metadata } from "tslib";
import { Directive, EventEmitter, HostListener, Output, OnInit, OnDestroy, ElementRef, Renderer2, forwardRef, Input } from '@angular/core';
import { AvlInteractionControlDirective } from './avl-interaction-control.directive';
import { NG_VALUE_ACCESSOR, NG_VALIDATORS } from '@angular/forms';
// Defines which property is used as the 'value' for the ControlValueAccessor
import * as ɵngcc0 from '@angular/core';
var valuePropertyNameMap = {
    // TODO: is there a nameof function is typescript?
    'avl-checkbox': 'checked',
    'avl-date': 'value',
    'avl-dropdown': 'selectedValue',
    'avl-time': 'value',
    'avl-numberfield': 'value',
    'avl-radio-group': 'selectedValue',
    'avl-slider': 'value',
    'avl-textarea': 'value',
    'avl-textfield': 'value',
    'avl-timespan': 'value',
    'avl-chip-list': 'selectedValue',
    'avl-chip-input': 'selectedValues',
    'avl-upload': 'files',
    'avl-search-bar': 'query',
    'avl-icon-toggle': 'checked',
    'avl-switch': 'checked'
};
/** Directive for controls implementing [AvlFormControl]. */
var AvlFormControlDirective = /** @class */ (function (_super) {
    __extends(AvlFormControlDirective, _super);
    function AvlFormControlDirective(elementRef, renderer) {
        var _this = _super.call(this, elementRef) || this;
        _this.elementRef = elementRef;
        _this.renderer = renderer;
        _this.writeValueAlreadyCalled = false;
        //#endregion
        //#region AvlFormControl
        // tslint:disable-next-line:member-ordering
        _this.invalidChange = new EventEmitter();
        var controlTag = _this.elementRef.nativeElement.tagName.toLowerCase();
        _this.valuePropertyName = valuePropertyNameMap[controlTag];
        return _this;
    }
    AvlFormControlDirective_1 = AvlFormControlDirective;
    Object.defineProperty(AvlFormControlDirective.prototype, "readonly", {
        // Angular writes readonly attributes to a readOnly property,
        // because that's how it's called on the native input element.
        set: function (value) {
            if (typeof value === 'boolean') {
                this.elementRef.nativeElement.readonly = value;
            }
            else {
                this.elementRef.nativeElement.readonly = value != null;
            }
        },
        enumerable: true,
        configurable: true
    });
    AvlFormControlDirective.prototype.ngOnInit = function () {
        var _this = this;
        this.unlistenPropertyChangedEvent =
            this.renderer.listen(this.elementRef.nativeElement, this.toKebabCase(this.valuePropertyName) + "-changed", function (e) {
                if (_this.onChangeCallback) {
                    _this.onChangeCallback(e.detail.value);
                }
            });
    };
    AvlFormControlDirective.prototype.ngOnDestroy = function () {
        if (this.unlistenPropertyChangedEvent) {
            this.unlistenPropertyChangedEvent();
        }
    };
    AvlFormControlDirective.prototype.writeValue = function (value) {
        // Because of a bug in Angular writeValue sometimes gets called with a null before being called with the real value,
        // so the null is discarded.
        // TODO: remove when issue is fixed: https://github.com/angular/angular/issues/14988
        if (!this.writeValueAlreadyCalled && value == null) {
            this.writeValueAlreadyCalled = true;
            return;
        }
        this.renderer.setProperty(this.elementRef.nativeElement, this.valuePropertyName, value);
        this.writeValueAlreadyCalled = true;
    };
    AvlFormControlDirective.prototype.registerOnChange = function (fn) {
        this.onChangeCallback = fn;
    };
    AvlFormControlDirective.prototype.registerOnTouched = function (fn) {
        this.onTouchedCallback = fn;
    };
    AvlFormControlDirective.prototype.setDisabledState = function (isDisabled) {
        this.renderer.setProperty(this.elementRef.nativeElement, 'disabled', isDisabled);
    };
    AvlFormControlDirective.prototype.onBlur = function () {
        if (this.onTouchedCallback) {
            this.onTouchedCallback();
        }
    };
    AvlFormControlDirective.prototype.onFocusedChanged = function (focused) {
        if (!focused && this.onTouchedCallback) {
            this.onTouchedCallback();
        }
    };
    AvlFormControlDirective.prototype.toKebabCase = function (camelCaseString) {
        return camelCaseString.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
    };
    AvlFormControlDirective.prototype.invalidChanged = function (e) {
        this.invalidChange.emit(e.detail.value);
        // Trigger validation
        if (this.onChangeCallback) {
            this.onChangeCallback(this.elementRef.nativeElement[this.valuePropertyName]);
        }
    };
    //#endregion
    //#region Validator
    AvlFormControlDirective.prototype.validate = function (control) {
        var formControl = this.elementRef.nativeElement;
        if (formControl.invalid) {
            return { invalid: formControl.errorMessage };
        }
        else {
            return null;
        }
    };
    var AvlFormControlDirective_1;
    AvlFormControlDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 }
    ]; };
    __decorate([
        Input(),
        __metadata("design:type", Object),
        __metadata("design:paramtypes", [Object])
    ], AvlFormControlDirective.prototype, "readonly", null);
    __decorate([
        HostListener('blur'),
        __metadata("design:type", Function),
        __metadata("design:paramtypes", []),
        __metadata("design:returntype", void 0)
    ], AvlFormControlDirective.prototype, "onBlur", null);
    __decorate([
        HostListener('focused-changed', ['$event.detail.value']),
        __metadata("design:type", Function),
        __metadata("design:paramtypes", [Object]),
        __metadata("design:returntype", void 0)
    ], AvlFormControlDirective.prototype, "onFocusedChanged", null);
    __decorate([
        Output(),
        __metadata("design:type", EventEmitter)
    ], AvlFormControlDirective.prototype, "invalidChange", void 0);
    __decorate([
        HostListener('invalid-changed', ['$event']),
        __metadata("design:type", Function),
        __metadata("design:paramtypes", [CustomEvent]),
        __metadata("design:returntype", void 0)
    ], AvlFormControlDirective.prototype, "invalidChanged", null);
    AvlFormControlDirective = AvlFormControlDirective_1 = __decorate([ __metadata("design:paramtypes", [ElementRef, Renderer2])
    ], AvlFormControlDirective);
AvlFormControlDirective.ɵfac = function AvlFormControlDirective_Factory(t) { return new (t || AvlFormControlDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2)); };
AvlFormControlDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: AvlFormControlDirective, selectors: [["avl-date"], ["avl-dropdown"], ["avl-time"], ["avl-icon-toggle"], ["avl-numberfield"], ["avl-radio-group"], ["avl-slider"], ["avl-textarea"], ["avl-textfield"], ["avl-timespan"], ["avl-checkbox"], ["avl-switch"], ["avl-chip-list"], ["avl-upload"], ["avl-search-bar"], ["avl-chip-input"]], hostBindings: function AvlFormControlDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("blur", function AvlFormControlDirective_blur_HostBindingHandler() { return ctx.onBlur(); })("focused-changed", function AvlFormControlDirective_focused_changed_HostBindingHandler($event) { return ctx.onFocusedChanged($event.detail.value); })("invalid-changed", function AvlFormControlDirective_invalid_changed_HostBindingHandler($event) { return ctx.invalidChanged($event); });
    } }, inputs: { readonly: "readonly" }, outputs: { invalidChange: "invalidChange" }, features: [ɵngcc0.ɵɵProvidersFeature([{ provide: NG_VALUE_ACCESSOR, useExisting: forwardRef(function () { return AvlFormControlDirective_1; }), multi: true },
            { provide: NG_VALIDATORS, useExisting: forwardRef(function () { return AvlFormControlDirective_1; }), multi: true }]), ɵngcc0.ɵɵInheritDefinitionFeature] });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(AvlFormControlDirective, [{
        type: Directive,
        args: [{
                selector: 'avl-date,avl-dropdown,avl-time,avl-icon-toggle,avl-numberfield,avl-radio-group,avl-slider,avl-textarea,avl-textfield,avl-timespan,avl-checkbox,avl-switch,avl-chip-list,avl-upload,avl-search-bar,avl-chip-input',
                providers: [{ provide: NG_VALUE_ACCESSOR, useExisting: forwardRef(function () { return AvlFormControlDirective_1; }), multi: true },
                    { provide: NG_VALIDATORS, useExisting: forwardRef(function () { return AvlFormControlDirective_1; }), multi: true }]
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }]; }, { readonly: [{
            type: Input
        }], onBlur: [{
            type: HostListener,
            args: ['blur']
        }], onFocusedChanged: [{
            type: HostListener,
            args: ['focused-changed', ['$event.detail.value']]
        }], invalidChanged: [{
            type: HostListener,
            args: ['invalid-changed', ['$event']]
        }], invalidChange: [{
            type: Output
        }] }); })();
    return AvlFormControlDirective;
}(AvlInteractionControlDirective));
export { AvlFormControlDirective };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXZsLWZvcm0tY29udHJvbC5kaXJlY3RpdmUuanMiLCJzb3VyY2VzIjpbIm5nOi9AYXZsLWNvbnRyb2xzL25nLWJpbmRlcnMvbGliL2ludGVyZmFjZS9hdmwtZm9ybS1jb250cm9sLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzSSxPQUFPLEVBQUUsOEJBQThCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUNyRixPQUFPLEVBQXdCLGlCQUFpQixFQUFnRCxhQUFhLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUd0SSw2RUFBNkU7O0FBQzdFLElBQU0sb0JBQW9CLEdBQUc7QUFDN0IsSUFBRSxrREFBa0Q7QUFDcEQsSUFBRSxjQUFjLEVBQUUsU0FBUztBQUMzQixJQUFFLFVBQVUsRUFBRSxPQUFPO0FBQ3JCLElBQUUsY0FBYyxFQUFFLGVBQWU7QUFDakMsSUFBRSxVQUFVLEVBQUUsT0FBTztBQUNyQixJQUFFLGlCQUFpQixFQUFFLE9BQU87QUFDNUIsSUFBRSxpQkFBaUIsRUFBRSxlQUFlO0FBQ3BDLElBQUUsWUFBWSxFQUFFLE9BQU87QUFDdkIsSUFBRSxjQUFjLEVBQUUsT0FBTztBQUN6QixJQUFFLGVBQWUsRUFBRSxPQUFPO0FBQzFCLElBQUUsY0FBYyxFQUFFLE9BQU87QUFDekIsSUFBRSxlQUFlLEVBQUcsZUFBZTtBQUNuQyxJQUFFLGdCQUFnQixFQUFFLGdCQUFnQjtBQUNwQyxJQUFFLFlBQVksRUFBRSxPQUFPO0FBQ3ZCLElBQUUsZ0JBQWdCLEVBQUUsT0FBTztBQUMzQixJQUFFLGlCQUFpQixFQUFFLFNBQVM7QUFDOUIsSUFBRSxZQUFZLEVBQUUsU0FBUztBQUN6QixDQUFDLENBQUM7QUFFRiw0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Q0EsQUFBQSxBQUFBLEFBQUEsQUFHQSxBQUpBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBYkEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQTJFQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQWhFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUF6QkEsQUFBQSxBQWFBLEFBQUEsQUFBQSxBQUhBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFRQSxBQUFBLEFBQUEsQUFBQSxBQU9BLEFBTkEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBR0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBR0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQVFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBdEZBLEFBQUEsQUFBQSxBQUFBLEFBUkEsQUFEQSxBQUFBLEFBQUEsQUFPQSxBQWdEQSxBQURBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFLQSxBQUdBLEFBREEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBS0EsQUFTQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBREEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQU1BLEFBaEdBLEFBQUEsQUFMQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQXNCQSxBQUFBLEFBQUEsQUFBQSxBQXJCQSxBQUFBLEFBNkdBLEFBQUEsQUFBQSxBQUFBLEFBN0dBLEFBQUEsQUFBQSxBQTZHQSxBQTdHQSxBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aXZlLCBFdmVudEVtaXR0ZXIsIEhvc3RMaXN0ZW5lciwgT3V0cHV0LCBPbkluaXQsIE9uRGVzdHJveSwgRWxlbWVudFJlZiwgUmVuZGVyZXIyLCBmb3J3YXJkUmVmLCBJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBBdmxJbnRlcmFjdGlvbkNvbnRyb2xEaXJlY3RpdmUgfSBmcm9tICcuL2F2bC1pbnRlcmFjdGlvbi1jb250cm9sLmRpcmVjdGl2ZSc7XHJcbmltcG9ydCB7IENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBOR19WQUxVRV9BQ0NFU1NPUiwgVmFsaWRhdG9yLCBBYnN0cmFjdENvbnRyb2wsIFZhbGlkYXRpb25FcnJvcnMsIE5HX1ZBTElEQVRPUlMgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IEF2bEZvcm1Db250cm9sIH0gZnJvbSAnQGF2bC1jb250cm9scy9pbnRlcmZhY2VzJztcclxuXHJcbi8vIERlZmluZXMgd2hpY2ggcHJvcGVydHkgaXMgdXNlZCBhcyB0aGUgJ3ZhbHVlJyBmb3IgdGhlIENvbnRyb2xWYWx1ZUFjY2Vzc29yXHJcbmNvbnN0IHZhbHVlUHJvcGVydHlOYW1lTWFwID0ge1xyXG4gIC8vIFRPRE86IGlzIHRoZXJlIGEgbmFtZW9mIGZ1bmN0aW9uIGlzIHR5cGVzY3JpcHQ/XHJcbiAgJ2F2bC1jaGVja2JveCc6ICdjaGVja2VkJyxcclxuICAnYXZsLWRhdGUnOiAndmFsdWUnLFxyXG4gICdhdmwtZHJvcGRvd24nOiAnc2VsZWN0ZWRWYWx1ZScsXHJcbiAgJ2F2bC10aW1lJzogJ3ZhbHVlJyxcclxuICAnYXZsLW51bWJlcmZpZWxkJzogJ3ZhbHVlJyxcclxuICAnYXZsLXJhZGlvLWdyb3VwJzogJ3NlbGVjdGVkVmFsdWUnLFxyXG4gICdhdmwtc2xpZGVyJzogJ3ZhbHVlJyxcclxuICAnYXZsLXRleHRhcmVhJzogJ3ZhbHVlJyxcclxuICAnYXZsLXRleHRmaWVsZCc6ICd2YWx1ZScsXHJcbiAgJ2F2bC10aW1lc3Bhbic6ICd2YWx1ZScsXHJcbiAgJ2F2bC1jaGlwLWxpc3QnIDogJ3NlbGVjdGVkVmFsdWUnLFxyXG4gICdhdmwtY2hpcC1pbnB1dCc6ICdzZWxlY3RlZFZhbHVlcycsXHJcbiAgJ2F2bC11cGxvYWQnOiAnZmlsZXMnLFxyXG4gICdhdmwtc2VhcmNoLWJhcic6ICdxdWVyeScsXHJcbiAgJ2F2bC1pY29uLXRvZ2dsZSc6ICdjaGVja2VkJyxcclxuICAnYXZsLXN3aXRjaCc6ICdjaGVja2VkJ1xyXG59O1xyXG5cclxuLyoqIERpcmVjdGl2ZSBmb3IgY29udHJvbHMgaW1wbGVtZW50aW5nIFtBdmxGb3JtQ29udHJvbF0uICovXHJcbkBEaXJlY3RpdmUoe1xyXG4gIHNlbGVjdG9yOiAnYXZsLWRhdGUsYXZsLWRyb3Bkb3duLGF2bC10aW1lLGF2bC1pY29uLXRvZ2dsZSxhdmwtbnVtYmVyZmllbGQsYXZsLXJhZGlvLWdyb3VwLGF2bC1zbGlkZXIsYXZsLXRleHRhcmVhLGF2bC10ZXh0ZmllbGQsYXZsLXRpbWVzcGFuLGF2bC1jaGVja2JveCxhdmwtc3dpdGNoLGF2bC1jaGlwLWxpc3QsYXZsLXVwbG9hZCxhdmwtc2VhcmNoLWJhcixhdmwtY2hpcC1pbnB1dCcsXHJcbiAgcHJvdmlkZXJzOiBbeyBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUiwgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gQXZsRm9ybUNvbnRyb2xEaXJlY3RpdmUpLCBtdWx0aTogdHJ1ZSB9LFxyXG4gIHsgcHJvdmlkZTogTkdfVkFMSURBVE9SUywgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gQXZsRm9ybUNvbnRyb2xEaXJlY3RpdmUpLCBtdWx0aTogdHJ1ZSB9XVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQXZsRm9ybUNvbnRyb2xEaXJlY3RpdmUgZXh0ZW5kcyBBdmxJbnRlcmFjdGlvbkNvbnRyb2xEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgQ29udHJvbFZhbHVlQWNjZXNzb3IsIFZhbGlkYXRvciB7XHJcbiAgLy8jcmVnaW9uIENvbnRyb2xWYWx1ZUFjY2Vzc29yXHJcbiAgcHJpdmF0ZSB2YWx1ZVByb3BlcnR5TmFtZTtcclxuICBwcml2YXRlIG9uVG91Y2hlZENhbGxiYWNrOiAoKSA9PiB7fTtcclxuICBwcml2YXRlIG9uQ2hhbmdlQ2FsbGJhY2s6ICh2YWx1ZTogYW55KSA9PiB2b2lkO1xyXG5cclxuICBwcml2YXRlIHVubGlzdGVuUHJvcGVydHlDaGFuZ2VkRXZlbnQ6ICgpID0+IHZvaWQ7XHJcblxyXG4gIHByaXZhdGUgd3JpdGVWYWx1ZUFscmVhZHlDYWxsZWQgPSBmYWxzZTtcclxuXHJcbiAgLy8gQW5ndWxhciB3cml0ZXMgcmVhZG9ubHkgYXR0cmlidXRlcyB0byBhIHJlYWRPbmx5IHByb3BlcnR5LFxyXG4gIC8vIGJlY2F1c2UgdGhhdCdzIGhvdyBpdCdzIGNhbGxlZCBvbiB0aGUgbmF0aXZlIGlucHV0IGVsZW1lbnQuXHJcbiAgQElucHV0KClcclxuICBwdWJsaWMgc2V0IHJlYWRvbmx5KHZhbHVlOiBhbnkpIHtcclxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xyXG4gICAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5yZWFkb25seSA9IHZhbHVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQucmVhZG9ubHkgPSB2YWx1ZSAhPSBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMikge1xyXG4gICAgc3VwZXIoZWxlbWVudFJlZik7XHJcbiAgICBjb25zdCBjb250cm9sVGFnID0gKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50IGFzIEhUTUxFbGVtZW50KS50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICB0aGlzLnZhbHVlUHJvcGVydHlOYW1lID0gdmFsdWVQcm9wZXJ0eU5hbWVNYXBbY29udHJvbFRhZ107XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMudW5saXN0ZW5Qcm9wZXJ0eUNoYW5nZWRFdmVudCA9XHJcbiAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCBgJHt0aGlzLnRvS2ViYWJDYXNlKHRoaXMudmFsdWVQcm9wZXJ0eU5hbWUpfS1jaGFuZ2VkYCwgKGU6IEN1c3RvbUV2ZW50KSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMub25DaGFuZ2VDYWxsYmFjaykge1xyXG4gICAgICAgICAgdGhpcy5vbkNoYW5nZUNhbGxiYWNrKGUuZGV0YWlsLnZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy51bmxpc3RlblByb3BlcnR5Q2hhbmdlZEV2ZW50KSB7XHJcbiAgICAgIHRoaXMudW5saXN0ZW5Qcm9wZXJ0eUNoYW5nZWRFdmVudCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgd3JpdGVWYWx1ZSh2YWx1ZTogYW55KSB7XHJcbiAgICAvLyBCZWNhdXNlIG9mIGEgYnVnIGluIEFuZ3VsYXIgd3JpdGVWYWx1ZSBzb21ldGltZXMgZ2V0cyBjYWxsZWQgd2l0aCBhIG51bGwgYmVmb3JlIGJlaW5nIGNhbGxlZCB3aXRoIHRoZSByZWFsIHZhbHVlLFxyXG4gICAgLy8gc28gdGhlIG51bGwgaXMgZGlzY2FyZGVkLlxyXG4gICAgLy8gVE9ETzogcmVtb3ZlIHdoZW4gaXNzdWUgaXMgZml4ZWQ6IGh0dHBzOi8vZ2l0aHViLmNvbS9hbmd1bGFyL2FuZ3VsYXIvaXNzdWVzLzE0OTg4XHJcbiAgICBpZiAoIXRoaXMud3JpdGVWYWx1ZUFscmVhZHlDYWxsZWQgJiYgdmFsdWUgPT0gbnVsbCkge1xyXG4gICAgICB0aGlzLndyaXRlVmFsdWVBbHJlYWR5Q2FsbGVkID0gdHJ1ZTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRQcm9wZXJ0eSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgdGhpcy52YWx1ZVByb3BlcnR5TmFtZSwgdmFsdWUpO1xyXG4gICAgdGhpcy53cml0ZVZhbHVlQWxyZWFkeUNhbGxlZCA9IHRydWU7XHJcbiAgfVxyXG5cclxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiAodmFsdWU6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5vbkNoYW5nZUNhbGxiYWNrID0gZm47XHJcbiAgfVxyXG5cclxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KSB7XHJcbiAgICB0aGlzLm9uVG91Y2hlZENhbGxiYWNrID0gZm47XHJcbiAgfVxyXG5cclxuICBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pIHtcclxuICAgIHRoaXMucmVuZGVyZXIuc2V0UHJvcGVydHkodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdkaXNhYmxlZCcsIGlzRGlzYWJsZWQpO1xyXG4gIH1cclxuXHJcbiAgQEhvc3RMaXN0ZW5lcignYmx1cicpXHJcbiAgb25CbHVyKCkge1xyXG4gICAgaWYgKHRoaXMub25Ub3VjaGVkQ2FsbGJhY2spIHtcclxuICAgICAgdGhpcy5vblRvdWNoZWRDYWxsYmFjaygpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQEhvc3RMaXN0ZW5lcignZm9jdXNlZC1jaGFuZ2VkJywgWyckZXZlbnQuZGV0YWlsLnZhbHVlJ10pXHJcbiAgb25Gb2N1c2VkQ2hhbmdlZChmb2N1c2VkKSB7XHJcbiAgICBpZiAoIWZvY3VzZWQgJiYgdGhpcy5vblRvdWNoZWRDYWxsYmFjaykge1xyXG4gICAgICB0aGlzLm9uVG91Y2hlZENhbGxiYWNrKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHRvS2ViYWJDYXNlKGNhbWVsQ2FzZVN0cmluZzogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIHJldHVybiBjYW1lbENhc2VTdHJpbmcucmVwbGFjZSgvKFthLXpdKShbQS1aXSkvZywgJyQxLSQyJykudG9Mb3dlckNhc2UoKTtcclxuICB9XHJcbiAgLy8jZW5kcmVnaW9uXHJcblxyXG4gIC8vI3JlZ2lvbiBBdmxGb3JtQ29udHJvbFxyXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptZW1iZXItb3JkZXJpbmdcclxuICBAT3V0cHV0KCkgaW52YWxpZENoYW5nZTogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcblxyXG4gIEBIb3N0TGlzdGVuZXIoJ2ludmFsaWQtY2hhbmdlZCcsIFsnJGV2ZW50J10pXHJcbiAgaW52YWxpZENoYW5nZWQoZTogQ3VzdG9tRXZlbnQpIHtcclxuICAgIHRoaXMuaW52YWxpZENoYW5nZS5lbWl0KGUuZGV0YWlsLnZhbHVlKTtcclxuICAgIC8vIFRyaWdnZXIgdmFsaWRhdGlvblxyXG4gICAgaWYgKHRoaXMub25DaGFuZ2VDYWxsYmFjaykge1xyXG4gICAgICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2sodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnRbdGhpcy52YWx1ZVByb3BlcnR5TmFtZV0pO1xyXG4gICAgfVxyXG4gIH1cclxuICAvLyNlbmRyZWdpb25cclxuXHJcbiAgLy8jcmVnaW9uIFZhbGlkYXRvclxyXG4gIHZhbGlkYXRlKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgfCBudWxsIHtcclxuICAgIGNvbnN0IGZvcm1Db250cm9sID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQgYXMgQXZsRm9ybUNvbnRyb2w7XHJcbiAgICBpZiAoZm9ybUNvbnRyb2wuaW52YWxpZCkge1xyXG4gICAgICByZXR1cm4geyBpbnZhbGlkOiBmb3JtQ29udHJvbC5lcnJvck1lc3NhZ2UgfTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuICAvLyNlbmRyZWdpb25cclxufVxyXG4iXX0=