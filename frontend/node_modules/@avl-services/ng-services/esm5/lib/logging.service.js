import { __decorate, __param } from "tslib";
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Inject, Injectable, Optional } from '@angular/core';
import { AvlAuthService } from '@avl-ng-controls/auth';
import { interval, Subject } from 'rxjs';
import { filter, switchMap, takeUntil, tap } from 'rxjs/operators';
import { Log, LogConfig, LogSeverity } from './logging.model';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@avl-ng-controls/auth";
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common/http';
import * as ɵngcc2 from '@avl-ng-controls/auth';
var LoggingService = /** @class */ (function () {
    /**
     * @ignore
     */
    function LoggingService(http, config, authService) {
        var _this = this;
        var _a;
        this.http = http;
        this.config = config;
        this.authService = authService;
        this.logs = [];
        this.isLogging = false;
        this.debounceTime$ = new Subject();
        this.logs$ = new Subject();
        this.stopLogging$ = new Subject();
        this.postLogs$ = new Subject();
        this.destroyed$ = new Subject();
        this.headers = new HttpHeaders({
            targetName: this.config.targetName,
        });
        if (config.autologging) {
            (_a = this.authService) === null || _a === void 0 ? void 0 : _a.isLoggedIn$.pipe(takeUntil(this.destroyed$)).subscribe(function (isLoggedIn) { return _this.decideOnLogging(isLoggedIn); });
        }
    }
    /**
     * @ignore
     */
    LoggingService.prototype.ngOnDestroy = function () {
        this.postLogs$.complete();
        this.debounceTime$.complete();
        this.logs$.complete();
        this.stopLogging$.next();
        this.stopLogging$.complete();
        this.destroyed$.next();
        this.destroyed$.complete();
    };
    /**
     * Starts periodical logging process.
     *
     * Depends on _debounceTime_ and _capacity_ properties.
     */
    LoggingService.prototype.startLogging = function () {
        var _this = this;
        this.isLogging = true;
        this.debounceTime$
            .pipe(takeUntil(this.stopLogging$), switchMap(function (debounceTime) { return _this.periodicalLogging(debounceTime); }))
            .subscribe(function () { return _this.onPostMessages(); });
        this.postLogs$
            .pipe(takeUntil(this.stopLogging$), switchMap(function () { return _this.postMessages(); }))
            .subscribe(function () { return _this.onPostMessages(); });
        this.setLoggingDebounceTime(this.config.debounceTime);
    };
    /**
     * Stops logging process.
     */
    LoggingService.prototype.stopLogging = function () {
        this.isLogging = false;
        this.postLogs();
        this.stopLogging$.next();
    };
    /**
     * Gets all currently queued logs as an observable value.
     * @returns All currently queued logs as an observable value
     */
    LoggingService.prototype.getLogs$ = function () {
        return this.logs$.asObservable();
    };
    /**
     * Logs message with debug severity.
     * @param message Message used for constructing a debug log
     * @param componentName Name of the component which called this method
     */
    LoggingService.prototype.debug = function (message, componentName) {
        if (componentName === void 0) { componentName = ''; }
        this.log(message, LogSeverity.Debug, componentName);
    };
    /**
     * Logs message with info severity.
     * @param message Message used for constructing a info log
     * @param componentName Name of the component which called this method
     */
    LoggingService.prototype.info = function (message, componentName) {
        if (componentName === void 0) { componentName = ''; }
        this.log(message, LogSeverity.Info, componentName);
    };
    /**
     * Logs message with warning severity.
     * @param message Message used for constructing a warning log
     * @param componentName Name of the component which called this method
     */
    LoggingService.prototype.warn = function (message, componentName) {
        if (componentName === void 0) { componentName = ''; }
        this.log(message, LogSeverity.Warning, componentName);
    };
    /**
     * Logs message with error severity.
     * @param message Message used for constructing a error log
     * @param componentName Name of the component which called this method
     */
    LoggingService.prototype.error = function (message, componentName) {
        if (componentName === void 0) { componentName = ''; }
        this.log(message, LogSeverity.Error, componentName);
    };
    /**
     * Logs message with fatal severity.
     * @param message Message used for constructing a fatal log
     * @param componentName Name of the component which called this method
     */
    LoggingService.prototype.fatal = function (message, componentName) {
        if (componentName === void 0) { componentName = ''; }
        this.log(message, LogSeverity.Fatal, componentName);
    };
    /**
     * Setter for debounce time (log period).
     * @param debounceTime Time in milliseconds; determines the period of API requests for logging
     */
    LoggingService.prototype.setLoggingDebounceTime = function (debounceTime) {
        this.config.debounceTime = debounceTime;
        this.debounceTime$.next(debounceTime);
    };
    /**
     * Setter for global log level.
     * @param globalLogLevel Minimum message severity to log
     */
    LoggingService.prototype.setGlobalLogLevel = function (globalLogLevel) {
        this.config.globalLogLevel = globalLogLevel;
    };
    /**
     * Setter for log queue capacity.
     * @param capacity Log queue capacity
     */
    LoggingService.prototype.setLogCapacity = function (capacity) {
        this.config.capacity = capacity;
    };
    // Logic, private methods
    LoggingService.prototype.log = function (message, severity, componentName) {
        if (!this.isLogging || severity < this.config.globalLogLevel) {
            return;
        }
        this.createAndStoreLog(message, severity, componentName);
        this.dispatchLogs();
        if (this.isFullCapacity()) {
            this.postLogs$.next();
        }
    };
    LoggingService.prototype.createAndStoreLog = function (message, severityType, componentName) {
        var timestamp = new Date().toISOString();
        var _a = this.config, appName = _a.appName, version = _a.version;
        var severity = severityType.toString();
        var log = { message: message, severity: severity, timestamp: timestamp, componentName: componentName, appName: appName, version: version };
        this.logs.push(log);
    };
    LoggingService.prototype.isFullCapacity = function () {
        return this.logs.length >= this.config.capacity;
    };
    LoggingService.prototype.clearLogs = function () {
        this.logs = [];
    };
    LoggingService.prototype.onPostMessages = function () {
        this.clearLogs();
        this.dispatchLogs();
    };
    LoggingService.prototype.postLogs = function () {
        this.postLogs$.next();
    };
    LoggingService.prototype.periodicalLogging = function (period) {
        var _this = this;
        return interval(period).pipe(tap(function () {
            if (!_this.logs.length) {
                _this.dispatchLogs();
            }
        }), filter(function () { return !!_this.logs.length; }), switchMap(function () { return _this.postMessages(); }));
    };
    LoggingService.prototype.postMessages = function () {
        return this.http.post(this.config.endpoint, this.logs, {
            headers: this.headers,
        });
    };
    LoggingService.prototype.dispatchLogs = function () {
        this.logs$.next(this.logs);
    };
    LoggingService.prototype.decideOnLogging = function (isLoggedIn) {
        if (isLoggedIn) {
            this.startLogging();
        }
        else {
            this.stopLogging();
        }
    };
    LoggingService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: LogConfig, decorators: [{ type: Inject, args: ['loggingConfig',] }] },
        { type: AvlAuthService, decorators: [{ type: Optional }, { type: Inject, args: [AvlAuthService,] }] }
    ]; };
    LoggingService.ɵprov = i0.ɵɵdefineInjectable({ factory: function LoggingService_Factory() { return new LoggingService(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject("loggingConfig"), i0.ɵɵinject(i2.AvlAuthService, 8)); }, token: LoggingService, providedIn: "root" });
    LoggingService = __decorate([ __param(1, Inject('loggingConfig')),
        __param(2, Optional()), __param(2, Inject(AvlAuthService))
    ], LoggingService);
LoggingService.ɵfac = function LoggingService_Factory(t) { return new (t || LoggingService)(ɵngcc0.ɵɵinject(ɵngcc1.HttpClient), ɵngcc0.ɵɵinject('loggingConfig'), ɵngcc0.ɵɵinject(AvlAuthService, 8)); };
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(LoggingService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc1.HttpClient }, { type: LogConfig, decorators: [{
                type: Inject,
                args: ['loggingConfig']
            }] }, { type: ɵngcc2.AvlAuthService, decorators: [{
                type: Optional
            }, {
                type: Inject,
                args: [AvlAuthService]
            }] }]; }, null); })();
    return LoggingService;
}());
export { LoggingService };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9nZ2luZy5zZXJ2aWNlLmpzIiwic291cmNlcyI6WyJuZzovQGF2bC1zZXJ2aWNlcy9uZy1zZXJ2aWNlcy9saWIvbG9nZ2luZy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQy9ELE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFhLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN4RSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDdkQsT0FBTyxFQUFFLFFBQVEsRUFBYyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDckQsT0FBTyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ25FLE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzlEO0FBR0E7QUFDeUM7Ozs7QUFBekM7QUFBa0QsSUFXaEQ7QUFDRjtBQUNFLE9BQUc7QUFDTCxJQUFFLHdCQUNVLElBQWdCLEVBQ1MsTUFBaUIsRUFDTixXQUEyQjtBQUN4RSxRQUpELGlCQVlDO0FBQ0g7QUFFUyxRQWRHLFNBQUksR0FBSixJQUFJLENBQVk7QUFBQyxRQUNRLFdBQU0sR0FBTixNQUFNLENBQVc7QUFBQyxRQUNQLGdCQUFXLEdBQVgsV0FBVyxDQUFnQjtBQUMzRSxRQWpCVSxTQUFJLEdBQVUsRUFBRSxDQUFDO0FBQzNCLFFBQ1UsY0FBUyxHQUFHLEtBQUssQ0FBQztBQUM1QixRQUNVLGtCQUFhLEdBQW9CLElBQUksT0FBTyxFQUFFLENBQUM7QUFDekQsUUFBVSxVQUFLLEdBQW1CLElBQUksT0FBTyxFQUFFLENBQUM7QUFDaEQsUUFBVSxpQkFBWSxHQUFrQixJQUFJLE9BQU8sRUFBRSxDQUFDO0FBQ3RELFFBQVUsY0FBUyxHQUFrQixJ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QSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBVUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFFQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFJQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBaUJBLEFBaEJBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFFQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUdBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBSUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUlBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFJQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBSUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUlBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFHQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUdBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUdBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQVVBLEFBVEEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUE1TUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFqQkEsQUFBQSxBQUhBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQWlCQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQWpCQSxBQUFBLEFBNE5BLEFBdE9BLEFBc09BLEFBNU5BLEFBNE5BLEFBNU5BLEFBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwSGVhZGVycyB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBPbkRlc3Ryb3ksIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEF2bEF1dGhTZXJ2aWNlIH0gZnJvbSAnQGF2bC1uZy1jb250cm9scy9hdXRoJztcclxuaW1wb3J0IHsgaW50ZXJ2YWwsIE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgZmlsdGVyLCBzd2l0Y2hNYXAsIHRha2VVbnRpbCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBMb2csIExvZ0NvbmZpZywgTG9nU2V2ZXJpdHkgfSBmcm9tICcuL2xvZ2dpbmcubW9kZWwnO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290JyxcclxufSlcclxuZXhwb3J0IGNsYXNzIExvZ2dpbmdTZXJ2aWNlIGltcGxlbWVudHMgT25EZXN0cm95IHtcclxuICBwcml2YXRlIGxvZ3M6IExvZ1tdID0gW107XHJcbiAgcHJpdmF0ZSBoZWFkZXJzOiBIdHRwSGVhZGVycztcclxuICBwcml2YXRlIGlzTG9nZ2luZyA9IGZhbHNlO1xyXG5cclxuICBwcml2YXRlIGRlYm91bmNlVGltZSQ6IFN1YmplY3Q8bnVtYmVyPiA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgcHJpdmF0ZSBsb2dzJDogU3ViamVjdDxMb2dbXT4gPSBuZXcgU3ViamVjdCgpO1xyXG4gIHByaXZhdGUgc3RvcExvZ2dpbmckOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3QoKTtcclxuICBwcml2YXRlIHBvc3RMb2dzJDogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgcHJpdmF0ZSBkZXN0cm95ZWQkOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3QoKTtcclxuXHJcbiAgLyoqXHJcbiAgICogQGlnbm9yZVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LFxyXG4gICAgQEluamVjdCgnbG9nZ2luZ0NvbmZpZycpIHByaXZhdGUgY29uZmlnOiBMb2dDb25maWcsXHJcbiAgICBAT3B0aW9uYWwoKSBASW5qZWN0KEF2bEF1dGhTZXJ2aWNlKSBwcml2YXRlIGF1dGhTZXJ2aWNlOiBBdmxBdXRoU2VydmljZVxyXG4gICkge1xyXG4gICAgdGhpcy5oZWFkZXJzID0gbmV3IEh0dHBIZWFkZXJzKHtcclxuICAgICAgdGFyZ2V0TmFtZTogdGhpcy5jb25maWcudGFyZ2V0TmFtZSxcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChjb25maWcuYXV0b2xvZ2dpbmcpIHtcclxuICAgICAgdGhpcy5hdXRoU2VydmljZT8uaXNMb2dnZWRJbiQucGlwZSh0YWtlVW50aWwodGhpcy5kZXN0cm95ZWQkKSkuc3Vic2NyaWJlKChpc0xvZ2dlZEluKSA9PiB0aGlzLmRlY2lkZU9uTG9nZ2luZyhpc0xvZ2dlZEluKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAaWdub3JlXHJcbiAgICovXHJcbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICB0aGlzLnBvc3RMb2dzJC5jb21wbGV0ZSgpO1xyXG4gICAgdGhpcy5kZWJvdW5jZVRpbWUkLmNvbXBsZXRlKCk7XHJcbiAgICB0aGlzLmxvZ3MkLmNvbXBsZXRlKCk7XHJcbiAgICB0aGlzLnN0b3BMb2dnaW5nJC5uZXh0KCk7XHJcbiAgICB0aGlzLnN0b3BMb2dnaW5nJC5jb21wbGV0ZSgpO1xyXG4gICAgdGhpcy5kZXN0cm95ZWQkLm5leHQoKTtcclxuICAgIHRoaXMuZGVzdHJveWVkJC5jb21wbGV0ZSgpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiBTdGFydHMgcGVyaW9kaWNhbCBsb2dnaW5nIHByb2Nlc3MuXHJcbiAgICogXHJcbiAgICogRGVwZW5kcyBvbiBfZGVib3VuY2VUaW1lXyBhbmQgX2NhcGFjaXR5XyBwcm9wZXJ0aWVzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGFydExvZ2dpbmcoKTogdm9pZCB7XHJcbiAgICB0aGlzLmlzTG9nZ2luZyA9IHRydWU7XHJcbiAgICB0aGlzLmRlYm91bmNlVGltZSRcclxuICAgICAgLnBpcGUoXHJcbiAgICAgICAgdGFrZVVudGlsKHRoaXMuc3RvcExvZ2dpbmckKSxcclxuICAgICAgICBzd2l0Y2hNYXAoKGRlYm91bmNlVGltZSkgPT4gdGhpcy5wZXJpb2RpY2FsTG9nZ2luZyhkZWJvdW5jZVRpbWUpKVxyXG4gICAgICApXHJcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4gdGhpcy5vblBvc3RNZXNzYWdlcygpKTtcclxuXHJcbiAgICB0aGlzLnBvc3RMb2dzJFxyXG4gICAgICAucGlwZShcclxuICAgICAgICB0YWtlVW50aWwodGhpcy5zdG9wTG9nZ2luZyQpLFxyXG4gICAgICAgIHN3aXRjaE1hcCgoKSA9PiB0aGlzLnBvc3RNZXNzYWdlcygpKVxyXG4gICAgICApXHJcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4gdGhpcy5vblBvc3RNZXNzYWdlcygpKTtcclxuXHJcbiAgICB0aGlzLnNldExvZ2dpbmdEZWJvdW5jZVRpbWUodGhpcy5jb25maWcuZGVib3VuY2VUaW1lKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0b3BzIGxvZ2dpbmcgcHJvY2Vzcy5cclxuICAgKi9cclxuICBwdWJsaWMgc3RvcExvZ2dpbmcoKTogdm9pZCB7XHJcbiAgICB0aGlzLmlzTG9nZ2luZyA9IGZhbHNlO1xyXG4gICAgdGhpcy5wb3N0TG9ncygpO1xyXG4gICAgdGhpcy5zdG9wTG9nZ2luZyQubmV4dCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0cyBhbGwgY3VycmVudGx5IHF1ZXVlZCBsb2dzIGFzIGFuIG9ic2VydmFibGUgdmFsdWUuXHJcbiAgICogQHJldHVybnMgQWxsIGN1cnJlbnRseSBxdWV1ZWQgbG9ncyBhcyBhbiBvYnNlcnZhYmxlIHZhbHVlXHJcbiAgICovXHJcbiAgcHVibGljIGdldExvZ3MkKCk6IE9ic2VydmFibGU8TG9nW10+IHtcclxuICAgIHJldHVybiB0aGlzLmxvZ3MkLmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTG9ncyBtZXNzYWdlIHdpdGggZGVidWcgc2V2ZXJpdHkuXHJcbiAgICogQHBhcmFtIG1lc3NhZ2UgTWVzc2FnZSB1c2VkIGZvciBjb25zdHJ1Y3RpbmcgYSBkZWJ1ZyBsb2dcclxuICAgKiBAcGFyYW0gY29tcG9uZW50TmFtZSBOYW1lIG9mIHRoZSBjb21wb25lbnQgd2hpY2ggY2FsbGVkIHRoaXMgbWV0aG9kXHJcbiAgICovXHJcbiAgcHVibGljIGRlYnVnKG1lc3NhZ2U6IHN0cmluZywgY29tcG9uZW50TmFtZTogc3RyaW5nID0gJycpOiB2b2lkIHtcclxuICAgIHRoaXMubG9nKG1lc3NhZ2UsIExvZ1NldmVyaXR5LkRlYnVnLCBjb21wb25lbnROYW1lKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIExvZ3MgbWVzc2FnZSB3aXRoIGluZm8gc2V2ZXJpdHkuXHJcbiAgICogQHBhcmFtIG1lc3NhZ2UgTWVzc2FnZSB1c2VkIGZvciBjb25zdHJ1Y3RpbmcgYSBpbmZvIGxvZ1xyXG4gICAqIEBwYXJhbSBjb21wb25lbnROYW1lIE5hbWUgb2YgdGhlIGNvbXBvbmVudCB3aGljaCBjYWxsZWQgdGhpcyBtZXRob2RcclxuICAgKi9cclxuICBwdWJsaWMgaW5mbyhtZXNzYWdlOiBzdHJpbmcsIGNvbXBvbmVudE5hbWU6IHN0cmluZyA9ICcnKTogdm9pZCB7XHJcbiAgICB0aGlzLmxvZyhtZXNzYWdlLCBMb2dTZXZlcml0eS5JbmZvLCBjb21wb25lbnROYW1lKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIExvZ3MgbWVzc2FnZSB3aXRoIHdhcm5pbmcgc2V2ZXJpdHkuXHJcbiAgICogQHBhcmFtIG1lc3NhZ2UgTWVzc2FnZSB1c2VkIGZvciBjb25zdHJ1Y3RpbmcgYSB3YXJuaW5nIGxvZ1xyXG4gICAqIEBwYXJhbSBjb21wb25lbnROYW1lIE5hbWUgb2YgdGhlIGNvbXBvbmVudCB3aGljaCBjYWxsZWQgdGhpcyBtZXRob2RcclxuICAgKi9cclxuICBwdWJsaWMgd2FybihtZXNzYWdlOiBzdHJpbmcsIGNvbXBvbmVudE5hbWU6IHN0cmluZyA9ICcnKTogdm9pZCB7XHJcbiAgICB0aGlzLmxvZyhtZXNzYWdlLCBMb2dTZXZlcml0eS5XYXJuaW5nLCBjb21wb25lbnROYW1lKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIExvZ3MgbWVzc2FnZSB3aXRoIGVycm9yIHNldmVyaXR5LlxyXG4gICAqIEBwYXJhbSBtZXNzYWdlIE1lc3NhZ2UgdXNlZCBmb3IgY29uc3RydWN0aW5nIGEgZXJyb3IgbG9nXHJcbiAgICogQHBhcmFtIGNvbXBvbmVudE5hbWUgTmFtZSBvZiB0aGUgY29tcG9uZW50IHdoaWNoIGNhbGxlZCB0aGlzIG1ldGhvZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBlcnJvcihtZXNzYWdlOiBzdHJpbmcsIGNvbXBvbmVudE5hbWU6IHN0cmluZyA9ICcnKTogdm9pZCB7XHJcbiAgICB0aGlzLmxvZyhtZXNzYWdlLCBMb2dTZXZlcml0eS5FcnJvciwgY29tcG9uZW50TmFtZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBMb2dzIG1lc3NhZ2Ugd2l0aCBmYXRhbCBzZXZlcml0eS5cclxuICAgKiBAcGFyYW0gbWVzc2FnZSBNZXNzYWdlIHVzZWQgZm9yIGNvbnN0cnVjdGluZyBhIGZhdGFsIGxvZ1xyXG4gICAqIEBwYXJhbSBjb21wb25lbnROYW1lIE5hbWUgb2YgdGhlIGNvbXBvbmVudCB3aGljaCBjYWxsZWQgdGhpcyBtZXRob2RcclxuICAgKi9cclxuICBwdWJsaWMgZmF0YWwobWVzc2FnZTogc3RyaW5nLCBjb21wb25lbnROYW1lOiBzdHJpbmcgPSAnJyk6IHZvaWQge1xyXG4gICAgdGhpcy5sb2cobWVzc2FnZSwgTG9nU2V2ZXJpdHkuRmF0YWwsIGNvbXBvbmVudE5hbWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0dGVyIGZvciBkZWJvdW5jZSB0aW1lIChsb2cgcGVyaW9kKS5cclxuICAgKiBAcGFyYW0gZGVib3VuY2VUaW1lIFRpbWUgaW4gbWlsbGlzZWNvbmRzOyBkZXRlcm1pbmVzIHRoZSBwZXJpb2Qgb2YgQVBJIHJlcXVlc3RzIGZvciBsb2dnaW5nXHJcbiAgICovXHJcbiAgcHVibGljIHNldExvZ2dpbmdEZWJvdW5jZVRpbWUoZGVib3VuY2VUaW1lOiBudW1iZXIpOiB2b2lkIHtcclxuICAgIHRoaXMuY29uZmlnLmRlYm91bmNlVGltZSA9IGRlYm91bmNlVGltZTtcclxuICAgIHRoaXMuZGVib3VuY2VUaW1lJC5uZXh0KGRlYm91bmNlVGltZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXR0ZXIgZm9yIGdsb2JhbCBsb2cgbGV2ZWwuXHJcbiAgICogQHBhcmFtIGdsb2JhbExvZ0xldmVsIE1pbmltdW0gbWVzc2FnZSBzZXZlcml0eSB0byBsb2dcclxuICAgKi9cclxuICBwdWJsaWMgc2V0R2xvYmFsTG9nTGV2ZWwoZ2xvYmFsTG9nTGV2ZWw6IExvZ1NldmVyaXR5KTogdm9pZCB7XHJcbiAgICB0aGlzLmNvbmZpZy5nbG9iYWxMb2dMZXZlbCA9IGdsb2JhbExvZ0xldmVsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0dGVyIGZvciBsb2cgcXVldWUgY2FwYWNpdHkuXHJcbiAgICogQHBhcmFtIGNhcGFjaXR5IExvZyBxdWV1ZSBjYXBhY2l0eVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRMb2dDYXBhY2l0eShjYXBhY2l0eTogbnVtYmVyKTogdm9pZCB7XHJcbiAgICB0aGlzLmNvbmZpZy5jYXBhY2l0eSA9IGNhcGFjaXR5O1xyXG4gIH1cclxuXHJcbiAgLy8gTG9naWMsIHByaXZhdGUgbWV0aG9kc1xyXG5cclxuICBwcml2YXRlIGxvZyhtZXNzYWdlOiBzdHJpbmcsIHNldmVyaXR5OiBMb2dTZXZlcml0eSwgY29tcG9uZW50TmFtZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICBpZiAoIXRoaXMuaXNMb2dnaW5nIHx8IHNldmVyaXR5IDwgdGhpcy5jb25maWcuZ2xvYmFsTG9nTGV2ZWwpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY3JlYXRlQW5kU3RvcmVMb2cobWVzc2FnZSwgc2V2ZXJpdHksIGNvbXBvbmVudE5hbWUpO1xyXG4gICAgdGhpcy5kaXNwYXRjaExvZ3MoKTtcclxuXHJcbiAgICBpZiAodGhpcy5pc0Z1bGxDYXBhY2l0eSgpKSB7XHJcbiAgICAgIHRoaXMucG9zdExvZ3MkLm5leHQoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgY3JlYXRlQW5kU3RvcmVMb2cobWVzc2FnZTogc3RyaW5nLCBzZXZlcml0eVR5cGU6IExvZ1NldmVyaXR5LCBjb21wb25lbnROYW1lOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcclxuICAgIGNvbnN0IHsgYXBwTmFtZSwgdmVyc2lvbiB9ID0gdGhpcy5jb25maWc7XHJcbiAgICBjb25zdCBzZXZlcml0eSA9IHNldmVyaXR5VHlwZS50b1N0cmluZygpO1xyXG4gICAgY29uc3QgbG9nOiBMb2cgPSB7IG1lc3NhZ2UsIHNldmVyaXR5LCB0aW1lc3RhbXAsIGNvbXBvbmVudE5hbWUsIGFwcE5hbWUsIHZlcnNpb24gfTtcclxuICAgIHRoaXMubG9ncy5wdXNoKGxvZyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGlzRnVsbENhcGFjaXR5KCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMubG9ncy5sZW5ndGggPj0gdGhpcy5jb25maWcuY2FwYWNpdHk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNsZWFyTG9ncygpOiB2b2lkIHtcclxuICAgIHRoaXMubG9ncyA9IFtdO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBvblBvc3RNZXNzYWdlcygpOiB2b2lkIHtcclxuICAgIHRoaXMuY2xlYXJMb2dzKCk7XHJcbiAgICB0aGlzLmRpc3BhdGNoTG9ncygpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwb3N0TG9ncygpOiB2b2lkIHtcclxuICAgIHRoaXMucG9zdExvZ3MkLm5leHQoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcGVyaW9kaWNhbExvZ2dpbmcocGVyaW9kOiBudW1iZXIpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcclxuICAgIHJldHVybiBpbnRlcnZhbChwZXJpb2QpLnBpcGUoXHJcbiAgICAgIHRhcCgoKSA9PiB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmxvZ3MubGVuZ3RoKSB7XHJcbiAgICAgICAgICB0aGlzLmRpc3BhdGNoTG9ncygpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSksXHJcbiAgICAgIGZpbHRlcigoKSA9PiAhIXRoaXMubG9ncy5sZW5ndGgpLFxyXG4gICAgICBzd2l0Y2hNYXAoKCkgPT4gdGhpcy5wb3N0TWVzc2FnZXMoKSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHBvc3RNZXNzYWdlcygpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcclxuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdDx2b2lkPih0aGlzLmNvbmZpZy5lbmRwb2ludCwgdGhpcy5sb2dzLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBkaXNwYXRjaExvZ3MoKTogdm9pZCB7XHJcbiAgICB0aGlzLmxvZ3MkLm5leHQodGhpcy5sb2dzKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZGVjaWRlT25Mb2dnaW5nKGlzTG9nZ2VkSW46IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgIGlmIChpc0xvZ2dlZEluKSB7XHJcbiAgICAgIHRoaXMuc3RhcnRMb2dnaW5nKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnN0b3BMb2dnaW5nKCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==