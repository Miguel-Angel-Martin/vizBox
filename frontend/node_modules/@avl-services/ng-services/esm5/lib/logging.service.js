import { __decorate, __param } from "tslib";
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Inject, Injectable, Optional } from '@angular/core';
import { AvlAuthService } from '@avl-ng-controls/auth';
import { interval, Subject } from 'rxjs';
import { filter, switchMap, takeUntil, tap } from 'rxjs/operators';
import { Log, LogConfig, LogSeverity } from './logging.model';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@avl-ng-controls/auth";
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common/http';
import * as ɵngcc2 from '@avl-ng-controls/auth';
var LoggingService = /** @class */ (function () {
    /**
     * @ignore
     */
    function LoggingService(http, config, authService) {
        var _this = this;
        var _a;
        this.http = http;
        this.config = config;
        this.authService = authService;
        this.logs = [];
        this.isLogging = false;
        this.debounceTime$ = new Subject();
        this.logs$ = new Subject();
        this.stopLogging$ = new Subject();
        this.postLogs$ = new Subject();
        this.destroyed$ = new Subject();
        this.headers = new HttpHeaders({
            targetName: this.config.targetName,
        });
        if (config.autologging) {
            (_a = this.authService) === null || _a === void 0 ? void 0 : _a.isLoggedIn$.pipe(takeUntil(this.destroyed$)).subscribe(function (isLoggedIn) { return _this.decideOnLogging(isLoggedIn); });
        }
    }
    /**
     * @ignore
     */
    LoggingService.prototype.ngOnDestroy = function () {
        this.postLogs$.complete();
        this.debounceTime$.complete();
        this.logs$.complete();
        this.stopLogging$.next();
        this.stopLogging$.complete();
        this.destroyed$.next();
        this.destroyed$.complete();
    };
    /**
     * Starts periodical logging process.
     *
     * Depends on _debounceTime_ and _capacity_ properties.
     */
    LoggingService.prototype.startLogging = function () {
        var _this = this;
        this.isLogging = true;
        console.log('Start logging');
        this.debounceTime$
            .pipe(takeUntil(this.stopLogging$), switchMap(function (debounceTime) { return _this.periodicalLogging(debounceTime); }))
            .subscribe(function () { return _this.onPostMessages(); });
        this.postLogs$
            .pipe(takeUntil(this.stopLogging$), switchMap(function () { return _this.postMessages(); }))
            .subscribe(function () { return _this.onPostMessages(); });
        this.setLoggingDebounceTime(this.config.debounceTime);
    };
    /**
     * Stops logging process.
     */
    LoggingService.prototype.stopLogging = function () {
        this.isLogging = false;
        console.log('Stop logging');
        this.postLogs();
        this.stopLogging$.next();
    };
    /**
     * Gets all currently queued logs as an observable value.
     * @returns All currently queued logs as an observable value
     */
    LoggingService.prototype.getLogs$ = function () {
        return this.logs$.asObservable();
    };
    /**
     * Logs message with debug severity.
     * @param message Message used for constructing a debug log
     * @param componentName Name of the component which called this method
     */
    LoggingService.prototype.debug = function (message, componentName) {
        if (componentName === void 0) { componentName = ''; }
        this.log(message, LogSeverity.Debug, componentName);
    };
    /**
     * Logs message with info severity.
     * @param message Message used for constructing a info log
     * @param componentName Name of the component which called this method
     */
    LoggingService.prototype.info = function (message, componentName) {
        if (componentName === void 0) { componentName = ''; }
        this.log(message, LogSeverity.Info, componentName);
    };
    /**
     * Logs message with warning severity.
     * @param message Message used for constructing a warning log
     * @param componentName Name of the component which called this method
     */
    LoggingService.prototype.warn = function (message, componentName) {
        if (componentName === void 0) { componentName = ''; }
        this.log(message, LogSeverity.Warning, componentName);
    };
    /**
     * Logs message with error severity.
     * @param message Message used for constructing a error log
     * @param componentName Name of the component which called this method
     */
    LoggingService.prototype.error = function (message, componentName) {
        if (componentName === void 0) { componentName = ''; }
        this.log(message, LogSeverity.Error, componentName);
    };
    /**
     * Logs message with fatal severity.
     * @param message Message used for constructing a fatal log
     * @param componentName Name of the component which called this method
     */
    LoggingService.prototype.fatal = function (message, componentName) {
        if (componentName === void 0) { componentName = ''; }
        this.log(message, LogSeverity.Fatal, componentName);
    };
    /**
     * Setter for debounce time (log period).
     * @param debounceTime Time in milliseconds; determines the period of API requests for logging
     */
    LoggingService.prototype.setLoggingDebounceTime = function (debounceTime) {
        console.log('New debounce time: ', debounceTime);
        this.config.debounceTime = debounceTime;
        this.debounceTime$.next(debounceTime);
    };
    /**
     * Setter for global log level.
     * @param globalLogLevel Minimum message severity to log
     */
    LoggingService.prototype.setGlobalLogLevel = function (globalLogLevel) {
        console.log('New global log level: ', globalLogLevel);
        this.config.globalLogLevel = globalLogLevel;
    };
    /**
     * Setter for log queue capacity.
     * @param capacity Log queue capacity
     */
    LoggingService.prototype.setLogCapacity = function (capacity) {
        console.log('New capacity: ', capacity);
        this.config.capacity = capacity;
    };
    // Logic, private methods
    LoggingService.prototype.log = function (message, severity, componentName) {
        if (!this.isLogging || severity < this.config.globalLogLevel) {
            return;
        }
        this.createAndStoreLog(message, severity, componentName);
        this.dispatchLogs();
        if (this.isFullCapacity()) {
            console.log('Full capacity. Logging...');
            this.postLogs$.next();
        }
    };
    LoggingService.prototype.createAndStoreLog = function (message, severityType, componentName) {
        var timestamp = new Date().toISOString();
        var _a = this.config, appName = _a.appName, version = _a.version;
        var severity = severityType.toString();
        var log = { message: message, severity: severity, timestamp: timestamp, componentName: componentName, appName: appName, version: version };
        this.logs.push(log);
    };
    LoggingService.prototype.isFullCapacity = function () {
        return this.logs.length >= this.config.capacity;
    };
    LoggingService.prototype.clearLogs = function () {
        this.logs = [];
    };
    LoggingService.prototype.onPostMessages = function () {
        this.clearLogs();
        this.dispatchLogs();
        console.log('Logs posted.');
    };
    LoggingService.prototype.postLogs = function () {
        this.postLogs$.next();
    };
    LoggingService.prototype.periodicalLogging = function (period) {
        var _this = this;
        return interval(period).pipe(tap(function () {
            if (!_this.logs.length) {
                _this.dispatchLogs();
                console.log('Empty logs. Nothing to send.');
            }
        }), filter(function () { return !!_this.logs.length; }), tap(function () { return console.log('Time expired. Logging...'); }), switchMap(function () { return _this.postMessages(); }));
    };
    LoggingService.prototype.postMessages = function () {
        return this.http.post(this.config.endpoint, this.logs, {
            headers: this.headers,
        });
    };
    LoggingService.prototype.dispatchLogs = function () {
        this.logs$.next(this.logs);
    };
    LoggingService.prototype.decideOnLogging = function (isLoggedIn) {
        if (isLoggedIn) {
            this.startLogging();
        }
        else {
            this.stopLogging();
        }
    };
    LoggingService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: LogConfig, decorators: [{ type: Inject, args: ['loggingConfig',] }] },
        { type: AvlAuthService, decorators: [{ type: Optional }, { type: Inject, args: [AvlAuthService,] }] }
    ]; };
    LoggingService.ɵprov = i0.ɵɵdefineInjectable({ factory: function LoggingService_Factory() { return new LoggingService(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject("loggingConfig"), i0.ɵɵinject(i2.AvlAuthService, 8)); }, token: LoggingService, providedIn: "root" });
    LoggingService = __decorate([ __param(1, Inject('loggingConfig')),
        __param(2, Optional()), __param(2, Inject(AvlAuthService))
    ], LoggingService);
LoggingService.ɵfac = function LoggingService_Factory(t) { return new (t || LoggingService)(ɵngcc0.ɵɵinject(ɵngcc1.HttpClient), ɵngcc0.ɵɵinject('loggingConfig'), ɵngcc0.ɵɵinject(AvlAuthService, 8)); };
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(LoggingService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc1.HttpClient }, { type: LogConfig, decorators: [{
                type: Inject,
                args: ['loggingConfig']
            }] }, { type: ɵngcc2.AvlAuthService, decorators: [{
                type: Optional
            }, {
                type: Inject,
                args: [AvlAuthService]
            }] }]; }, null); })();
    return LoggingService;
}());
export { LoggingService };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9nZ2luZy5zZXJ2aWNlLmpzIiwic291cmNlcyI6WyJuZzovQGF2bC1zZXJ2aWNlcy9uZy1zZXJ2aWNlcy9saWIvbG9nZ2luZy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQy9ELE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFhLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN4RSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDdkQsT0FBTyxFQUFFLFFBQVEsRUFBYyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDckQsT0FBTyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ25FLE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzlEO0FBR0E7QUFDeUM7Ozs7QUFBekM7QUFBa0QsSUFXaEQ7QUFDRjtBQUNFLE9BQUc7QUFDTCxJQUFFLHdCQUNVLElBQWdCLEVBQ1MsTUFBaUIsRUFDTixXQUEyQjtBQUN4RSxRQUpELGlCQVlDO0FBQ0g7QUFFUyxRQWRHLFNBQUksR0FBSixJQUFJLENBQVk7QUFBQyxRQUNRLFdBQU0sR0FBTixNQUFNLENBQVc7QUFBQyxRQUNQLGdCQUFXLEdBQVgsV0FBVyxDQUFnQjtBQUMzRSxRQWpCVSxTQUFJLEdBQVUsRUFBRSxDQUFDO0FBQzNCLFFBQ1UsY0FBUyxHQUFHLEtBQUssQ0FBQztBQUM1QixRQUNVLGtCQUFhLEdBQW9CLElBQUksT0FBTyxFQUFFLENBQUM7QUFDekQsUUFBVSxVQUFLLEdBQW1CLElBQUksT0FBTyxFQUFFLENBQUM7QUFDaEQsUUFBVSxpQkFBWSxHQUFrQixJQUFJLE9BQU8sRUFBRSxDQUFDO0FBQ3RELFFBQVUsY0FBUyxHQUFrQixJ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QUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBS0EsQUFXQSxBQUVBLEFBQ0EsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFIQSxBQVlBLEFBWEEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBaEJBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQVVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUVBLEFBRUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBSUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQWtCQSxBQWpCQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUVBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUdBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBSUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUlBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFJQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBSUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUlBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFHQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBR0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFHQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBWUEsQUFYQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBck5BLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBakJBLEFBQUEsQUFIQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFpQkEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFqQkEsQUFBQSxBQXFPQSxBQS9PQSxBQStPQSxBQXJPQSxBQXFPQSxBQXJPQSxBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cEhlYWRlcnMgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSwgT25EZXN0cm95LCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBBdmxBdXRoU2VydmljZSB9IGZyb20gJ0BhdmwtbmctY29udHJvbHMvYXV0aCc7XHJcbmltcG9ydCB7IGludGVydmFsLCBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGZpbHRlciwgc3dpdGNoTWFwLCB0YWtlVW50aWwsIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgTG9nLCBMb2dDb25maWcsIExvZ1NldmVyaXR5IH0gZnJvbSAnLi9sb2dnaW5nLm1vZGVsJztcclxuXHJcbkBJbmplY3RhYmxlKHtcclxuICBwcm92aWRlZEluOiAncm9vdCcsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBMb2dnaW5nU2VydmljZSBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XHJcbiAgcHJpdmF0ZSBsb2dzOiBMb2dbXSA9IFtdO1xyXG4gIHByaXZhdGUgaGVhZGVyczogSHR0cEhlYWRlcnM7XHJcbiAgcHJpdmF0ZSBpc0xvZ2dpbmcgPSBmYWxzZTtcclxuXHJcbiAgcHJpdmF0ZSBkZWJvdW5jZVRpbWUkOiBTdWJqZWN0PG51bWJlcj4gPSBuZXcgU3ViamVjdCgpO1xyXG4gIHByaXZhdGUgbG9ncyQ6IFN1YmplY3Q8TG9nW10+ID0gbmV3IFN1YmplY3QoKTtcclxuICBwcml2YXRlIHN0b3BMb2dnaW5nJDogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgcHJpdmF0ZSBwb3N0TG9ncyQ6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdCgpO1xyXG4gIHByaXZhdGUgZGVzdHJveWVkJDogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0KCk7XHJcblxyXG4gIC8qKlxyXG4gICAqIEBpZ25vcmVcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgaHR0cDogSHR0cENsaWVudCxcclxuICAgIEBJbmplY3QoJ2xvZ2dpbmdDb25maWcnKSBwcml2YXRlIGNvbmZpZzogTG9nQ29uZmlnLFxyXG4gICAgQE9wdGlvbmFsKCkgQEluamVjdChBdmxBdXRoU2VydmljZSkgcHJpdmF0ZSBhdXRoU2VydmljZTogQXZsQXV0aFNlcnZpY2VcclxuICApIHtcclxuICAgIHRoaXMuaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycyh7XHJcbiAgICAgIHRhcmdldE5hbWU6IHRoaXMuY29uZmlnLnRhcmdldE5hbWUsXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoY29uZmlnLmF1dG9sb2dnaW5nKSB7XHJcbiAgICAgIHRoaXMuYXV0aFNlcnZpY2U/LmlzTG9nZ2VkSW4kLnBpcGUodGFrZVVudGlsKHRoaXMuZGVzdHJveWVkJCkpLnN1YnNjcmliZSgoaXNMb2dnZWRJbikgPT4gdGhpcy5kZWNpZGVPbkxvZ2dpbmcoaXNMb2dnZWRJbikpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGlnbm9yZVxyXG4gICAqL1xyXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgdGhpcy5wb3N0TG9ncyQuY29tcGxldGUoKTtcclxuICAgIHRoaXMuZGVib3VuY2VUaW1lJC5jb21wbGV0ZSgpO1xyXG4gICAgdGhpcy5sb2dzJC5jb21wbGV0ZSgpO1xyXG4gICAgdGhpcy5zdG9wTG9nZ2luZyQubmV4dCgpO1xyXG4gICAgdGhpcy5zdG9wTG9nZ2luZyQuY29tcGxldGUoKTtcclxuICAgIHRoaXMuZGVzdHJveWVkJC5uZXh0KCk7XHJcbiAgICB0aGlzLmRlc3Ryb3llZCQuY29tcGxldGUoKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICogU3RhcnRzIHBlcmlvZGljYWwgbG9nZ2luZyBwcm9jZXNzLlxyXG4gICAqIFxyXG4gICAqIERlcGVuZHMgb24gX2RlYm91bmNlVGltZV8gYW5kIF9jYXBhY2l0eV8gcHJvcGVydGllcy5cclxuICAgKi9cclxuICBwdWJsaWMgc3RhcnRMb2dnaW5nKCk6IHZvaWQge1xyXG4gICAgdGhpcy5pc0xvZ2dpbmcgPSB0cnVlO1xyXG4gICAgY29uc29sZS5sb2coJ1N0YXJ0IGxvZ2dpbmcnKTtcclxuICAgIHRoaXMuZGVib3VuY2VUaW1lJFxyXG4gICAgICAucGlwZShcclxuICAgICAgICB0YWtlVW50aWwodGhpcy5zdG9wTG9nZ2luZyQpLFxyXG4gICAgICAgIHN3aXRjaE1hcCgoZGVib3VuY2VUaW1lKSA9PiB0aGlzLnBlcmlvZGljYWxMb2dnaW5nKGRlYm91bmNlVGltZSkpXHJcbiAgICAgIClcclxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB0aGlzLm9uUG9zdE1lc3NhZ2VzKCkpO1xyXG5cclxuICAgIHRoaXMucG9zdExvZ3MkXHJcbiAgICAgIC5waXBlKFxyXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLnN0b3BMb2dnaW5nJCksXHJcbiAgICAgICAgc3dpdGNoTWFwKCgpID0+IHRoaXMucG9zdE1lc3NhZ2VzKCkpXHJcbiAgICAgIClcclxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB0aGlzLm9uUG9zdE1lc3NhZ2VzKCkpO1xyXG5cclxuICAgIHRoaXMuc2V0TG9nZ2luZ0RlYm91bmNlVGltZSh0aGlzLmNvbmZpZy5kZWJvdW5jZVRpbWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RvcHMgbG9nZ2luZyBwcm9jZXNzLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdG9wTG9nZ2luZygpOiB2b2lkIHtcclxuICAgIHRoaXMuaXNMb2dnaW5nID0gZmFsc2U7XHJcbiAgICBjb25zb2xlLmxvZygnU3RvcCBsb2dnaW5nJyk7XHJcbiAgICB0aGlzLnBvc3RMb2dzKCk7XHJcbiAgICB0aGlzLnN0b3BMb2dnaW5nJC5uZXh0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXRzIGFsbCBjdXJyZW50bHkgcXVldWVkIGxvZ3MgYXMgYW4gb2JzZXJ2YWJsZSB2YWx1ZS5cclxuICAgKiBAcmV0dXJucyBBbGwgY3VycmVudGx5IHF1ZXVlZCBsb2dzIGFzIGFuIG9ic2VydmFibGUgdmFsdWVcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0TG9ncyQoKTogT2JzZXJ2YWJsZTxMb2dbXT4ge1xyXG4gICAgcmV0dXJuIHRoaXMubG9ncyQuYXNPYnNlcnZhYmxlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBMb2dzIG1lc3NhZ2Ugd2l0aCBkZWJ1ZyBzZXZlcml0eS5cclxuICAgKiBAcGFyYW0gbWVzc2FnZSBNZXNzYWdlIHVzZWQgZm9yIGNvbnN0cnVjdGluZyBhIGRlYnVnIGxvZ1xyXG4gICAqIEBwYXJhbSBjb21wb25lbnROYW1lIE5hbWUgb2YgdGhlIGNvbXBvbmVudCB3aGljaCBjYWxsZWQgdGhpcyBtZXRob2RcclxuICAgKi9cclxuICBwdWJsaWMgZGVidWcobWVzc2FnZTogc3RyaW5nLCBjb21wb25lbnROYW1lOiBzdHJpbmcgPSAnJyk6IHZvaWQge1xyXG4gICAgdGhpcy5sb2cobWVzc2FnZSwgTG9nU2V2ZXJpdHkuRGVidWcsIGNvbXBvbmVudE5hbWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTG9ncyBtZXNzYWdlIHdpdGggaW5mbyBzZXZlcml0eS5cclxuICAgKiBAcGFyYW0gbWVzc2FnZSBNZXNzYWdlIHVzZWQgZm9yIGNvbnN0cnVjdGluZyBhIGluZm8gbG9nXHJcbiAgICogQHBhcmFtIGNvbXBvbmVudE5hbWUgTmFtZSBvZiB0aGUgY29tcG9uZW50IHdoaWNoIGNhbGxlZCB0aGlzIG1ldGhvZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBpbmZvKG1lc3NhZ2U6IHN0cmluZywgY29tcG9uZW50TmFtZTogc3RyaW5nID0gJycpOiB2b2lkIHtcclxuICAgIHRoaXMubG9nKG1lc3NhZ2UsIExvZ1NldmVyaXR5LkluZm8sIGNvbXBvbmVudE5hbWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTG9ncyBtZXNzYWdlIHdpdGggd2FybmluZyBzZXZlcml0eS5cclxuICAgKiBAcGFyYW0gbWVzc2FnZSBNZXNzYWdlIHVzZWQgZm9yIGNvbnN0cnVjdGluZyBhIHdhcm5pbmcgbG9nXHJcbiAgICogQHBhcmFtIGNvbXBvbmVudE5hbWUgTmFtZSBvZiB0aGUgY29tcG9uZW50IHdoaWNoIGNhbGxlZCB0aGlzIG1ldGhvZFxyXG4gICAqL1xyXG4gIHB1YmxpYyB3YXJuKG1lc3NhZ2U6IHN0cmluZywgY29tcG9uZW50TmFtZTogc3RyaW5nID0gJycpOiB2b2lkIHtcclxuICAgIHRoaXMubG9nKG1lc3NhZ2UsIExvZ1NldmVyaXR5Lldhcm5pbmcsIGNvbXBvbmVudE5hbWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTG9ncyBtZXNzYWdlIHdpdGggZXJyb3Igc2V2ZXJpdHkuXHJcbiAgICogQHBhcmFtIG1lc3NhZ2UgTWVzc2FnZSB1c2VkIGZvciBjb25zdHJ1Y3RpbmcgYSBlcnJvciBsb2dcclxuICAgKiBAcGFyYW0gY29tcG9uZW50TmFtZSBOYW1lIG9mIHRoZSBjb21wb25lbnQgd2hpY2ggY2FsbGVkIHRoaXMgbWV0aG9kXHJcbiAgICovXHJcbiAgcHVibGljIGVycm9yKG1lc3NhZ2U6IHN0cmluZywgY29tcG9uZW50TmFtZTogc3RyaW5nID0gJycpOiB2b2lkIHtcclxuICAgIHRoaXMubG9nKG1lc3NhZ2UsIExvZ1NldmVyaXR5LkVycm9yLCBjb21wb25lbnROYW1lKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIExvZ3MgbWVzc2FnZSB3aXRoIGZhdGFsIHNldmVyaXR5LlxyXG4gICAqIEBwYXJhbSBtZXNzYWdlIE1lc3NhZ2UgdXNlZCBmb3IgY29uc3RydWN0aW5nIGEgZmF0YWwgbG9nXHJcbiAgICogQHBhcmFtIGNvbXBvbmVudE5hbWUgTmFtZSBvZiB0aGUgY29tcG9uZW50IHdoaWNoIGNhbGxlZCB0aGlzIG1ldGhvZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBmYXRhbChtZXNzYWdlOiBzdHJpbmcsIGNvbXBvbmVudE5hbWU6IHN0cmluZyA9ICcnKTogdm9pZCB7XHJcbiAgICB0aGlzLmxvZyhtZXNzYWdlLCBMb2dTZXZlcml0eS5GYXRhbCwgY29tcG9uZW50TmFtZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXR0ZXIgZm9yIGRlYm91bmNlIHRpbWUgKGxvZyBwZXJpb2QpLlxyXG4gICAqIEBwYXJhbSBkZWJvdW5jZVRpbWUgVGltZSBpbiBtaWxsaXNlY29uZHM7IGRldGVybWluZXMgdGhlIHBlcmlvZCBvZiBBUEkgcmVxdWVzdHMgZm9yIGxvZ2dpbmdcclxuICAgKi9cclxuICBwdWJsaWMgc2V0TG9nZ2luZ0RlYm91bmNlVGltZShkZWJvdW5jZVRpbWU6IG51bWJlcik6IHZvaWQge1xyXG4gICAgY29uc29sZS5sb2coJ05ldyBkZWJvdW5jZSB0aW1lOiAnLCBkZWJvdW5jZVRpbWUpO1xyXG4gICAgdGhpcy5jb25maWcuZGVib3VuY2VUaW1lID0gZGVib3VuY2VUaW1lO1xyXG4gICAgdGhpcy5kZWJvdW5jZVRpbWUkLm5leHQoZGVib3VuY2VUaW1lKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHRlciBmb3IgZ2xvYmFsIGxvZyBsZXZlbC5cclxuICAgKiBAcGFyYW0gZ2xvYmFsTG9nTGV2ZWwgTWluaW11bSBtZXNzYWdlIHNldmVyaXR5IHRvIGxvZ1xyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRHbG9iYWxMb2dMZXZlbChnbG9iYWxMb2dMZXZlbDogTG9nU2V2ZXJpdHkpOiB2b2lkIHtcclxuICAgIGNvbnNvbGUubG9nKCdOZXcgZ2xvYmFsIGxvZyBsZXZlbDogJywgZ2xvYmFsTG9nTGV2ZWwpO1xyXG4gICAgdGhpcy5jb25maWcuZ2xvYmFsTG9nTGV2ZWwgPSBnbG9iYWxMb2dMZXZlbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHRlciBmb3IgbG9nIHF1ZXVlIGNhcGFjaXR5LlxyXG4gICAqIEBwYXJhbSBjYXBhY2l0eSBMb2cgcXVldWUgY2FwYWNpdHlcclxuICAgKi9cclxuICBwdWJsaWMgc2V0TG9nQ2FwYWNpdHkoY2FwYWNpdHk6IG51bWJlcik6IHZvaWQge1xyXG4gICAgY29uc29sZS5sb2coJ05ldyBjYXBhY2l0eTogJywgY2FwYWNpdHkpO1xyXG4gICAgdGhpcy5jb25maWcuY2FwYWNpdHkgPSBjYXBhY2l0eTtcclxuICB9XHJcblxyXG4gIC8vIExvZ2ljLCBwcml2YXRlIG1ldGhvZHNcclxuXHJcbiAgcHJpdmF0ZSBsb2cobWVzc2FnZTogc3RyaW5nLCBzZXZlcml0eTogTG9nU2V2ZXJpdHksIGNvbXBvbmVudE5hbWU6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLmlzTG9nZ2luZyB8fCBzZXZlcml0eSA8IHRoaXMuY29uZmlnLmdsb2JhbExvZ0xldmVsKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNyZWF0ZUFuZFN0b3JlTG9nKG1lc3NhZ2UsIHNldmVyaXR5LCBjb21wb25lbnROYW1lKTtcclxuICAgIHRoaXMuZGlzcGF0Y2hMb2dzKCk7XHJcblxyXG4gICAgaWYgKHRoaXMuaXNGdWxsQ2FwYWNpdHkoKSkge1xyXG4gICAgICBjb25zb2xlLmxvZygnRnVsbCBjYXBhY2l0eS4gTG9nZ2luZy4uLicpO1xyXG4gICAgICB0aGlzLnBvc3RMb2dzJC5uZXh0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNyZWF0ZUFuZFN0b3JlTG9nKG1lc3NhZ2U6IHN0cmluZywgc2V2ZXJpdHlUeXBlOiBMb2dTZXZlcml0eSwgY29tcG9uZW50TmFtZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XHJcbiAgICBjb25zdCB7IGFwcE5hbWUsIHZlcnNpb24gfSA9IHRoaXMuY29uZmlnO1xyXG4gICAgY29uc3Qgc2V2ZXJpdHkgPSBzZXZlcml0eVR5cGUudG9TdHJpbmcoKTtcclxuICAgIGNvbnN0IGxvZzogTG9nID0geyBtZXNzYWdlLCBzZXZlcml0eSwgdGltZXN0YW1wLCBjb21wb25lbnROYW1lLCBhcHBOYW1lLCB2ZXJzaW9uIH07XHJcbiAgICB0aGlzLmxvZ3MucHVzaChsb2cpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpc0Z1bGxDYXBhY2l0eSgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmxvZ3MubGVuZ3RoID49IHRoaXMuY29uZmlnLmNhcGFjaXR5O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjbGVhckxvZ3MoKTogdm9pZCB7XHJcbiAgICB0aGlzLmxvZ3MgPSBbXTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgb25Qb3N0TWVzc2FnZXMoKTogdm9pZCB7XHJcbiAgICB0aGlzLmNsZWFyTG9ncygpO1xyXG4gICAgdGhpcy5kaXNwYXRjaExvZ3MoKTtcclxuICAgIGNvbnNvbGUubG9nKCdMb2dzIHBvc3RlZC4nKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcG9zdExvZ3MoKTogdm9pZCB7XHJcbiAgICB0aGlzLnBvc3RMb2dzJC5uZXh0KCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHBlcmlvZGljYWxMb2dnaW5nKHBlcmlvZDogbnVtYmVyKTogT2JzZXJ2YWJsZTx2b2lkPiB7XHJcbiAgICByZXR1cm4gaW50ZXJ2YWwocGVyaW9kKS5waXBlKFxyXG4gICAgICB0YXAoKCkgPT4ge1xyXG4gICAgICAgIGlmICghdGhpcy5sb2dzLmxlbmd0aCkge1xyXG4gICAgICAgICAgdGhpcy5kaXNwYXRjaExvZ3MoKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdFbXB0eSBsb2dzLiBOb3RoaW5nIHRvIHNlbmQuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KSxcclxuICAgICAgZmlsdGVyKCgpID0+ICEhdGhpcy5sb2dzLmxlbmd0aCksXHJcbiAgICAgIHRhcCgoKSA9PiBjb25zb2xlLmxvZygnVGltZSBleHBpcmVkLiBMb2dnaW5nLi4uJykpLFxyXG4gICAgICBzd2l0Y2hNYXAoKCkgPT4gdGhpcy5wb3N0TWVzc2FnZXMoKSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHBvc3RNZXNzYWdlcygpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcclxuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdDx2b2lkPih0aGlzLmNvbmZpZy5lbmRwb2ludCwgdGhpcy5sb2dzLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBkaXNwYXRjaExvZ3MoKTogdm9pZCB7XHJcbiAgICB0aGlzLmxvZ3MkLm5leHQodGhpcy5sb2dzKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZGVjaWRlT25Mb2dnaW5nKGlzTG9nZ2VkSW46IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgIGlmIChpc0xvZ2dlZEluKSB7XHJcbiAgICAgIHRoaXMuc3RhcnRMb2dnaW5nKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnN0b3BMb2dnaW5nKCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==