import { __assign, __decorate } from "tslib";
import { Injectable } from "@angular/core";
import { TranslationManagementService } from "./translation-management.service";
import { ThemeService } from "./theme.service";
import { Subject } from "rxjs";
import { MessageType, } from "./message.model";
import * as i0 from "@angular/core";
import * as i1 from "./translation-management.service";
import * as i2 from "./theme.service";
import * as ɵngcc0 from '@angular/core';
var ChildCommunicationService = /** @class */ (function () {
    function ChildCommunicationService(translationManagementService, themeService) {
        var _a;
        var _this = this;
        this.translationManagementService = translationManagementService;
        this.themeService = themeService;
        this.handlers = (_a = {},
            _a[MessageType.login] = function (url) { return _this.handleLogin(url); },
            _a[MessageType.navigation] = function (url) { return _this.handleNavigation(url); },
            _a[MessageType.action] = function (action) { return _this.handleAction(action); },
            _a[MessageType.registration] = function (_) { return _this.handleRegistration(); },
            _a);
        this.actionSubject = new Subject();
        this.navigationSubject = new Subject();
        this.loginSubject = new Subject();
        this.registrationCompletedSubject = new Subject();
        this.action$ = this.actionSubject;
        /**
         * Observable tracking url to navigate to
         */
        this.navigation$ = this.navigationSubject;
        /**
         * Observable tracking url for login
         * Url for login provided by child application
         */
        this.login$ = this.loginSubject;
        /**
         * Observable tracking child registration
         * Emits true if registration was successful, false otherwise
         */
        this.registrationCompleted$ = this
            .registrationCompletedSubject;
        window.addEventListener("message", function (event) { return _this.onMessage(event); });
        this.themeService.themeChanged.subscribe(function () { return _this.postThemeToChildren(); });
    }
    /**
     * Sends message to child about locale
     */
    ChildCommunicationService.prototype.notifyChildAboutLocale = function (country) {
        this.postMessageToChild(MessageType.locale, country);
    };
    /**
     * Sends message to child about language
     */
    ChildCommunicationService.prototype.notifyChildAboutLanguage = function (language) {
        this.postMessageToChild(MessageType.language, language);
    };
    /**
     * Sends message to child about action
     */
    ChildCommunicationService.prototype.notifyChildAboutAction = function (action) {
        this.postMessageToChild(MessageType.action, action);
    };
    /**
     * Sends message to child about navigation
     */
    ChildCommunicationService.prototype.notifyChildAboutNavigation = function (url) {
        this.postMessageToChild(MessageType.navigation, url);
    };
    /**
     * Sends messages to children about current user
     */
    ChildCommunicationService.prototype.postAuthenticationDataToChildren = function () {
        var payload = {
            refresh_token: sessionStorage.getItem("refresh_token"),
            access_token: sessionStorage.getItem("access_token"),
            id_token: sessionStorage.getItem("id_token"),
            refresh_token_expires_at: Number(sessionStorage.getItem("refresh_token_expires_at")),
            access_token_expires_at: Number(sessionStorage.getItem("access_token_expires_at")),
            access_token_stored_at: Number(sessionStorage.getItem("access_token_stored_at")),
            username: sessionStorage.getItem("username"),
            name: sessionStorage.getItem("name"),
            roles: JSON.parse(sessionStorage.getItem("roles")),
        };
        this.postMessageToChild(MessageType.authentication, payload);
    };
    /**
     * Sends messages to children about selected application theme
     */
    ChildCommunicationService.prototype.postThemeToChildren = function () {
        var theme = this.themeService.getCurrentTheme();
        this.postMessageToChild(MessageType.theme, theme);
    };
    /**
     * Sends messages to children about selected language
     */
    ChildCommunicationService.prototype.postLanguageToChildren = function () {
        this.postMessageToChild(MessageType.language, this.translationManagementService.language);
    };
    /**
     * Sends messages to children about selected country
     */
    ChildCommunicationService.prototype.postLocaleToChildren = function () {
        var country = localStorage.getItem("country");
        this.postMessageToChild(MessageType.locale, country);
    };
    /**
     * Sends message to child about redirection from idb
     */
    ChildCommunicationService.prototype.postRedirectedFromLogIn = function (payload) {
        this.postMessageToChild(MessageType.redirectedFromLogIn, payload);
    };
    /**
     * Sends message to children about color scheme
     */
    ChildCommunicationService.prototype.postColorSchemeToChildren = function () {
        var computedStyle = window.getComputedStyle(document.body);
        var productColor = computedStyle.getPropertyValue("--avl-product-color");
        var productHoverColor = computedStyle.getPropertyValue("--avl-product-hover-color");
        var productFocusColor = computedStyle.getPropertyValue("--avl-product-focus-color");
        var colorScheme = {
            "--avl-product-color": productColor,
            "--avl-product-hover-color": productHoverColor,
            "--avl-product-focus-color": productFocusColor,
        };
        this.postMessageToChild(MessageType.colorScheme, colorScheme);
    };
    ChildCommunicationService.prototype.handleAction = function (action) {
        this.actionSubject.next(action);
    };
    ChildCommunicationService.prototype.handleNavigation = function (navigation) {
        this.navigationSubject.next(navigation);
    };
    ChildCommunicationService.prototype.handleLogin = function (login) {
        this.loginSubject.next(login);
    };
    // when child started its registration iframe is loaded and shell gets a message that he can send messages to iframe
    ChildCommunicationService.prototype.handleRegistration = function () {
        this.iframeEl = document.getElementsByTagName("iframe")[0];
        this.postThemeToChildren();
        this.postColorSchemeToChildren();
        this.postLanguageToChildren();
        this.postLocaleToChildren();
        this.registrationCompletedSubject.next(true);
    };
    ChildCommunicationService.prototype.onMessage = function (event) {
        var _a = event.data, payload = _a.payload, messageType = _a.messageType;
        var handlers = __assign(__assign({}, this.handlers), { default: function () { return console.log("Unrecognized message for the child.", event); } });
        (handlers[messageType] || handlers.default)(payload);
    };
    ChildCommunicationService.prototype.postMessageToChild = function (messageType, payload) {
        var _a;
        if (!this.iframeEl) {
            return;
        }
        var message = { messageType: messageType, payload: payload };
        (_a = this.iframeEl.contentWindow) === null || _a === void 0 ? void 0 : _a.postMessage(message, "*");
    };
    ChildCommunicationService.ctorParameters = function () { return [
        { type: TranslationManagementService },
        { type: ThemeService }
    ]; };
    ChildCommunicationService.ɵprov = i0.ɵɵdefineInjectable({ factory: function ChildCommunicationService_Factory() { return new ChildCommunicationService(i0.ɵɵinject(i1.TranslationManagementService), i0.ɵɵinject(i2.ThemeService)); }, token: ChildCommunicationService, providedIn: "root" });
ChildCommunicationService.ɵfac = function ChildCommunicationService_Factory(t) { return new (t || ChildCommunicationService)(ɵngcc0.ɵɵinject(TranslationManagementService), ɵngcc0.ɵɵinject(ThemeService)); };
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ChildCommunicationService, [{
        type: Injectable,
        args: [{
                providedIn: "root"
            }]
    }], function () { return [{ type: TranslationManagementService }, { type: ThemeService }]; }, null); })();
    return ChildCommunicationService;
}());
export { ChildCommunicationService };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hpbGQtY29tbXVuaWNhdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlcyI6WyJuZzovQGF2bC1zZXJ2aWNlcy9uZy1zZXJ2aWNlcy9saWIvY2hpbGQtY29tbXVuaWNhdGlvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQ2hGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBQUUsT0FBTyxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQzNDLE9BQU8sRUFJTCxXQUFXLEdBR1osTUFBTSxpQkFBaUIsQ0FBQztBQUN6QjtBQUdBO0FBRVk7O0FBRFo7QUFDb0IsSUFrQ2xCLG1DQUNVLDRCQUEwRCxFQUMxRCxZQUEwQjtBQUNuQztBQUNVLFFBSlgsaUJBTUM7QUFDSCxRQU5ZLGlDQUE0QixHQUE1Qiw0QkFBNEIsQ0FBOEI7QUFBQyxRQUMzRCxpQkFBWSxHQUFaLFlBQVksQ0FBYztBQUN0QyxRQXJDVSxhQUFRO0FBQWEsWUFDM0IsR0FBQyxXQUFXLENBQUMsS0FBSyxJQUFHLFVBQUMsR0FBVyxJQUFLLE9BQUEsS0FBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsRUFBckIsQ0FBcUI7QUFDL0QsWUFBSSxHQUFDLFdBQVcsQ0FBQyxVQUFVLElBQUcsVUFBQyxHQUFXLElBQUssT0FBQSxLQUFJLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLEVBQTFCLENBQTBCO0FBQ3pFLFlBQUksR0FBQyxXQUFXLENBQUMsTUFBTSxJQUFHLFVBQUMsTUFBYyxJQUFLLE9BQUEsS0FBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsRUFBekIsQ0FBeUI7QUFDdkUsWUFBSSxHQUFDLFdBQVcsQ0FBQyxZQUFZLElBQUcsVUFBQyxDQUFDLElBQUssT0FBQSxLQUFJLENBQUMsa0JB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QUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUlBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFFQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFHQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFHQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBTUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFFQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFFQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFFQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFFQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFFQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFFQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFFQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBRUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBRUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBRUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBOUpBLEFBQUEsQUFDQSxBQUFBLEFBckNBLEFBQUEsQUFIQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBbU1BLEFBbk5BLEFBbU5BLEFBbk1BLEFBbU1BLEFBbk1BLEFBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgVHJhbnNsYXRpb25NYW5hZ2VtZW50U2VydmljZSB9IGZyb20gXCIuL3RyYW5zbGF0aW9uLW1hbmFnZW1lbnQuc2VydmljZVwiO1xyXG5pbXBvcnQgeyBUaGVtZVNlcnZpY2UgfSBmcm9tIFwiLi90aGVtZS5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7IFN1YmplY3QsIE9ic2VydmFibGUgfSBmcm9tIFwicnhqc1wiO1xyXG5pbXBvcnQge1xyXG4gIENvbG9yU2NoZW1lLFxyXG4gIE1lc3NhZ2UsXHJcbiAgTWVzc2FnZUhhbmRsZXJzLFxyXG4gIE1lc3NhZ2VUeXBlLFxyXG4gIFBheWxvYWQsXHJcbiAgVXNlcixcclxufSBmcm9tIFwiLi9tZXNzYWdlLm1vZGVsXCI7XHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogXCJyb290XCIsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDaGlsZENvbW11bmljYXRpb25TZXJ2aWNlIHtcclxuICBwcml2YXRlIGhhbmRsZXJzOiBNZXNzYWdlSGFuZGxlcnMgPSB7XHJcbiAgICBbTWVzc2FnZVR5cGUubG9naW5dOiAodXJsOiBzdHJpbmcpID0+IHRoaXMuaGFuZGxlTG9naW4odXJsKSxcclxuICAgIFtNZXNzYWdlVHlwZS5uYXZpZ2F0aW9uXTogKHVybDogc3RyaW5nKSA9PiB0aGlzLmhhbmRsZU5hdmlnYXRpb24odXJsKSxcclxuICAgIFtNZXNzYWdlVHlwZS5hY3Rpb25dOiAoYWN0aW9uOiBzdHJpbmcpID0+IHRoaXMuaGFuZGxlQWN0aW9uKGFjdGlvbiksXHJcbiAgICBbTWVzc2FnZVR5cGUucmVnaXN0cmF0aW9uXTogKF8pID0+IHRoaXMuaGFuZGxlUmVnaXN0cmF0aW9uKCksXHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSBhY3Rpb25TdWJqZWN0ID0gbmV3IFN1YmplY3Q8c3RyaW5nPigpO1xyXG4gIHByaXZhdGUgbmF2aWdhdGlvblN1YmplY3QgPSBuZXcgU3ViamVjdDxzdHJpbmc+KCk7XHJcbiAgcHJpdmF0ZSBsb2dpblN1YmplY3QgPSBuZXcgU3ViamVjdDxzdHJpbmc+KCk7XHJcbiAgcHJpdmF0ZSByZWdpc3RyYXRpb25Db21wbGV0ZWRTdWJqZWN0ID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcclxuXHJcbiAgcHJvdGVjdGVkIGlmcmFtZUVsOiBIVE1MSUZyYW1lRWxlbWVudDtcclxuXHJcbiAgcHVibGljIGFjdGlvbiQ6IE9ic2VydmFibGU8c3RyaW5nPiA9IHRoaXMuYWN0aW9uU3ViamVjdDtcclxuXHJcbiAgLyoqXHJcbiAgICogT2JzZXJ2YWJsZSB0cmFja2luZyB1cmwgdG8gbmF2aWdhdGUgdG9cclxuICAgKi9cclxuICBwdWJsaWMgbmF2aWdhdGlvbiQ6IE9ic2VydmFibGU8c3RyaW5nPiA9IHRoaXMubmF2aWdhdGlvblN1YmplY3Q7XHJcblxyXG4gIC8qKlxyXG4gICAqIE9ic2VydmFibGUgdHJhY2tpbmcgdXJsIGZvciBsb2dpblxyXG4gICAqIFVybCBmb3IgbG9naW4gcHJvdmlkZWQgYnkgY2hpbGQgYXBwbGljYXRpb25cclxuICAgKi9cclxuICBwdWJsaWMgbG9naW4kOiBPYnNlcnZhYmxlPHN0cmluZz4gPSB0aGlzLmxvZ2luU3ViamVjdDtcclxuXHJcbiAgLyoqXHJcbiAgICogT2JzZXJ2YWJsZSB0cmFja2luZyBjaGlsZCByZWdpc3RyYXRpb25cclxuICAgKiBFbWl0cyB0cnVlIGlmIHJlZ2lzdHJhdGlvbiB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2Ugb3RoZXJ3aXNlXHJcbiAgICovXHJcbiAgcHVibGljIHJlZ2lzdHJhdGlvbkNvbXBsZXRlZCQ6IE9ic2VydmFibGU8Ym9vbGVhbj4gPSB0aGlzXHJcbiAgICAucmVnaXN0cmF0aW9uQ29tcGxldGVkU3ViamVjdDtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHRyYW5zbGF0aW9uTWFuYWdlbWVudFNlcnZpY2U6IFRyYW5zbGF0aW9uTWFuYWdlbWVudFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIHRoZW1lU2VydmljZTogVGhlbWVTZXJ2aWNlXHJcbiAgKSB7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgKGV2ZW50KSA9PiB0aGlzLm9uTWVzc2FnZShldmVudCkpO1xyXG4gICAgdGhpcy50aGVtZVNlcnZpY2UudGhlbWVDaGFuZ2VkLnN1YnNjcmliZSgoKSA9PiB0aGlzLnBvc3RUaGVtZVRvQ2hpbGRyZW4oKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZW5kcyBtZXNzYWdlIHRvIGNoaWxkIGFib3V0IGxvY2FsZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBub3RpZnlDaGlsZEFib3V0TG9jYWxlKGNvdW50cnk6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgdGhpcy5wb3N0TWVzc2FnZVRvQ2hpbGQoTWVzc2FnZVR5cGUubG9jYWxlLCBjb3VudHJ5KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlbmRzIG1lc3NhZ2UgdG8gY2hpbGQgYWJvdXQgbGFuZ3VhZ2VcclxuICAgKi9cclxuICBwdWJsaWMgbm90aWZ5Q2hpbGRBYm91dExhbmd1YWdlKGxhbmd1YWdlOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMucG9zdE1lc3NhZ2VUb0NoaWxkKE1lc3NhZ2VUeXBlLmxhbmd1YWdlLCBsYW5ndWFnZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZW5kcyBtZXNzYWdlIHRvIGNoaWxkIGFib3V0IGFjdGlvblxyXG4gICAqL1xyXG4gIHB1YmxpYyBub3RpZnlDaGlsZEFib3V0QWN0aW9uKGFjdGlvbjogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB0aGlzLnBvc3RNZXNzYWdlVG9DaGlsZChNZXNzYWdlVHlwZS5hY3Rpb24sIGFjdGlvbik7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZW5kcyBtZXNzYWdlIHRvIGNoaWxkIGFib3V0IG5hdmlnYXRpb25cclxuICAgKi9cclxuICBwdWJsaWMgbm90aWZ5Q2hpbGRBYm91dE5hdmlnYXRpb24odXJsOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMucG9zdE1lc3NhZ2VUb0NoaWxkKE1lc3NhZ2VUeXBlLm5hdmlnYXRpb24sIHVybCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZW5kcyBtZXNzYWdlcyB0byBjaGlsZHJlbiBhYm91dCBjdXJyZW50IHVzZXJcclxuICAgKi9cclxuICBwdWJsaWMgcG9zdEF1dGhlbnRpY2F0aW9uRGF0YVRvQ2hpbGRyZW4oKSB7XHJcbiAgICBjb25zdCBwYXlsb2FkOiBVc2VyID0ge1xyXG4gICAgICByZWZyZXNoX3Rva2VuOiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicmVmcmVzaF90b2tlblwiKSxcclxuICAgICAgYWNjZXNzX3Rva2VuOiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwiYWNjZXNzX3Rva2VuXCIpLFxyXG4gICAgICBpZF90b2tlbjogc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcImlkX3Rva2VuXCIpLFxyXG4gICAgICByZWZyZXNoX3Rva2VuX2V4cGlyZXNfYXQ6IE51bWJlcihcclxuICAgICAgICBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicmVmcmVzaF90b2tlbl9leHBpcmVzX2F0XCIpXHJcbiAgICAgICksXHJcbiAgICAgIGFjY2Vzc190b2tlbl9leHBpcmVzX2F0OiBOdW1iZXIoXHJcbiAgICAgICAgc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcImFjY2Vzc190b2tlbl9leHBpcmVzX2F0XCIpXHJcbiAgICAgICksXHJcbiAgICAgIGFjY2Vzc190b2tlbl9zdG9yZWRfYXQ6IE51bWJlcihcclxuICAgICAgICBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwiYWNjZXNzX3Rva2VuX3N0b3JlZF9hdFwiKVxyXG4gICAgICApLFxyXG4gICAgICB1c2VybmFtZTogc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInVzZXJuYW1lXCIpLFxyXG4gICAgICBuYW1lOiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwibmFtZVwiKSxcclxuICAgICAgcm9sZXM6IEpTT04ucGFyc2Uoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVzXCIpKSxcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5wb3N0TWVzc2FnZVRvQ2hpbGQoTWVzc2FnZVR5cGUuYXV0aGVudGljYXRpb24sIHBheWxvYWQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VuZHMgbWVzc2FnZXMgdG8gY2hpbGRyZW4gYWJvdXQgc2VsZWN0ZWQgYXBwbGljYXRpb24gdGhlbWVcclxuICAgKi9cclxuICBwdWJsaWMgcG9zdFRoZW1lVG9DaGlsZHJlbigpOiB2b2lkIHtcclxuICAgIGNvbnN0IHRoZW1lID0gdGhpcy50aGVtZVNlcnZpY2UuZ2V0Q3VycmVudFRoZW1lKCk7XHJcbiAgICB0aGlzLnBvc3RNZXNzYWdlVG9DaGlsZChNZXNzYWdlVHlwZS50aGVtZSwgdGhlbWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VuZHMgbWVzc2FnZXMgdG8gY2hpbGRyZW4gYWJvdXQgc2VsZWN0ZWQgbGFuZ3VhZ2VcclxuICAgKi9cclxuICBwdWJsaWMgcG9zdExhbmd1YWdlVG9DaGlsZHJlbigpOiB2b2lkIHtcclxuICAgIHRoaXMucG9zdE1lc3NhZ2VUb0NoaWxkKFxyXG4gICAgICBNZXNzYWdlVHlwZS5sYW5ndWFnZSxcclxuICAgICAgdGhpcy50cmFuc2xhdGlvbk1hbmFnZW1lbnRTZXJ2aWNlLmxhbmd1YWdlXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VuZHMgbWVzc2FnZXMgdG8gY2hpbGRyZW4gYWJvdXQgc2VsZWN0ZWQgY291bnRyeVxyXG4gICAqL1xyXG4gIHB1YmxpYyBwb3N0TG9jYWxlVG9DaGlsZHJlbigpOiB2b2lkIHtcclxuICAgIGNvbnN0IGNvdW50cnkgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImNvdW50cnlcIik7XHJcbiAgICB0aGlzLnBvc3RNZXNzYWdlVG9DaGlsZChNZXNzYWdlVHlwZS5sb2NhbGUsIGNvdW50cnkpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VuZHMgbWVzc2FnZSB0byBjaGlsZCBhYm91dCByZWRpcmVjdGlvbiBmcm9tIGlkYlxyXG4gICAqL1xyXG4gIHB1YmxpYyBwb3N0UmVkaXJlY3RlZEZyb21Mb2dJbihwYXlsb2FkOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICB0aGlzLnBvc3RNZXNzYWdlVG9DaGlsZChNZXNzYWdlVHlwZS5yZWRpcmVjdGVkRnJvbUxvZ0luLCBwYXlsb2FkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlbmRzIG1lc3NhZ2UgdG8gY2hpbGRyZW4gYWJvdXQgY29sb3Igc2NoZW1lXHJcbiAgICovXHJcbiAgcHVibGljIHBvc3RDb2xvclNjaGVtZVRvQ2hpbGRyZW4oKTogdm9pZCB7XHJcbiAgICBjb25zdCBjb21wdXRlZFN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuYm9keSk7XHJcbiAgICBjb25zdCBwcm9kdWN0Q29sb3IgPSBjb21wdXRlZFN0eWxlLmdldFByb3BlcnR5VmFsdWUoXCItLWF2bC1wcm9kdWN0LWNvbG9yXCIpO1xyXG4gICAgY29uc3QgcHJvZHVjdEhvdmVyQ29sb3IgPSBjb21wdXRlZFN0eWxlLmdldFByb3BlcnR5VmFsdWUoXHJcbiAgICAgIFwiLS1hdmwtcHJvZHVjdC1ob3Zlci1jb2xvclwiXHJcbiAgICApO1xyXG4gICAgY29uc3QgcHJvZHVjdEZvY3VzQ29sb3IgPSBjb21wdXRlZFN0eWxlLmdldFByb3BlcnR5VmFsdWUoXHJcbiAgICAgIFwiLS1hdmwtcHJvZHVjdC1mb2N1cy1jb2xvclwiXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IGNvbG9yU2NoZW1lOiBDb2xvclNjaGVtZSA9IHtcclxuICAgICAgXCItLWF2bC1wcm9kdWN0LWNvbG9yXCI6IHByb2R1Y3RDb2xvcixcclxuICAgICAgXCItLWF2bC1wcm9kdWN0LWhvdmVyLWNvbG9yXCI6IHByb2R1Y3RIb3ZlckNvbG9yLFxyXG4gICAgICBcIi0tYXZsLXByb2R1Y3QtZm9jdXMtY29sb3JcIjogcHJvZHVjdEZvY3VzQ29sb3IsXHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMucG9zdE1lc3NhZ2VUb0NoaWxkKE1lc3NhZ2VUeXBlLmNvbG9yU2NoZW1lLCBjb2xvclNjaGVtZSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhbmRsZUFjdGlvbihhY3Rpb246IHN0cmluZyk6IHZvaWQge1xyXG4gICAgdGhpcy5hY3Rpb25TdWJqZWN0Lm5leHQoYWN0aW9uKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlTmF2aWdhdGlvbihuYXZpZ2F0aW9uOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMubmF2aWdhdGlvblN1YmplY3QubmV4dChuYXZpZ2F0aW9uKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlTG9naW4obG9naW46IHN0cmluZyk6IHZvaWQge1xyXG4gICAgdGhpcy5sb2dpblN1YmplY3QubmV4dChsb2dpbik7XHJcbiAgfVxyXG5cclxuICAvLyB3aGVuIGNoaWxkIHN0YXJ0ZWQgaXRzIHJlZ2lzdHJhdGlvbiBpZnJhbWUgaXMgbG9hZGVkIGFuZCBzaGVsbCBnZXRzIGEgbWVzc2FnZSB0aGF0IGhlIGNhbiBzZW5kIG1lc3NhZ2VzIHRvIGlmcmFtZVxyXG4gIHByaXZhdGUgaGFuZGxlUmVnaXN0cmF0aW9uKCk6IHZvaWQge1xyXG4gICAgdGhpcy5pZnJhbWVFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFxyXG4gICAgICBcImlmcmFtZVwiXHJcbiAgICApWzBdIGFzIEhUTUxJRnJhbWVFbGVtZW50O1xyXG5cclxuICAgIHRoaXMucG9zdFRoZW1lVG9DaGlsZHJlbigpO1xyXG4gICAgdGhpcy5wb3N0Q29sb3JTY2hlbWVUb0NoaWxkcmVuKCk7XHJcbiAgICB0aGlzLnBvc3RMYW5ndWFnZVRvQ2hpbGRyZW4oKTtcclxuICAgIHRoaXMucG9zdExvY2FsZVRvQ2hpbGRyZW4oKTtcclxuXHJcbiAgICB0aGlzLnJlZ2lzdHJhdGlvbkNvbXBsZXRlZFN1YmplY3QubmV4dCh0cnVlKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgb25NZXNzYWdlKGV2ZW50OiBNZXNzYWdlRXZlbnQpOiB2b2lkIHtcclxuICAgIGNvbnN0IHsgcGF5bG9hZCwgbWVzc2FnZVR5cGUgfTogTWVzc2FnZSA9IGV2ZW50LmRhdGE7XHJcbiAgICBjb25zdCBoYW5kbGVycyA9IHtcclxuICAgICAgLi4udGhpcy5oYW5kbGVycyxcclxuICAgICAgZGVmYXVsdDogKCkgPT4gY29uc29sZS5sb2coXCJVbnJlY29nbml6ZWQgbWVzc2FnZSBmb3IgdGhlIGNoaWxkLlwiLCBldmVudCksXHJcbiAgICB9O1xyXG5cclxuICAgIChoYW5kbGVyc1ttZXNzYWdlVHlwZV0gfHwgaGFuZGxlcnMuZGVmYXVsdCkocGF5bG9hZCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHBvc3RNZXNzYWdlVG9DaGlsZChtZXNzYWdlVHlwZTogTWVzc2FnZVR5cGUsIHBheWxvYWQ6IFBheWxvYWQpOiB2b2lkIHtcclxuICAgIGlmICghdGhpcy5pZnJhbWVFbCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbWVzc2FnZTogTWVzc2FnZSA9IHsgbWVzc2FnZVR5cGUsIHBheWxvYWQgfTtcclxuICAgIHRoaXMuaWZyYW1lRWwuY29udGVudFdpbmRvdz8ucG9zdE1lc3NhZ2UobWVzc2FnZSwgXCIqXCIpO1xyXG4gIH1cclxufVxyXG4iXX0=