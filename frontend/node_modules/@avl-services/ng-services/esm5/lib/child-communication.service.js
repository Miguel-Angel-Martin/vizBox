import { __assign, __decorate } from "tslib";
import { Injectable } from "@angular/core";
import { TranslationManagementService } from "./translation-management.service";
import { ThemeService } from "./theme.service";
import { Subject } from "rxjs";
import { MessageType, } from "./message.model";
import { AvlAuthService, User } from '@avl-ng-controls/auth';
import * as i0 from "@angular/core";
import * as i1 from "./translation-management.service";
import * as i2 from "./theme.service";
import * as i3 from "@avl-ng-controls/auth";
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@avl-ng-controls/auth';
var ChildCommunicationService = /** @class */ (function () {
    function ChildCommunicationService(translationManagementService, themeService, authService) {
        var _a;
        var _this = this;
        this.translationManagementService = translationManagementService;
        this.themeService = themeService;
        this.authService = authService;
        this.handlers = (_a = {},
            _a[MessageType.login] = function (url) { return _this.handleLogin(url); },
            _a[MessageType.navigation] = function (url) { return _this.handleNavigation(url); },
            _a[MessageType.action] = function (action) { return _this.handleAction(action); },
            _a[MessageType.registration] = function (_) { return _this.handleRegistration(); },
            _a[MessageType.user] = function (user) { return _this.handleUser(user); },
            _a);
        this.actionSubject = new Subject();
        this.navigationSubject = new Subject();
        this.loginSubject = new Subject();
        this.registrationCompletedSubject = new Subject();
        this.action$ = this.actionSubject;
        /**
         * Observable tracking url to navigate to
         */
        this.navigation$ = this.navigationSubject;
        /**
         * Observable tracking url for login
         * Url for login provided by child application
         */
        this.login$ = this.loginSubject;
        /**
         * Observable tracking child registration
         * Emits true if registration was successful, false otherwise
         */
        this.registrationCompleted$ = this
            .registrationCompletedSubject;
        window.addEventListener("message", function (event) { return _this.onMessage(event); });
        this.themeService.themeChanged.subscribe(function () { return _this.postThemeToChildren(); });
    }
    /**
     * Sends message to child about locale
     */
    ChildCommunicationService.prototype.notifyChildAboutLocale = function (country) {
        this.postMessageToChild(MessageType.locale, country);
    };
    /**
     * Sends message to child about language
     */
    ChildCommunicationService.prototype.notifyChildAboutLanguage = function (language) {
        this.postMessageToChild(MessageType.language, language);
    };
    /**
     * Sends message to child about action
     */
    ChildCommunicationService.prototype.notifyChildAboutAction = function (action) {
        this.postMessageToChild(MessageType.action, action);
    };
    /**
     * Sends message to child about navigation
     */
    ChildCommunicationService.prototype.notifyChildAboutNavigation = function (url) {
        this.postMessageToChild(MessageType.navigation, url);
    };
    /**
     * Sends messages to children about current user
     */
    ChildCommunicationService.prototype.postAuthenticationDataToChildren = function () {
        var payload = this.authService.readUserFromSessionStorage();
        this.postMessageToChild(MessageType.authentication, payload);
    };
    /**
     * Sends messages to children about selected application theme
     */
    ChildCommunicationService.prototype.postThemeToChildren = function () {
        var theme = this.themeService.getCurrentTheme();
        this.postMessageToChild(MessageType.theme, theme);
    };
    /**
     * Sends messages to children about selected language
     */
    ChildCommunicationService.prototype.postLanguageToChildren = function () {
        this.postMessageToChild(MessageType.language, this.translationManagementService.language);
    };
    /**
     * Sends messages to children about selected country
     */
    ChildCommunicationService.prototype.postLocaleToChildren = function () {
        var country = localStorage.getItem("country");
        this.postMessageToChild(MessageType.locale, country);
    };
    /**
     * Sends message to child about redirection from idb
     */
    ChildCommunicationService.prototype.postRedirectedFromLogIn = function (payload) {
        this.postMessageToChild(MessageType.redirectedFromLogIn, payload);
    };
    /**
     * Sends message to children about color scheme
     */
    ChildCommunicationService.prototype.postColorSchemeToChildren = function () {
        var computedStyle = window.getComputedStyle(document.body);
        var productColor = computedStyle.getPropertyValue("--avl-product-color");
        var productHoverColor = computedStyle.getPropertyValue("--avl-product-hover-color");
        var productFocusColor = computedStyle.getPropertyValue("--avl-product-focus-color");
        var colorScheme = {
            "--avl-product-color": productColor,
            "--avl-product-hover-color": productHoverColor,
            "--avl-product-focus-color": productFocusColor,
        };
        this.postMessageToChild(MessageType.colorScheme, colorScheme);
    };
    ChildCommunicationService.prototype.handleAction = function (action) {
        this.actionSubject.next(action);
    };
    ChildCommunicationService.prototype.handleNavigation = function (navigation) {
        this.navigationSubject.next(navigation);
    };
    ChildCommunicationService.prototype.handleLogin = function (login) {
        this.loginSubject.next(login);
    };
    // when child started its registration iframe is loaded and shell gets a message that he can send messages to iframe
    ChildCommunicationService.prototype.handleRegistration = function () {
        this.iframeEl = document.getElementsByTagName("iframe")[0];
        this.postThemeToChildren();
        this.postColorSchemeToChildren();
        this.postLanguageToChildren();
        this.postLocaleToChildren();
        this.registrationCompletedSubject.next(true);
    };
    ChildCommunicationService.prototype.onMessage = function (event) {
        var _a = event.data, payload = _a.payload, messageType = _a.messageType;
        var handlers = __assign(__assign({}, this.handlers), { default: function () { return console.log("Unrecognized message for the child.", event); } });
        (handlers[messageType] || handlers.default)(payload);
    };
    ChildCommunicationService.prototype.postMessageToChild = function (messageType, payload) {
        var _a;
        if (!this.iframeEl) {
            return;
        }
        var message = { messageType: messageType, payload: payload };
        (_a = this.iframeEl.contentWindow) === null || _a === void 0 ? void 0 : _a.postMessage(message, "*");
    };
    // when child updates user data, it has to reflect in user data in shell
    ChildCommunicationService.prototype.handleUser = function (user) {
        if (user === null || user === void 0 ? void 0 : user.access_token) {
            this.authService.storeUserToSessionStorage(user);
        }
        else {
            this.authService.clearUserFromSessionStorage();
        }
        this.authService.reloadPersistedUserData();
    };
    ChildCommunicationService.ctorParameters = function () { return [
        { type: TranslationManagementService },
        { type: ThemeService },
        { type: AvlAuthService }
    ]; };
    ChildCommunicationService.ɵprov = i0.ɵɵdefineInjectable({ factory: function ChildCommunicationService_Factory() { return new ChildCommunicationService(i0.ɵɵinject(i1.TranslationManagementService), i0.ɵɵinject(i2.ThemeService), i0.ɵɵinject(i3.AvlAuthService)); }, token: ChildCommunicationService, providedIn: "root" });
ChildCommunicationService.ɵfac = function ChildCommunicationService_Factory(t) { return new (t || ChildCommunicationService)(ɵngcc0.ɵɵinject(TranslationManagementService), ɵngcc0.ɵɵinject(ThemeService), ɵngcc0.ɵɵinject(ɵngcc1.AvlAuthService)); };
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ChildCommunicationService, [{
        type: Injectable,
        args: [{
                providedIn: "root"
            }]
    }], function () { return [{ type: TranslationManagementService }, { type: ThemeService }, { type: ɵngcc1.AvlAuthService }]; }, null); })();
    return ChildCommunicationService;
}());
export { ChildCommunicationService };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hpbGQtY29tbXVuaWNhdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlcyI6WyJuZzovQGF2bC1zZXJ2aWNlcy9uZy1zZXJ2aWNlcy9saWIvY2hpbGQtY29tbXVuaWNhdGlvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQ2hGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBQUUsT0FBTyxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQzNDLE9BQU8sRUFJTCxXQUFXLEdBRVosTUFBTSxpQkFBaUIsQ0FBQztBQUN6QixPQUFPLEVBQUUsY0FBYyxFQUFFLElBQUksRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzdEO0FBR0E7QUFFWTtBQUNEOzs7QUFGWDtBQUNvQixJQW1DbEIsbUNBQ1UsNEJBQTBELEVBQzFELFlBQTBCLEVBQzFCLFdBQTJCO0FBQ3BDO0FBQ1UsUUFMWCxpQkFPQztBQUNILFFBUFksaUNBQTRCLEdBQTVCLDRCQUE0QixDQUE4QjtBQUFDLFFBQzNELGlCQUFZLEdBQVosWUFBWSxDQUFjO0FBQUMsUUFDM0IsZ0JBQVcsR0FBWCxXQUFXLENBQWdCO0FBQ3ZDLFFBdkNVLGFBQVE7QUFBYSxZQUMzQixHQUFDLFdBQVcsQ0FBQyxLQUFLLElBQUcsVUFBQyxHQUFXLElBQUssT0FBQSxLQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxFQUFyQixDQUFxQjtBQUMvRCxZQUFJLEdBQUMsV0FBVyxDQUFDLFVBQVUsSUFBRyxVQUFDLEdBQVcsSUFBSyxPQUFBLEtBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsRUFBMUIsQ0FBMEI7QUFDekUsWUFBSSxHQUFDLFdBQVcsQ0FBQyxNQUFNLElBQUcsVUFBQyxNQUFjLElBQUssT0FBQSxLQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxFQUF6QixDQUF5QjtBQUN2RSxZQUFJLEdBQUMsV0FBVyxDQUFDLFlBQVksSUFBRyxVQUFDLENBQUMsSUFBSyxPQUFBLEtBQUksQ0FBQyxrQkFBa0IsRUFBRSxFQUF6QixDQUF5QjtBQUNoRSxZQUFJLEdBQUMsV0FBVyxDQUFDLElBQUksSUFBRyxVQUFDLElBQVUsSUFBSyxPQUFBLEtBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQXJCLENBQXFCO0FBQzdELGdCQUFJO0FBQ0osUUFDVSxrQkFBYSxHQUFHLElBQUksT0FBTyxFQUFVLENBQUM7QUFDaEQsUUFBVSxzQkFBaUIsR0FBRyxJQUFJLE9BQU8sRUFBVSxDQUFDO0FBQ3BELFFBQVUsaUJBQVksR0FBRyxJQUFJLE9BQU8sRUFBVSxDQUFDO0FBQy9DLFFBQVUsaUNBQTRCLEdBQUcsSUFBSSxPQUFPLEVBQVcsQ0FBQztBQUNoRSxRQUdTLFlBQU8sR0FBdUIsSUFBSSxDQUFDLGFBQWEsQ0FBQztBQUMxRCxRQUNFO0FBQ0Y7QUFFQSxXQURLO0FBQ0wsUUFBUyxnQkFBVyxHQUF1QixJQUFJLENBQUMsaUJBQWlCLENBQUM7QUFDbEUsUUFDRTtBQUNGO0FBQ007QUFFQSxXQUREO0FBQ0wsUUFBUyxXQUFNLEdBQXVCLElBQUksQ0FBQyxZQUFZLENBQUM7QUFDeEQsUUFDRTtBQUNGO0FBQ007QUFFQSxXQUREO0FBQ0wsUUFBUywyQkFBc0IsR0FBd0IsSUFBSTtBQUMzRCxhQUFLLDRCQUE0QixDQUFDO0FBQ2xDLFFBTUksTUFBTSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxVQUFDLEtBQUssSUFBSyxPQUFBLEtBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLEVBQXJCLENBQXFCLENBQUMsQ0FBQztBQUN6RSxRQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxjQUFNLE9BQUEsS0FBSSxDQUFDLG1CQUFtQixFQUFFLEVBQTFCLENBQTBCLENBQUMsQ0FBQztBQUMvRSxJQUFFLENBQUM7QUFDSCxJQUNFO0FBQ0Y7QUFDRSxPQUFHO0FBQ0wsSUFBUywwREFBc0IsR0FBN0IsVUFBOEIsT0FBZTtBQUFJLFFBQy9DLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ3pELElBQUUsQ0FBQztBQUVILElBQUU7QUFDRjtBQUNFLE9BQUc7QUFDTCxJQUFTLDREQUF3QixHQUEvQixVQUFnQyxRQUFnQjtBQUFJLFFBQ2xELElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBQzVELElBQUUsQ0FBQztBQUVILElBQUU7QUFDRjtBQUNFLE9BQUc7QUFDTCxJQUFTLDBEQUFzQixHQUE3QixVQUE4QixNQUFjO0FBQUksUUFDOUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDeEQsSUFBRSxDQUFDO0FBRUgsSUFBRTtBQUNGO0FBQ0UsT0FBRztBQUNMLElBQVMsOERBQTBCLEdBQWpDLFVBQWtDLEdBQVc7QUFBSSxRQUMvQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsV0FBVyxDQUFDLFVBQVUsRUFBRSxHQUFHLENBQUMsQ0FBQztBQUN6RCxJQUFFLENBQUM7QUFFSCxJQUFFO0FBQ0Y7QUFDRSxPQUFHO0FBQ0wsSUFBUyxvRUFBZ0MsR0FBdkM7QUFBYyxRQUNaLElBQU0sT0FBTyxHQUFTLElBQUksQ0FBQyxXQUFXLENBQUMsMEJBQTBCLEVBQUUsQ0FBQztBQUN4RSxRQUFJLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLENBQUMsY0FBYyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ2pFLElBQUUsQ0FBQztBQUVILElBQUU7QUFDRjtBQUNFLE9BQUc7QUFDTCxJQUFTLHVEQUFtQixHQUExQjtBQUFjLFFBQ1osSUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxlQUFlLEVBQUUsQ0FBQztBQUN0RCxRQUFJLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ3RELElBQUUsQ0FBQztBQUVILElBQUU7QUFDRjtBQUNFLE9BQUc7QUFDTCxJQUFTLDBEQUFzQixHQUE3QjtBQUFjLFFBQ1osSUFBSSxDQUFDLGtCQUFrQixDQUNyQixXQUFXLENBQUMsUUFBUSxFQUNwQixJQUFJLENBQUMsNEJBQTRCLENBQUMsUUFBUSxDQUMzQyxDQUFDO0FBQ04sSUFBRSxDQUFDO0FBRUgsSUFBRTtBQUNGO0FBQ0UsT0FBRztBQUNMLElBQVMsd0RBQW9CLEdBQTNCO0FBQWMsUUFDWixJQUFNLE9BQU8sR0FBRyxZQUFZLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ3BELFFBQUksSUFBSSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDekQsSUFBRSxDQUFDO0FBRUgsSUFBRTtBQUNGO0FBQ0UsT0FBRztBQUNMLElBQVMsMkRBQXVCLEdBQTlCLFVBQStCLE9BQWdCO0FBQUksUUFDakQsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxtQkFBbUIsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUN0RSxJQUFFLENBQUM7QUFFSCxJQUFFO0FBQ0Y7QUFDRSxPQUFHO0FBQ0wsSUFBUyw2REFBeUIsR0FBaEM7QUFBYyxRQUNaLElBQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDakUsUUFBSSxJQUFNLFlBQVksR0FBRyxhQUFhLENBQUMsZ0JBQWdCLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQUMvRSxRQUFJLElBQU0saUJBQWlCLEdBQUcsYUFBYSxDQUFDLGdCQUFnQixDQUN0RCwyQkFBMkIsQ0FDNUIsQ0FBQztBQUNOLFFBQUksSUFBTSxpQkFBaUIsR0FBRyxhQUFhLENBQUMsZ0JBQWdCLENBQ3RELDJCQUEyQixDQUM1QixDQUFDO0FBQ04sUUFDSSxJQUFNLFdBQVcsR0FBZ0I7QUFDckMsWUFBTSxxQkFBcUIsRUFBRSxZQUFZO0FBQ3pDLFlBQU0sMkJBQTJCLEVBQUUsaUJBQWlCO0FBQ3BELFlBQU0sMkJBQTJCLEVBQUUsaUJBQWlCO0FBQ3BELFNBQUssQ0FBQztBQUNOLFFBQ0ksSUFBSSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxXQUFXLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFDbEUsSUFBRSxDQUFDO0FBRUgsSUFBVSxnREFBWSxHQUFwQixVQUFxQixNQUFjO0FBQUksUUFDckMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDcEMsSUFBRSxDQUFDO0FBRUgsSUFBVSxvREFBZ0IsR0FBeEIsVUFBeUIsVUFBa0I7QUFBSSxRQUM3QyxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQzVDLElBQUUsQ0FBQztBQUVILElBQVUsK0NBQVcsR0FBbkIsVUFBb0IsS0FBYTtBQUFJLFFBQ25DLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ2xDLElBQUUsQ0FBQztBQUVILElBQUUsb0hBQW9IO0FBQ3RILElBQVUsc0RBQWtCLEdBQTFCO0FBQWMsUUFDWixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQyxvQkFBb0IsQ0FDM0MsUUFBUSxDQUNULENBQUMsQ0FBQyxDQUFzQixDQUFDO0FBQzlCLFFBQ0ksSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7QUFDL0IsUUFBSSxJQUFJLENBQUMseUJBQXlCLEVBQUUsQ0FBQztBQUNyQyxRQUFJLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO0FBQ2xDLFFBQUksSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7QUFDaEMsUUFDSSxJQUFJLENBQUMsNEJBQTRCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ2pELElBQUUsQ0FBQztBQUVILElBQVUsNkNBQVMsR0FBakIsVUFBa0IsS0FBbUI7QUFBSSxRQUNqQyxJQUFBLGVBQThDLEVBQTVDLG9CQUFPLEVBQUUsNEJBQW1DLENBQUM7QUFDekQsUUFBSSxJQUFNLFFBQVEseUJBQ1QsSUFBSSxDQUFDLFFBQVEsS0FDaEIsT0FBTyxFQUFFLGNBQU0sT0FBQSxPQUFPLENBQUMsR0FBRyxDQUFDLHFDQUFxQyxFQUFFLEtBQUssQ0FBQyxFQUF6RCxDQUF5RCxHQUN6RSxDQUFDO0FBQ04sUUFDSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDekQsSUFBRSxDQUFDO0FBRUgsSUFBVSxzREFBa0IsR0FBMUIsVUFBMkIsV0FBd0IsRUFBRSxPQUFnQjtBQUFJO0FBQ2pFLFFBQU4sSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUU7QUFDeEIsWUFBTSxPQUFPO0FBQ2IsU0FBSztBQUNMLFFBQ0ksSUFBTSxPQUFPLEdBQVksRUFBRSxXQUFXLGFBQUEsRUFBRSxPQUFPLFNBQUEsRUFBRSxDQUFDO0FBQ3RELFFBQUksTUFBQSxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsMENBQUUsV0FBVyxDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUU7QUFDM0QsSUFBRSxDQUFDO0FBRUgsSUFBRSx3RUFBd0U7QUFDMUUsSUFBVSw4Q0FBVSxHQUFsQixVQUFtQixJQUFVO0FBQy9CLFFBQUksSUFBSSxJQUFJLGFBQUosSUFBSSx1QkFBSixJQUFJLENBQUUsWUFBWSxFQUFFO0FBQzVCLFlBQU0sSUFBSSxDQUFDLFdBQVcsQ0FBQyx5QkFBeUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUN2RCxTQUFLO0FBQUMsYUFBSztBQUNYLFlBQU0sSUFBSSxDQUFDLFdBQVcsQ0FBQywyQkFBMkIsRUFBRSxDQUFDO0FBQ3JELFNBQUs7QUFDTCxRQUNJLElBQUksQ0FBQyxXQUFXLENBQUMsdUJBQXVCLEVBQUUsQ0FBQztBQUMvQyxJQUFFLENBQUM7QUFDRjtBQUNvRSxnQkEzSjNCLDRCQUE0QjtBQUNwRSxnQkFBd0IsWUFBWTtBQUNwQyxnQkFBdUIsY0FBYztBQUNyQztBQUNJO0lBekNPLHlCQUF5Qix3QkFIckMsVUFBVSxDQUFDLGNBQ1YsVUFBVSxFQUFFLE1BQU0sV0FDbkIsQ0FBQyxRQUNXLHlCQUF5QixDQStMckM7Ozs7OzsrSUFDRDtBQUFDLG9DQWhORDtBQUFFLENBK01ELEFBL0xELElBK0xDOztBQS9NQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUlBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBS0EsQUFvQ0EsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFIQSxBQU9BLEFBTkEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBdENBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFJQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBRUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBR0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBR0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQU9BLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBRUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBRUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBRUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBRUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBRUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBRUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBRUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUVBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUVBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUVBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQXpKQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUF2Q0EsQUFBQSxBQUhBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUErTEEsQUEvTUEsQUErTUEsQUEvTEEsQUErTEEsQUEvTEEsQUFBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQgeyBUcmFuc2xhdGlvbk1hbmFnZW1lbnRTZXJ2aWNlIH0gZnJvbSBcIi4vdHJhbnNsYXRpb24tbWFuYWdlbWVudC5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7IFRoZW1lU2VydmljZSB9IGZyb20gXCIuL3RoZW1lLnNlcnZpY2VcIjtcclxuaW1wb3J0IHsgU3ViamVjdCwgT2JzZXJ2YWJsZSB9IGZyb20gXCJyeGpzXCI7XHJcbmltcG9ydCB7XHJcbiAgQ29sb3JTY2hlbWUsXHJcbiAgTWVzc2FnZSxcclxuICBNZXNzYWdlSGFuZGxlcnMsXHJcbiAgTWVzc2FnZVR5cGUsXHJcbiAgUGF5bG9hZCxcclxufSBmcm9tIFwiLi9tZXNzYWdlLm1vZGVsXCI7XHJcbmltcG9ydCB7IEF2bEF1dGhTZXJ2aWNlLCBVc2VyIH0gZnJvbSAnQGF2bC1uZy1jb250cm9scy9hdXRoJztcclxuXHJcbkBJbmplY3RhYmxlKHtcclxuICBwcm92aWRlZEluOiBcInJvb3RcIixcclxufSlcclxuZXhwb3J0IGNsYXNzIENoaWxkQ29tbXVuaWNhdGlvblNlcnZpY2Uge1xyXG4gIHByaXZhdGUgaGFuZGxlcnM6IE1lc3NhZ2VIYW5kbGVycyA9IHtcclxuICAgIFtNZXNzYWdlVHlwZS5sb2dpbl06ICh1cmw6IHN0cmluZykgPT4gdGhpcy5oYW5kbGVMb2dpbih1cmwpLFxyXG4gICAgW01lc3NhZ2VUeXBlLm5hdmlnYXRpb25dOiAodXJsOiBzdHJpbmcpID0+IHRoaXMuaGFuZGxlTmF2aWdhdGlvbih1cmwpLFxyXG4gICAgW01lc3NhZ2VUeXBlLmFjdGlvbl06IChhY3Rpb246IHN0cmluZykgPT4gdGhpcy5oYW5kbGVBY3Rpb24oYWN0aW9uKSxcclxuICAgIFtNZXNzYWdlVHlwZS5yZWdpc3RyYXRpb25dOiAoXykgPT4gdGhpcy5oYW5kbGVSZWdpc3RyYXRpb24oKSxcclxuICAgIFtNZXNzYWdlVHlwZS51c2VyXTogKHVzZXI6IFVzZXIpID0+IHRoaXMuaGFuZGxlVXNlcih1c2VyKSxcclxuICB9O1xyXG5cclxuICBwcml2YXRlIGFjdGlvblN1YmplY3QgPSBuZXcgU3ViamVjdDxzdHJpbmc+KCk7XHJcbiAgcHJpdmF0ZSBuYXZpZ2F0aW9uU3ViamVjdCA9IG5ldyBTdWJqZWN0PHN0cmluZz4oKTtcclxuICBwcml2YXRlIGxvZ2luU3ViamVjdCA9IG5ldyBTdWJqZWN0PHN0cmluZz4oKTtcclxuICBwcml2YXRlIHJlZ2lzdHJhdGlvbkNvbXBsZXRlZFN1YmplY3QgPSBuZXcgU3ViamVjdDxib29sZWFuPigpO1xyXG5cclxuICBwcm90ZWN0ZWQgaWZyYW1lRWw6IEhUTUxJRnJhbWVFbGVtZW50O1xyXG5cclxuICBwdWJsaWMgYWN0aW9uJDogT2JzZXJ2YWJsZTxzdHJpbmc+ID0gdGhpcy5hY3Rpb25TdWJqZWN0O1xyXG5cclxuICAvKipcclxuICAgKiBPYnNlcnZhYmxlIHRyYWNraW5nIHVybCB0byBuYXZpZ2F0ZSB0b1xyXG4gICAqL1xyXG4gIHB1YmxpYyBuYXZpZ2F0aW9uJDogT2JzZXJ2YWJsZTxzdHJpbmc+ID0gdGhpcy5uYXZpZ2F0aW9uU3ViamVjdDtcclxuXHJcbiAgLyoqXHJcbiAgICogT2JzZXJ2YWJsZSB0cmFja2luZyB1cmwgZm9yIGxvZ2luXHJcbiAgICogVXJsIGZvciBsb2dpbiBwcm92aWRlZCBieSBjaGlsZCBhcHBsaWNhdGlvblxyXG4gICAqL1xyXG4gIHB1YmxpYyBsb2dpbiQ6IE9ic2VydmFibGU8c3RyaW5nPiA9IHRoaXMubG9naW5TdWJqZWN0O1xyXG5cclxuICAvKipcclxuICAgKiBPYnNlcnZhYmxlIHRyYWNraW5nIGNoaWxkIHJlZ2lzdHJhdGlvblxyXG4gICAqIEVtaXRzIHRydWUgaWYgcmVnaXN0cmF0aW9uIHdhcyBzdWNjZXNzZnVsLCBmYWxzZSBvdGhlcndpc2VcclxuICAgKi9cclxuICBwdWJsaWMgcmVnaXN0cmF0aW9uQ29tcGxldGVkJDogT2JzZXJ2YWJsZTxib29sZWFuPiA9IHRoaXNcclxuICAgIC5yZWdpc3RyYXRpb25Db21wbGV0ZWRTdWJqZWN0O1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgdHJhbnNsYXRpb25NYW5hZ2VtZW50U2VydmljZTogVHJhbnNsYXRpb25NYW5hZ2VtZW50U2VydmljZSxcclxuICAgIHByaXZhdGUgdGhlbWVTZXJ2aWNlOiBUaGVtZVNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGF1dGhTZXJ2aWNlOiBBdmxBdXRoU2VydmljZVxyXG4gICkge1xyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIChldmVudCkgPT4gdGhpcy5vbk1lc3NhZ2UoZXZlbnQpKTtcclxuICAgIHRoaXMudGhlbWVTZXJ2aWNlLnRoZW1lQ2hhbmdlZC5zdWJzY3JpYmUoKCkgPT4gdGhpcy5wb3N0VGhlbWVUb0NoaWxkcmVuKCkpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VuZHMgbWVzc2FnZSB0byBjaGlsZCBhYm91dCBsb2NhbGVcclxuICAgKi9cclxuICBwdWJsaWMgbm90aWZ5Q2hpbGRBYm91dExvY2FsZShjb3VudHJ5OiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMucG9zdE1lc3NhZ2VUb0NoaWxkKE1lc3NhZ2VUeXBlLmxvY2FsZSwgY291bnRyeSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZW5kcyBtZXNzYWdlIHRvIGNoaWxkIGFib3V0IGxhbmd1YWdlXHJcbiAgICovXHJcbiAgcHVibGljIG5vdGlmeUNoaWxkQWJvdXRMYW5ndWFnZShsYW5ndWFnZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB0aGlzLnBvc3RNZXNzYWdlVG9DaGlsZChNZXNzYWdlVHlwZS5sYW5ndWFnZSwgbGFuZ3VhZ2UpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VuZHMgbWVzc2FnZSB0byBjaGlsZCBhYm91dCBhY3Rpb25cclxuICAgKi9cclxuICBwdWJsaWMgbm90aWZ5Q2hpbGRBYm91dEFjdGlvbihhY3Rpb246IHN0cmluZyk6IHZvaWQge1xyXG4gICAgdGhpcy5wb3N0TWVzc2FnZVRvQ2hpbGQoTWVzc2FnZVR5cGUuYWN0aW9uLCBhY3Rpb24pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VuZHMgbWVzc2FnZSB0byBjaGlsZCBhYm91dCBuYXZpZ2F0aW9uXHJcbiAgICovXHJcbiAgcHVibGljIG5vdGlmeUNoaWxkQWJvdXROYXZpZ2F0aW9uKHVybDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB0aGlzLnBvc3RNZXNzYWdlVG9DaGlsZChNZXNzYWdlVHlwZS5uYXZpZ2F0aW9uLCB1cmwpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VuZHMgbWVzc2FnZXMgdG8gY2hpbGRyZW4gYWJvdXQgY3VycmVudCB1c2VyXHJcbiAgICovXHJcbiAgcHVibGljIHBvc3RBdXRoZW50aWNhdGlvbkRhdGFUb0NoaWxkcmVuKCkge1xyXG4gICAgY29uc3QgcGF5bG9hZDogVXNlciA9IHRoaXMuYXV0aFNlcnZpY2UucmVhZFVzZXJGcm9tU2Vzc2lvblN0b3JhZ2UoKTtcclxuICAgIHRoaXMucG9zdE1lc3NhZ2VUb0NoaWxkKE1lc3NhZ2VUeXBlLmF1dGhlbnRpY2F0aW9uLCBwYXlsb2FkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlbmRzIG1lc3NhZ2VzIHRvIGNoaWxkcmVuIGFib3V0IHNlbGVjdGVkIGFwcGxpY2F0aW9uIHRoZW1lXHJcbiAgICovXHJcbiAgcHVibGljIHBvc3RUaGVtZVRvQ2hpbGRyZW4oKTogdm9pZCB7XHJcbiAgICBjb25zdCB0aGVtZSA9IHRoaXMudGhlbWVTZXJ2aWNlLmdldEN1cnJlbnRUaGVtZSgpO1xyXG4gICAgdGhpcy5wb3N0TWVzc2FnZVRvQ2hpbGQoTWVzc2FnZVR5cGUudGhlbWUsIHRoZW1lKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlbmRzIG1lc3NhZ2VzIHRvIGNoaWxkcmVuIGFib3V0IHNlbGVjdGVkIGxhbmd1YWdlXHJcbiAgICovXHJcbiAgcHVibGljIHBvc3RMYW5ndWFnZVRvQ2hpbGRyZW4oKTogdm9pZCB7XHJcbiAgICB0aGlzLnBvc3RNZXNzYWdlVG9DaGlsZChcclxuICAgICAgTWVzc2FnZVR5cGUubGFuZ3VhZ2UsXHJcbiAgICAgIHRoaXMudHJhbnNsYXRpb25NYW5hZ2VtZW50U2VydmljZS5sYW5ndWFnZVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlbmRzIG1lc3NhZ2VzIHRvIGNoaWxkcmVuIGFib3V0IHNlbGVjdGVkIGNvdW50cnlcclxuICAgKi9cclxuICBwdWJsaWMgcG9zdExvY2FsZVRvQ2hpbGRyZW4oKTogdm9pZCB7XHJcbiAgICBjb25zdCBjb3VudHJ5ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJjb3VudHJ5XCIpO1xyXG4gICAgdGhpcy5wb3N0TWVzc2FnZVRvQ2hpbGQoTWVzc2FnZVR5cGUubG9jYWxlLCBjb3VudHJ5KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlbmRzIG1lc3NhZ2UgdG8gY2hpbGQgYWJvdXQgcmVkaXJlY3Rpb24gZnJvbSBpZGJcclxuICAgKi9cclxuICBwdWJsaWMgcG9zdFJlZGlyZWN0ZWRGcm9tTG9nSW4ocGF5bG9hZDogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgdGhpcy5wb3N0TWVzc2FnZVRvQ2hpbGQoTWVzc2FnZVR5cGUucmVkaXJlY3RlZEZyb21Mb2dJbiwgcGF5bG9hZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZW5kcyBtZXNzYWdlIHRvIGNoaWxkcmVuIGFib3V0IGNvbG9yIHNjaGVtZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBwb3N0Q29sb3JTY2hlbWVUb0NoaWxkcmVuKCk6IHZvaWQge1xyXG4gICAgY29uc3QgY29tcHV0ZWRTdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGRvY3VtZW50LmJvZHkpO1xyXG4gICAgY29uc3QgcHJvZHVjdENvbG9yID0gY29tcHV0ZWRTdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKFwiLS1hdmwtcHJvZHVjdC1jb2xvclwiKTtcclxuICAgIGNvbnN0IHByb2R1Y3RIb3ZlckNvbG9yID0gY29tcHV0ZWRTdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKFxyXG4gICAgICBcIi0tYXZsLXByb2R1Y3QtaG92ZXItY29sb3JcIlxyXG4gICAgKTtcclxuICAgIGNvbnN0IHByb2R1Y3RGb2N1c0NvbG9yID0gY29tcHV0ZWRTdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKFxyXG4gICAgICBcIi0tYXZsLXByb2R1Y3QtZm9jdXMtY29sb3JcIlxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBjb2xvclNjaGVtZTogQ29sb3JTY2hlbWUgPSB7XHJcbiAgICAgIFwiLS1hdmwtcHJvZHVjdC1jb2xvclwiOiBwcm9kdWN0Q29sb3IsXHJcbiAgICAgIFwiLS1hdmwtcHJvZHVjdC1ob3Zlci1jb2xvclwiOiBwcm9kdWN0SG92ZXJDb2xvcixcclxuICAgICAgXCItLWF2bC1wcm9kdWN0LWZvY3VzLWNvbG9yXCI6IHByb2R1Y3RGb2N1c0NvbG9yLFxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLnBvc3RNZXNzYWdlVG9DaGlsZChNZXNzYWdlVHlwZS5jb2xvclNjaGVtZSwgY29sb3JTY2hlbWUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYW5kbGVBY3Rpb24oYWN0aW9uOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMuYWN0aW9uU3ViamVjdC5uZXh0KGFjdGlvbik7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhbmRsZU5hdmlnYXRpb24obmF2aWdhdGlvbjogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB0aGlzLm5hdmlnYXRpb25TdWJqZWN0Lm5leHQobmF2aWdhdGlvbik7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhbmRsZUxvZ2luKGxvZ2luOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMubG9naW5TdWJqZWN0Lm5leHQobG9naW4pO1xyXG4gIH1cclxuXHJcbiAgLy8gd2hlbiBjaGlsZCBzdGFydGVkIGl0cyByZWdpc3RyYXRpb24gaWZyYW1lIGlzIGxvYWRlZCBhbmQgc2hlbGwgZ2V0cyBhIG1lc3NhZ2UgdGhhdCBoZSBjYW4gc2VuZCBtZXNzYWdlcyB0byBpZnJhbWVcclxuICBwcml2YXRlIGhhbmRsZVJlZ2lzdHJhdGlvbigpOiB2b2lkIHtcclxuICAgIHRoaXMuaWZyYW1lRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcclxuICAgICAgXCJpZnJhbWVcIlxyXG4gICAgKVswXSBhcyBIVE1MSUZyYW1lRWxlbWVudDtcclxuXHJcbiAgICB0aGlzLnBvc3RUaGVtZVRvQ2hpbGRyZW4oKTtcclxuICAgIHRoaXMucG9zdENvbG9yU2NoZW1lVG9DaGlsZHJlbigpO1xyXG4gICAgdGhpcy5wb3N0TGFuZ3VhZ2VUb0NoaWxkcmVuKCk7XHJcbiAgICB0aGlzLnBvc3RMb2NhbGVUb0NoaWxkcmVuKCk7XHJcblxyXG4gICAgdGhpcy5yZWdpc3RyYXRpb25Db21wbGV0ZWRTdWJqZWN0Lm5leHQodHJ1ZSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9uTWVzc2FnZShldmVudDogTWVzc2FnZUV2ZW50KTogdm9pZCB7XHJcbiAgICBjb25zdCB7IHBheWxvYWQsIG1lc3NhZ2VUeXBlIH06IE1lc3NhZ2UgPSBldmVudC5kYXRhO1xyXG4gICAgY29uc3QgaGFuZGxlcnMgPSB7XHJcbiAgICAgIC4uLnRoaXMuaGFuZGxlcnMsXHJcbiAgICAgIGRlZmF1bHQ6ICgpID0+IGNvbnNvbGUubG9nKFwiVW5yZWNvZ25pemVkIG1lc3NhZ2UgZm9yIHRoZSBjaGlsZC5cIiwgZXZlbnQpLFxyXG4gICAgfTtcclxuXHJcbiAgICAoaGFuZGxlcnNbbWVzc2FnZVR5cGVdIHx8IGhhbmRsZXJzLmRlZmF1bHQpKHBheWxvYWQpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwb3N0TWVzc2FnZVRvQ2hpbGQobWVzc2FnZVR5cGU6IE1lc3NhZ2VUeXBlLCBwYXlsb2FkOiBQYXlsb2FkKTogdm9pZCB7XHJcbiAgICBpZiAoIXRoaXMuaWZyYW1lRWwpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG1lc3NhZ2U6IE1lc3NhZ2UgPSB7IG1lc3NhZ2VUeXBlLCBwYXlsb2FkIH07XHJcbiAgICB0aGlzLmlmcmFtZUVsLmNvbnRlbnRXaW5kb3c/LnBvc3RNZXNzYWdlKG1lc3NhZ2UsIFwiKlwiKTtcclxuICB9XHJcblxyXG4gIC8vIHdoZW4gY2hpbGQgdXBkYXRlcyB1c2VyIGRhdGEsIGl0IGhhcyB0byByZWZsZWN0IGluIHVzZXIgZGF0YSBpbiBzaGVsbFxyXG4gIHByaXZhdGUgaGFuZGxlVXNlcih1c2VyOiBVc2VyKSB7XHJcbiAgICBpZiAodXNlcj8uYWNjZXNzX3Rva2VuKSB7XHJcbiAgICAgIHRoaXMuYXV0aFNlcnZpY2Uuc3RvcmVVc2VyVG9TZXNzaW9uU3RvcmFnZSh1c2VyKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuYXV0aFNlcnZpY2UuY2xlYXJVc2VyRnJvbVNlc3Npb25TdG9yYWdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5hdXRoU2VydmljZS5yZWxvYWRQZXJzaXN0ZWRVc2VyRGF0YSgpO1xyXG4gIH1cclxufVxyXG4iXX0=