import { __decorate, __param } from "tslib";
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Inject, Injectable, Optional } from '@angular/core';
import { AvlAuthService } from '@avl-ng-controls/auth';
import { interval, Subject } from 'rxjs';
import { filter, switchMap, takeUntil, tap } from 'rxjs/operators';
import { Log, LogConfig, LogSeverity } from './logging.model';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@avl-ng-controls/auth";
var LoggingService = /** @class */ (function () {
    /**
     * @ignore
     */
    function LoggingService(http, config, authService) {
        var _this = this;
        var _a;
        this.http = http;
        this.config = config;
        this.authService = authService;
        this.logs = [];
        this.isLogging = false;
        this.debounceTime$ = new Subject();
        this.logs$ = new Subject();
        this.stopLogging$ = new Subject();
        this.postLogs$ = new Subject();
        this.destroyed$ = new Subject();
        this.headers = new HttpHeaders({
            targetName: this.config.targetName,
        });
        if (config.autologging) {
            (_a = this.authService) === null || _a === void 0 ? void 0 : _a.isLoggedIn$.pipe(takeUntil(this.destroyed$)).subscribe(function (isLoggedIn) { return _this.decideOnLogging(isLoggedIn); });
        }
    }
    /**
     * @ignore
     */
    LoggingService.prototype.ngOnDestroy = function () {
        this.postLogs$.complete();
        this.debounceTime$.complete();
        this.logs$.complete();
        this.stopLogging$.next();
        this.stopLogging$.complete();
        this.destroyed$.next();
        this.destroyed$.complete();
    };
    /**
     * Starts periodical logging process.
     *
     * Depends on _debounceTime_ and _capacity_ properties.
     */
    LoggingService.prototype.startLogging = function () {
        var _this = this;
        this.isLogging = true;
        console.log('Start logging');
        this.debounceTime$
            .pipe(takeUntil(this.stopLogging$), switchMap(function (debounceTime) { return _this.periodicalLogging(debounceTime); }))
            .subscribe(function () { return _this.onPostMessages(); });
        this.postLogs$
            .pipe(takeUntil(this.stopLogging$), switchMap(function () { return _this.postMessages(); }))
            .subscribe(function () { return _this.onPostMessages(); });
        this.setLoggingDebounceTime(this.config.debounceTime);
    };
    /**
     * Stops logging process.
     */
    LoggingService.prototype.stopLogging = function () {
        this.isLogging = false;
        console.log('Stop logging');
        this.postLogs();
        this.stopLogging$.next();
    };
    /**
     * Gets all currently queued logs as an observable value.
     * @returns All currently queued logs as an observable value
     */
    LoggingService.prototype.getLogs$ = function () {
        return this.logs$.asObservable();
    };
    /**
     * Logs message with debug severity.
     * @param message Message used for constructing a debug log
     * @param componentName Name of the component which called this method
     */
    LoggingService.prototype.debug = function (message, componentName) {
        if (componentName === void 0) { componentName = ''; }
        this.log(message, LogSeverity.Debug, componentName);
    };
    /**
     * Logs message with info severity.
     * @param message Message used for constructing a info log
     * @param componentName Name of the component which called this method
     */
    LoggingService.prototype.info = function (message, componentName) {
        if (componentName === void 0) { componentName = ''; }
        this.log(message, LogSeverity.Info, componentName);
    };
    /**
     * Logs message with warning severity.
     * @param message Message used for constructing a warning log
     * @param componentName Name of the component which called this method
     */
    LoggingService.prototype.warn = function (message, componentName) {
        if (componentName === void 0) { componentName = ''; }
        this.log(message, LogSeverity.Warning, componentName);
    };
    /**
     * Logs message with error severity.
     * @param message Message used for constructing a error log
     * @param componentName Name of the component which called this method
     */
    LoggingService.prototype.error = function (message, componentName) {
        if (componentName === void 0) { componentName = ''; }
        this.log(message, LogSeverity.Error, componentName);
    };
    /**
     * Logs message with fatal severity.
     * @param message Message used for constructing a fatal log
     * @param componentName Name of the component which called this method
     */
    LoggingService.prototype.fatal = function (message, componentName) {
        if (componentName === void 0) { componentName = ''; }
        this.log(message, LogSeverity.Fatal, componentName);
    };
    /**
     * Setter for debounce time (log period).
     * @param debounceTime Time in milliseconds; determines the period of API requests for logging
     */
    LoggingService.prototype.setLoggingDebounceTime = function (debounceTime) {
        console.log('New debounce time: ', debounceTime);
        this.config.debounceTime = debounceTime;
        this.debounceTime$.next(debounceTime);
    };
    /**
     * Setter for global log level.
     * @param globalLogLevel Minimum message severity to log
     */
    LoggingService.prototype.setGlobalLogLevel = function (globalLogLevel) {
        console.log('New global log level: ', globalLogLevel);
        this.config.globalLogLevel = globalLogLevel;
    };
    /**
     * Setter for log queue capacity.
     * @param capacity Log queue capacity
     */
    LoggingService.prototype.setLogCapacity = function (capacity) {
        console.log('New capacity: ', capacity);
        this.config.capacity = capacity;
    };
    // Logic, private methods
    LoggingService.prototype.log = function (message, severity, componentName) {
        if (!this.isLogging || severity < this.config.globalLogLevel) {
            return;
        }
        this.createAndStoreLog(message, severity, componentName);
        this.dispatchLogs();
        if (this.isFullCapacity()) {
            console.log('Full capacity. Logging...');
            this.postLogs$.next();
        }
    };
    LoggingService.prototype.createAndStoreLog = function (message, severityType, componentName) {
        var timestamp = new Date().toISOString();
        var _a = this.config, appName = _a.appName, version = _a.version;
        var severity = severityType.toString();
        var log = { message: message, severity: severity, timestamp: timestamp, componentName: componentName, appName: appName, version: version };
        this.logs.push(log);
    };
    LoggingService.prototype.isFullCapacity = function () {
        return this.logs.length >= this.config.capacity;
    };
    LoggingService.prototype.clearLogs = function () {
        this.logs = [];
    };
    LoggingService.prototype.onPostMessages = function () {
        this.clearLogs();
        this.dispatchLogs();
        console.log('Logs posted.');
    };
    LoggingService.prototype.postLogs = function () {
        this.postLogs$.next();
    };
    LoggingService.prototype.periodicalLogging = function (period) {
        var _this = this;
        return interval(period).pipe(tap(function () {
            if (!_this.logs.length) {
                _this.dispatchLogs();
                console.log('Empty logs. Nothing to send.');
            }
        }), filter(function () { return !!_this.logs.length; }), tap(function () { return console.log('Time expired. Logging...'); }), switchMap(function () { return _this.postMessages(); }));
    };
    LoggingService.prototype.postMessages = function () {
        return this.http.post(this.config.endpoint, this.logs, {
            headers: this.headers,
        });
    };
    LoggingService.prototype.dispatchLogs = function () {
        this.logs$.next(this.logs);
    };
    LoggingService.prototype.decideOnLogging = function (isLoggedIn) {
        if (isLoggedIn) {
            this.startLogging();
        }
        else {
            this.stopLogging();
        }
    };
    LoggingService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: LogConfig, decorators: [{ type: Inject, args: ['loggingConfig',] }] },
        { type: AvlAuthService, decorators: [{ type: Optional }, { type: Inject, args: [AvlAuthService,] }] }
    ]; };
    LoggingService.ɵprov = i0.ɵɵdefineInjectable({ factory: function LoggingService_Factory() { return new LoggingService(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject("loggingConfig"), i0.ɵɵinject(i2.AvlAuthService, 8)); }, token: LoggingService, providedIn: "root" });
    LoggingService = __decorate([
        Injectable({
            providedIn: 'root',
        }),
        __param(1, Inject('loggingConfig')),
        __param(2, Optional()), __param(2, Inject(AvlAuthService))
    ], LoggingService);
    return LoggingService;
}());
export { LoggingService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9nZ2luZy5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGF2bC1zZXJ2aWNlcy9uZy1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbImxpYi9sb2dnaW5nLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDL0QsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQWEsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsUUFBUSxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNyRCxPQUFPLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDbkUsT0FBTyxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLE1BQU0saUJBQWlCLENBQUM7Ozs7QUFLOUQ7SUFXRTs7T0FFRztJQUNILHdCQUNVLElBQWdCLEVBQ1MsTUFBaUIsRUFDTixXQUEyQjtRQUh6RSxpQkFZQzs7UUFYUyxTQUFJLEdBQUosSUFBSSxDQUFZO1FBQ1MsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUNOLGdCQUFXLEdBQVgsV0FBVyxDQUFnQjtRQWhCakUsU0FBSSxHQUFVLEVBQUUsQ0FBQztRQUVqQixjQUFTLEdBQUcsS0FBSyxDQUFDO1FBRWxCLGtCQUFhLEdBQW9CLElBQUksT0FBTyxFQUFFLENBQUM7UUFDL0MsVUFBSyxHQUFtQixJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQ3RDLGlCQUFZLEdBQWtCLElBQUksT0FBTyxFQUFFLENBQUM7UUFDNUMsY0FBUyxHQUFrQixJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQ3pDLGVBQVUsR0FBa0IsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQVVoRCxJQUFJLENBQUMsT0FB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LE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTztTQUN0QixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU8scUNBQVksR0FBcEI7UUFDRSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUVPLHdDQUFlLEdBQXZCLFVBQXdCLFVBQW1CO1FBQ3pDLElBQUksVUFBVSxFQUFFO1lBQ2QsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1NBQ3JCO2FBQU07WUFDTCxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7U0FDcEI7SUFDSCxDQUFDOztnQkFyTmUsVUFBVTtnQkFDaUIsU0FBUyx1QkFBakQsTUFBTSxTQUFDLGVBQWU7Z0JBQ2tDLGNBQWMsdUJBQXRFLFFBQVEsWUFBSSxNQUFNLFNBQUMsY0FBYzs7O0lBakJ6QixjQUFjO1FBSDFCLFVBQVUsQ0FBQztZQUNWLFVBQVUsRUFBRSxNQUFNO1NBQ25CLENBQUM7UUFpQkcsV0FBQSxNQUFNLENBQUMsZUFBZSxDQUFDLENBQUE7UUFDdkIsV0FBQSxRQUFRLEVBQUUsQ0FBQSxFQUFFLFdBQUEsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFBO09BakIxQixjQUFjLENBcU8xQjt5QkEvT0Q7Q0ErT0MsQUFyT0QsSUFxT0M7U0FyT1ksY0FBYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBIZWFkZXJzIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBJbmplY3QsIEluamVjdGFibGUsIE9uRGVzdHJveSwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQXZsQXV0aFNlcnZpY2UgfSBmcm9tICdAYXZsLW5nLWNvbnRyb2xzL2F1dGgnO1xyXG5pbXBvcnQgeyBpbnRlcnZhbCwgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBmaWx0ZXIsIHN3aXRjaE1hcCwgdGFrZVVudGlsLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IExvZywgTG9nQ29uZmlnLCBMb2dTZXZlcml0eSB9IGZyb20gJy4vbG9nZ2luZy5tb2RlbCc7XHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgTG9nZ2luZ1NlcnZpY2UgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xyXG4gIHByaXZhdGUgbG9nczogTG9nW10gPSBbXTtcclxuICBwcml2YXRlIGhlYWRlcnM6IEh0dHBIZWFkZXJzO1xyXG4gIHByaXZhdGUgaXNMb2dnaW5nID0gZmFsc2U7XHJcblxyXG4gIHByaXZhdGUgZGVib3VuY2VUaW1lJDogU3ViamVjdDxudW1iZXI+ID0gbmV3IFN1YmplY3QoKTtcclxuICBwcml2YXRlIGxvZ3MkOiBTdWJqZWN0PExvZ1tdPiA9IG5ldyBTdWJqZWN0KCk7XHJcbiAgcHJpdmF0ZSBzdG9wTG9nZ2luZyQ6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdCgpO1xyXG4gIHByaXZhdGUgcG9zdExvZ3MkOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3QoKTtcclxuICBwcml2YXRlIGRlc3Ryb3llZCQ6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdCgpO1xyXG5cclxuICAvKipcclxuICAgKiBAaWdub3JlXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsXHJcbiAgICBASW5qZWN0KCdsb2dnaW5nQ29uZmlnJykgcHJpdmF0ZSBjb25maWc6IExvZ0NvbmZpZyxcclxuICAgIEBPcHRpb25hbCgpIEBJbmplY3QoQXZsQXV0aFNlcnZpY2UpIHByaXZhdGUgYXV0aFNlcnZpY2U6IEF2bEF1dGhTZXJ2aWNlXHJcbiAgKSB7XHJcbiAgICB0aGlzLmhlYWRlcnMgPSBuZXcgSHR0cEhlYWRlcnMoe1xyXG4gICAgICB0YXJnZXROYW1lOiB0aGlzLmNvbmZpZy50YXJnZXROYW1lLFxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGNvbmZpZy5hdXRvbG9nZ2luZykge1xyXG4gICAgICB0aGlzLmF1dGhTZXJ2aWNlPy5pc0xvZ2dlZEluJC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3llZCQpKS5zdWJzY3JpYmUoKGlzTG9nZ2VkSW4pID0+IHRoaXMuZGVjaWRlT25Mb2dnaW5nKGlzTG9nZ2VkSW4pKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBpZ25vcmVcclxuICAgKi9cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIHRoaXMucG9zdExvZ3MkLmNvbXBsZXRlKCk7XHJcbiAgICB0aGlzLmRlYm91bmNlVGltZSQuY29tcGxldGUoKTtcclxuICAgIHRoaXMubG9ncyQuY29tcGxldGUoKTtcclxuICAgIHRoaXMuc3RvcExvZ2dpbmckLm5leHQoKTtcclxuICAgIHRoaXMuc3RvcExvZ2dpbmckLmNvbXBsZXRlKCk7XHJcbiAgICB0aGlzLmRlc3Ryb3llZCQubmV4dCgpO1xyXG4gICAgdGhpcy5kZXN0cm95ZWQkLmNvbXBsZXRlKCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIFN0YXJ0cyBwZXJpb2RpY2FsIGxvZ2dpbmcgcHJvY2Vzcy5cclxuICAgKiBcclxuICAgKiBEZXBlbmRzIG9uIF9kZWJvdW5jZVRpbWVfIGFuZCBfY2FwYWNpdHlfIHByb3BlcnRpZXMuXHJcbiAgICovXHJcbiAgcHVibGljIHN0YXJ0TG9nZ2luZygpOiB2b2lkIHtcclxuICAgIHRoaXMuaXNMb2dnaW5nID0gdHJ1ZTtcclxuICAgIGNvbnNvbGUubG9nKCdTdGFydCBsb2dnaW5nJyk7XHJcbiAgICB0aGlzLmRlYm91bmNlVGltZSRcclxuICAgICAgLnBpcGUoXHJcbiAgICAgICAgdGFrZVVudGlsKHRoaXMuc3RvcExvZ2dpbmckKSxcclxuICAgICAgICBzd2l0Y2hNYXAoKGRlYm91bmNlVGltZSkgPT4gdGhpcy5wZXJpb2RpY2FsTG9nZ2luZyhkZWJvdW5jZVRpbWUpKVxyXG4gICAgICApXHJcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4gdGhpcy5vblBvc3RNZXNzYWdlcygpKTtcclxuXHJcbiAgICB0aGlzLnBvc3RMb2dzJFxyXG4gICAgICAucGlwZShcclxuICAgICAgICB0YWtlVW50aWwodGhpcy5zdG9wTG9nZ2luZyQpLFxyXG4gICAgICAgIHN3aXRjaE1hcCgoKSA9PiB0aGlzLnBvc3RNZXNzYWdlcygpKVxyXG4gICAgICApXHJcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4gdGhpcy5vblBvc3RNZXNzYWdlcygpKTtcclxuXHJcbiAgICB0aGlzLnNldExvZ2dpbmdEZWJvdW5jZVRpbWUodGhpcy5jb25maWcuZGVib3VuY2VUaW1lKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0b3BzIGxvZ2dpbmcgcHJvY2Vzcy5cclxuICAgKi9cclxuICBwdWJsaWMgc3RvcExvZ2dpbmcoKTogdm9pZCB7XHJcbiAgICB0aGlzLmlzTG9nZ2luZyA9IGZhbHNlO1xyXG4gICAgY29uc29sZS5sb2coJ1N0b3AgbG9nZ2luZycpO1xyXG4gICAgdGhpcy5wb3N0TG9ncygpO1xyXG4gICAgdGhpcy5zdG9wTG9nZ2luZyQubmV4dCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0cyBhbGwgY3VycmVudGx5IHF1ZXVlZCBsb2dzIGFzIGFuIG9ic2VydmFibGUgdmFsdWUuXHJcbiAgICogQHJldHVybnMgQWxsIGN1cnJlbnRseSBxdWV1ZWQgbG9ncyBhcyBhbiBvYnNlcnZhYmxlIHZhbHVlXHJcbiAgICovXHJcbiAgcHVibGljIGdldExvZ3MkKCk6IE9ic2VydmFibGU8TG9nW10+IHtcclxuICAgIHJldHVybiB0aGlzLmxvZ3MkLmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTG9ncyBtZXNzYWdlIHdpdGggZGVidWcgc2V2ZXJpdHkuXHJcbiAgICogQHBhcmFtIG1lc3NhZ2UgTWVzc2FnZSB1c2VkIGZvciBjb25zdHJ1Y3RpbmcgYSBkZWJ1ZyBsb2dcclxuICAgKiBAcGFyYW0gY29tcG9uZW50TmFtZSBOYW1lIG9mIHRoZSBjb21wb25lbnQgd2hpY2ggY2FsbGVkIHRoaXMgbWV0aG9kXHJcbiAgICovXHJcbiAgcHVibGljIGRlYnVnKG1lc3NhZ2U6IHN0cmluZywgY29tcG9uZW50TmFtZTogc3RyaW5nID0gJycpOiB2b2lkIHtcclxuICAgIHRoaXMubG9nKG1lc3NhZ2UsIExvZ1NldmVyaXR5LkRlYnVnLCBjb21wb25lbnROYW1lKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIExvZ3MgbWVzc2FnZSB3aXRoIGluZm8gc2V2ZXJpdHkuXHJcbiAgICogQHBhcmFtIG1lc3NhZ2UgTWVzc2FnZSB1c2VkIGZvciBjb25zdHJ1Y3RpbmcgYSBpbmZvIGxvZ1xyXG4gICAqIEBwYXJhbSBjb21wb25lbnROYW1lIE5hbWUgb2YgdGhlIGNvbXBvbmVudCB3aGljaCBjYWxsZWQgdGhpcyBtZXRob2RcclxuICAgKi9cclxuICBwdWJsaWMgaW5mbyhtZXNzYWdlOiBzdHJpbmcsIGNvbXBvbmVudE5hbWU6IHN0cmluZyA9ICcnKTogdm9pZCB7XHJcbiAgICB0aGlzLmxvZyhtZXNzYWdlLCBMb2dTZXZlcml0eS5JbmZvLCBjb21wb25lbnROYW1lKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIExvZ3MgbWVzc2FnZSB3aXRoIHdhcm5pbmcgc2V2ZXJpdHkuXHJcbiAgICogQHBhcmFtIG1lc3NhZ2UgTWVzc2FnZSB1c2VkIGZvciBjb25zdHJ1Y3RpbmcgYSB3YXJuaW5nIGxvZ1xyXG4gICAqIEBwYXJhbSBjb21wb25lbnROYW1lIE5hbWUgb2YgdGhlIGNvbXBvbmVudCB3aGljaCBjYWxsZWQgdGhpcyBtZXRob2RcclxuICAgKi9cclxuICBwdWJsaWMgd2FybihtZXNzYWdlOiBzdHJpbmcsIGNvbXBvbmVudE5hbWU6IHN0cmluZyA9ICcnKTogdm9pZCB7XHJcbiAgICB0aGlzLmxvZyhtZXNzYWdlLCBMb2dTZXZlcml0eS5XYXJuaW5nLCBjb21wb25lbnROYW1lKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIExvZ3MgbWVzc2FnZSB3aXRoIGVycm9yIHNldmVyaXR5LlxyXG4gICAqIEBwYXJhbSBtZXNzYWdlIE1lc3NhZ2UgdXNlZCBmb3IgY29uc3RydWN0aW5nIGEgZXJyb3IgbG9nXHJcbiAgICogQHBhcmFtIGNvbXBvbmVudE5hbWUgTmFtZSBvZiB0aGUgY29tcG9uZW50IHdoaWNoIGNhbGxlZCB0aGlzIG1ldGhvZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBlcnJvcihtZXNzYWdlOiBzdHJpbmcsIGNvbXBvbmVudE5hbWU6IHN0cmluZyA9ICcnKTogdm9pZCB7XHJcbiAgICB0aGlzLmxvZyhtZXNzYWdlLCBMb2dTZXZlcml0eS5FcnJvciwgY29tcG9uZW50TmFtZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBMb2dzIG1lc3NhZ2Ugd2l0aCBmYXRhbCBzZXZlcml0eS5cclxuICAgKiBAcGFyYW0gbWVzc2FnZSBNZXNzYWdlIHVzZWQgZm9yIGNvbnN0cnVjdGluZyBhIGZhdGFsIGxvZ1xyXG4gICAqIEBwYXJhbSBjb21wb25lbnROYW1lIE5hbWUgb2YgdGhlIGNvbXBvbmVudCB3aGljaCBjYWxsZWQgdGhpcyBtZXRob2RcclxuICAgKi9cclxuICBwdWJsaWMgZmF0YWwobWVzc2FnZTogc3RyaW5nLCBjb21wb25lbnROYW1lOiBzdHJpbmcgPSAnJyk6IHZvaWQge1xyXG4gICAgdGhpcy5sb2cobWVzc2FnZSwgTG9nU2V2ZXJpdHkuRmF0YWwsIGNvbXBvbmVudE5hbWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0dGVyIGZvciBkZWJvdW5jZSB0aW1lIChsb2cgcGVyaW9kKS5cclxuICAgKiBAcGFyYW0gZGVib3VuY2VUaW1lIFRpbWUgaW4gbWlsbGlzZWNvbmRzOyBkZXRlcm1pbmVzIHRoZSBwZXJpb2Qgb2YgQVBJIHJlcXVlc3RzIGZvciBsb2dnaW5nXHJcbiAgICovXHJcbiAgcHVibGljIHNldExvZ2dpbmdEZWJvdW5jZVRpbWUoZGVib3VuY2VUaW1lOiBudW1iZXIpOiB2b2lkIHtcclxuICAgIGNvbnNvbGUubG9nKCdOZXcgZGVib3VuY2UgdGltZTogJywgZGVib3VuY2VUaW1lKTtcclxuICAgIHRoaXMuY29uZmlnLmRlYm91bmNlVGltZSA9IGRlYm91bmNlVGltZTtcclxuICAgIHRoaXMuZGVib3VuY2VUaW1lJC5uZXh0KGRlYm91bmNlVGltZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXR0ZXIgZm9yIGdsb2JhbCBsb2cgbGV2ZWwuXHJcbiAgICogQHBhcmFtIGdsb2JhbExvZ0xldmVsIE1pbmltdW0gbWVzc2FnZSBzZXZlcml0eSB0byBsb2dcclxuICAgKi9cclxuICBwdWJsaWMgc2V0R2xvYmFsTG9nTGV2ZWwoZ2xvYmFsTG9nTGV2ZWw6IExvZ1NldmVyaXR5KTogdm9pZCB7XHJcbiAgICBjb25zb2xlLmxvZygnTmV3IGdsb2JhbCBsb2cgbGV2ZWw6ICcsIGdsb2JhbExvZ0xldmVsKTtcclxuICAgIHRoaXMuY29uZmlnLmdsb2JhbExvZ0xldmVsID0gZ2xvYmFsTG9nTGV2ZWw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXR0ZXIgZm9yIGxvZyBxdWV1ZSBjYXBhY2l0eS5cclxuICAgKiBAcGFyYW0gY2FwYWNpdHkgTG9nIHF1ZXVlIGNhcGFjaXR5XHJcbiAgICovXHJcbiAgcHVibGljIHNldExvZ0NhcGFjaXR5KGNhcGFjaXR5OiBudW1iZXIpOiB2b2lkIHtcclxuICAgIGNvbnNvbGUubG9nKCdOZXcgY2FwYWNpdHk6ICcsIGNhcGFjaXR5KTtcclxuICAgIHRoaXMuY29uZmlnLmNhcGFjaXR5ID0gY2FwYWNpdHk7XHJcbiAgfVxyXG5cclxuICAvLyBMb2dpYywgcHJpdmF0ZSBtZXRob2RzXHJcblxyXG4gIHByaXZhdGUgbG9nKG1lc3NhZ2U6IHN0cmluZywgc2V2ZXJpdHk6IExvZ1NldmVyaXR5LCBjb21wb25lbnROYW1lOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIGlmICghdGhpcy5pc0xvZ2dpbmcgfHwgc2V2ZXJpdHkgPCB0aGlzLmNvbmZpZy5nbG9iYWxMb2dMZXZlbCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5jcmVhdGVBbmRTdG9yZUxvZyhtZXNzYWdlLCBzZXZlcml0eSwgY29tcG9uZW50TmFtZSk7XHJcbiAgICB0aGlzLmRpc3BhdGNoTG9ncygpO1xyXG5cclxuICAgIGlmICh0aGlzLmlzRnVsbENhcGFjaXR5KCkpIHtcclxuICAgICAgY29uc29sZS5sb2coJ0Z1bGwgY2FwYWNpdHkuIExvZ2dpbmcuLi4nKTtcclxuICAgICAgdGhpcy5wb3N0TG9ncyQubmV4dCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjcmVhdGVBbmRTdG9yZUxvZyhtZXNzYWdlOiBzdHJpbmcsIHNldmVyaXR5VHlwZTogTG9nU2V2ZXJpdHksIGNvbXBvbmVudE5hbWU6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xyXG4gICAgY29uc3QgeyBhcHBOYW1lLCB2ZXJzaW9uIH0gPSB0aGlzLmNvbmZpZztcclxuICAgIGNvbnN0IHNldmVyaXR5ID0gc2V2ZXJpdHlUeXBlLnRvU3RyaW5nKCk7XHJcbiAgICBjb25zdCBsb2c6IExvZyA9IHsgbWVzc2FnZSwgc2V2ZXJpdHksIHRpbWVzdGFtcCwgY29tcG9uZW50TmFtZSwgYXBwTmFtZSwgdmVyc2lvbiB9O1xyXG4gICAgdGhpcy5sb2dzLnB1c2gobG9nKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaXNGdWxsQ2FwYWNpdHkoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5sb2dzLmxlbmd0aCA+PSB0aGlzLmNvbmZpZy5jYXBhY2l0eTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2xlYXJMb2dzKCk6IHZvaWQge1xyXG4gICAgdGhpcy5sb2dzID0gW107XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9uUG9zdE1lc3NhZ2VzKCk6IHZvaWQge1xyXG4gICAgdGhpcy5jbGVhckxvZ3MoKTtcclxuICAgIHRoaXMuZGlzcGF0Y2hMb2dzKCk7XHJcbiAgICBjb25zb2xlLmxvZygnTG9ncyBwb3N0ZWQuJyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHBvc3RMb2dzKCk6IHZvaWQge1xyXG4gICAgdGhpcy5wb3N0TG9ncyQubmV4dCgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwZXJpb2RpY2FsTG9nZ2luZyhwZXJpb2Q6IG51bWJlcik6IE9ic2VydmFibGU8dm9pZD4ge1xyXG4gICAgcmV0dXJuIGludGVydmFsKHBlcmlvZCkucGlwZShcclxuICAgICAgdGFwKCgpID0+IHtcclxuICAgICAgICBpZiAoIXRoaXMubG9ncy5sZW5ndGgpIHtcclxuICAgICAgICAgIHRoaXMuZGlzcGF0Y2hMb2dzKCk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnRW1wdHkgbG9ncy4gTm90aGluZyB0byBzZW5kLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSksXHJcbiAgICAgIGZpbHRlcigoKSA9PiAhIXRoaXMubG9ncy5sZW5ndGgpLFxyXG4gICAgICB0YXAoKCkgPT4gY29uc29sZS5sb2coJ1RpbWUgZXhwaXJlZC4gTG9nZ2luZy4uLicpKSxcclxuICAgICAgc3dpdGNoTWFwKCgpID0+IHRoaXMucG9zdE1lc3NhZ2VzKCkpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwb3N0TWVzc2FnZXMoKTogT2JzZXJ2YWJsZTx2b2lkPiB7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3Q8dm9pZD4odGhpcy5jb25maWcuZW5kcG9pbnQsIHRoaXMubG9ncywge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZGlzcGF0Y2hMb2dzKCk6IHZvaWQge1xyXG4gICAgdGhpcy5sb2dzJC5uZXh0KHRoaXMubG9ncyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRlY2lkZU9uTG9nZ2luZyhpc0xvZ2dlZEluOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICBpZiAoaXNMb2dnZWRJbikge1xyXG4gICAgICB0aGlzLnN0YXJ0TG9nZ2luZygpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5zdG9wTG9nZ2luZygpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=