import { __assign, __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { Router } from '@angular/router';
import { Subject, BehaviorSubject } from 'rxjs';
import { v4 as uuidv4 } from 'uuid';
import { MessageType } from './message.model';
import { AvlAuthService, User } from '@avl-ng-controls/auth';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "@avl-ng-controls/auth";
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/router';
import * as ɵngcc2 from '@avl-ng-controls/auth';
var ShellCommunicationService = /** @class */ (function () {
    function ShellCommunicationService(router, authService) {
        var _a;
        var _this = this;
        this.router = router;
        this.authService = authService;
        this.handlers = (_a = {},
            _a[MessageType.theme] = function (theme) { return _this.handleTheme(theme); },
            _a[MessageType.locale] = function (locale) { return _this.handleLocale(locale); },
            _a[MessageType.language] = function (language) { return _this.handleLanguage(language); },
            _a[MessageType.colorScheme] = function (colorScheme) { return _this.handleColorScheme(colorScheme); },
            _a[MessageType.navigation] = function (url) { return _this.handleNavigation(url); },
            _a[MessageType.action] = function (action) { return _this.handleAction(action); },
            _a[MessageType.authentication] = function (user) { return _this.handleAuthentication(user); },
            _a[MessageType.redirectedFromLogIn] = function (redirected) { return _this.handleRedirectedFromLogIn(redirected); },
            _a);
        this.themeSubject = new Subject();
        this.languageSubject = new Subject();
        this.actionSubject = new Subject();
        this.localeSubject = new Subject();
        this.colorSchemeSubject = new Subject();
        /**
        * Observable tracking theme
        * Emits "dark" if dark theme selected, "light" otherwise
        */
        this.theme$ = this.themeSubject;
        /**
        * Observable tracking language
        */
        this.language$ = this.languageSubject;
        this.action$ = this.actionSubject;
        /**
        * Observable tracking country changes
        */
        this.locale$ = this.localeSubject;
        /**
        * Observable tracking color scheme changes
        */
        this.colorScheme$ = this.colorSchemeSubject;
        /**
         * Observable tracking if redirected from idb
         * Resolves to true on redirection, false otherwise
         */
        this.redirectedFromLogIn = new BehaviorSubject(undefined);
        /**
         * If current application is inside shell application
         * True if current application is inside shell application, false otherwise.
         */
        this.isChild = window.location !== window.parent.location;
        window.addEventListener('message', function (event) { return _this.onMessage(event); });
        this.id = uuidv4();
    }
    ShellCommunicationService.prototype.notifyShellAboutAction = function (action) {
        this.postMessageToShell(MessageType.action, action);
    };
    /**
     * Sends message to shell that it needs to navigate to login page
     */
    ShellCommunicationService.prototype.notifyShellAboutLogin = function (url) {
        this.postMessageToShell(MessageType.login, url);
    };
    /**
     * Sends message to shell that it needs to navigate to @url
     */
    ShellCommunicationService.prototype.notifyShellAboutNavigation = function (url) {
        this.postMessageToShell(MessageType.navigation, url);
    };
    /**
     * Sends registration message to shell
     */
    ShellCommunicationService.prototype.registerToShell = function () {
        this.postMessageToShell(MessageType.registration, this.id);
    };
    /**
    * Send updated user data to shell
    */
    ShellCommunicationService.prototype.updateUserToShell = function () {
        var user = this.authService.readUserFromSessionStorage();
        this.postMessageToShell(MessageType.user, user);
    };
    ShellCommunicationService.prototype.onMessage = function (event) {
        var _a = event.data, payload = _a.payload, messageType = _a.messageType;
        var handlers = __assign(__assign({}, this.handlers), { default: function () { return console.log('Unrecognized message for the shell.', event); } });
        (handlers[messageType] || handlers.default)(payload);
    };
    ShellCommunicationService.prototype.postMessageToShell = function (messageType, payload) {
        var message = { messageType: messageType, payload: payload };
        window.parent.window.postMessage(message, '*');
    };
    ShellCommunicationService.prototype.handleColorScheme = function (colorScheme) {
        this.colorSchemeSubject.next(colorScheme);
    };
    ShellCommunicationService.prototype.handleLanguage = function (language) {
        this.languageSubject.next(language);
    };
    ShellCommunicationService.prototype.handleLocale = function (locale) {
        this.localeSubject.next(locale);
    };
    ShellCommunicationService.prototype.handleTheme = function (theme) {
        this.themeSubject.next(theme);
    };
    ShellCommunicationService.prototype.handleNavigation = function (url) {
        this.router.navigateByUrl(url);
    };
    ShellCommunicationService.prototype.handleAction = function (action) {
        this.actionSubject.next(action);
    };
    ShellCommunicationService.prototype.handleAuthentication = function (user) {
        if (user === null || user === void 0 ? void 0 : user.access_token) {
            this.authService.storeUserToSessionStorage(user);
        }
        else {
            this.authService.clearUserFromSessionStorage();
        }
        this.authService.reloadPersistedUserData();
    };
    ShellCommunicationService.prototype.handleRedirectedFromLogIn = function (redirected) {
        this.redirectedFromLogIn.next(redirected);
    };
    ShellCommunicationService.ctorParameters = function () { return [
        { type: Router },
        { type: AvlAuthService }
    ]; };
    ShellCommunicationService.ɵprov = i0.ɵɵdefineInjectable({ factory: function ShellCommunicationService_Factory() { return new ShellCommunicationService(i0.ɵɵinject(i1.Router), i0.ɵɵinject(i2.AvlAuthService)); }, token: ShellCommunicationService, providedIn: "root" });
ShellCommunicationService.ɵfac = function ShellCommunicationService_Factory(t) { return new (t || ShellCommunicationService)(ɵngcc0.ɵɵinject(ɵngcc1.Router), ɵngcc0.ɵɵinject(ɵngcc2.AvlAuthService)); };
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ShellCommunicationService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc1.Router }, { type: ɵngcc2.AvlAuthService }]; }, null); })();
    return ShellCommunicationService;
}());
export { ShellCommunicationService };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hlbGwtY29tbXVuaWNhdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlcyI6WyJuZzovQGF2bC1zZXJ2aWNlcy9uZy1zZXJ2aWNlcy9saWIvc2hlbGwtY29tbXVuaWNhdGlvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QyxPQUFPLEVBQUUsT0FBTyxFQUFjLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1RCxPQUFPLEVBQUUsRUFBRSxJQUFJLE1BQU0sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNwQyxPQUFPLEVBQXlDLFdBQVcsRUFBVyxNQUFNLGlCQUFpQixDQUFDO0FBQzlGLE9BQU8sRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDN0Q7QUFHQztBQUNvQzs7OztBQUFyQztBQUNvQixJQTJEbEIsbUNBQW9CLE1BQWMsRUFBVSxXQUEyQjtBQUN6RTtBQUFnQixRQURkLGlCQUlDO0FBQ0gsUUFMc0IsV0FBTSxHQUFOLE1BQU0sQ0FBUTtBQUFDLFFBQVMsZ0JBQVcsR0FBWCxXQUFXLENBQWdCO0FBQUMsUUF6RGhFLGFBQVE7QUFBYSxZQUMzQixHQUFDLFdBQVcsQ0FBQyxLQUFLLElBQUcsVUFBQyxLQUFhLElBQUssT0FBQSxLQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxFQUF2QixDQUF1QjtBQUNuRSxZQUFJLEdBQUMsV0FBVyxDQUFDLE1BQU0sSUFBRyxVQUFDLE1BQWMsSUFBSyxPQUFBLEtBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLEVBQXpCLENBQXlCO0FBQ3ZFLFlBQUksR0FBQyxXQUFXLENBQUMsUUFBUSxJQUFHLFVBQUMsUUFBZ0IsSUFBSyxPQUFBLEtBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLEVBQTdCLENBQTZCO0FB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QUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUdBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUVBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBRUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBRUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQVFBLEFBR0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUdBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFHQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFFQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFFQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFFQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFFQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQTFGQSxBQUFBLEFBQUEsQUFBQSxBQTVEQSxBQUFBLEFBSEEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQXVKQSxBQWpLQSxBQWlLQSxBQXZKQSxBQXVKQSxBQXZKQSxBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xyXG5pbXBvcnQgeyBTdWJqZWN0LCBPYnNlcnZhYmxlLCBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgdjQgYXMgdXVpZHY0IH0gZnJvbSAndXVpZCc7XHJcbmltcG9ydCB7IENvbG9yU2NoZW1lLCBNZXNzYWdlLCBNZXNzYWdlSGFuZGxlcnMsIE1lc3NhZ2VUeXBlLCBQYXlsb2FkIH0gZnJvbSAnLi9tZXNzYWdlLm1vZGVsJztcclxuaW1wb3J0IHsgQXZsQXV0aFNlcnZpY2UsIFVzZXIgfSBmcm9tICdAYXZsLW5nLWNvbnRyb2xzL2F1dGgnO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgU2hlbGxDb21tdW5pY2F0aW9uU2VydmljZSB7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBpZDogc3RyaW5nO1xyXG5cclxuICBwcml2YXRlIGhhbmRsZXJzOiBNZXNzYWdlSGFuZGxlcnMgPSB7XHJcbiAgICBbTWVzc2FnZVR5cGUudGhlbWVdOiAodGhlbWU6IHN0cmluZykgPT4gdGhpcy5oYW5kbGVUaGVtZSh0aGVtZSksXHJcbiAgICBbTWVzc2FnZVR5cGUubG9jYWxlXTogKGxvY2FsZTogc3RyaW5nKSA9PiB0aGlzLmhhbmRsZUxvY2FsZShsb2NhbGUpLFxyXG4gICAgW01lc3NhZ2VUeXBlLmxhbmd1YWdlXTogKGxhbmd1YWdlOiBzdHJpbmcpID0+IHRoaXMuaGFuZGxlTGFuZ3VhZ2UobGFuZ3VhZ2UpLFxyXG4gICAgW01lc3NhZ2VUeXBlLmNvbG9yU2NoZW1lXTogKGNvbG9yU2NoZW1lOiBDb2xvclNjaGVtZSkgPT4gdGhpcy5oYW5kbGVDb2xvclNjaGVtZShjb2xvclNjaGVtZSksXHJcbiAgICBbTWVzc2FnZVR5cGUubmF2aWdhdGlvbl06ICh1cmw6IHN0cmluZykgPT4gdGhpcy5oYW5kbGVOYXZpZ2F0aW9uKHVybCksXHJcbiAgICBbTWVzc2FnZVR5cGUuYWN0aW9uXTogKGFjdGlvbjogc3RyaW5nKSA9PiB0aGlzLmhhbmRsZUFjdGlvbihhY3Rpb24pLFxyXG4gICAgW01lc3NhZ2VUeXBlLmF1dGhlbnRpY2F0aW9uXTogKHVzZXI6IFVzZXIpID0+IHRoaXMuaGFuZGxlQXV0aGVudGljYXRpb24odXNlciksXHJcbiAgICBbTWVzc2FnZVR5cGUucmVkaXJlY3RlZEZyb21Mb2dJbl06IChyZWRpcmVjdGVkOiBib29sZWFuKSA9PiB0aGlzLmhhbmRsZVJlZGlyZWN0ZWRGcm9tTG9nSW4ocmVkaXJlY3RlZCksXHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSB0aGVtZVN1YmplY3QgPSBuZXcgU3ViamVjdDxzdHJpbmc+KCk7XHJcbiAgcHJpdmF0ZSBsYW5ndWFnZVN1YmplY3QgPSBuZXcgU3ViamVjdDxzdHJpbmc+KCk7XHJcbiAgcHJpdmF0ZSBhY3Rpb25TdWJqZWN0ID0gbmV3IFN1YmplY3Q8c3RyaW5nPigpO1xyXG4gIHByaXZhdGUgbG9jYWxlU3ViamVjdCA9IG5ldyBTdWJqZWN0PHN0cmluZz4oKTtcclxuICBwcml2YXRlIGNvbG9yU2NoZW1lU3ViamVjdCA9IG5ldyBTdWJqZWN0PENvbG9yU2NoZW1lPigpO1xyXG5cclxuICAvKipcclxuICAqIE9ic2VydmFibGUgdHJhY2tpbmcgdGhlbWVcclxuICAqIEVtaXRzIFwiZGFya1wiIGlmIGRhcmsgdGhlbWUgc2VsZWN0ZWQsIFwibGlnaHRcIiBvdGhlcndpc2UgXHJcbiAgKi9cclxuICBwdWJsaWMgdGhlbWUkOiBPYnNlcnZhYmxlPHN0cmluZz4gPSB0aGlzLnRoZW1lU3ViamVjdDtcclxuXHJcbiAgLyoqXHJcbiAgKiBPYnNlcnZhYmxlIHRyYWNraW5nIGxhbmd1YWdlXHJcbiAgKi9cclxuICBwdWJsaWMgbGFuZ3VhZ2UkOiBPYnNlcnZhYmxlPHN0cmluZz4gPSB0aGlzLmxhbmd1YWdlU3ViamVjdDtcclxuICBwdWJsaWMgYWN0aW9uJDogT2JzZXJ2YWJsZTxzdHJpbmc+ID0gdGhpcy5hY3Rpb25TdWJqZWN0O1xyXG5cclxuICAvKipcclxuICAqIE9ic2VydmFibGUgdHJhY2tpbmcgY291bnRyeSBjaGFuZ2VzXHJcbiAgKi9cclxuICBwdWJsaWMgbG9jYWxlJDogT2JzZXJ2YWJsZTxzdHJpbmc+ID0gdGhpcy5sb2NhbGVTdWJqZWN0O1xyXG5cclxuICAvKipcclxuICAqIE9ic2VydmFibGUgdHJhY2tpbmcgY29sb3Igc2NoZW1lIGNoYW5nZXNcclxuICAqL1xyXG4gIHB1YmxpYyBjb2xvclNjaGVtZSQ6IE9ic2VydmFibGU8Q29sb3JTY2hlbWU+ID0gdGhpcy5jb2xvclNjaGVtZVN1YmplY3Q7XHJcblxyXG4gIC8qKlxyXG4gICogT2JzZXJ2YWJsZSB0cmFja2luZyBsb2dpbiBzdGF0ZVxyXG4gICogUmVzb2x2ZXMgdG8gdHJ1ZSBvbiBzdWNjZXNzZnVsIGxvZ2luLCBmYWxzZSBvdGhlcndpc2VcclxuICAqL1xyXG4gIHB1YmxpYyBpc0xvZ2dlZEluJDogT2JzZXJ2YWJsZTxib29sZWFuPjtcclxuXHJcbiAgLyoqXHJcbiAgICogT2JzZXJ2YWJsZSB0cmFja2luZyBpZiByZWRpcmVjdGVkIGZyb20gaWRiXHJcbiAgICogUmVzb2x2ZXMgdG8gdHJ1ZSBvbiByZWRpcmVjdGlvbiwgZmFsc2Ugb3RoZXJ3aXNlXHJcbiAgICovXHJcbiAgcHVibGljIHJlZGlyZWN0ZWRGcm9tTG9nSW4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+KHVuZGVmaW5lZCk7XHJcbiAgXHJcbiAgLyoqXHJcbiAgICogSWYgY3VycmVudCBhcHBsaWNhdGlvbiBpcyBpbnNpZGUgc2hlbGwgYXBwbGljYXRpb24gXHJcbiAgICogVHJ1ZSBpZiBjdXJyZW50IGFwcGxpY2F0aW9uIGlzIGluc2lkZSBzaGVsbCBhcHBsaWNhdGlvbiwgZmFsc2Ugb3RoZXJ3aXNlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBpc0NoaWxkID0gd2luZG93LmxvY2F0aW9uICE9PSB3aW5kb3cucGFyZW50LmxvY2F0aW9uO1xyXG4gIFxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsIHByaXZhdGUgYXV0aFNlcnZpY2U6IEF2bEF1dGhTZXJ2aWNlKSB7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIChldmVudCkgPT4gdGhpcy5vbk1lc3NhZ2UoZXZlbnQpKTtcclxuICAgIFxyXG4gICAgdGhpcy5pZCA9IHV1aWR2NCgpO1xyXG4gIH1cclxuICBcclxuICBwdWJsaWMgbm90aWZ5U2hlbGxBYm91dEFjdGlvbihhY3Rpb246IHN0cmluZyk6IHZvaWQge1xyXG4gICAgdGhpcy5wb3N0TWVzc2FnZVRvU2hlbGwoTWVzc2FnZVR5cGUuYWN0aW9uLCBhY3Rpb24pO1xyXG4gIH1cclxuICBcclxuICAvKipcclxuICAgKiBTZW5kcyBtZXNzYWdlIHRvIHNoZWxsIHRoYXQgaXQgbmVlZHMgdG8gbmF2aWdhdGUgdG8gbG9naW4gcGFnZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBub3RpZnlTaGVsbEFib3V0TG9naW4odXJsOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMucG9zdE1lc3NhZ2VUb1NoZWxsKE1lc3NhZ2VUeXBlLmxvZ2luLCB1cmwpO1xyXG4gIH1cclxuICBcclxuICAvKipcclxuICAgKiBTZW5kcyBtZXNzYWdlIHRvIHNoZWxsIHRoYXQgaXQgbmVlZHMgdG8gbmF2aWdhdGUgdG8gQHVybFxyXG4gICAqL1xyXG4gIHB1YmxpYyBub3RpZnlTaGVsbEFib3V0TmF2aWdhdGlvbih1cmw6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgdGhpcy5wb3N0TWVzc2FnZVRvU2hlbGwoTWVzc2FnZVR5cGUubmF2aWdhdGlvbiwgdXJsKTtcclxuICB9XHJcbiAgXHJcbiAgLyoqXHJcbiAgICogU2VuZHMgcmVnaXN0cmF0aW9uIG1lc3NhZ2UgdG8gc2hlbGwgXHJcbiAgICovXHJcbiAgcHVibGljIHJlZ2lzdGVyVG9TaGVsbCgpOiB2b2lkIHtcclxuICAgIHRoaXMucG9zdE1lc3NhZ2VUb1NoZWxsKE1lc3NhZ2VUeXBlLnJlZ2lzdHJhdGlvbiwgdGhpcy5pZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIFNlbmQgdXBkYXRlZCB1c2VyIGRhdGEgdG8gc2hlbGxcclxuICAqL1xyXG4gIHB1YmxpYyB1cGRhdGVVc2VyVG9TaGVsbCgpOiB2b2lkIHtcclxuICAgIGNvbnN0IHVzZXIgPSB0aGlzLmF1dGhTZXJ2aWNlLnJlYWRVc2VyRnJvbVNlc3Npb25TdG9yYWdlKCk7XHJcbiAgICB0aGlzLnBvc3RNZXNzYWdlVG9TaGVsbChNZXNzYWdlVHlwZS51c2VyLCB1c2VyKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgb25NZXNzYWdlKGV2ZW50OiBNZXNzYWdlRXZlbnQpOiB2b2lkIHtcclxuICAgIGNvbnN0IHsgcGF5bG9hZCwgbWVzc2FnZVR5cGUgfTogTWVzc2FnZSA9IGV2ZW50LmRhdGE7XHJcbiAgICBjb25zdCBoYW5kbGVycyA9IHtcclxuICAgICAgLi4udGhpcy5oYW5kbGVycyxcclxuICAgICAgZGVmYXVsdDogKCkgPT4gY29uc29sZS5sb2coJ1VucmVjb2duaXplZCBtZXNzYWdlIGZvciB0aGUgc2hlbGwuJywgZXZlbnQpXHJcbiAgICB9O1xyXG5cclxuICAgIChoYW5kbGVyc1ttZXNzYWdlVHlwZV0gfHwgaGFuZGxlcnMuZGVmYXVsdCkocGF5bG9hZCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHBvc3RNZXNzYWdlVG9TaGVsbChtZXNzYWdlVHlwZTogTWVzc2FnZVR5cGUsIHBheWxvYWQ6IFBheWxvYWQpOiB2b2lkIHtcclxuICAgIGNvbnN0IG1lc3NhZ2U6IE1lc3NhZ2UgPSB7IG1lc3NhZ2VUeXBlLCBwYXlsb2FkIH07XHJcbiAgICB3aW5kb3cucGFyZW50LndpbmRvdy5wb3N0TWVzc2FnZShtZXNzYWdlLCAnKicpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYW5kbGVDb2xvclNjaGVtZShjb2xvclNjaGVtZTogQ29sb3JTY2hlbWUpOiB2b2lkIHtcclxuICAgIHRoaXMuY29sb3JTY2hlbWVTdWJqZWN0Lm5leHQoY29sb3JTY2hlbWUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYW5kbGVMYW5ndWFnZShsYW5ndWFnZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB0aGlzLmxhbmd1YWdlU3ViamVjdC5uZXh0KGxhbmd1YWdlKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlTG9jYWxlKGxvY2FsZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB0aGlzLmxvY2FsZVN1YmplY3QubmV4dChsb2NhbGUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYW5kbGVUaGVtZSh0aGVtZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB0aGlzLnRoZW1lU3ViamVjdC5uZXh0KHRoZW1lKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlTmF2aWdhdGlvbih1cmw6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVCeVVybCh1cmwpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYW5kbGVBY3Rpb24oYWN0aW9uOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMuYWN0aW9uU3ViamVjdC5uZXh0KGFjdGlvbik7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhbmRsZUF1dGhlbnRpY2F0aW9uKHVzZXI6IFVzZXIpOiB2b2lkIHtcclxuICAgIGlmICh1c2VyPy5hY2Nlc3NfdG9rZW4pIHtcclxuICAgICAgdGhpcy5hdXRoU2VydmljZS5zdG9yZVVzZXJUb1Nlc3Npb25TdG9yYWdlKHVzZXIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5hdXRoU2VydmljZS5jbGVhclVzZXJGcm9tU2Vzc2lvblN0b3JhZ2UoKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmF1dGhTZXJ2aWNlLnJlbG9hZFBlcnNpc3RlZFVzZXJEYXRhKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhbmRsZVJlZGlyZWN0ZWRGcm9tTG9nSW4ocmVkaXJlY3RlZDogYm9vbGVhbikge1xyXG4gICAgdGhpcy5yZWRpcmVjdGVkRnJvbUxvZ0luLm5leHQocmVkaXJlY3RlZCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==