import { __decorate } from "tslib";
import { Injectable } from "@angular/core";
import { TranslationManagementService } from "./translation-management.service";
import { ThemeService } from "./theme.service";
import { Subject } from "rxjs";
import { MessageType, } from "./message.model";
import * as i0 from "@angular/core";
import * as i1 from "./translation-management.service";
import * as i2 from "./theme.service";
import * as ɵngcc0 from '@angular/core';
let ChildCommunicationService = class ChildCommunicationService {
    constructor(translationManagementService, themeService) {
        this.translationManagementService = translationManagementService;
        this.themeService = themeService;
        this.handlers = {
            [MessageType.login]: (url) => this.handleLogin(url),
            [MessageType.navigation]: (url) => this.handleNavigation(url),
            [MessageType.action]: (action) => this.handleAction(action),
            [MessageType.registration]: (_) => this.handleRegistration(),
        };
        this.actionSubject = new Subject();
        this.navigationSubject = new Subject();
        this.loginSubject = new Subject();
        this.registrationCompletedSubject = new Subject();
        this.action$ = this.actionSubject;
        /**
         * Observable tracking url to navigate to
         */
        this.navigation$ = this.navigationSubject;
        /**
         * Observable tracking url for login
         * Url for login provided by child application
         */
        this.login$ = this.loginSubject;
        /**
         * Observable tracking child registration
         * Emits true if registration was successful, false otherwise
         */
        this.registrationCompleted$ = this
            .registrationCompletedSubject;
        window.addEventListener("message", (event) => this.onMessage(event));
        this.themeService.themeChanged.subscribe(() => this.postThemeToChildren());
    }
    /**
     * Sends message to child about locale
     */
    notifyChildAboutLocale(country) {
        this.postMessageToChild(MessageType.locale, country);
    }
    /**
     * Sends message to child about language
     */
    notifyChildAboutLanguage(language) {
        this.postMessageToChild(MessageType.language, language);
    }
    /**
     * Sends message to child about action
     */
    notifyChildAboutAction(action) {
        this.postMessageToChild(MessageType.action, action);
    }
    /**
     * Sends message to child about navigation
     */
    notifyChildAboutNavigation(url) {
        this.postMessageToChild(MessageType.navigation, url);
    }
    /**
     * Sends messages to children about current user
     */
    postAuthenticationDataToChildren() {
        const payload = {
            refresh_token: sessionStorage.getItem("refresh_token"),
            access_token: sessionStorage.getItem("access_token"),
            id_token: sessionStorage.getItem("id_token"),
            refresh_token_expires_at: Number(sessionStorage.getItem("refresh_token_expires_at")),
            access_token_expires_at: Number(sessionStorage.getItem("access_token_expires_at")),
            access_token_stored_at: Number(sessionStorage.getItem("access_token_stored_at")),
            username: sessionStorage.getItem("username"),
            name: sessionStorage.getItem("name"),
            roles: JSON.parse(sessionStorage.getItem("roles")),
        };
        this.postMessageToChild(MessageType.authentication, payload);
    }
    /**
     * Sends messages to children about selected application theme
     */
    postThemeToChildren() {
        const theme = this.themeService.getCurrentTheme();
        this.postMessageToChild(MessageType.theme, theme);
    }
    /**
     * Sends messages to children about selected language
     */
    postLanguageToChildren() {
        this.postMessageToChild(MessageType.language, this.translationManagementService.language);
    }
    /**
     * Sends messages to children about selected country
     */
    postLocaleToChildren() {
        const country = localStorage.getItem("country");
        this.postMessageToChild(MessageType.locale, country);
    }
    /**
     * Sends message to child about redirection from idb
     */
    postRedirectedFromLogIn(payload) {
        this.postMessageToChild(MessageType.redirectedFromLogIn, payload);
    }
    /**
     * Sends message to children about color scheme
     */
    postColorSchemeToChildren() {
        const computedStyle = window.getComputedStyle(document.body);
        const productColor = computedStyle.getPropertyValue("--avl-product-color");
        const productHoverColor = computedStyle.getPropertyValue("--avl-product-hover-color");
        const productFocusColor = computedStyle.getPropertyValue("--avl-product-focus-color");
        const colorScheme = {
            "--avl-product-color": productColor,
            "--avl-product-hover-color": productHoverColor,
            "--avl-product-focus-color": productFocusColor,
        };
        this.postMessageToChild(MessageType.colorScheme, colorScheme);
    }
    handleAction(action) {
        this.actionSubject.next(action);
    }
    handleNavigation(navigation) {
        this.navigationSubject.next(navigation);
    }
    handleLogin(login) {
        this.loginSubject.next(login);
    }
    // when child started its registration iframe is loaded and shell gets a message that he can send messages to iframe
    handleRegistration() {
        this.iframeEl = document.getElementsByTagName("iframe")[0];
        this.postThemeToChildren();
        this.postColorSchemeToChildren();
        this.postLanguageToChildren();
        this.postLocaleToChildren();
        this.registrationCompletedSubject.next(true);
    }
    onMessage(event) {
        const { payload, messageType } = event.data;
        const handlers = Object.assign(Object.assign({}, this.handlers), { default: () => console.log("Unrecognized message for the child.", event) });
        (handlers[messageType] || handlers.default)(payload);
    }
    postMessageToChild(messageType, payload) {
        var _a;
        if (!this.iframeEl) {
            return;
        }
        const message = { messageType, payload };
        (_a = this.iframeEl.contentWindow) === null || _a === void 0 ? void 0 : _a.postMessage(message, "*");
    }
};
ChildCommunicationService.ɵfac = function ChildCommunicationService_Factory(t) { return new (t || ChildCommunicationService)(ɵngcc0.ɵɵinject(TranslationManagementService), ɵngcc0.ɵɵinject(ThemeService)); };
ChildCommunicationService.ctorParameters = () => [
    { type: TranslationManagementService },
    { type: ThemeService }
];
ChildCommunicationService.ɵprov = i0.ɵɵdefineInjectable({ factory: function ChildCommunicationService_Factory() { return new ChildCommunicationService(i0.ɵɵinject(i1.TranslationManagementService), i0.ɵɵinject(i2.ThemeService)); }, token: ChildCommunicationService, providedIn: "root" });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ChildCommunicationService, [{
        type: Injectable,
        args: [{
                providedIn: "root"
            }]
    }], function () { return [{ type: TranslationManagementService }, { type: ThemeService }]; }, null); })();
export { ChildCommunicationService };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hpbGQtY29tbXVuaWNhdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlcyI6WyJuZzovQGF2bC1zZXJ2aWNlcy9uZy1zZXJ2aWNlcy9saWIvY2hpbGQtY29tbXVuaWNhdGlvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQ2hGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBQUUsT0FBTyxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQzNDLE9BQU8sRUFJTCxXQUFXLEdBR1osTUFBTSxpQkFBaUIsQ0FBQztBQUN6QjtBQUdBO0FBRVk7O0FBRFosSUFBYSx5QkFBeUIsR0FBdEMsTUFBYSx5QkFBeUI7QUFDdEMsSUFrQ0UsWUFDVSw0QkFBMEQsRUFDMUQsWUFBMEI7QUFDbkMsUUFGUyxpQ0FBNEIsR0FBNUIsNEJBQTRCLENBQThCO0FBQUMsUUFDM0QsaUJBQVksR0FBWixZQUFZLENBQWM7QUFDdEMsUUFyQ1UsYUFBUSxHQUFvQjtBQUN0QyxZQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsR0FBVyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQztBQUMvRCxZQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsR0FBVyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxDQUFDO0FBQ3pFLFlBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFjLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDO0FBQ3ZFLFlBQUksQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxD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eUIsQ0FtTXJDOzs7OEdBQ0Q7O0FBcE5BLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBSUEsQUFBQSxBQUdBLEFBQUEsQUFBQSxBQUFBLEFBS0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBbUNBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFEQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQXBDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUlBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFFQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFHQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFHQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBTUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUVBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFFQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBRUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUVBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFFQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBRUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUVBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBRUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUVBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFFQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBL0pBLEFBQUEsQUFDQSxBQUFBLEFBckNBLEFBQUEsQUFIQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBbU1BLEFBbk1BLEFBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgVHJhbnNsYXRpb25NYW5hZ2VtZW50U2VydmljZSB9IGZyb20gXCIuL3RyYW5zbGF0aW9uLW1hbmFnZW1lbnQuc2VydmljZVwiO1xyXG5pbXBvcnQgeyBUaGVtZVNlcnZpY2UgfSBmcm9tIFwiLi90aGVtZS5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7IFN1YmplY3QsIE9ic2VydmFibGUgfSBmcm9tIFwicnhqc1wiO1xyXG5pbXBvcnQge1xyXG4gIENvbG9yU2NoZW1lLFxyXG4gIE1lc3NhZ2UsXHJcbiAgTWVzc2FnZUhhbmRsZXJzLFxyXG4gIE1lc3NhZ2VUeXBlLFxyXG4gIFBheWxvYWQsXHJcbiAgVXNlcixcclxufSBmcm9tIFwiLi9tZXNzYWdlLm1vZGVsXCI7XHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogXCJyb290XCIsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDaGlsZENvbW11bmljYXRpb25TZXJ2aWNlIHtcclxuICBwcml2YXRlIGhhbmRsZXJzOiBNZXNzYWdlSGFuZGxlcnMgPSB7XHJcbiAgICBbTWVzc2FnZVR5cGUubG9naW5dOiAodXJsOiBzdHJpbmcpID0+IHRoaXMuaGFuZGxlTG9naW4odXJsKSxcclxuICAgIFtNZXNzYWdlVHlwZS5uYXZpZ2F0aW9uXTogKHVybDogc3RyaW5nKSA9PiB0aGlzLmhhbmRsZU5hdmlnYXRpb24odXJsKSxcclxuICAgIFtNZXNzYWdlVHlwZS5hY3Rpb25dOiAoYWN0aW9uOiBzdHJpbmcpID0+IHRoaXMuaGFuZGxlQWN0aW9uKGFjdGlvbiksXHJcbiAgICBbTWVzc2FnZVR5cGUucmVnaXN0cmF0aW9uXTogKF8pID0+IHRoaXMuaGFuZGxlUmVnaXN0cmF0aW9uKCksXHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSBhY3Rpb25TdWJqZWN0ID0gbmV3IFN1YmplY3Q8c3RyaW5nPigpO1xyXG4gIHByaXZhdGUgbmF2aWdhdGlvblN1YmplY3QgPSBuZXcgU3ViamVjdDxzdHJpbmc+KCk7XHJcbiAgcHJpdmF0ZSBsb2dpblN1YmplY3QgPSBuZXcgU3ViamVjdDxzdHJpbmc+KCk7XHJcbiAgcHJpdmF0ZSByZWdpc3RyYXRpb25Db21wbGV0ZWRTdWJqZWN0ID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcclxuXHJcbiAgcHJvdGVjdGVkIGlmcmFtZUVsOiBIVE1MSUZyYW1lRWxlbWVudDtcclxuXHJcbiAgcHVibGljIGFjdGlvbiQ6IE9ic2VydmFibGU8c3RyaW5nPiA9IHRoaXMuYWN0aW9uU3ViamVjdDtcclxuXHJcbiAgLyoqXHJcbiAgICogT2JzZXJ2YWJsZSB0cmFja2luZyB1cmwgdG8gbmF2aWdhdGUgdG9cclxuICAgKi9cclxuICBwdWJsaWMgbmF2aWdhdGlvbiQ6IE9ic2VydmFibGU8c3RyaW5nPiA9IHRoaXMubmF2aWdhdGlvblN1YmplY3Q7XHJcblxyXG4gIC8qKlxyXG4gICAqIE9ic2VydmFibGUgdHJhY2tpbmcgdXJsIGZvciBsb2dpblxyXG4gICAqIFVybCBmb3IgbG9naW4gcHJvdmlkZWQgYnkgY2hpbGQgYXBwbGljYXRpb25cclxuICAgKi9cclxuICBwdWJsaWMgbG9naW4kOiBPYnNlcnZhYmxlPHN0cmluZz4gPSB0aGlzLmxvZ2luU3ViamVjdDtcclxuXHJcbiAgLyoqXHJcbiAgICogT2JzZXJ2YWJsZSB0cmFja2luZyBjaGlsZCByZWdpc3RyYXRpb25cclxuICAgKiBFbWl0cyB0cnVlIGlmIHJlZ2lzdHJhdGlvbiB3YXMgc3VjY2Vzc2Z1bCwgZmFsc2Ugb3RoZXJ3aXNlXHJcbiAgICovXHJcbiAgcHVibGljIHJlZ2lzdHJhdGlvbkNvbXBsZXRlZCQ6IE9ic2VydmFibGU8Ym9vbGVhbj4gPSB0aGlzXHJcbiAgICAucmVnaXN0cmF0aW9uQ29tcGxldGVkU3ViamVjdDtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHRyYW5zbGF0aW9uTWFuYWdlbWVudFNlcnZpY2U6IFRyYW5zbGF0aW9uTWFuYWdlbWVudFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIHRoZW1lU2VydmljZTogVGhlbWVTZXJ2aWNlXHJcbiAgKSB7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgKGV2ZW50KSA9PiB0aGlzLm9uTWVzc2FnZShldmVudCkpO1xyXG4gICAgdGhpcy50aGVtZVNlcnZpY2UudGhlbWVDaGFuZ2VkLnN1YnNjcmliZSgoKSA9PiB0aGlzLnBvc3RUaGVtZVRvQ2hpbGRyZW4oKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZW5kcyBtZXNzYWdlIHRvIGNoaWxkIGFib3V0IGxvY2FsZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBub3RpZnlDaGlsZEFib3V0TG9jYWxlKGNvdW50cnk6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgdGhpcy5wb3N0TWVzc2FnZVRvQ2hpbGQoTWVzc2FnZVR5cGUubG9jYWxlLCBjb3VudHJ5KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlbmRzIG1lc3NhZ2UgdG8gY2hpbGQgYWJvdXQgbGFuZ3VhZ2VcclxuICAgKi9cclxuICBwdWJsaWMgbm90aWZ5Q2hpbGRBYm91dExhbmd1YWdlKGxhbmd1YWdlOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMucG9zdE1lc3NhZ2VUb0NoaWxkKE1lc3NhZ2VUeXBlLmxhbmd1YWdlLCBsYW5ndWFnZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZW5kcyBtZXNzYWdlIHRvIGNoaWxkIGFib3V0IGFjdGlvblxyXG4gICAqL1xyXG4gIHB1YmxpYyBub3RpZnlDaGlsZEFib3V0QWN0aW9uKGFjdGlvbjogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB0aGlzLnBvc3RNZXNzYWdlVG9DaGlsZChNZXNzYWdlVHlwZS5hY3Rpb24sIGFjdGlvbik7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZW5kcyBtZXNzYWdlIHRvIGNoaWxkIGFib3V0IG5hdmlnYXRpb25cclxuICAgKi9cclxuICBwdWJsaWMgbm90aWZ5Q2hpbGRBYm91dE5hdmlnYXRpb24odXJsOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMucG9zdE1lc3NhZ2VUb0NoaWxkKE1lc3NhZ2VUeXBlLm5hdmlnYXRpb24sIHVybCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZW5kcyBtZXNzYWdlcyB0byBjaGlsZHJlbiBhYm91dCBjdXJyZW50IHVzZXJcclxuICAgKi9cclxuICBwdWJsaWMgcG9zdEF1dGhlbnRpY2F0aW9uRGF0YVRvQ2hpbGRyZW4oKSB7XHJcbiAgICBjb25zdCBwYXlsb2FkOiBVc2VyID0ge1xyXG4gICAgICByZWZyZXNoX3Rva2VuOiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicmVmcmVzaF90b2tlblwiKSxcclxuICAgICAgYWNjZXNzX3Rva2VuOiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwiYWNjZXNzX3Rva2VuXCIpLFxyXG4gICAgICBpZF90b2tlbjogc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcImlkX3Rva2VuXCIpLFxyXG4gICAgICByZWZyZXNoX3Rva2VuX2V4cGlyZXNfYXQ6IE51bWJlcihcclxuICAgICAgICBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicmVmcmVzaF90b2tlbl9leHBpcmVzX2F0XCIpXHJcbiAgICAgICksXHJcbiAgICAgIGFjY2Vzc190b2tlbl9leHBpcmVzX2F0OiBOdW1iZXIoXHJcbiAgICAgICAgc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcImFjY2Vzc190b2tlbl9leHBpcmVzX2F0XCIpXHJcbiAgICAgICksXHJcbiAgICAgIGFjY2Vzc190b2tlbl9zdG9yZWRfYXQ6IE51bWJlcihcclxuICAgICAgICBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwiYWNjZXNzX3Rva2VuX3N0b3JlZF9hdFwiKVxyXG4gICAgICApLFxyXG4gICAgICB1c2VybmFtZTogc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInVzZXJuYW1lXCIpLFxyXG4gICAgICBuYW1lOiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwibmFtZVwiKSxcclxuICAgICAgcm9sZXM6IEpTT04ucGFyc2Uoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVzXCIpKSxcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5wb3N0TWVzc2FnZVRvQ2hpbGQoTWVzc2FnZVR5cGUuYXV0aGVudGljYXRpb24sIHBheWxvYWQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VuZHMgbWVzc2FnZXMgdG8gY2hpbGRyZW4gYWJvdXQgc2VsZWN0ZWQgYXBwbGljYXRpb24gdGhlbWVcclxuICAgKi9cclxuICBwdWJsaWMgcG9zdFRoZW1lVG9DaGlsZHJlbigpOiB2b2lkIHtcclxuICAgIGNvbnN0IHRoZW1lID0gdGhpcy50aGVtZVNlcnZpY2UuZ2V0Q3VycmVudFRoZW1lKCk7XHJcbiAgICB0aGlzLnBvc3RNZXNzYWdlVG9DaGlsZChNZXNzYWdlVHlwZS50aGVtZSwgdGhlbWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VuZHMgbWVzc2FnZXMgdG8gY2hpbGRyZW4gYWJvdXQgc2VsZWN0ZWQgbGFuZ3VhZ2VcclxuICAgKi9cclxuICBwdWJsaWMgcG9zdExhbmd1YWdlVG9DaGlsZHJlbigpOiB2b2lkIHtcclxuICAgIHRoaXMucG9zdE1lc3NhZ2VUb0NoaWxkKFxyXG4gICAgICBNZXNzYWdlVHlwZS5sYW5ndWFnZSxcclxuICAgICAgdGhpcy50cmFuc2xhdGlvbk1hbmFnZW1lbnRTZXJ2aWNlLmxhbmd1YWdlXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VuZHMgbWVzc2FnZXMgdG8gY2hpbGRyZW4gYWJvdXQgc2VsZWN0ZWQgY291bnRyeVxyXG4gICAqL1xyXG4gIHB1YmxpYyBwb3N0TG9jYWxlVG9DaGlsZHJlbigpOiB2b2lkIHtcclxuICAgIGNvbnN0IGNvdW50cnkgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImNvdW50cnlcIik7XHJcbiAgICB0aGlzLnBvc3RNZXNzYWdlVG9DaGlsZChNZXNzYWdlVHlwZS5sb2NhbGUsIGNvdW50cnkpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VuZHMgbWVzc2FnZSB0byBjaGlsZCBhYm91dCByZWRpcmVjdGlvbiBmcm9tIGlkYlxyXG4gICAqL1xyXG4gIHB1YmxpYyBwb3N0UmVkaXJlY3RlZEZyb21Mb2dJbihwYXlsb2FkOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICB0aGlzLnBvc3RNZXNzYWdlVG9DaGlsZChNZXNzYWdlVHlwZS5yZWRpcmVjdGVkRnJvbUxvZ0luLCBwYXlsb2FkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlbmRzIG1lc3NhZ2UgdG8gY2hpbGRyZW4gYWJvdXQgY29sb3Igc2NoZW1lXHJcbiAgICovXHJcbiAgcHVibGljIHBvc3RDb2xvclNjaGVtZVRvQ2hpbGRyZW4oKTogdm9pZCB7XHJcbiAgICBjb25zdCBjb21wdXRlZFN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuYm9keSk7XHJcbiAgICBjb25zdCBwcm9kdWN0Q29sb3IgPSBjb21wdXRlZFN0eWxlLmdldFByb3BlcnR5VmFsdWUoXCItLWF2bC1wcm9kdWN0LWNvbG9yXCIpO1xyXG4gICAgY29uc3QgcHJvZHVjdEhvdmVyQ29sb3IgPSBjb21wdXRlZFN0eWxlLmdldFByb3BlcnR5VmFsdWUoXHJcbiAgICAgIFwiLS1hdmwtcHJvZHVjdC1ob3Zlci1jb2xvclwiXHJcbiAgICApO1xyXG4gICAgY29uc3QgcHJvZHVjdEZvY3VzQ29sb3IgPSBjb21wdXRlZFN0eWxlLmdldFByb3BlcnR5VmFsdWUoXHJcbiAgICAgIFwiLS1hdmwtcHJvZHVjdC1mb2N1cy1jb2xvclwiXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IGNvbG9yU2NoZW1lOiBDb2xvclNjaGVtZSA9IHtcclxuICAgICAgXCItLWF2bC1wcm9kdWN0LWNvbG9yXCI6IHByb2R1Y3RDb2xvcixcclxuICAgICAgXCItLWF2bC1wcm9kdWN0LWhvdmVyLWNvbG9yXCI6IHByb2R1Y3RIb3ZlckNvbG9yLFxyXG4gICAgICBcIi0tYXZsLXByb2R1Y3QtZm9jdXMtY29sb3JcIjogcHJvZHVjdEZvY3VzQ29sb3IsXHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMucG9zdE1lc3NhZ2VUb0NoaWxkKE1lc3NhZ2VUeXBlLmNvbG9yU2NoZW1lLCBjb2xvclNjaGVtZSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhbmRsZUFjdGlvbihhY3Rpb246IHN0cmluZyk6IHZvaWQge1xyXG4gICAgdGhpcy5hY3Rpb25TdWJqZWN0Lm5leHQoYWN0aW9uKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlTmF2aWdhdGlvbihuYXZpZ2F0aW9uOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMubmF2aWdhdGlvblN1YmplY3QubmV4dChuYXZpZ2F0aW9uKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlTG9naW4obG9naW46IHN0cmluZyk6IHZvaWQge1xyXG4gICAgdGhpcy5sb2dpblN1YmplY3QubmV4dChsb2dpbik7XHJcbiAgfVxyXG5cclxuICAvLyB3aGVuIGNoaWxkIHN0YXJ0ZWQgaXRzIHJlZ2lzdHJhdGlvbiBpZnJhbWUgaXMgbG9hZGVkIGFuZCBzaGVsbCBnZXRzIGEgbWVzc2FnZSB0aGF0IGhlIGNhbiBzZW5kIG1lc3NhZ2VzIHRvIGlmcmFtZVxyXG4gIHByaXZhdGUgaGFuZGxlUmVnaXN0cmF0aW9uKCk6IHZvaWQge1xyXG4gICAgdGhpcy5pZnJhbWVFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFxyXG4gICAgICBcImlmcmFtZVwiXHJcbiAgICApWzBdIGFzIEhUTUxJRnJhbWVFbGVtZW50O1xyXG5cclxuICAgIHRoaXMucG9zdFRoZW1lVG9DaGlsZHJlbigpO1xyXG4gICAgdGhpcy5wb3N0Q29sb3JTY2hlbWVUb0NoaWxkcmVuKCk7XHJcbiAgICB0aGlzLnBvc3RMYW5ndWFnZVRvQ2hpbGRyZW4oKTtcclxuICAgIHRoaXMucG9zdExvY2FsZVRvQ2hpbGRyZW4oKTtcclxuXHJcbiAgICB0aGlzLnJlZ2lzdHJhdGlvbkNvbXBsZXRlZFN1YmplY3QubmV4dCh0cnVlKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgb25NZXNzYWdlKGV2ZW50OiBNZXNzYWdlRXZlbnQpOiB2b2lkIHtcclxuICAgIGNvbnN0IHsgcGF5bG9hZCwgbWVzc2FnZVR5cGUgfTogTWVzc2FnZSA9IGV2ZW50LmRhdGE7XHJcbiAgICBjb25zdCBoYW5kbGVycyA9IHtcclxuICAgICAgLi4udGhpcy5oYW5kbGVycyxcclxuICAgICAgZGVmYXVsdDogKCkgPT4gY29uc29sZS5sb2coXCJVbnJlY29nbml6ZWQgbWVzc2FnZSBmb3IgdGhlIGNoaWxkLlwiLCBldmVudCksXHJcbiAgICB9O1xyXG5cclxuICAgIChoYW5kbGVyc1ttZXNzYWdlVHlwZV0gfHwgaGFuZGxlcnMuZGVmYXVsdCkocGF5bG9hZCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHBvc3RNZXNzYWdlVG9DaGlsZChtZXNzYWdlVHlwZTogTWVzc2FnZVR5cGUsIHBheWxvYWQ6IFBheWxvYWQpOiB2b2lkIHtcclxuICAgIGlmICghdGhpcy5pZnJhbWVFbCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbWVzc2FnZTogTWVzc2FnZSA9IHsgbWVzc2FnZVR5cGUsIHBheWxvYWQgfTtcclxuICAgIHRoaXMuaWZyYW1lRWwuY29udGVudFdpbmRvdz8ucG9zdE1lc3NhZ2UobWVzc2FnZSwgXCIqXCIpO1xyXG4gIH1cclxufVxyXG4iXX0=